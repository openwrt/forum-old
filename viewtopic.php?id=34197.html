<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT on DSL router (with serial output)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p154753">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						20 Jan 2012, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>I have a DSL router Aztech DSL605EU. It appears to be a Infinion 7100 processor running Linux 2.4. Is there much info on this platform?</p><p>PSPBoot1.4 rev: 1.4.0.4<br />BusyBox v0.61.pre (2007.04.25-05:50+0000) multi-call binary</p><p>Memory<br /></p><div class="codebox"><pre><code>(psbl) fa
Current Flash Allocation:

section :   PSBL, base : 0xb0000000, size :      64992 bytes
section :    ENV, base : 0xb0010000, size :      65535 bytes

unallocated Space Start: 0xb0020000
unallocated Space End  : 0xb0200000</code></pre></div><div class="codebox"><pre><code>(psbl) printenv

BUILD_OPS       0x301
bootloaderVersion       1.4.0.4
ProductID       AR7RD
HWRevision      Unknown
SerialNumber    none
IPA             192.168.1.1
MAC_PORT        0
MEMSZ           0x00800000
FLASHSZ         0x00200000
MODETTY0        9600,n,8,1,hw
MODETTY1        9600,n,8,1,hw
CPUFREQ         211968000
MIPSFREQ        211968000
SYSFREQ         105984000
BOOTCFG         m:f:&quot;mtd1&quot;
PROMPT          (psbl)
mtd2            0x90000000,0x90010000
mtd3            0x90010000,0x90020000
mtd4            0x90020000,0x90200000
StaticBuffer    120
vcc_encaps0     0.0
vcc_encaps1     0.0
vcc_encaps2     0.0
vcc_encaps3     0.0
vcc_encaps4     0.0
vcc_encaps5     0.0
vcc_encaps6     0.0
vcc_encaps7     0.0
usb_vid         0x0451
usb_pid         0x6060
mtd1            0x90020090,0x9009c000
mtd0            0x9009c000,0x90200000
autopvc_enable  1
pppoe_relay_enabled     1
sar_ipacemax    6
DSL_BIT_TMODE   1
DSL_UPG_DONE    1
DSL_FEATURE_CNTL_0      0x400002</code></pre></div><p>BOOT (Most of it at least I think since I don&#039;t know how to capture the scrolling text easily)<br /></p><div class="codebox"><pre><code>Basic POST completed...     Success.
Last reset cause: Hardware reset (Power-on reset)

PSPBoot1.4 rev: 1.4.0.4
(c) Copyright 2002-2005 Texas Instruments, Inc. All Rights Reserved.

Press ESC for monitor... 1

(psbl) 

Booting...
Launching kernel decompressor.
Starting LZMA Uncompression Algorithm.
Copyright (C) 2003 Texas Instruments Incorporated; Copyright (C) 1999-2003 Igor Pavlov.
Compressed file is LZMA format.
Kernel decompressor was successful ... launching kernel.

LINUX started...
Config serial console: ttyS0,9600
Auto Detection OHIO chip
This SOC has MDIX cababilities on chip.
CPU revision is: 00018448
Primary instruction cache 16kb, linesize 16 bytes (4 ways)
Primary data cache 8kb, linesize 16 bytes (4 ways)
Number of TLB entries 16.
Linux version 2.4.17_mvl21-malta-mips_fp_le (shanice@rdfwdev2) (gcc version 2.95.3 20010315 (release/MontaVista)) #1 Wed Apr 25 13:47:03 SGT 2007
Determined physical RAM map:
 memory: 14000000 @ 00000000 (reserved)
 memory: 00020000 @ 14000000 (ROM data)
 memory: 007e0000 @ 14020000 (usable)
On node 0 totalpages: 2048
zone(0): 2048 pages.
zone(1): 0 pages.
zone(2): 0 pages.
Kernel command line: 
calculating r4koff... 00102c00(1059840)
CPU frequency 211.97 MHz
Calibrating delay loop... 211.35 BogoMIPS
Freeing Adam2 reserved memory [0x14001000,0x0001f000]
Memory: 6248k/8192k available (1559k kernel code, 1944k reserved, 99k data, 60k init)
Dentry-cache hash table entries: 1024 (order: 1, 8192 bytes)
Inode-cache hash table entries: 512 (order: 0, 4096 bytes)
Mount-cache hash table entries: 512 (order: 0, 4096 bytes)
Buffer-cache hash table entries: 1024 (order: 0, 4096 bytes)
Page-cache hash table entries: 2048 (order: 1, 8192 bytes)
Checking for &#039;wait&#039; instruction...  unavailable.
POSIX conformance testing by UNIFIX
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
TI Optimizations: Allocating TI-Cached Memory Pool.
Using 120 Buffers for TI-Cached Memory Pool.
DEBUG: Using Hybrid Mode.
NSP Optimizations: Succesfully allocated TI-Cached Memory Pool.
Initializing RT netlink socket
DEBUG: Starting ksoftirqd with ALWAYS_SOFTIRQ:0x3 NON ALWAYS SOFTIRQ:0xfffffffc.
DEBUG: Starting ksoftirqd with priority:0 policy:0 nice:19.
Starting kswapd
Disabling the Out Of Memory Killer
devfs: v1.7 (20011216) Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x1
pty: 32 Unix98 ptys configured
Serial driver version 5.05c (2001-07-08) with no serial options enabled
ttyS00 at 0xa8610e00 (irq = 15) is a 16550A
block: 64 slots per queue, batch=16
Initializing the TI QoS NSP Framework.
DEBUG: Initializing the Network Queue Manager Algorithms.
DEBUG: Initialization of the Translation Unit.
DEBUG: Initializing the LOCAL High Priority Database Module. 
DEBUG: Initialization of the LOCAL High Priority Database Module successful..
Succesfully Initialized the TI QoS NSP Framework.
CPMAC Auto Detect Enabled: detected internal PHY .
Error getting CPMAC Configuration params for instance:0
Environment Variable:MACCFG_A not set in bootloader
Setting Default configuration params for CPMAC instance:0

 MAC CFG : Tx Interrupts off , threshold : 20 
Default Asymmetric MTU for eth0 1500
TI CPMAC Linux DDA version 1.9 - CPMAC DDC version 0.3
Cpmac: Installed 1 instances.
Cpmac driver is allocating buffer memory at init time.
PPP generic driver version 2.4.1
avalanche flash device: 0x400000 at 0x10000000.
Physically mapped flash:0: Found 1 x16 devices at 0x200000 in 16-bit mode
 Amd/Fujitsu Extended Query Table v1.0 at 0x0040
number of CFI chips: 2
Debug : Flash Type : 2

Avalanche: No single image format found. Using mtd env variables
Looking for mtd device :mtd0:
Avalanche: Adding a mtd0 image (0x9c000), with size (0x164000).
Creating 1 MTD partitions on &quot;Physically mapped flash:0&quot;:
0x0009c000-0x00200000 : &quot;mtd0&quot;
mtd: partition &quot;mtd0&quot; doesn&#039;t start on an erase block boundary -- force read-only
Avalanche:      linking partition mtd0: mtd0 -&gt; ../../mtdblock/0
Looking for mtd device :mtd1:
Avalanche: Adding a mtd1 image (0x20090), with size (0x7bf70).
Creating 1 MTD partitions on &quot;Physically mapped flash:0&quot;:
0x00020090-0x0009c000 : &quot;mtd1&quot;
mtd: partition &quot;mtd1&quot; doesn&#039;t start on an erase block boundary -- force read-only
Avalanche:      linking partition mtd1: mtd1 -&gt; ../../mtdblock/1
Looking for mtd device :mtd2:
Avalanche: Adding a mtd2 image (0x0), with size (0x10000).
Creating 1 MTD partitions on &quot;Physically mapped flash:0&quot;:
0x00000000-0x00010000 : &quot;mtd2&quot;
Avalanche:      linking partition mtd2: mtd2 -&gt; ../../mtdblock/2
Looking for mtd device :mtd3:
Avalanche: Adding a mtd3 image (0x10000), with size (0x10000).
Creating 1 MTD partitions on &quot;Physically mapped flash:0&quot;:
0x00010000-0x00020000 : &quot;mtd3&quot;
Avalanche:      linking partition mtd3: mtd3 -&gt; ../../mtdblock/3
Looking for mtd device :mtd4:
Avalanche: Adding a mtd4 image (0x20000), with size (0x1e0000).
Creating 1 MTD partitions on &quot;Physically mapped flash:0&quot;:
0x00020000-0x00200000 : &quot;mtd4&quot;
Avalanche:      linking partition mtd4: mtd4 -&gt; ../../mtdblock/4
Looking for mtd device :mtd5:
InitLast login: Thu Jan 19 18:33:24 on ttys001
ip_tables: (C) 2000-2002 Netfilter core team
netfilter PSD loaded - (c) astaro AG
NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.
NET4: Ethernet Bridge 008 for NET4.0
Initializing the WAN Bridge.
Please set the MAC Address for the WAN Bridge.
Set the Environment variable &#039;wan_br_mac&#039;. 
MAC Address should be in the following format: xx.xx.xx.xx.xx.xx
VFS: Mounted root (squashfs filesystem) readonly.
Mounted devfs on /dev
Freeing unused kernel memory: 60k freed
serial console detected.  Disabling virtual terminals.
console=/dev/tts/0
init started:  BusyBox v0.61.pre (2007.04.25-05:50+0000) multi-call binary
Starting pid 9, console /dev/tts/0: &#039;/etc/init.d/rcS&#039;
Algorithmics/MIPS FPU Emulator v1.5
ledcfg: reading Standard Configuration File /etc/led.conf
ledcfg: configured 19 states
Using /lib/modules/2.4.17_mvl21-malta-mips_fp_le/kernel/net/core/aztech_ppp/aztech_ppp.o
Using /lib/modules/2.4.17_mvl21-malta-mips_fp_le/kernel/drivers/net/avalanche_usb/avalanche_usb.o
USB: Entering USB_init_module.
USB Driver built for RNDIS-CDC protocols.
Error getting protocol configuration from bootloader environment.
Defaulting to &quot;RNDIS-CDC&quot; mode.
VID = 0x451
PID = 0x6060
No Serial Number String present.
Manufacturer = Texas Instruments                      
Product description = Texas Instruments CDC Ethernet/RNDIS Adapter        
USB: Entering USB_Init.
USB: Leaving USB_Init.
Default Asymmetric MTU for usb0 1500
USB: Leaving USB_init_module.
Using /lib/modules/2.4.17_mvl21-malta-mips_fp_le/kernel/drivers/atm/tiatm.o
registered device TI Avalanche SAR
Ohio250(7200/7100A2) detected
DSP binary filesize = 385738 bytes
tn7dsl_init : env var DSL_BIT_TMODE is set
Texas Instruments ATM driver: version:[7.03.01.00]
Waiting for enter to start &#039;/bin/sh&#039; (pid 80, terminal /dev/tts/0)

Please press Enter to activate this console. SIOCGIFFLAGS: No such device
SIOCGIFFLAGS: No such device
SIOCGIFFLAGS: No such device
resolver: configuration tree:
Sep  8 12:00:19 cfgmgr(sar):  Could not get oam_ping_interval from boot loader env 
Sep  8 12:00:19 cfgmgr(sar):  Trying to retreive the value from Configuration 
Sep  8 12:00:19 cfgmgr(sar): oamPingInterval(20)(20)
Sep  8 12:00:20 cfgmgr(pppoe-104): Valid Configuration Tree
PVC dB
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
vpi = -1 vci = -1 in_use = 0
Doing BRCTL ...
addbr br0 
Doing BRCTL ...
addbr br1 
Sep  8 12:00:20 cfgmgr(resolver): stat successfull for /etc/resolv.Default Asymmetric MTU for br0 1500
conf.
Sep  8 12:00:20 cfgmgr(resolver): Resolver Polling Timer Started succesfully.
Sep  8 12:00:20 cfgmgr(sntp): NTP Polling Timer for DHCP Started succesfully.
Sep  8 12:00:20 cfgmgr(sar): DSL Polling Timer Started succesfully.
SeDefault Asymmetric MTU for br1 1500
p  8 12:00:20 cfgmgr(fdb): Firewall NAT service started
Sep  8 12:00:20 cfgmgr(pppoe-104): del_iptable_rules : ppp_name not intact 
Sep  8 12:00:20 cfgmgr(dBridge Multicasting for br0 is now Enabled.
dnsclient): updateall_servers : No children found for conn:
Sep  8 12:00:20 cfgmgr(lanbridge0): Bridge Created: br0
Doing BRCTL ...
setfilter br0 0 
Doing BRCTL ...
addif br0 eth0 
Doing BRCTL ...
addif br0 usb0 
Sep  8 12:00:21 cfgmgr(lanbridge1): Bridge Created: br1
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
Bridge Multicasting for br1 is now Enabled.
device usb0 entered promiscuous mode
Doing BRCTL ...
setfilter br1 0 
Doing BRCTL ...
stp br0 off 
Sep  8 12:00:21 cfgmgr(lanbridge0): Bridge Interface Added: eth0
Doing BRCTL ...
setfilter br0 0 
Doing BRCTL ...
stp br1 off 
Sep  8 12:00:22 cfgmgr(lanbridge0): Bridge Interface Added: usb0
br0: port 2(usb0) entering learning state
Doing BRCTL ...
setfilter br0 0 
br0: port 1(eth0) entering forwarding state
br0: topology change detected, propagating
br0: port 2(usb0) entering forwarding state
br0: topology change detected, propagating
Sep  8 12:00:30 cfgmgr(sar): DSL Carrier is down
Sep  8 12:00:30 cfgmgr(pppoe-104): del_iptable_rules : ppp_name not intact</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154759">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						20 Jan 2012, 03:36					</div>
				</div>
				<div class="post-content content">
					<p>Okay, so this is a AR7, I should be able to TFTP some custom firmware and load this to the boot loader and flash the image. Hopefully this will work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154761">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						20 Jan 2012, 07:44					</div>
				</div>
				<div class="post-content content">
					<p>Okay,</p><p>Here is my current partitioning:</p><p>I need to make a Openwrt image small enough to fit this. I have only been able to make one that&#039;s 2.1 MB. Are there any directions on shrinking it anymore? I&#039;ve removed everything to do with wireless from the image.</p><div class="codebox"><pre><code>mtd1            0x90020090,0x9009c000
mtd0            0x9009c000,0x90200000
mtd2            0x90000000,0x90010000
mtd3            0x90010000,0x90020000
mtd4            0x90020000,0x90200000</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154821">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						20 Jan 2012, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve removed all the references to wireless compat. Are there any other methods to slim down an image? make kernel_menuconfig does not have a lot of visible options to remove. I even tried to remove dnsmasq but it didn&#039;t seem to contribute to any change in size.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154848">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						21 Jan 2012, 05:55					</div>
				</div>
				<div class="post-content content">
					<p>So it errors when I try to flash the image. FTP says it worked but it shows this under the serial connection once it finishes</p><div class="codebox"><pre><code>Press ESC for monitor... 2
(psbl) FlashEraseBlock(b0020000,b01fffff);
..............................
..............................ERROR: Store to media failed</code></pre></div><p>I&#039;ve seen a bunch of incomplete information about creating a magical size for the partitions so that it doesn&#039;t fail. Nothing very useful to determine how so.</p><p>Boots saying</p><div class="codebox"><pre><code>[    4.530000] List of all partitions:
[    4.570000] 1f00              64 mtdblock0  (driver?)
[    4.640000] 1f01              64 mtdblock1  (driver?)
[    4.700000] 1f02            1920 mtdblock2  (driver?)
[    4.760000] 1f03            1024 mtdblock3  (driver?)
[    4.820000] No filesystem could mount root, tried:  squashfs
[    4.890000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,3)
[    4.990000] Rebooting in 3 seconds..</code></pre></div>											<p class="post-edited">(Last edited by <strong>napierzaza</strong> on 21 Jan 2012, 05:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154849">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						21 Jan 2012, 08:03					</div>
				</div>
				<div class="post-content content">
					<p>the kernel can be striped down way more..........</p><p>check this out as a refrence <a href="http://www.telnet.bg/openwrt/kernel-con">http://www.telnet.bg/openwrt/kernel-con</a> â€¦ .10-r16500</p><p>NOTE: This config is not for the ar7.... use it as a refrence for you&#039;r build</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154900">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						21 Jan 2012, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>Cool thanks. But the link didn&#039;t work!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>