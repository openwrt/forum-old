<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> A couple of problems after installing OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p160862">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						14 Mar 2012, 18:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi, my name is lostpacket and I was hit by OpenWRT</p><p>Searched a bit through the Google to see if there are users with problems like mine but didn&#039;t succeed <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Ok, let&#039;s explain what are they:</p><p>1. Installed <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a> on TP-LINK TL-WR1043ND, v.1.8, through the System Tools &gt; Firmware upgrade. All seemed ok, but ...<br />2. ... after the reboot there wasn&#039;t a Web UI. Sum&#039;d 2+2 and installed LuCI. Everything was fine except that ...<br />3. ... the interface doesn&#039;t load after each reboot. Checked that the uhttpd is in StartUp list - yes, it is there, LuCI too. Everytime after reboot I must manually start the web server with /etc/init.d/uhttpd start ... Ok, moving on to the next ...<br />4. ... problem. Found that after reboot the access to the router is randomed. For example sometimes it allows access only through telnet, sometimes through the SSH. The interesting part is that SSH waits only for the default root password, nevertheless it was changed at first telnet session after the installation. Goto 5<br />:5. Read this tutorial for USB - <a href="http://h-wrt.com/en/doc/flash">http://h-wrt.com/en/doc/flash</a> . Everything seems fine (in Web UI, under Mount there are /dev/sda1 as SWAP &#039;64MB, /dev/sda2 as RootFS &#039;64MB, /dev/sda3 as /home &#039;7700MB), but sometimes after reboot I&#039;ve got error while trying to do mount_root. Yes, I must mount that manually (weird) so I can use the Web UI. Go go go to the next problem ...<br />6. Affirmative! Or not ... My main goal is to use OpenWRT on this TP-LINK as git/sqlite server, just for hobbyist goals, nothing special. It is behind another WR1043ND, in which I setup ports from 1 to 65000 to be forwarded to the OpenWRT. This range is the only one active, DMZ is stopped too, same with DHCP server. Doh, it&#039;s not working, not possible to connect to the OpenWRT (no ping replies). SSH is enabled with Dropbear WAN checkbox in Web UI.</p><p>The scheme is this:</p><p>Internet ---&gt; [main router with internal address 192.168.1.1] --- &#039;cable from main router&#039; switch to OpenWRT wan&#039; ---&gt; [OpenWRT with static address 192.168.1.3]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--- &#039;cable from main router&#039; switch to the network card&#039; ---&gt; [my pc with static address 192.168.1.2]</p><p>So if I want to connect to OpenWRT, I must disconnect the cable from it&#039;s WAN port and connect the cable from my pc to one of its switch ports.</p><p>Can someone help me in this deadly situation?</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 14 Mar 2012, 19:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160896">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>So no one has some ideas where&#039;s the problem with connecting? I already flushed the iptables, put a new cable between the pc and the router, but nothing changed <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Only got a ping replies.</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 15 Mar 2012, 02:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160920">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						15 Mar 2012, 11:28					</div>
				</div>
				<div class="post-content content">
					<p>and what&#039;s the lan-subnet of your openwrt-router ...&nbsp; 192.168.1.0/24? <br />if that&#039;s the case that&#039;s the problem. <br />the openwrt-router thinks that this subnet is reachable through both interfaces, so it&#039;s sending out packages on the wan or lan interface depending on the metric of the interface. but only one interface is actually connected to your lan... so hmm... how should this work?<br />If the second router should act as a dump AP, please configure it as <a href="http://wiki.openwrt.org/doc/recipes/dumbap">dump AP</a>. You can even use the wan-port as lan-port, it&#039;s only seperated by the switch vlan-config.<br />If it should act as a router/firewall use another subnet on its lan.</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 15 Mar 2012, 11:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160926">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 12:50					</div>
				</div>
				<div class="post-content content">
					<p>Yes. The main problem became bigger yesterday. Now I can&#039;t access the router through telnet or ssh in normal mode, only through telnet in failsafe <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />I did nothing - just powered it on and bang, nobody home. Router was tested before installing OpenWRT, reached above 78MB/s transfer LAN-LAN and around 60MB/s LAN-WAN.</p><div class="quotebox"><blockquote><p>f the second router should act as a dump AP, please configure it as dump AP</p></blockquote></div><div class="quotebox"><blockquote><p>My main goal is to use OpenWRT on this TP-LINK as git/sqlite server</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 15 Mar 2012, 12:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160928">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						15 Mar 2012, 13:15					</div>
				</div>
				<div class="post-content content">
					<p>having the same subnet on lan and wan doesn&#039;t work and makes a lot of problem. that you can&#039;t reach it now is one of it. </p><p>So don&#039;t do it! <br />You can run whatever you want on this device (but you probably will have issues with git on a device with only 32MB ram). <br />But this means you don&#039;t need any routing or firewall dhcp stuff on the router - so ok you are right, the network config isn&#039;t a dump AP it&#039;s a dump switch, but the dump AP config will be fine, just don&#039;t configure the wifi </p><p>So don&#039;t configure the wan-interface (remove it from /etc/config/network), just configure lan and connect a lan-port of your openwrtbox to the mainrouter. and disable dhcp and filewall (like in the dump AP document)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160929">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 13:25					</div>
				</div>
				<div class="post-content content">
					<p>What are the commands to do your advice, so I&#039;ll be safe against human errors? Thanks in advance</p><p>uci delete network.wan will delete all .wan.*? Like wan.proto=dhcp, .wan.ifname=eth0.2, etc ?</p><br /><p>Edit: I deleted it but can&#039;t gain resolving on the router, just reaching only the main router address:</p><div class="quotebox"><blockquote><p>root@OpenWrt:~# ping 192.168.1.1<br />PING 192.168.1.1 (192.168.1.1): 56 data bytes<br />64 bytes from 192.168.1.1: seq=0 ttl=64 time=0.743 ms<br />64 bytes from 192.168.1.1: seq=1 ttl=64 time=0.437 ms<br />64 bytes from 192.168.1.1: seq=2 ttl=64 time=0.463 ms<br />64 bytes from 192.168.1.1: seq=3 ttl=64 time=0.455 ms<br />^C<br />--- 192.168.1.1 ping statistics ---<br />4 packets transmitted, 4 packets received, 0% packet loss<br />round-trip min/avg/max = 0.437/0.524/0.743 ms<br />root@OpenWrt:~# ping cnn.com<br />ping: bad address &#039;cnn.com&#039;<br />root@OpenWrt:~# ping 8.8.8.8<br />PING 8.8.8.8 (8.8.8.8): 56 data bytes<br />ping: sendto: Network is unreachable</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 15 Mar 2012, 14:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160964">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>Ok, another up cause things became too weird even for Chuck Norris.</p><div class="quotebox"><blockquote><p>root@OpenWrt:~# ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr F8:D1:11:7F:7B:DE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.3&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:31 errors:0 dropped:2 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1802 (1.7 KiB)&nbsp; TX bytes:0 (0.0 B)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr F8:D1:11:7F:7B:DE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:900 errors:0 dropped:0 overruns:91796 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:417 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:191779 (187.2 KiB)&nbsp; TX bytes:47997 (46.8 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4</p><p>eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr F8:D1:11:7F:7B:DE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:194 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:54804 (53.5 KiB)&nbsp; TX bytes:264 (264.0 B)</p><p>eth0.2&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr F8:D1:11:7F:7B:DE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.10&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:678 errors:0 dropped:6 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:412 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:111222 (108.6 KiB)&nbsp; TX bytes:45026 (43.9 KiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2876 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2876 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:196064 (191.4 KiB)&nbsp; TX bytes:196064 (191.4 KiB)</p></blockquote></div><p>Now I have ping replies from Google DNS 8.8.8.8 through WAN port. i&#039;m also connecting to it since it is not possible to connect over SSH or Telnet through its LAN port (192.168.1.3)</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 15 Mar 2012, 17:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160973">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						15 Mar 2012, 18:30					</div>
				</div>
				<div class="post-content content">
					<p>omg you have wan and lan on the same subnet??? -.-</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160987">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 20:09					</div>
				</div>
				<div class="post-content content">
					<p>Omg, yes. Not my fault, OpenWRT was installed with this configuration in trunk version in the first post.</p><p>I have about 20 + 20 routers, all with DD-WRT, which are working like that - cable from router1 LAN port to router2 WAN port and no problems.<br />But for OpenWRT I wasted around 2 days in reading to have WebUI and Internet access. Not cool.</p><p>Anyway the version now is &#039;openwrt-ar71xx-generic-tl-wr1043nd-v1-jffs2-factory&#039;, which gave me a lot of no access headache ... And I&#039;m sure after power off or restart the router will show again the same issues.</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 15 Mar 2012, 20:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160989">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						15 Mar 2012, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>why on earth did you installed jffs2 version?? BTW, also with stock firmware you have lan on 1.1, if you connect it to a dhcp server that gives 1.x addresses, it&#039;s not firmware&#039;s fault -.-</p><p>you should have installed backfire if you want GUI preinstalled, it&#039;s not that hard to understand!</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 15 Mar 2012, 20:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160990">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						15 Mar 2012, 20:47					</div>
				</div>
				<div class="post-content content">
					<p>Cause squashfs version STOPPED the access to the router even in Failsafe mode. Tried to connect from 3 different pcs on different network setups.<br />And at the first try SquashFS version did not receive DHCP lease, same happened with JFFS2.</p><p>Btw show me which one is not Backfire:<br /><a href="http://downloads.openwrt.org/backfire/10.03.1/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin">http://downloads.openwrt.org/backfire/1 … actory.bin</a><br /><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr1043nd-v1-jffs2-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161010">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						15 Mar 2012, 23:45					</div>
				</div>
				<div class="post-content content">
					<p>the images in folder backfire have Luci GUI, while in the trunk images in the snapshot folder you have to install your preferred GUI by yourself.</p><p>if you don&#039;t understand what WAN, LAN and subnets are, it&#039;s possible that your router does not work.</p><p>BTW it&#039;s likely that you have problems if you keep br-lan in the same subnet of the DHCP server you connected on WAN port</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 15 Mar 2012, 23:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161014">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						16 Mar 2012, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s working already, but noticed that /etc/resolv.conf doesn&#039;t save the nameservers and have some fear that after reboot it will revert to<br /></p><div class="quotebox"><blockquote><p>search lan<br />nameserver 127.0.0.1</p></blockquote></div><p>Anyway should I stick with JFFS2? Didn&#039;t notice a problems after installing UI ...</p><p>Edit: I was sure that /etc/resolv.conf will be reset.<br />Workaround is to change in /etc/config/dhcp </p><div class="quotebox"><blockquote><p>option resolvfile&nbsp; &nbsp;&nbsp; &#039;/tmp/resolv.conf.auto&#039;</p></blockquote></div><p>to point to another location with the file with already saved IPs of dns servers.</p><p>Using this in /etc/config/network<br /></p><div class="quotebox"><blockquote><p>config &#039;interface&#039; &#039;example&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039;&nbsp; &nbsp; &nbsp;&#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039;&nbsp; &nbsp; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039;&nbsp; &nbsp; &#039;192.168.1.200&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039;&nbsp; &nbsp;&#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;gateway&#039;&nbsp; &nbsp; &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; <strong><span class="bbu">option &#039;dns&#039;&nbsp; &nbsp; &#039;192.168.1.1&#039;</span></strong></p></blockquote></div><p>is not working! And I&#039;m sure cause 192.168.1.1 has properly setup DNS servers and it forwards requests too!</p><p>Son of a ...</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 16 Mar 2012, 02:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161554">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">lostpacket</div>
					<div class="post-datetime">
						20 Mar 2012, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>Can someone give me a clue why the following firewall rule blocks the access to the router (in this case SSH):</p><div class="codebox"><pre><code>config rule
        option src &#039;wan&#039;
        option src_ip &#039;!public dynamic ip&#039;
        option target &#039;DROP&#039;
        option name &#039;Blocks SSH access to router except for LAN&#039;
        option family &#039;ipv4&#039;
        option proto &#039;tcp udp&#039;
        option dest_port &#039;22&#039;</code></pre></div><p>I see the things like this:</p><p>Every packet that reaching port 22 on the WAN from a different network than &#039;public dynamic ip&#039; will be dropped. Am I correct?</p>											<p class="post-edited">(Last edited by <strong>lostpacket</strong> on 20 Mar 2012, 21:03)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>