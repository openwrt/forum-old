<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> L2TP over IPsec with PSK using racoon/xl2tpd</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 26 Mar 2018 and 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=30982&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=30982&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=30982&amp;p=4.html">4</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p170830">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">languagegame</div>
					<div class="post-datetime">
						24 Jun 2012, 19:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alfredlim wrote:</cite><blockquote><p>Sorry to bring up this thread.</p><p>Any idea what does this error means?</p><p>xl2tpd[6049]: control_finish: Peer requested tunnel 15 twice, ignoring second one.<br />xl2tpd[6049]: control_finish: Peer requested tunnel 15 twice, ignoring second one.<br />xl2tpd[6049]: Maximum retries exceeded for tunnel 17563.&nbsp; Closing.<br />xl2tpd[6049]: Connection 15 closed to x.x.x.x, port 61760 (Timeout)<br />xl2tpd[6049]: control_finish: Peer requested tunnel 15 twice, ignoring second one.<br />xl2tpd[6049]: Unable to deliver closing message for tunnel 17563. Destroying anyway.<br />xl2tpd[6049]: control_finish: Peer requested tunnel 15 twice, ignoring second one.<br />xl2tpd[6049]: Maximum retries exceeded for tunnel 14753.&nbsp; Closing.<br />xl2tpd[6049]: Connection 15 closed to x.x.x.x, port 61760 (Timeout)<br />xl2tpd[6049]: Unable to deliver closing message for tunnel 14753. Destroying anyway.</p><p>where x.x.x.x is my public ip address</p></blockquote></div><p>This means that setkey.conf was not run.&nbsp; Check the /etc/init.d/racoon script and make sure it passes the WAN IP address to setkey.conf when it executes it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170850">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">languagegame</div>
					<div class="post-datetime">
						25 Jun 2012, 00:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheCondor wrote:</cite><blockquote><p>Hi, someone can help me with strongswan+xl2tp? I can&#039;t use racoon because there aren&#039;t some package (like zlib, kmod-cbc and other) for my openwrt version (10.03.1 final on tplink wr1043nd).</p></blockquote></div><p>I was able to get this to work on 10.03.1 final on an WNDR3700.&nbsp; Trick is that two of the packages must be installed from the latest trunk.&nbsp; Rest of packages can be installed from the 10.03.1 final packages.</p><p>Specifically, install libopenssl and ip-sect tools from trunk (replace the hardware version, ar71xx, with your router version):<br /></p><div class="codebox"><pre><code>opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/libopenssl_1.0.1c-1_ar71xx.ipk
opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/ipsec-tools_0.8.0-2_ar71xx.ipk</code></pre></div><p>Then install these packages from 10.03.1 final:<br /></p><div class="codebox"><pre><code>opkg install kmod-ipsec4
opkg install iptables-mod-ipsec
opkg install kmod-crypto-authenc
opkg install xl2tpd</code></pre></div><p>This will install enough to get up and running.&nbsp; </p><p>You&#039;ll need to modify /etc/init.d/racoon though, as it references some items that don&#039;t apply in 10.03.1 final.<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common

START=49

start() {
  include /lib/network
  scan_interfaces
  wan_ip=&quot;$(uci_get_state network wan ipaddr)&quot;

  /etc/setkey.conf $wan_ip

  test -d /var/racoon || mkdir /var/racoon

  start-stop-daemon -S -x racoon
}

stop() {
  start-stop-daemon -K -q -x racoon
}</code></pre></div>											<p class="post-edited">(Last edited by <strong>languagegame</strong> on 25 Jun 2012, 08:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171177">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">Tu13es</div>
					<div class="post-datetime">
						28 Jun 2012, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>I think I&#039;ve got everything set up for this but I&#039;m still not able to connect via both my iPhone and Mac.&nbsp; I get a &quot;server not responding&quot; message.</p><p>I&#039;m not sure if the issue with racoon not running or a firewall issue.&nbsp; The racoon process is running, but I don&#039;t see a /var/log/racoon.txt.&nbsp; Should I be looking somewhere else?&nbsp; Where is this logfile defined?</p><p>I have the firewall rules configured like in the OP, but I&#039;m wondering if one of my zones is preventing it from working?&nbsp; Here&#039;s what I have:<br /></p><div class="quotebox"><blockquote><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option drop_invalid &#039;1&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p></blockquote></div><p>I&#039;m running arokh&#039;s WNDR3700 alternate build.&nbsp; I&#039;m assuming the L2TP packages in it are sufficient to run this VPN.&nbsp; Or do I need to manually install packages still?</p><p>Edit: This ended up being a problem with racoon that I have yet to solve, not a firewall issue.</p>											<p class="post-edited">(Last edited by <strong>Tu13es</strong> on 22 Oct 2012, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171429">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">netbus</div>
					<div class="post-datetime">
						3 Jul 2012, 15:51					</div>
				</div>
				<div class="post-content content">
					<p>My tunnel is not comming up cause I get &quot;avp is incorrect size&quot; message<br />I am trying to create a tunnel with an android smartphone<br /></p><div class="codebox"><pre><code>Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: handle_avps: handling avp&#039;s for tunnel 43998, call 0
Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: message_type_avp: message type 4 (Stop-Control-Connection-Notification)
Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: assigned_tunnel_avp: using peer&#039;s tunnel 24425
Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: result_code_avp: avp is incorrect size.  8 &lt; 10
Jul  3 14:48:46 Gateway daemon.warn xl2tpd[18375]: handle_avps: Bad exit status handling attribute 1 (Result Code) on mandatory packet.
Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: handle_packet: bad AVP handling!
Jul  3 14:48:46 Gateway daemon.debug xl2tpd[18375]: network_thread: bad packet</code></pre></div><p>anybody an idea?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179305">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">username2r</div>
					<div class="post-datetime">
						25 Sep 2012, 10:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Received&nbsp; &nbsp; Severity&nbsp; &nbsp; Tag&nbsp; &nbsp; Message&nbsp; &nbsp; <br />09/24/12 15:49:09&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Unable to deliver closing message for tunnel 44902. Destroying anyway.&nbsp; &nbsp; <br />09/24/12 15:49:04&nbsp; &nbsp; Info&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Connection 3 closed to XX.XX.XXX.XXX, port 57588 (Timeout)&nbsp; &nbsp; <br />09/24/12 15:49:04&nbsp; &nbsp; Notice&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Maximum retries exceeded for tunnel 44902.&nbsp; Closing.&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: KA remove: YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA deleted YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA expired YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: purged IPsec-SA proto_id=ESP spi=228808141.&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: deleting a generated policy.&nbsp; &nbsp; <br />09/24/12 15:49:01&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:53&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Unable to deliver closing message for tunnel 20249. Destroying anyway.&nbsp; &nbsp; <br />09/24/12 15:48:53&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:49&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:48&nbsp; &nbsp; Info&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Connection 3 closed to XX.XX.XXX.XXX, port 57588 (Timeout)&nbsp; &nbsp; <br />09/24/12 15:48:48&nbsp; &nbsp; Notice&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Maximum retries exceeded for tunnel 20249.&nbsp; Closing.&nbsp; &nbsp; <br />09/24/12 15:48:45&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:43&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: IPsec-SA established: ESP/Transport YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924] spi=228808141(0xda355cd)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: IPsec-SA established: ESP/Transport YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924] spi=45329826(0x2b3ada2)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adjusting peer&#039;s encmode UDP-Transport(4)-&gt;Transport(2)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adjusting my encmode UDP-Transport-&gt;Transport&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: no policy found, try to generate the policy : 192.168.1.3/32[57588] YY.YYY.YY.YY/32[1701] proto=udp dir=in&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: respond new phase 2 negotiation: YY.YYY.YY.YY[4500]&lt;=&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA established YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: purging spi=264787826.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: received INITIAL-CONTACT&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: KA list add: YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-T: ports changed to: XX.XX.XXX.XXX[43924]&lt;-&gt;YY.YYY.YY.YY[4500]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] NOTIFY: Using default PSK.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] ERROR: couldn&#039;t find the pskey for XX.XX.XXX.XXX.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adding remote and local NAT-D payloads.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [YY.YYY.YY.YY] INFO: Hashing YY.YYY.YY.YY[500] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Hashing XX.XX.XXX.XXX[61672] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT detected: PEER&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-D payload #1 doesn&#039;t match&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Hashing XX.XX.XXX.XXX[61672] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-D payload #0 verified&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [YY.YYY.YY.YY] INFO: Hashing YY.YYY.YY.YY[500] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Selected NAT-T version: RFC 3947&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: DPD&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-03&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-04&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-05&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-06&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-07&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-08&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: RFC 3947&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: begin Identity Protection mode.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: respond new phase 1 negotiation: YY.YYY.YY.YY[500]&lt;=&gt;XX.XX.XXX.XXX[61672]</p></blockquote></div><p>I cant connect from my iPad, above is the syslog from the period where I attempt. Can anyone help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181158">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">Tu13es</div>
					<div class="post-datetime">
						22 Oct 2012, 06:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>username2r wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Received&nbsp; &nbsp; Severity&nbsp; &nbsp; Tag&nbsp; &nbsp; Message&nbsp; &nbsp; <br />09/24/12 15:49:09&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Unable to deliver closing message for tunnel 44902. Destroying anyway.&nbsp; &nbsp; <br />09/24/12 15:49:04&nbsp; &nbsp; Info&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Connection 3 closed to XX.XX.XXX.XXX, port 57588 (Timeout)&nbsp; &nbsp; <br />09/24/12 15:49:04&nbsp; &nbsp; Notice&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Maximum retries exceeded for tunnel 44902.&nbsp; Closing.&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: KA remove: YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA deleted YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA expired YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: purged IPsec-SA proto_id=ESP spi=228808141.&nbsp; &nbsp; <br />09/24/12 15:49:02&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: deleting a generated policy.&nbsp; &nbsp; <br />09/24/12 15:49:01&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:53&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Unable to deliver closing message for tunnel 20249. Destroying anyway.&nbsp; &nbsp; <br />09/24/12 15:48:53&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:49&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:48&nbsp; &nbsp; Info&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Connection 3 closed to XX.XX.XXX.XXX, port 57588 (Timeout)&nbsp; &nbsp; <br />09/24/12 15:48:48&nbsp; &nbsp; Notice&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; Maximum retries exceeded for tunnel 20249.&nbsp; Closing.&nbsp; &nbsp; <br />09/24/12 15:48:45&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:43&nbsp; &nbsp; Debug&nbsp; &nbsp; xl2tpd[2395]&nbsp; &nbsp; control_finish: Peer requested tunnel 3 twice, ignoring second one.&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: IPsec-SA established: ESP/Transport YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924] spi=228808141(0xda355cd)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: IPsec-SA established: ESP/Transport YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924] spi=45329826(0x2b3ada2)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adjusting peer&#039;s encmode UDP-Transport(4)-&gt;Transport(2)&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adjusting my encmode UDP-Transport-&gt;Transport&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: no policy found, try to generate the policy : 192.168.1.3/32[57588] YY.YYY.YY.YY/32[1701] proto=udp dir=in&nbsp; &nbsp; <br />09/24/12 15:48:41&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: respond new phase 2 negotiation: YY.YYY.YY.YY[4500]&lt;=&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: ISAKMP-SA established YY.YYY.YY.YY[4500]-XX.XX.XXX.XXX[43924] spi:0da7a1945cb31062:65e3f5e2b144a172&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: purging spi=264787826.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: received INITIAL-CONTACT&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: KA list add: YY.YYY.YY.YY[4500]-&gt;XX.XX.XXX.XXX[43924]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-T: ports changed to: XX.XX.XXX.XXX[43924]&lt;-&gt;YY.YYY.YY.YY[4500]&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] NOTIFY: Using default PSK.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] ERROR: couldn&#039;t find the pskey for XX.XX.XXX.XXX.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: Adding remote and local NAT-D payloads.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [YY.YYY.YY.YY] INFO: Hashing YY.YYY.YY.YY[500] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Hashing XX.XX.XXX.XXX[61672] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT detected: PEER&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-D payload #1 doesn&#039;t match&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Hashing XX.XX.XXX.XXX[61672] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: NAT-D payload #0 verified&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [YY.YYY.YY.YY] INFO: Hashing YY.YYY.YY.YY[500] with algo #2 &nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; [XX.XX.XXX.XXX] INFO: Selected NAT-T version: RFC 3947&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: DPD&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-03&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-04&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-05&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-06&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-07&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-08&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: received Vendor ID: RFC 3947&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: begin Identity Protection mode.&nbsp; &nbsp; <br />09/24/12 15:48:40&nbsp; &nbsp; Info&nbsp; &nbsp; racoon&nbsp; &nbsp; INFO: respond new phase 1 negotiation: YY.YYY.YY.YY[500]&lt;=&gt;XX.XX.XXX.XXX[61672]</p></blockquote></div><p>I cant connect from my iPad, above is the syslog from the period where I attempt. Can anyone help?</p></blockquote></div><p>I&#039;m hitting the same thing on my iPhone.&nbsp; I also see the following line:</p><p>Oct 21 23:11:10 OpenWrt daemon.info racoon: ERROR: phase1 negotiation failed due to time up. e82e51960155b572:ca721a6e60ceec9c</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184020">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">mmhorda</div>
					<div class="post-datetime">
						22 Nov 2012, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone. sorry for double post.<br />How can i connect another router with openwt to this setup which is on first page?<br />thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184413">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">Dickie</div>
					<div class="post-datetime">
						27 Nov 2012, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>Can someone post a successful log from starting the racoon/xl2tpd , through to connecting a client please?&nbsp; <br />I&#039;m sure we could all figure out at least where the issues are if we had some point of reference.&nbsp; &nbsp;For example I can initiate the connection fine, but the last stage I get is;</p><p>racoon: INFO: KA list add:&nbsp; &nbsp;etc etc </p><p>then I never get anything else.&nbsp; So I&#039;m not sure if the problem is with my xl2tp config of firewall etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185409">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">rolfl</div>
					<div class="post-datetime">
						6 Dec 2012, 18:06					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a> doesn&#039;t have xl2tp package anymore.</p><p>Is there any other l2tp package that would work? If so what would need to be changed in the setup?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185413">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">phukit</div>
					<div class="post-datetime">
						6 Dec 2012, 19:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am trying to setup this IPSec VPN however I get this error for every package I try to install.</p><div class="codebox"><pre><code>Installing xl2tpd (1.3.1-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/xl2tpd_1.3.1-1_ar71xx.ipk.

                    Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for xl2tpd:
 *     kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) *     kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) * 
 * opkg_install_cmd: Cannot install package xl2tpd.</code></pre></div><p>I am on kernel 3.3.8 is it saying I need to update to 3.3.8-1?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186049">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">avbohemen</div>
					<div class="post-datetime">
						14 Dec 2012, 18:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rolfl wrote:</cite><blockquote><p><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a> doesn&#039;t have xl2tp package anymore.</p><p>Is there any other l2tp package that would work? If so what would need to be changed in the setup?</p></blockquote></div><p>xl2tpd is not in the downloads anymore because it fails to compile. See <a href="https://dev.openwrt.org/ticket/12577">https://dev.openwrt.org/ticket/12577</a> I just created a working patch, so hopefully it will be taken by the devs.</p><p>However, on the newer builds (kernel 3.6+) I have some trouble getting L2TP over IPsec to work automatically. </p><p>After a reboot, racoon wil not start, with an error in setkey.conf (&quot;pfkey_open: Address family not supported by protocol&quot;). This can be fixed by entering &quot;insmod af_key&quot;, but I&#039;m not really sure why that is not automatic anymore.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187849">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">Szczesny</div>
					<div class="post-datetime">
						4 Jan 2013, 10:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>avbohemen wrote:</cite><blockquote><p>After a reboot, racoon wil not start, with an error in setkey.conf (&quot;pfkey_open: Address family not supported by protocol&quot;). This can be fixed by entering &quot;insmod af_key&quot;, but I&#039;m not really sure why that is not automatic anymore.</p></blockquote></div><p>Hi,<br />I have solution for that.</p><p>The xfrm modules must be loaded before af_key. So, change content of /etc/modules.d/30-ipsec file to this one:<br />xfrm_ipcomp<br />xfrm_algo<br />xfrm_user<br />af_key</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188578">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">Szczesny</div>
					<div class="post-datetime">
						11 Jan 2013, 11:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi, <br />Ok, now I have the problem. Here is the log:<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: respond new phase 1 negotiation: xxWAN_IPxx[500]&lt;=&gt;xxREMOTE_IPxx[500]<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: begin Identity Protection mode.<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received Vendor ID: RFC 3947<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-00<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received broken Microsoft ID: FRAGMENTATION<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: received Vendor ID: DPD<br />Jan 11 10:38:58 bane daemon.info racoon: [xxREMOTE_IPxx] INFO: Selected NAT-T version: RFC 3947<br />Jan 11 10:38:58 bane daemon.info racoon: [xxWAN_IPxx] INFO: Hashing xxWAN_IPxx[500] with algo #2<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: NAT-D payload #0 verified<br />Jan 11 10:38:58 bane daemon.info racoon: [xxREMOTE_IPxx] INFO: Hashing xxREMOTE_IPxx[500] with algo #2<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: NAT-D payload #1 doesn&#039;t match<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: NAT detected: PEER<br />Jan 11 10:38:58 bane daemon.info racoon: [xxREMOTE_IPxx] INFO: Hashing xxREMOTE_IPxx[500] with algo #2<br />Jan 11 10:38:58 bane daemon.info racoon: [xxWAN_IPxx] INFO: Hashing xxWAN_IPxx[500] with algo #2<br />Jan 11 10:38:58 bane daemon.info racoon: INFO: Adding remote and local NAT-D payloads.<br />Jan 11 10:38:58 bane daemon.info racoon: [xxREMOTE_IPxx] ERROR: couldn&#039;t find the pskey for xxREMOTE_IPxx.<br />Jan 11 10:38:58 bane daemon.info racoon: [xxREMOTE_IPxx] NOTIFY: Using default PSK.<br />Jan 11 10:39:48 bane daemon.info racoon: ERROR: phase1 negotiation failed due to time up. 1d512a7e8de8fae5:9adf8602175e7a5d</p><br /><p>I&#039;m unable to connect via VPN. Does anyone have solution for that?</p><p>BR,<br />Rafal</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192621">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">dborca</div>
					<div class="post-datetime">
						20 Feb 2013, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>to people seeing racoon: [xxREMOTE_IPxx] ERROR: couldn&#039;t find the pskey for xxREMOTE_IPxx<br />and NOT seeing racoon: [xxREMOTE_IPxx] NOTIFY: Using default PSK.</p><p>Most probably racoon cannot find pre-shared key. PSK file has the following format:<br />IDENTIFIER1 SHAREDKEY1<br />IDENTIFIER2 SHAREDKEY2<br />...</p><p>Standard (non-patched) racoon does not recognize * as a wildcard IDENTIFIER.&nbsp; The patch is here:<br /><a href="https://dev.openwrt.org/browser/packages/net/ipsec-tools/patches/001-ipsec-tools-def-psk.patch">https://dev.openwrt.org/browser/package â€¦ -psk.patch</a></p><p>More troubleshooting:</p><p>P: tools complain about some protocol not being registered<br />S: make sure you have l2tp in /etc/services</p><p>P: racoon and xl2tpd started up, racoon connects but xl2tpd is not receiving anything<br />S: make sure you have the relevant kernel modules loaded.&nbsp; By relevant, I mean:<br />&nbsp; &nbsp; modprobe xfrm_user # ip xfrm policy<br />&nbsp; &nbsp; modprobe xt_policy # iptables ... -m policy<br />&nbsp; &nbsp; modprobe af_key # racoon<br />&nbsp; &nbsp; modprobe esp4 # racoon<br />&nbsp; &nbsp; modprobe xfrm4_mode_transport # racoon &lt;-&gt; xl2tpd</p><p>P: xl2tpd says something about &quot;Peer requested tunnel 22 twice, ignoring second one.&quot;<br />S: make sure you have the right policies<br />&nbsp; &nbsp; ip xfrm policy add src $WANIP dst 0.0.0.0/0 proto udp sport 1701 dir out tmpl proto esp mode transport level required<br />&nbsp; &nbsp; ip xfrm policy add src 0.0.0.0/0 dst $WANIP proto udp dport 1701 dir in tmpl proto esp mode transport level required</p><p>P: xl2tpd says something about &quot;LCP: timeout sending Config-Requests&quot;<br />S: make sure you have &quot;force userspace = yes&quot; in xl2tpd.conf<br />xl2tpd &lt;= v1.3.1 lies about &quot;IPsec SAref does not work with L2TP kernel mode yet, enabling forceuserspace=yes&quot;<br />Actually it does NOT force userspace.</p><p>P: Ok, I connected, but DNS is not responding<br />S: most probably the DNS daemon does not listen on the newly created pppX interface.</p><p>I would like to thank @arokh for his great tutorial which helped me a lot.&nbsp; I suggest he adds a troubleshooting section in the original post <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>-dborca</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192957">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">jol</div>
					<div class="post-datetime">
						23 Feb 2013, 21:25					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for this thread. I tried to set this up, using backfire 10.03.1 and the instructions in post #52 above (I am using openwrt-ar71xx-wndr3700-jffs2-sysupgrade), but did not succeed so far. There is one thing totally different in my setup, which is that I am running OpenWRT as an access point and bridge (including an OpenVPN bridge) behind another router and thus I am not using the WAN interface and firewall at all (so far). Of course I configured the other router to forward ESP, UDP ports 500, 4500, and 1701 to OpenWRT. In this setup, do I need to enter the external address (I am using `wget <a href="http://ipecho.net/plain">http://ipecho.net/plain</a> -O - -q ; echo` ) or the internal address in /etc/init.d/racoon? How can I enable debug output and where can I locate that? Any other issue to watch out for?<br />Thanks &amp; Best regards, jol</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202640">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">avbohemen</div>
					<div class="post-datetime">
						24 May 2013, 12:53					</div>
				</div>
				<div class="post-content content">
					<p>Ever since trunk got updated with iptables 1.4.18 and/or firewall3, I get the following errors in my firewall config, regarding this section:<br /></p><div class="quotebox"><blockquote><p># L2TP/ESP<br />config &#039;rule&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;_name&#039; &#039;L2TP ESP&#039;&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;1701&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;extra&#039; &#039;-m policy --strict --dir in --pol ipsec --proto esp&#039;</p></blockquote></div><p>After doing &quot;/etc/init.d/firewall reload&quot;, I get:<br /></p><div class="quotebox"><blockquote><p>Warning: Unable to locate ipset utility, disabling ipset support<br /> * Clearing IPv4 filter table<br /> * Clearing IPv4 nat table<br /> * Clearing IPv4 mangle table<br /> * Clearing IPv4 raw table<br /> * Populating IPv4 filter table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec NAT-T&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec IKE&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec ESP&#039;<br />&nbsp; &nbsp;* Rule &#039;L2TP ESP&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-Network-Printer&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-Ping&#039;<br />&nbsp; &nbsp;* Redirect &#039;Kerio-WebMail&#039;<br />&nbsp; &nbsp;* Redirect &#039;Kerio-IMAP&#039;<br />&nbsp; &nbsp;* Forward &#039;lan&#039; -&gt; &#039;wan&#039;<br /> * Populating IPv4 nat table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br />&nbsp; &nbsp;* Redirect &#039;Kerio-WebMail&#039;<br />&nbsp; &nbsp;* Redirect &#039;Kerio-IMAP&#039;<br /> * Populating IPv4 mangle table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br /> * Populating IPv4 raw table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br /> * Clearing IPv6 filter table<br /> * Clearing IPv6 mangle table<br /> * Clearing IPv6 raw table<br /> * Populating IPv6 filter table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec NAT-T&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec IKE&#039;<br />&nbsp; &nbsp;* Rule &#039;IPsec ESP&#039;<br />&nbsp; &nbsp;* Rule &#039;L2TP ESP&#039;<br /><strong>/usr/lib/iptables/libxt_policy.so: no &quot;policy&quot; extension found for this protocol<br />fw3_ipt_rule_append(): Can&#039;t find match &#039;policy&#039;</strong><br />&nbsp; &nbsp;* Rule &#039;Allow-Network-Printer&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp;* Rule &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp;* Rule &#039;Enforce-ULA-Border-Src&#039;<br />&nbsp; &nbsp;* Rule &#039;Enforce-ULA-Border-Dest&#039;<br />&nbsp; &nbsp;* Forward &#039;lan&#039; -&gt; &#039;wan&#039;<br /> * Populating IPv6 mangle table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br /> * Populating IPv6 raw table<br />&nbsp; &nbsp;* Zone &#039;lan&#039;<br />&nbsp; &nbsp;* Zone &#039;wan&#039;<br /> * Set tcp_ecn to off<br /> * Set tcp_syncookies to on<br /> * Set tcp_window_scaling to on<br /> * Running script &#039;/usr/share/miniupnpd/firewall.include&#039;</p></blockquote></div><p>The error only appears in the IPv6 section, and after adding &quot;option family ipv4&quot;, the rule works fine. It looks like a bug in firewall3 in to me. I also tried the old stanzas:<br /></p><div class="quotebox"><blockquote><p>iptables -A zone_wan_input -p udp -m policy --strict --dir in --pol ipsec --proto esp -m udp --dport 1701 -j ACCEPT<br />iptables -A zone_wan_input -m policy --strict --dir in --pol ipsec --proto esp -j REJECT</p></blockquote></div><p>and they work fine, even without a specific ipv4-only definition.&nbsp; For now I am adding these to /etc/firewall.user again, but I would like to know if these methods are the same before I file a ticket.</p>											<p class="post-edited">(Last edited by <strong>avbohemen</strong> on 24 May 2013, 13:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205133">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">xtdv</div>
					<div class="post-datetime">
						20 Jun 2013, 10:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I folowed the wiki page to setup VPN server with xl2tpd and openswan: <a href="http://wiki.openwrt.org/inbox/openswanxl2tpvpn">http://wiki.openwrt.org/inbox/openswanxl2tpvpn</a></p><p>Everything seem fine but my Windows machine connect to the router, this is the log I got:<br /></p><div class="codebox"><pre><code>Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: listening for IKE messages
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface eth0.2/eth0.2 10.84.0.184:500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface eth0.2/eth0.2 10.84.0.184:4500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface br-lan/br-lan 192.168.1.1:500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface br-lan/br-lan 192.168.1.1:4500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface lo/lo 127.0.0.1:500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: adding interface lo/lo 127.0.0.1:4500
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: loading secrets from &quot;/etc/ipsec.secrets&quot;
Jun 20 14:00:03 OpenWrt authpriv.warn pluto[3400]: loading secrets from &quot;/etc/ipsec.uci.secrets&quot;
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS NT5 ISAKMPOAKLEY 00000008]
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [RFC 3947] method set to=115 
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [draft-ietf-ipsec-nat-t-ike-02_n] meth=106, but already using method 115
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [FRAGMENTATION]
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS-Negotiation Discovery Capable]
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [Vid-Initial-Contact]
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [IKE CGA version 1]
Jun 20 14:00:09 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: initial Main Mode message received on 10.84.0.184:500 but no connection has been authorized with policy=PSK
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS NT5 ISAKMPOAKLEY 00000008]
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [RFC 3947] method set to=115 
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [draft-ietf-ipsec-nat-t-ike-02_n] meth=106, but already using method 115
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [FRAGMENTATION]
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS-Negotiation Discovery Capable]
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [Vid-Initial-Contact]
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [IKE CGA version 1]
Jun 20 14:00:10 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: initial Main Mode message received on 10.84.0.184:500 but no connection has been authorized with policy=PSK
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS NT5 ISAKMPOAKLEY 00000008]
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [RFC 3947] method set to=115 
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [draft-ietf-ipsec-nat-t-ike-02_n] meth=106, but already using method 115
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [FRAGMENTATION]
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS-Negotiation Discovery Capable]
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [Vid-Initial-Contact]
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [IKE CGA version 1]
Jun 20 14:00:12 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: initial Main Mode message received on 10.84.0.184:500 but no connection has been authorized with policy=PSK
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS NT5 ISAKMPOAKLEY 00000008]
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [RFC 3947] method set to=115 
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: received Vendor ID payload [draft-ietf-ipsec-nat-t-ike-02_n] meth=106, but already using method 115
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [FRAGMENTATION]
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [MS-Negotiation Discovery Capable]
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [Vid-Initial-Contact]
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: ignoring Vendor ID payload [IKE CGA version 1]
Jun 20 14:00:16 OpenWrt authpriv.warn pluto[3400]: packet from 10.84.0.203:500: initial Main Mode message received on 10.84.0.184:500 but no connection has been authorized with policy=PSK</code></pre></div><p>Could anyone please help me identify my problems? Thank you so much.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219564">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">kop48</div>
					<div class="post-datetime">
						10 Dec 2013, 06:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi folks,</p><p>I was wondering whether anyone would be able to shed any insight into why my IPSec tunnel isn&#039;t working. I&#039;m using Arokh&#039;s WNDR3700 alternate build which is supposedly configured for IPSec already. Unfortunately, I&#039;m getting the error below when I try to connect using my Mac. I can&#039;t figure out why - I&#039;ve checked racoon.conf and it&#039;s calling setkey from what I can see. However, I get an error about duplicate tunnels being requested, and the link is finally disconnected.</p><p><strong>Update: </strong> Evidently, I can&#039;t test things very well! :-/ It worked fine once I tried to connect from outside the network.</p><div class="codebox"><pre><code>Mon Dec  9 19:46:19 2013 daemon.debug xl2tpd[5494]: death_handler: Fatal signal 15 received
Mon Dec  9 19:46:19 2013 daemon.debug xl2tpd[6567]: setsockopt recvref[30]: Protocol not available
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6567]: Not looking for kernel support.
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: xl2tpd version xl2tpd-1.3.1 started on OpenWrt PID:6568
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: Written by Mark Spencer, Copyright (C) 1998, Adtran, Inc.
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: Forked by Scott Balmos and David Stipp, (C) 2001
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: Inherited by Jeff McAdams, (C) 2002
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: Forked again by Xelerance (www.xelerance.com) (C) 2006
Mon Dec  9 19:46:19 2013 daemon.info xl2tpd[6568]: Listening on IP address 0.0.0.0, port 1701
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: respond new phase 1 negotiation: xx.xx.xx.xx.xx[500]&lt;=&gt;192.168.1.182[500]
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: begin Identity Protection mode.
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: RFC 3947
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-08
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-07
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-06
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-05
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-04
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-03
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02

Mon Dec  9 19:46:25 2013 daemon.info racoon: [xx.xx.xx.xx.xx] INFO: Hashing xx.xx.xx.xx.xx[500] with algo #2 
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: NAT-D payload #0 verified
Mon Dec  9 19:46:25 2013 daemon.info racoon: [192.168.1.182] INFO: Hashing 192.168.1.182[500] with algo #2 
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: NAT-D payload #1 verified
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: NAT not detected 
Mon Dec  9 19:46:25 2013 daemon.info racoon: [192.168.1.182] INFO: Hashing 192.168.1.182[500] with algo #2 
Mon Dec  9 19:46:25 2013 daemon.info racoon: [xx.xx.xx.xx.xx] INFO: Hashing xx.xx.xx.xx.xx[500] with algo #2 
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: Adding remote and local NAT-D payloads.
Mon Dec  9 19:46:25 2013 daemon.info racoon: [192.168.1.182] ERROR: couldn&#039;t find the pskey for 192.168.1.182.
Mon Dec  9 19:46:25 2013 daemon.info racoon: [192.168.1.182] NOTIFY: Using default PSK.
Mon Dec  9 19:46:25 2013 daemon.info racoon: [192.168.1.182] INFO: received INITIAL-CONTACT
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: purging spi=213299205.
Mon Dec  9 19:46:25 2013 daemon.info racoon: INFO: ISAKMP-SA established xx.xx.xx.xx.xx[500]-192.168.1.182[500] spi:bef67780ab57fc68:d6cf27ee2a013141
Mon Dec  9 19:46:27 2013 daemon.info racoon: INFO: respond new phase 2 negotiation: xx.xx.xx.xx.xx[500]&lt;=&gt;192.168.1.182[500]
Mon Dec  9 19:46:27 2013 daemon.info racoon: INFO: Update the generated policy : 192.168.1.182/32[57808] xx.xx.xx.xx.xx/32[1701] proto=udp dir=in
Mon Dec  9 19:46:27 2013 daemon.info racoon: INFO: IPsec-SA established: ESP/Transport xx.xx.xx.xx.xx[500]-&gt;192.168.1.182[500] spi=261335155(0xf93a873)
Mon Dec  9 19:46:27 2013 daemon.info racoon: INFO: IPsec-SA established: ESP/Transport xx.xx.xx.xx.xx[500]-&gt;192.168.1.182[500] spi=197284226(0xbc25182)
Mon Dec  9 19:46:27 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:27 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:27 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:27 2013 daemon.none xl2tpd[6568]: control_finish: sending SCCRP
Mon Dec  9 19:46:29 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:29 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:29 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:29 2013 daemon.none xl2tpd[6568]: control_finish: Peer requested tunnel 5 twice, ignoring second one.
Mon Dec  9 19:46:29 2013 daemon.none xl2tpd[6568]: build_fdset: closing down tunnel 62959
Mon Dec  9 19:46:30 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:31 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:32 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: control_finish: Peer requested tunnel 5 twice, ignoring second one.
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: build_fdset: closing down tunnel 1234
Mon Dec  9 19:46:33 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:34 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:34 2013 daemon.error xl2tpd[6568]: Maximum retries exceeded for tunnel 57327.  Closing.
Mon Dec  9 19:46:34 2013 daemon.info xl2tpd[6568]: Connection 5 closed to 192.168.1.182, port 57808 (Timeout)
Mon Dec  9 19:46:35 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:36 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: control_finish: Peer requested tunnel 5 twice, ignoring second one.
Mon Dec  9 19:46:37 2013 daemon.none xl2tpd[6568]: build_fdset: closing down tunnel 18582
Mon Dec  9 19:46:38 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:39 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:39 2013 daemon.none xl2tpd[6568]: Unable to deliver closing message for tunnel 57327. Destroying anyway.
Mon Dec  9 19:46:41 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:41 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:41 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:41 2013 daemon.none xl2tpd[6568]: control_finish: sending SCCRP
Mon Dec  9 19:46:44 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: network_thread: recv packet from 192.168.1.182, size = 76, tunnel = 0, call = 0 ref=0 refhim=0
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: get_call: allocating new tunnel for host 192.168.1.182, port 57808.
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: control_finish: message type is Start-Control-Connection-Request(1).  Tunnel is 5, call is 0.
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: control_finish: Peer requested tunnel 5 twice, ignoring second one.
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: build_fdset: closing down tunnel 59973
Mon Dec  9 19:46:45 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:46 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:47 2013 daemon.info racoon: INFO: deleting a generated policy.
Mon Dec  9 19:46:47 2013 daemon.info racoon: INFO: purged IPsec-SA proto_id=ESP spi=197284226.
Mon Dec  9 19:46:47 2013 daemon.info racoon: INFO: ISAKMP-SA expired xx.xx.xx.xx.xx[500]-192.168.1.182[500] spi:bef67780ab57fc68:d6cf27ee2a013141
Mon Dec  9 19:46:47 2013 daemon.info racoon: INFO: ISAKMP-SA deleted xx.xx.xx.xx.xx[500]-192.168.1.182[500] spi:bef67780ab57fc68:d6cf27ee2a013141
Mon Dec  9 19:46:47 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:48 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:48 2013 daemon.error xl2tpd[6568]: Maximum retries exceeded for tunnel 65259.  Closing.
Mon Dec  9 19:46:48 2013 daemon.info xl2tpd[6568]: Connection 5 closed to 192.168.1.182, port 57808 (Timeout)
Mon Dec  9 19:46:49 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:50 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:51 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:52 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:53 2013 daemon.none xl2tpd[6568]: network_thread: select timeout
Mon Dec  9 19:46:53 2013 daemon.none xl2tpd[6568]: Unable to deliver closing message for tunnel 65259. Destroying anyway.</code></pre></div><p>Any help would be greatly appreciated!</p><p>Cheers,</p>											<p class="post-edited">(Last edited by <strong>kop48</strong> on 23 Feb 2014, 20:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226087">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">morganfw</div>
					<div class="post-datetime">
						23 Feb 2014, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I&#039;ve compiled latest trunk r39719 with all packages and custom files required on the 1st post.<br />/etc/init.d/racoon was modified with following options to acquire WAN IP on /etc/setkey.conf:<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2009-2011 OpenWrt.org
# Copyright (C) 2011 Artem Makhutov

START=49

SERVICE_USE_PID=1

start() {
        wan_ip=&quot;$(uci get network.wan.ipaddr)&quot;
        mkdir -m 0700 -p /var/racoon
       [ -f /etc/ipsec.conf ] &amp;&amp; /usr/sbin/setkey -f /etc/ipsec.conf
        /etc/setkey.conf $wan_ip
        service_start /usr/sbin/racoon -f /etc/racoon.conf
}

stop() {
        service_stop /usr/sbin/racoon
}</code></pre></div><p>/etc/setkey.conf was chmoded 755 and I&#039;ve restarted racoon and xl2tpd, with following error:<br /></p><div class="codebox"><pre><code>Sun Feb 23 18:42:32 2014 daemon.crit xl2tpd[17155]: setsockopt recvref[30]: Protocol not available</code></pre></div><p>Now I&#039;ve issues with VPN connection from my Android 4.4.2 device, log report following message:<br /></p><div class="codebox"><pre><code>Sun Feb 23 18:16:37 2014 daemon.debug xl2tpd[16118]: result_code_avp: avp is incorrect size.  8 &lt; 10
Sun Feb 23 18:16:37 2014 daemon.warn xl2tpd[16118]: handle_avps: Bad exit status handling attribute 1 (Result Code) on mandatory packet.</code></pre></div><p>and VPN disconnect.</p><p>Any suggestion?<br />Regards.</p>											<p class="post-edited">(Last edited by <strong>morganfw</strong> on 23 Feb 2014, 19:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226101">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">morganfw</div>
					<div class="post-datetime">
						23 Feb 2014, 21:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>morganfw wrote:</cite><blockquote><p>Hi all,<br />I&#039;ve compiled latest trunk r39719 with all packages and custom files required on the 1st post.<br />/etc/init.d/racoon was modified with following options to acquire WAN IP on /etc/setkey.conf:<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2009-2011 OpenWrt.org
# Copyright (C) 2011 Artem Makhutov

START=49

SERVICE_USE_PID=1

start() {
        wan_ip=&quot;$(uci get network.wan.ipaddr)&quot;
        mkdir -m 0700 -p /var/racoon
       [ -f /etc/ipsec.conf ] &amp;&amp; /usr/sbin/setkey -f /etc/ipsec.conf
        /etc/setkey.conf $wan_ip
        service_start /usr/sbin/racoon -f /etc/racoon.conf
}

stop() {
        service_stop /usr/sbin/racoon
}</code></pre></div><p>/etc/setkey.conf was chmoded 755 and I&#039;ve restarted racoon and xl2tpd, with following error:<br /></p><div class="codebox"><pre><code>Sun Feb 23 18:42:32 2014 daemon.crit xl2tpd[17155]: setsockopt recvref[30]: Protocol not available</code></pre></div><p>Now I&#039;ve issues with VPN connection from my Android 4.4.2 device, log report following message:<br /></p><div class="codebox"><pre><code>Sun Feb 23 18:16:37 2014 daemon.debug xl2tpd[16118]: result_code_avp: avp is incorrect size.  8 &lt; 10
Sun Feb 23 18:16:37 2014 daemon.warn xl2tpd[16118]: handle_avps: Bad exit status handling attribute 1 (Result Code) on mandatory packet.</code></pre></div><p>and VPN disconnect.</p><p>Any suggestion?<br />Regards.</p></blockquote></div><p>I&#039;ve found the issue, so I&#039;ve commented out in file /etc/ppp/options.xl2tpd following line:<br /></p><div class="codebox"><pre><code>#dump</code></pre></div><p>then restarted racoon and xl2tpd, now VPN works like a charm with my Android 4.4.2 device!!! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>PS: In PPPD manual page both options dryrun and dump are described as follow:</p><p><strong>dryrun</strong><br /><em>With the dryrun option, pppd will print out all the option values which have been set and then exit, after parsing the command line and options files and checking the option values, but before initiating the link. The option values are logged at level info, and also printed to standard output unless the device on standard output is the device that pppd would be using to communicate with the peer.</em></p><p><strong>dump</strong><br /><em>With the dump option, pppd will print out all the option values which have been set. This option is like the dryrun option except that pppd proceeds as normal rather than exiting.</em></p>											<p class="post-edited">(Last edited by <strong>morganfw</strong> on 23 Feb 2014, 23:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228228">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">nlh</div>
					<div class="post-datetime">
						23 Mar 2014, 09:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>morganfw wrote:</cite><blockquote><p>...<br />I&#039;ve found the issue, so I&#039;ve commented out in file /etc/ppp/options.xl2tpd following line:<br /></p><div class="codebox"><pre><code>#dump</code></pre></div><p>...</p></blockquote></div><p>The &quot;#dump&quot; and &quot;#dryrun&quot; options can sometimes cause pppd to crash.&nbsp; You&#039;ll turn on these debugging options to try to figure out why your connections are not working, but end up causing other problems instead.</p><p>See: <a href="http://patchwork.openwrt.org/patch/3245/">http://patchwork.openwrt.org/patch/3245/</a></p>											<p class="post-edited">(Last edited by <strong>nlh</strong> on 23 Mar 2014, 09:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228719">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">morganfw</div>
					<div class="post-datetime">
						28 Mar 2014, 22:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nlh wrote:</cite><blockquote><div class="quotebox"><cite>morganfw wrote:</cite><blockquote><p>...<br />I&#039;ve found the issue, so I&#039;ve commented out in file /etc/ppp/options.xl2tpd following line:<br /></p><div class="codebox"><pre><code>#dump</code></pre></div><p>...</p></blockquote></div><p>The &quot;#dump&quot; and &quot;#dryrun&quot; options can sometimes cause pppd to crash.&nbsp; You&#039;ll turn on these debugging options to try to figure out why your connections are not working, but end up causing other problems instead.</p><p>See: <a href="http://patchwork.openwrt.org/patch/3245/">http://patchwork.openwrt.org/patch/3245/</a></p></blockquote></div><p>Thx nlh, I&#039;ll try install your patch and recompile OpenWrt on my WNDR3700.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228748">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">morganfw</div>
					<div class="post-datetime">
						29 Mar 2014, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>@nlh<br />I&#039;ve applied patch and build again trunk r40296 for WNDR3700 kernel 3.10.34, but with dump enabled VPN doesn&#039;t start.<br />With #dump disabled all works fine!<br />Any suggestion?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228801">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">nlh</div>
					<div class="post-datetime">
						30 Mar 2014, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>@morganfw<br />No idea.&nbsp; I&#039;ll give it a try w/ racoon tomorrow.&nbsp; &nbsp;What does &quot;logread&quot; show when you try to connect?&nbsp; Does it perform the dump as expected from pppd, or does pppd stop abruptly?&nbsp; Can you post the /etc/ppp/options.xl2tpd file you are using (from when it fails) in case there is some other option in there that is causing a crash?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228912">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">morganfw</div>
					<div class="post-datetime">
						31 Mar 2014, 22:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nlh wrote:</cite><blockquote><p>@morganfw<br />No idea.&nbsp; I&#039;ll give it a try w/ racoon tomorrow.&nbsp; &nbsp;What does &quot;logread&quot; show when you try to connect?&nbsp; Does it perform the dump as expected from pppd, or does pppd stop abruptly?&nbsp; Can you post the /etc/ppp/options.xl2tpd file you are using (from when it fails) in case there is some other option in there that is causing a crash?</p></blockquote></div><p>I&#039;ve enabled dump option again then I&#039;ve restarted racoon and xl2tpd with<br /></p><div class="codebox"><pre><code>/etc/init.d/racoon restart &amp;&amp; /etc/init.d/xl2tpd restart</code></pre></div><p>when I try to connect from Cellular Mobile to Router VPN it hangs, logread reports following (where XXX.XXX.XXX.XXX is my Mobile Network IP, YYY.YYY.YYY.YYY is my ISP NAT Public IP, 192.168.1.128 is first Private IP assigned by ISP HAG/CPE [ISP assign me Privates IP from 192.168.1.128 to 192.168.1.254 and in my WNDR3700 Router I use only first IP manually configured in static mode):<br /></p><div class="codebox"><pre><code>Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: respond new phase 1 negotiation: 192.168.1.128[500]&lt;=&gt;XXX.XXX.XXX.XXX[28542]
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: begin Identity Protection mode.
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received Vendor ID: RFC 3947
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-02

Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received Vendor ID: draft-ietf-ipsec-nat-t-ike-00
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received broken Microsoft ID: FRAGMENTATION
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: received Vendor ID: DPD
Mon Mar 31 21:01:04 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] INFO: Selected NAT-T version: RFC 3947
Mon Mar 31 21:01:04 2014 daemon.info racoon: [192.168.1.128] INFO: Hashing 192.168.1.128[500] with algo #2 
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: NAT-D payload #0 doesn&#039;t match
Mon Mar 31 21:01:04 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] INFO: Hashing XXX.XXX.XXX.XXX[28542] with algo #2 
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: NAT-D payload #1 doesn&#039;t match
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: NAT detected: ME PEER
Mon Mar 31 21:01:04 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] INFO: Hashing XXX.XXX.XXX.XXX[28542] with algo #2 
Mon Mar 31 21:01:04 2014 daemon.info racoon: [192.168.1.128] INFO: Hashing 192.168.1.128[500] with algo #2 
Mon Mar 31 21:01:04 2014 daemon.info racoon: INFO: Adding remote and local NAT-D payloads.
Mon Mar 31 21:01:04 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] ERROR: couldn&#039;t find the pskey for XXX.XXX.XXX.XXX.
Mon Mar 31 21:01:04 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] NOTIFY: Using default PSK.
Mon Mar 31 21:01:05 2014 daemon.info racoon: INFO: NAT-T: ports changed to: XXX.XXX.XXX.XXX[16100]&lt;-&gt;192.168.1.128[4500]
Mon Mar 31 21:01:05 2014 daemon.info racoon: INFO: KA list add: 192.168.1.128[4500]-&gt;XXX.XXX.XXX.XXX[16100]
Mon Mar 31 21:01:05 2014 daemon.info racoon: INFO: ISAKMP-SA established 192.168.1.128[4500]-XXX.XXX.XXX.XXX[16100] spi:1a08c5c0aa8acc42:bb5f00ecd0600361
Mon Mar 31 21:01:05 2014 daemon.info racoon: [XXX.XXX.XXX.XXX] INFO: received INITIAL-CONTACT
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: respond new phase 2 negotiation: 192.168.1.128[4500]&lt;=&gt;XXX.XXX.XXX.XXX[16100]
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: no policy found, try to generate the policy : 100.71.198.100/32[0] YYY.YYY.YYY.YYY/32[1701] proto=udp dir=in
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: Adjusting my encmode UDP-Transport-&gt;Transport
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: Adjusting peer&#039;s encmode UDP-Transport(4)-&gt;Transport(2)
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: IPsec-SA established: ESP/Transport 192.168.1.128[4500]-&gt;XXX.XXX.XXX.XXX[16100] spi=99386219(0x5ec836b)
Mon Mar 31 21:01:06 2014 daemon.info racoon: INFO: IPsec-SA established: ESP/Transport 192.168.1.128[4500]-&gt;XXX.XXX.XXX.XXX[16100] spi=103237369(0x62746f9)
Mon Mar 31 21:01:08 2014 daemon.debug xl2tpd[12114]: control_finish: Peer requested tunnel 50792 twice, ignoring second one.
Mon Mar 31 21:01:08 2014 daemon.notice xl2tpd[12114]: Connection established to XXX.XXX.XXX.XXX, 42731.  Local: 53008, Remote: 50792 (ref=0/0).  LNS session is &#039;default&#039;
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: start_pppd: I&#039;m running: 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;/usr/sbin/pppd&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;passive&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;nodetach&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;192.168.1.80:192.168.1.81&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;refuse-pap&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;auth&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;require-chap&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;name&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;VPNServer&quot; 
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: &quot;debug&quot; 
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: Plugin pppol2tp.so loaded.
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: pppd options in effect:
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: debug        # (from command line)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: nodetach        # (from command line)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: idle 1800        # (from /etc/ppp/options.xl2tpd)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: logfile /dev/null        # (from /etc/ppp/options)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: maxfail 0        # (from /etc/ppp/options)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: connect-delay 5000        # (from /etc/ppp/options.xl2tpd)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: dump        # (from /etc/ppp/options.xl2tpd)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: plugin pppol2tp.so        # (from command line)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: require-mschap-v2        # (from /etc/ppp/options.xl2tpd)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: refuse-pap        # (from command line)
Mon Mar 31 21:01:09 2014 daemon.info pppd[14039]: name l2tp-server        # (from /etc/ppp/options.xl2tpd)
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: child_handler : pppd terminated for call 14570 by signal 11
Mon Mar 31 21:01:09 2014 daemon.info xl2tpd[12114]: call_close: Call 41623 to XXX.XXX.XXX.XXX disconnected
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: result_code_avp: avp is incorrect size.  8 &lt; 10
Mon Mar 31 21:01:09 2014 daemon.warn xl2tpd[12114]: handle_avps: Bad exit status handling attribute 1 (Result Code) on mandatory packet.
Mon Mar 31 21:01:09 2014 daemon.debug xl2tpd[12114]: Terminating pppd: sending TERM signal to pid 14039
Mon Mar 31 21:01:09 2014 daemon.info xl2tpd[12114]: Connection 50792 closed to XXX.XXX.XXX.XXX, port 42731 (Result Code: expected at least 10, got 8)</code></pre></div><p>and following my /etc/ppp/options.xl2tpd with dump enabled:</p><div class="codebox"><pre><code>## Frequently Used Options ##
lock
auth
## Options ##
name &quot;l2tp-server&quot;
dump
# CCP seems to confuse Android clients, better turn it off
noccp
novj
novjccomp
nopcomp
noaccomp
#require-mschap
require-mschap-v2
ms-dns 192.168.1.80
lcp-echo-interval 120
lcp-echo-failure 10
idle 1800
connect-delay 5000
nodefaultroute
noipdefault

proxyarp
mtu 1410
mru 1410</code></pre></div><p>if I comment dump option it works like a charm!</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=30982&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=30982&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=30982&amp;p=4.html">4</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>