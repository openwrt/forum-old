<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problem with ipv6 relay</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p246864">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">crccw</div>
					<div class="post-datetime">
						12 Sep 2014, 18:22					</div>
				</div>
				<div class="post-content content">
					<p>I can only get /64 address, so relay is the only way to work.</p><p>My network has native ipv6 support,and the router ping ipv6.google.com successfully</p><p>but my pc can&#039;t get ipv6 address.</p><p>ifconfig:<br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 00:86:33:50:17:C5  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fd38:c222:bbed::1/64 Scope:Global
          inet6 addr: fe80::286:33ff:fe50:17c5/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:18694 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15493 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:5818135 (5.5 MiB)  TX bytes:6530133 (6.2 MiB)

eth0      Link encap:Ethernet  HWaddr 00:86:33:50:17:C5  
          inet6 addr: fe80::286:33ff:fe50:17c5/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:56678 errors:0 dropped:322 overruns:0 frame:0
          TX packets:25374 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:12220881 (11.6 MiB)  TX bytes:10865635 (10.3 MiB)
          Interrupt:5 

eth0.1    Link encap:Ethernet  HWaddr 00:86:33:50:17:C5  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:12825 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11962 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1635089 (1.5 MiB)  TX bytes:5272119 (5.0 MiB)

eth0.2    Link encap:Ethernet  HWaddr 00:86:33:50:17:C6  
          inet addr:172.16.132.170  Bcast:172.16.133.255  Mask:255.255.254.0
          inet6 addr: 2001:da8:207:e132:286:33ff:fe50:17c6/64 Scope:Global
          inet6 addr: fe80::286:33ff:fe50:17c6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:43057 errors:0 dropped:62 overruns:0 frame:0
          TX packets:13404 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:9415253 (8.9 MiB)  TX bytes:5591655 (5.3 MiB)</code></pre></div><p>ifstatus:<br /></p><div class="codebox"><pre><code>{
    &quot;up&quot;: true,
    &quot;pending&quot;: false,
    &quot;available&quot;: true,
    &quot;autostart&quot;: true,
    &quot;uptime&quot;: 822,
    &quot;l3_device&quot;: &quot;eth0.2&quot;,
    &quot;proto&quot;: &quot;dhcpv6&quot;,
    &quot;device&quot;: &quot;eth0.2&quot;,
    &quot;metric&quot;: 0,
    &quot;delegation&quot;: true,
    &quot;ipv4-address&quot;: [
        
    ],
    &quot;ipv6-address&quot;: [
        {
            &quot;address&quot;: &quot;2001:da8:207:e132:286:33ff:fe50:17c6&quot;,
            &quot;mask&quot;: 64,
            &quot;preferred&quot;: 604767,
            &quot;valid&quot;: 2591967
        }
    ],
    &quot;ipv6-prefix&quot;: [
        
    ],
    &quot;ipv6-prefix-assignment&quot;: [
        
    ],
    &quot;route&quot;: [
        {
            &quot;target&quot;: &quot;2001:da8:207:e132::&quot;,
            &quot;mask&quot;: 64,
            &quot;nexthop&quot;: &quot;::&quot;,
            &quot;metric&quot;: 256,
            &quot;valid&quot;: 2591967,
            &quot;source&quot;: &quot;::\/0&quot;
        },
        {
            &quot;target&quot;: &quot;::&quot;,
            &quot;mask&quot;: 0,
            &quot;nexthop&quot;: &quot;fe80::eda:41ff:fe40:afe1&quot;,
            &quot;metric&quot;: 1024,
            &quot;valid&quot;: 1767,
            &quot;source&quot;: &quot;2001:da8:207:e132:286:33ff:fe50:17c6\/64&quot;
        },
        {
            &quot;target&quot;: &quot;::&quot;,
            &quot;mask&quot;: 0,
            &quot;nexthop&quot;: &quot;fe80::eda:41ff:fe40:afe1&quot;,
            &quot;metric&quot;: 1024,
            &quot;valid&quot;: 1767,
            &quot;source&quot;: &quot;::\/128&quot;
        }
    ],
    &quot;dns-server&quot;: [
        
    ],
    &quot;dns-search&quot;: [
        
    ],
    &quot;inactive&quot;: {
        &quot;ipv4-address&quot;: [
            
        ],
        &quot;ipv6-address&quot;: [
            
        ],
        &quot;route&quot;: [
            
        ],
        &quot;dns-server&quot;: [
            
        ],
        &quot;dns-search&quot;: [
            
        ]
    },
    &quot;data&quot;: {
        
    }
}</code></pre></div><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd38:c222:bbed::/48&#039;

config interface &#039;lan&#039;
        option force_link &#039;1&#039;
        option macaddr &#039;00:86:33:50:17:c5&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option _orig_ifname &#039;eth0.1 ra0&#039;
        option _orig_bridge &#039;true&#039;
        option ifname &#039;eth0.1 ra0&#039;
        option ip6assign &#039;64&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0.2&#039;
        option macaddr &#039;00:86:33:50:17:c6&#039;
        option proto &#039;dhcp&#039;
        option metric &#039;1&#039;

config interface &#039;wan6&#039;
        option ifname &#039;@wan&#039;
        option proto &#039;dhcpv6&#039;</code></pre></div><p>/etc/config/dhcp:<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option dhcpv6 &#039;relay&#039;
        option ra &#039;relay&#039;
        option ndp &#039;relay&#039;

config dhcp &#039;wan6&#039;
        option dhcpv6 &#039;relay&#039;
        option ra &#039;relay&#039;
        option ndp &#039;relay&#039;
        option master &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>crccw</strong> on 12 Sep 2014, 18:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246867">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">crccw</div>
					<div class="post-datetime">
						12 Sep 2014, 19:22					</div>
				</div>
				<div class="post-content content">
					<p>UPDATE:<br />after deleting<br /></p><div class="codebox"><pre><code>config dhcp &#039;wan6&#039;
        option dhcpv6 &#039;relay&#039;
        option ra &#039;relay&#039;
        option ndp &#039;relay&#039;
        option master &#039;1&#039;</code></pre></div><p>client can get ipv6 address now,but still no connection, and there&#039;s no correct ipv6 address on br-lan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249122">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">austinchou0126</div>
					<div class="post-datetime">
						4 Oct 2014, 14:42					</div>
				</div>
				<div class="post-content content">
					<p>the same problem. LOL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249126">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						4 Oct 2014, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>If it only gives you one address but not a prefix, you will need NAT or you should ask your ISP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249132">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">austinchou0126</div>
					<div class="post-datetime">
						4 Oct 2014, 16:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kh_tsang wrote:</cite><blockquote><p>If it only gives you one address but not a prefix, you will need NAT or you should ask your ISP.</p></blockquote></div><p>You mean, on the router, SNAT all the traffic from LAN computers to MASQUERADE?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249133">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						4 Oct 2014, 16:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>austinchou0126 wrote:</cite><blockquote><div class="quotebox"><cite>kh_tsang wrote:</cite><blockquote><p>If it only gives you one address but not a prefix, you will need NAT or you should ask your ISP.</p></blockquote></div><p>You mean, on the router, SNAT all the traffic from LAN computers to MASQUERADE?</p></blockquote></div><p>Yes, but you need to install the nat module of ip6tables and apply default route from fc00::/7</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249135">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						4 Oct 2014, 17:03					</div>
				</div>
				<div class="post-content content">
					<p>Or you may ask your ISP about routed prefix.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249670">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">austinchou0126</div>
					<div class="post-datetime">
						8 Oct 2014, 07:49					</div>
				</div>
				<div class="post-content content">
					<p>Finally I figure this out. If you follow the example config on <a href="http://wiki.openwrt.org/doc/uci/network6#router.advertisement.dhcpv6,">http://wiki.openwrt.org/doc/uci/network â€¦ nt.dhcpv6,</a> you just got a global address but failed to get access to the internet. You should add &#039;option interface wan&#039; below &#039;config dhcp wan6&#039; and you will get all things to work after restarting odhcpd service. <br />But here is another problem: you will lose internet connection after a while, so you need to restart this service intervally to make all clients get global ipv6 address and the internet, this maybe a bug or something else, but at least you have ipv6 connections. I will edit the wiki later.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>