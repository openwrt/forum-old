<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Cross compile IPK?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p114746">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						8 Aug 2010, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>I have an IPK that contains daemonlogger that was compiled to run on MIPs, specifically it was destined for whiterussian 8.0.9 atheros.&nbsp; When I try to install it for backfire 10.3 ar71xx I get an error saying my architecture is unsupported.&nbsp; I really want to be able to get this package installed on my wzr-hp-g300nh router.&nbsp; </p><p>I searched around and learned more about IPK&#039;s but I have a few questions, mainly is this even feasible?&nbsp; I ask because a few things come to mind.&nbsp; I read the wiki about IPK&#039;s but it talks about setting up a sdk for whiterussian, how does this correlate to backfire?&nbsp; Even though an IPK mostly contains scripts and config files isn&#039;t it possible the packaged daemonlogger program is customized for the purpose of the package?&nbsp; Seems to me you wouldn&#039;t include another program in the package itself as you would just have people download the program directly as a dependency.&nbsp; Though daemonlogger doesn&#039;t seem to exist in either the whiterussian or backfire releases so perhaps this is why it isn&#039;t a separate dependency.&nbsp; Do I need to look out for the included scripts not functioning the same on backfire as it would with whiterussian?&nbsp; I ask this because I have a vm of kunbuntu and the directory structure is different than backfire, it seems like a linux thing or equivalent to xp to vista/7.</p><br /><p>I am a noob but I have really picked up a lot in about a day&#039;s time.&nbsp; I&#039;ve learned so much in a short amount of time and I am working through issues just by searching around.&nbsp; I am confident I can get daemonlogger running on my unit if it&#039;s even possible just by working through the issues one at a time but I would really like to know if I am even on the right track, or if it is even possible.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114786">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						9 Aug 2010, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>possibly you are using the ipk on&nbsp; wrong type of architecture.<br />next, using linux you can extract the file as its a compressed archive.<br />on windows machines you can use 7-zip to extract its contents and then if it has scripts only you should be able to get the functionality on the newer router with little or no modifications.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114810">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						9 Aug 2010, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the reply mohnkhan.</p><p>I figured out the extraction part but I am thinking the IPK isn&#039;t necessarily my issue, it&#039;s the daemonlogger program inside of if that is compiled for another architecture and as you said I should be able to just look at the scripts and duplicate it on my end.&nbsp; The kicker is going to be daemonlogger I think.</p><p>*On the note about extracting IPK&#039;s, I have ark on my linux VM but it isn&#039;t capable of editing them.&nbsp; I used 7zip on my xp machine to extract everything but when I go to dump something back in it breaks the file structure of the IPK.&nbsp; Do you know of anything that will run in linux that stays true to the IPK structure when adding and removing files?</p>											<p class="post-edited">(Last edited by <strong>fusioncases</strong> on 9 Aug 2010, 18:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114865">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						10 Aug 2010, 09:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi fusioncases,<br /> You are most welcome.<br />&nbsp; &nbsp;to extract ipk rename is as .tar or something. you can directly open it with a archive manager.<br /> to know more about ipk please read this<br /></p><div class="codebox"><pre><code>  http://www.bitsum.com/creating_ipk_packages.htm</code></pre></div><p>I have my own modified version of the script created by this guy. which i use on various platform.<br />of-course will definitely share it with you if you need one <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>you can put all the files in a directory structure&nbsp; which will mimic ur routers structure.</p><p> lets say you create a&nbsp; file called hello.sh<br />and you want it in sbin</p><p>then in myipkfolder/sbin/hello.sh<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />then run the make ipk..<br />it will just do magic <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> and build the ipk for you.</p><p>if ur demon logger is some executable then i will also guide you how to compile for your platform, using a shortcut way..</p><p>if you still face any problems please post here <br />i will try my best to help you out.</p><p>regards<br />mohnkhan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115011">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">siris</div>
					<div class="post-datetime">
						12 Aug 2010, 00:24					</div>
				</div>
				<div class="post-content content">
					<p>That is all fine and dandy for your shell scripts as they are non-architecture specific.&nbsp; However, the daemonlogger binary is written in C and compiled using a compiler for mips.&nbsp; What you have to do is recompile the daemonlogger binary for your new target architecture using the correct compiler.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115029">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						12 Aug 2010, 10:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi fusioncases,<br />Any luck with your script / program migration please post your results here so that we can all share the knowledge <br />Lets make this world a better place. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>ahhh !! enough of dialogues from me. <br />humm about ar71xx, I can help you build the executable and the package too.,<br />As i have a tool-chain ready for this target.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115095">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						12 Aug 2010, 23:46					</div>
				</div>
				<div class="post-content content">
					<p>Siris - Yeah that&#039;s the path I am headed down now.</p><p>Mohnkhan, thank you very much for the info so far and I really appreciate the offers to help.&nbsp; Before I take you up on the offer though I wanted to try to figure it out on my own.&nbsp; I am sure I am going to hit a brick wall eventually though so I should be asking some more questions soon <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I will also make sure I post everything once I get it figured out and include a write up, I think it&#039;s very important to share such information.</p><p>I do have one question though, is there a chance that the compiled version of daemonlogger included in the package has been modified?&nbsp; I can always ask the person who built the package but since I am unfamiliar with, well, pretty much all of this I didn&#039;t know if this was even plausible, or legal for that matter.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115194">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						14 Aug 2010, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>Update - I wanted to start with the basics and build my own IPK file first before compiling daemonlogger.&nbsp; Yeah I know, sounds way simple but I just started with linux..&nbsp; I ran into some problems but was able to search for solutions and I now have a IPK file that mimics the one I am trying to get working on another architecture.&nbsp; Using the script provided though I noticed it added .svn directories at the base and also under &quot;etc&quot; in my IPK.&nbsp; Is this something I should be concerned about?&nbsp; I ran the make_ipk.sh in a unbuntu environment if that means anything.&nbsp; The IPK I am porting does not have these directories.</p><p>My next step is running the make file for the daemonlogger program but I am a little concerned.&nbsp; I&#039;ve read some posts about people trying to do this on openwrt and they have had to edit the makefile itself for certain programs (I haven&#039;t seen anything for daemonlogger specifically).&nbsp; This is way over my head, I can edit the file, but I don&#039;t even know where to start on figuring out what exactly I would be editing to make it work on wrt.&nbsp; At any rate, I guess I will find out more about that shortly..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115225">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						15 Aug 2010, 12:38					</div>
				</div>
				<div class="post-content content">
					<p>to build an ipk you can compile the program by hand&nbsp; then.<br />use the script to build the ipk</p><p>you can automate the compilation by using a make file<br />if you build it in openwrt make system then<br />you can even get the ipk itself directly in one single step</p><p>ignore the svn folders<br />they keep record of the versions you checked out from svn</p><p>the easiest way to start would be follow <br />svn co svn://svn.openwrt.org/openwrt/branches/backfire</p><p>check it out..<br />then type<br />make package/symlinks<br />or <br />./scripts/feeds update</p><p>or both of the last two commmands.</p><p>then&nbsp; make menuconfig.</p><br /><p>then you can try adding a custom package.</p>											<p class="post-edited">(Last edited by <strong>mohnkhan</strong> on 15 Aug 2010, 12:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115375">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						17 Aug 2010, 07:24					</div>
				</div>
				<div class="post-content content">
					<p>I ran into a problem with it adding the SVN directories, I tried making another package with completely different name and files and the install fails telling me &quot;check_data_file_clashes&quot; and they all point to the SVN directory.</p><p>I made a change to the script under the &quot;create data.tar&quot; section to fix this issue:</p><div class="codebox"><pre><code> 

echo &quot; Creating data.tar ...&quot;
OUR_BASENAME=`basename $0`
IPK_BASENAME=`basename $1`
# just get top-level directories actually
ALL_FILES=`find &quot;./&quot; -maxdepth 1 | sed 1d` 
rm data.tar
INPUT_FILES=&quot; &quot;
for i in $ALL_FILES; do
    echo &quot;  Processing $i &quot;
    if [ -d $i ]; then
        INPUT_FILES=`echo $INPUT_FILES &quot;$i&quot;`
    fi
done
echo &quot; dbg.infiles: $INPUT_FILES&quot;
tar &quot;--exclude=./control.tar&quot; &quot;--exclude=./control&quot; &quot;--exclude=./conffile*&quot; &quot;--exclude=./.svn&quot; &quot;--exclude=./.svn*&quot; &quot;--exclude=./$OUR_BASENAME&quot; &quot;--exclude=./$IPK_BASENAME&quot; &quot;--exclude=./make_ipk*.log&quot; -cvf data.tar $INPUT_FILES
echo &quot; -------- current data.tar ----------&quot;
tar -tvf data.tar
if [ $? != 0 ] || [ ! -f &quot;data.tar&quot; ]; then 
    echo &quot; ERROR: creation of $2/data.tar failed!&quot;
    exit 2    
fi</code></pre></div><p>I find it odd that a script is dictating the creation of the IPK but yet it doesn&#039;t mention anything about creating the svn directory or any sub files in the first place... At any rate this fixed me up for the IPK.</p>											<p class="post-edited">(Last edited by <strong>fusioncases</strong> on 17 Aug 2010, 07:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115378">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						17 Aug 2010, 09:34					</div>
				</div>
				<div class="post-content content">
					<p>please post your make file here..<br />it would be easier to help..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115443">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						18 Aug 2010, 01:29					</div>
				</div>
				<div class="post-content content">
					<p>Here is the makefile.in from Daemonlogger: <a href="http://openwrt.pastebin.com/EtjSmWLH">http://openwrt.pastebin.com/EtjSmWLH</a></p><p>Daemonlogger can be found here: <a href="http://www.snort.org/users/roesch/Site/Daemonlogger/Daemonlogger.html">http://www.snort.org/users/roesch/Site/ â€¦ ogger.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115584">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						20 Aug 2010, 11:57					</div>
				</div>
				<div class="post-content content">
					<p>sorry i was very busy with firmware release schedule at my work place.<br />will look at it now.. and update here my status.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115588">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						20 Aug 2010, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>some more updates on this <br />1.&nbsp; your make file is incorrect type.<br />2. I was expecting&nbsp; a openwrt makefile for it.<br />3. I have started building one for openwrt but i noticed it has dependency for libdnet.<br />&nbsp; so will check if openwrt has one else will add another make file to complete this dependency too.<br />will keep you posted</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115607">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						20 Aug 2010, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s very nice of you mohnkhan but is there a way I can figure this out on my own?&nbsp; I have been looking through guides and set up a backfire development environment but I don&#039;t know what to do next.&nbsp; The guides I come across are outdated/incomplete.</p><p>I am getting quite a bit of enjoyment out of this whole process and can foresee wanting to do more work like this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115697">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						23 Aug 2010, 08:54					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>#
# Copyright (C) 2006-2009 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=daemonlogger
PKG_VERSION:=1.2.1
PKG_RELEASE:=1

PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE_URL:=http://www.snort.org/users/roesch/code/ \
        http://download.example.com/mirror
PKG_MD5SUM:=acb64aa6cd5777e297569f100b5c39ee

include $(INCLUDE_DIR)/package.mk

define Package/daemonlogger
  SECTION:=ipv6
  CATEGORY:=IPv6
  TITLE:=Some kind of deamon logger Program
  URL:=http://www.snort.org/users/roesch/code/
  DEPENDS:=+libdnet+libpcap
endef

define Package/daemonlogger/description
It sniffs packets and spools them straight to the disk and can daemonize itself for background packet logging.  By default the file rolls over when 1 GB of data is logged.
It sniffs packets and rewrites them to a second interface, essentially acting as a soft tap.  It can also do this in daemon mode.Some kind of deamon logger Program.
endef

define Build/Configure
    $(call Build/Configure/Default,\
        --with-pidfile=/var/run/deak.pid \
    )
endef

define Build/Compile
    $(MAKE) -C $(PKG_BUILD_DIR) \
        daemonlogger_LDADD=&quot;&quot;
endef

#define Package/daemonlogger/conffiles
#/etc/config/daemonlogger
#endef

define Package/daemonlogger/install
    $(INSTALL_DIR) $(1)/sbin
    $(INSTALL_BIN) $(PKG_BUILD_DIR)/daemonlogger $(1)/sbin/    
endef

$(eval $(call BuildPackage,daemonlogger))</code></pre></div><p>this is my&nbsp; first version of make file..<br />i have put it in ipv6 just because the menu comes up faster on my box and I don&#039;t have to scroll down.. too much<br />all you need to do is create a folder with the name daemonlogger in<br /> ./backfire/packages&lt;daemonlogger&gt;<br /> inside this keep this text file as Makefile..<br /> and then type make menuconfig<br />and select this package as *<br />it should compile and put the package in ur image..<br />you can test it first for vmware image by selecting x86 as&nbsp; a target.</p><p>sorry I was way too busy doing some packing and lots of cleaning up.... so I couldn&#039;t reply back..<br />this is work done till Friday..<br />I will come back to you again today if there is any problem with it.</p><br /><p>Edit..<br />I just saw that your post..<br />how to set up a development environment.<br />its easy a cake. if you know little bit of Linux.<br />get a Linux box.. any flavour but full blown Linux distro.. to make your life easy..&nbsp; viz., fedora ubuntu or something<br />once you have it..<br />type the following commands on the Linux box..<br />1.svn co svn://svn.openwrt.org/openwrt/branches/backfire<br />2. &quot;make package/symlinks&quot; or both of these...<br />3.&nbsp; ./scripts/feeds update<br />4. make menuconfig&nbsp; &nbsp;select the packages and the name of hardware or target device you want to compile for..<br />5. make V=99&nbsp; <br /> bing wait for 3 hours in total.. (assuming you have 1 mbps internet connection and some dual core machine)<br />&nbsp; if you have faster connection and faster processor.. it may take less time.. or more time depending on your pc and internet speed.</p><p>and the package I gave you you can put it somewhere there itself.</p>											<p class="post-edited">(Last edited by <strong>mohnkhan</strong> on 23 Aug 2010, 09:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118436">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">mohnkhan</div>
					<div class="post-datetime">
						4 Oct 2010, 15:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi fusioncases,<br />any updates on this ?<br /> hope you are doing great.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>