<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unbranded XDX-RN502R</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p165814">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						26 Apr 2012, 04:29					</div>
				</div>
				<div class="post-content content">
					<p>Looking for a cheap and small device to hack on, I bought a router advertised as TopLink RT-3GWT, or Portable Wireless router model C1291, or CW-G3. I have seen other model numbers from other merchants that look the same, but the one I got has a writing on the PCB: XDX-RN502R V2.0</p><p><span class="postimg"><img src="http://mesh.openisp.ca/hardware/Bococom-DWR150/RT-3GWT_2.jpg" alt="http://mesh.openisp.ca/hardware/Bococom-DWR150/RT-3GWT_2.jpg" /></span></p><p><span class="postimg"><img src="http://mesh.openisp.ca/hardware/Bococom-DWR150/bococom-bare.jpg" alt="http://mesh.openisp.ca/hardware/Bococom-DWR150/bococom-bare.jpg" /></span></p><p>Here are its characteristics:<br />* Ralink RT3050F<br />* 4MB Flash, 32MB RAM<br />* USB port<br />* Ethernet port<br />* RP-SMA antenna connector<br />* 12 volt power adapter</p><p>I can telnet into the original firmware and I get:<br /></p><div class="codebox"><pre><code>Welcome to  Bococom Router Series
  For detailed information, please check:
        www.bococom.com


BusyBox v1.12.1 (2010-11-26 17:38:48 CST) built-in shell (msh)
Enter &#039;help&#039; for a list of built-in commands.</code></pre></div><p>This lead me to a post on this forum about a similar board based on the big brother Ralink 3052 which has two antennas and an ethernet switch, the XDX-RN502J:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=163152">https://forum.openwrt.org/viewtopic.php?pid=163152</a></p><p>So I bought a TTL-level serial cable and soldered it. Here&#039;s the output of the original firmware:</p><div class="codebox"><pre><code>U-Boot 1.1.3 (Apr  7 2010 - 09:43:57)                                           

Board: Ralink APSoC DRAM:  32 MB                                                
relocate_code Pointer at: 81fac000                                              
======= config usb otg =====                                                    
flash_protect ON: from 0xBF000000 to 0xBF0205C3                                 
protect on 0                                                                    
protect on 1                                                                    
protect on 2                                                                    
protect on 3                                                                    
protect on 4                                                                    
protect on 5
protect on 6                                                                    
protect on 7                                                                    
protect on 8                                                                    
protect on 9                                                                    
flash_protect ON: from 0xBF030000 to 0xBF03FFFF                                 
protect on 10                                                                   
*** Warning - bad CRC, using default environment                                

============================================                                    
Ralink UBoot Version: 3.2                                                       
--------------------------------------------                                    
ASIC 3052_MP2 (Port5&lt;-&gt;None)                                                    
DRAM COMPONENT: 256Mbits                                                        
DRAM BUS: 16BIT                                                                 
Total memory: 32 MBytes                                                         
Date:Apr  7 2010  Time:09:43:57                                                 
============================================                                    
icache: sets:128, ways:4, linesz:32 ,total:16384                                
dcache: sets:128, ways:4, linesz:32 ,total:16384                                

 ##### The CPU freq = 320 MHZ ####                                              

SDRAM bus set to 16 bit                                                         
 SDRAM size =32 Mbytes                                                          

Please choose the operation:                                                    
   1: Load system code to SDRAM via TFTP.                                       
   2: Load system code then write to Flash via TFTP.                            
   3: Boot system code via Flash (default).                                     
   4: Entr boot command line interface.                                         
   9: Load Boot Loader code then write to Flash via TFTP.                       

You choosed 3                                                                   

 0                                                                              

3: System Boot system code via Flash.                                           
## Booting image at bf050000 ...                                                
   Image Name:   Linux Kernel Image                                             
   Created:      2011-05-25   7:38:47 UTC                                       

 System Control Status = 0x00400000                                             
   Image Type:   MIPS Linux Kernel Image (lzma compressed)                      
   Data Size:    3502016 Bytes =  3.3 MB                                        
   Load Address: 80000000                                                       
   Entry Point:  802d2000                                                       
   Verifying Checksum ... OK                                                    
   Uncompressing Kernel Image ... OK                                            
No initrd                                                                       
## Transferring control to Linux (at address 802d2000) ...                      
## Giving linux memsize in MB, 32                                               

Starting kernel ...                                                             


LINUX started...                                                                

 THIS IS ASIC                                                                   

3G Router Start!</code></pre></div><p>Then the console goes silent and does not echo back what I type.</p><p>Choosing option #4 to enter the U-Boot menu, I&#039;m able to see some variables:</p><div class="codebox"><pre><code>RT3052 # printenv                                                               
bootcmd=tftp                                                                    
bootdelay=5                                                                     
baudrate=57600                                                                  
ethaddr=&quot;00:AA:BB:CC:DD:10&quot;                                                     
ipaddr=10.10.10.123                                                             
serverip=10.10.10.3                                                             
preboot=echo;echo                                                               
ramargs=setenv bootargs root=/dev/ram rw                                        
addip=setenv bootargs $(bootargs) ip=$(ipaddr):$(serverip):$(gatewayip):$(netmask):$(hostname):$(netdev):off
addmisc=setenv bootargs $(bootargs) console=ttyS0,$(baudrate) ethaddr=$(ethaddr) panic=1
flash_self=run ramargs addip addmisc;bootm $(kernel_addr) $(ramdisk_addr)
kernel_addr=BFC40000                                                            
u-boot=u-boot.bin                                                               
load=tftp 8A100000 $(u-boot)                                                    
u_b=protect off 1:0-1;era 1:0-1;cp.b 8A100000 BC400000 $(filesize)              
loadfs=tftp 8A100000 root.cramfs                                                
u_fs=era bc540000 bc83ffff;cp.b 8A100000 BC540000 $(filesize)                   
test_tftp=tftp 8A100000 root.cramfs;run test_tftp                               
stdin=serial                                                                    
stdout=serial                                                                   
stderr=serial                                                                   
ethact=Eth0 (10/100-M)                                                          

Environment size: 783/65532 bytes</code></pre></div><p>Here are the other available commands:</p><div class="codebox"><pre><code>RT3052 # help                                                                   
?       - alias for &#039;help&#039;                                                      
boot    - boot default, i.e., run &#039;bootcmd&#039;                                     
bootd   - boot default, i.e., run &#039;bootcmd&#039;                                     
bootm   - boot application image from memory                                    
bootp   - boot image via network using BootP/TFTP protocol                      
cp      - memory copy                                                           
echo    - echo args to console                                                  
erase   - erase FLASH memory                                                    
go      - start application at address &#039;addr&#039;                                   
help    - print online help                                                     
loadb   - load binary file over serial line (kermit mode)                       
md      - memory display                                                        
mdio   - Ralink PHY register R/W command !!                                     
mm      - memory modify (auto-incrementing)                                     
mw      - memory write (fill)                                                   
nm      - memory modify (constant address)                                      
printenv- print environment variables                                           
protect - enable or disable FLASH write protection                              
reset   - Perform RESET of the CPU                                              
run     - run commands in an environment variable                               
saveenv - save environment variables to persistent storage                      
setenv  - set environment variables                                             
spicmd  - read/write data from/to eeprom or vtss                                
tftpboot- boot image via network using TFTP protocol                            
loopback   - Ralink eth loopback test !!                                        
version - print monitor version</code></pre></div><p>I compiled OpenWRT with these settings:</p><p>Target System: Ralink RT288x/RT3xxx<br />Subtarget: RT305x based boards<br />Target Profile Default Profile<br />Target images: ramdisk</p><p>Here&#039;s what I got by booting from the generated openwrt-ramips-rt305x-xdxrn502j-initramfs-uImage.bin image:</p><div class="codebox"><pre><code>U-Boot 1.1.3 (Apr  7 2010 - 09:43:57)

Board: Ralink APSoC DRAM:  32 MB
relocate_code Pointer at: 81fac000
======= config usb otg ===== 
flash_protect ON: from 0xBF000000 to 0xBF0205C3
protect on 0
protect on 1
protect on 2
protect on 3
protect on 4
protect on 5
protect on 6
protect on 7
protect on 8
protect on 9
flash_protect ON: from 0xBF030000 to 0xBF03FFFF
protect on 10
============================================ 
Ralink UBoot Version: 3.2
-------------------------------------------- 
ASIC 3052_MP2 (Port5&lt;-&gt;None)
DRAM COMPONENT: 256Mbits 
DRAM BUS: 16BIT 
Total memory: 32 MBytes
Date:Apr  7 2010  Time:09:43:57
============================================ 
icache: sets:128, ways:4, linesz:32 ,total:16384
dcache: sets:128, ways:4, linesz:32 ,total:16384 

 ##### The CPU freq = 320 MHZ #### 

SDRAM bus set to 16 bit 
 SDRAM size =32 Mbytes

Please choose the operation: 
   1: Load system code to SDRAM via TFTP. 
   2: Load system code then write to Flash via TFTP. 
   3: Boot system code via Flash (default).
   4: Entr boot command line interface.
   9: Load Boot Loader code then write to Flash via TFTP. 

You choosed 1

 0 

 eth_register  
Eth0 (10/100-M)
 enetvar=ethaddr,Eth addr:00:AA:BB:CC:DD:10
 00:AA:BB:CC:DD:10:

 eth_current-&gt;name = Eth0 (10/100-M)

   
1: System Load Linux to SDRAM via TFTP. 
 Please Input new ones /or Ctrl-C to discard
        Input device IP (192.168.1.1) ==:      

        Input server IP (192.168.1.2) ==:

        Input Linux Kernel filename (xdxrn502j.bin) ==:


 netboot_common, argc= 3 
 *************buf = 0x81fcc740
 **********NexTxPacket = 81fe4840

 NetTxPacket = 0x81FE4840 

 NetRxPackets[0] = 0x81FE4E40

 NetRxPackets[1] = 0x81FE5440

 NetRxPackets[2] = 0x81FE5A40

 NetRxPackets[3] = 0x81FE6040

 NetRxPackets[4] = 0x81FE6640

 NetRxPackets[5] = 0x81FE6C40

 NetRxPackets[6] = 0x81FE7240

 NetRxPackets[7] = 0x81FE7840

 NetRxPackets[8] = 0x81FE7E40

 NetRxPackets[9] = 0x81FE8440

 NetRxPackets[10] = 0x81FE8A40

 NetRxPackets[11] = 0x81FE9040

 NetRxPackets[12] = 0x81FE9640

 NetRxPackets[13] = 0x81FE9C40

 NetRxPackets[14] = 0x81FEA240

 NetRxPackets[15] = 0x81FEA840

 NetRxPackets[16] = 0x81FEAE40

 NetRxPackets[17] = 0x81FEB440

 NetRxPackets[18] = 0x81FEBA40

 NetRxPackets[19] = 0x81FEC040

 KSEG1ADDR(NetTxPacket) = 0xA1FE4840 

 NetLoop,call eth_halt ! 

 NetLoop,call eth_init ! 
Trying Eth0 (10/100-M)

 Waitting for RX_DMA_BUSY status Start... done

 Header Payload scatter function is Disable !! 

 ETH_STATE_ACTIVE!! 
Using Eth0 (10/100-M) device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;xdxrn502j.bin&#039;.

 TIMEOUT_COUNT=10,Load address: 0x80800000
Loading: Got ARP REPLY, set server/gtwy eth addr (00:50:ba:0d:35:9e)
Got it
T #
 first block received  
################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################
done
Bytes transferred = 2243740 (223c9c hex)
NetBootFileXferSize= 00223c9c
Automatic boot of image at addr 0x80800000 ...
## Booting image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-3.2.15
   Created:      2012-04-25   4:18:59 UTC

 System Control Status = 0x00400000 
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    2243676 Bytes =  2.1 MB
   Load Address: 80000000
   Entry Point:  80000000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 32

Starting kernel ...

[    0.000000] Linux version 3.2.15 (nicolas@cortex) (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #6 Wed Apr 25 00:18:02
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001964c (MIPS 24KEc)
[    0.000000] Ralink RT3350 id:1 rev:2 running at 320.00 MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone PFN ranges:
[    0.000000]   Normal   0x00000000 -&gt; 0x00002000
[    0.000000] Movable zone start PFN for each node
[    0.000000] early_node_map[1] active PFN ranges
[    0.000000]     0: 0x00000000 -&gt; 0x00002000
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=XDXRN502J console=ttyS1,57600 mtdparts=physmap-flash.0:192k(u-boot)ro,64k(u-boot-env)ro,64k(factory2
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Primary instruction cache 16kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 32 bytes
[    0.000000] Writing ErrCtl register=0000f648
[    0.000000] Readback ErrCtl register=0000f648
[    0.000000] Memory: 28612k/32768k available (1889k kernel code, 4156k reserved, 316k data, 1532k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:48
[    0.000000] console [ttyS1] enabled, bootconsole disabled
[    0.000000] console [ttyS1] enabled, bootconsole disabled
[    0.010000] Calibrating delay loop... 212.58 BogoMIPS (lpj=1062912)
[    0.090000] pid_max: default: 32768 minimum: 301
[    0.090000] Mount-cache hash table entries: 512
[    0.100000] NET: Registered protocol family 16
[    0.110000] MIPS: machine is XDX RN502J
[    0.140000] bio: create slab &lt;bio-0&gt; at 0
[    0.150000] Switching to clocksource MIPS
[    0.170000] NET: Registered protocol family 2
[    0.170000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.190000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    0.200000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.220000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.230000] TCP reno registered
[    0.240000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.250000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.260000] NET: Registered protocol family 1
[    4.160000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    4.170000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    4.190000] msgmni has been set to 55
[    4.200000] io scheduler noop registered
[    4.210000] io scheduler deadline registered (default)
[    4.220000] Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled
[    4.230000] serial8250: ttyS0 at MMIO 0x10000500 (irq = 13) is a 16550A
[    4.250000] serial8250: ttyS1 at MMIO 0x10000c00 (irq = 20) is a 16550A
[    4.270000] physmap platform flash device: 00800000 at bf000000
[    4.280000] physmap-flash.0: Found 1 x16 devices at 0x0 in 16-bit bank. Manufacturer ID 0x0000c2 Chip ID 0x0022a8
[    4.300000] Amd/Fujitsu Extended Query Table at 0x0040
[    4.310000]   Amd/Fujitsu Extended Query version 1.1.
[    4.320000] number of CFI chips: 1
[    4.330000] 6 cmdlinepart partitions found on MTD device physmap-flash.0
[    4.340000] Creating 6 MTD partitions on &quot;physmap-flash.0&quot;:
[    4.350000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    4.370000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    4.390000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    4.400000] 0x000000050000-0x000000130000 : &quot;kernel&quot;
[    4.420000] 0x000000130000-0x000000400000 : &quot;rootfs&quot;
[    4.430000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    4.440000] split_squashfs: no squashfs found in &quot;physmap-flash.0&quot;
[    4.460000] 0x000000050000-0x000000400000 : &quot;firmware&quot;
[    4.480000] TCP westwood registered
[    4.490000] NET: Registered protocol family 17
[    4.500000] 8021q: 802.1Q VLAN Support v1.8
[    4.530000] Freeing unused kernel memory: 1532k freed
[    5.690000] input: gpio-keys-polled as /devices/platform/gpio-keys-polled/input/input0
- preinit -
Press the [f] key and hit [enter] to enter failsafe mode
- regular preinit -
- init -

Please press Enter to activate this console. [    9.670000] Compat-wireless backport release: compat-wireless-2012-04-17-1-r31387
[    9.680000] Backport based on wireless-testing.git master-2012-04-17
[    9.740000] cfg80211: Calling CRDA to update world regulatory domain
[    9.940000] cfg80211: World regulatory domain updated:
[    9.950000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[    9.970000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.980000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   10.000000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   10.010000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.030000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.160000] SCSI subsystem initialized
[   10.240000] usbcore: registered new interface driver usbfs
[   10.250000] usbcore: registered new interface driver hub
[   10.270000] usbcore: registered new device driver usb
[   10.480000] usbcore: registered new interface driver rtl8187
272+0 records in
272+0 records out
[   10.830000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   11.130000] nf_conntrack version 0.5.0 (471 buckets, 1884 max)
[   11.560000] batman_adv: B.A.T.M.A.N. advanced 2012.1.0 (compatibility version 14) loaded
[   11.650000] i2c /dev entries driver
[   11.700000] dwc_otg: version 2.72a 24-JUN-2008
[   11.710000] dwc_otg: Core Release: 2.66a
[   11.920000] dwc_otg: Periodic Transfer Interrupt Enhancement - disabled
[   11.930000] dwc_otg: Multiprocessor Interrupt Enhancement - disabled
[   11.940000] dwc_otg: Using DMA mode
[   11.950000] dwc_otg: Device using Buffer DMA mode
[   11.960000] dwc_otg dwc_otg.0: DWC OTG Controller
[   11.970000] dwc_otg dwc_otg.0: new USB bus registered, assigned bus number 1
[   11.990000] dwc_otg dwc_otg.0: irq 26, io mem 0x101c0000
[   12.000000] dwc_otg: Init: Port Power? op_state=1
[   12.010000] dwc_otg: Init: Power Port (0)
[   12.020000] hub 1-0:1.0: USB hub found
[   12.020000] hub 1-0:1.0: 1 port detected
[   12.100000] Initializing USB Mass Storage driver...
[   12.110000] usbcore: registered new interface driver usb-storage
[   12.120000] USB Mass Storage support registered.
[   12.170000] Linux video capture interface: v2.00
[   12.250000] usbcore: registered new interface driver zd1211rw
[   12.310000] gspca_main: v2.14.0 registered
[   16.590000] ramips-wdt: timeout value 60 must be 0 &lt; timeout &lt; 40
[   24.800000] device eth0.1 entered promiscuous mode
[   24.810000] device eth0 entered promiscuous mode
[   24.940000] br-lan: port 1(eth0.1) entering forwarding state
[   24.960000] br-lan: port 1(eth0.1) entering forwarding state
^[OM


BusyBox v1.19.4 (2012-04-23 23:51:27 EDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 ATTITUDE ADJUSTMENT (31387, r31387)
 -----------------------------------------------------
  * 1/4 oz Vodka      Pour all ingredients into mixing
  * 1/4 oz Gin        tin with ice, strain into glass.
  * 1/4 oz Amaretto
  * 1/4 oz Triple sec
  * 1/4 oz Peach schnapps
  * 1/4 oz Sour mix
  * 1 splash Cranberry juice
 -----------------------------------------------------
root@OpenWrt:/#</code></pre></div><p>This is promising! The wireless card works (after enabling it in /etc/config/wireless and doing /etc/init.d/network restart), and there are eth0, eth0.1 and eth0.2 although there&#039;s only one ethernet port. I suppose this is because the XDX-RN502J board has more than one, and this can be fixed by some configuration. The LAN LED flashes correctly, and the 3G LED flashes during boot, then stays ON. When I bring wlan0 up with ifconfig, the WIFI LED goes ON. All good :)</p><p>However, when restarting the network, I see these errors:</p><div class="codebox"><pre><code>root@OpenWrt:/# /etc/init.d/network restart
/sbin/wifi: eval: line 1: hostapd_set_log_options: not found
/sbin/wifi: eval: line 1: hostapd_set_bss_options: not found
/sbin/wifi: eval: line 1: hostapd: not found
Failed to start hostapd for phy0</code></pre></div><p>I don&#039;t know how to fix that.</p><p>I would now like to write this image to the flash memory, but I don&#039;t know how I should do that. I&#039;m currently booting with a ramfs+initrd image. Ideally, I would flash from the web interface, so nobody else has to solder a cable to flash this model.</p><p>Currently, here are the options I see for flashing:<br />* Using &quot;2: Load system code then write to Flash via TFTP.&quot; from U-Boot menu<br />* Using &quot;4: Entr boot command line interface.&quot; from U-Boot menu, download the image (how?) and write it to the correct address (which?)<br />* Download the image while running OpenWRT and write it with mtd or dd<br />* Original firmware web interface, which has a form to upload a firmware</p><p>Here&#039;s the mtd layout:</p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00030000 00010000 &quot;u-boot&quot;
mtd1: 00010000 00010000 &quot;u-boot-env&quot;
mtd2: 00010000 00010000 &quot;factory&quot;
mtd3: 000e0000 00010000 &quot;kernel&quot;
mtd4: 002d0000 00010000 &quot;rootfs&quot;
mtd5: 003b0000 00010000 &quot;firmware&quot;</code></pre></div><p>I&#039;m not sure where to start.</p><p>It is important to me to test the flashing from the original firmware, so I made a backup of the mtdX devices so I can copy them back in case I wipe it. I guess I could restore it by booting this ramfs image I&#039;m using, then dd the mtd partitions back to the flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165846">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						26 Apr 2012, 10:25					</div>
				</div>
				<div class="post-content content">
					<p>great work !<br />I have the same model at home waiting to get some time to post the details you mentioned above.<br />I also connected serial TTl and i&#039;m unable to get commands to it.<br />Please detail for me how you managed to ged it into its bootloader and send openwrt.<br />I have some upgrade images and i want to work on flashing from original web gui.<br />PM me and let&#039;s work together.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167048">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						11 May 2012, 05:14					</div>
				</div>
				<div class="post-content content">
					<p>Over the last few days, I used the patch that added support for the XDX-RN502J to add support to my XDX-RN502R. I have pushed my changes to GitHub in this branch: <a href="https://github.com/elecnix/openwrt/tree/xdx-rn502r">https://github.com/elecnix/openwrt/tree/xdx-rn502r</a> My plan is to produce a patch and submit it to inclusion in OpenWRT trunk, but I&#039;m stuck with one problem: the ethernet port has a bug.</p><p>Here&#039;s the issue: tcpdump on the router sees all traffic from the connected computer or network. However, nothing goes out. When I ping my laptop from the router, the LAN LED does not even flash. A friend had a look at the Ralink documentation, and he asked to have a look at the memory registers at address 0x10110000, so I went into the U-Boot shell and I&#039;m copying it here. I have no idea what to do with this, and since I haven&#039;t heard from my friend, I&#039;m updating this thread to get more help.</p><div class="codebox"><pre><code>RT3052 # md 0x10110000 256
10110000: 04000000 7fffffff ffc86e5a 00000014    ........Zn......
10110010: 0f000000 00401555 03030303 0000016e    ....U.@.....n...
10110020: 00000000 00000004 00000000 00000000    ................
10110030: 00000000 00080000 0000e40d 09692a44    ............D*i.
10110040: 00001001 00001001 00001002 00000001    ................
10110050: 00002001 00004003 00006005 00008007    . ...@...`......
10110060: 0000a009 0000c00b 0000e00d 0001000f    ................
10110070: ffff506f ffffffff ffffffff ffffffff    oP..............
10110080: 81808100 00000000 00000000 02404040    ............@@@.
10110090: 10007f7f 00000000 00007f7f 0008a301    ................
101100a0: 00000000 00000005 00000005 00000005    ................
101100b0: 00000005 00000005 0000001e 00000000    ................
101100c0: 80001f00 00000000 3f502b28 0002500c    ........(+P?.P..
101100d0: 00000000 00000000 40000000 0000006a    ...........@j...
101100e0: 00000000 00000000 00000000 00000000    ................
101100f0: 00000000 00000000 00000000 00000000    ................
10110100: 00000000 00000000 00000000 00000000    ................
10110110: 00000000 00000000 00000000 00000000    ................
10110120: 00000000 00000000 00000000 00000000    ................
10110130: 00000000 00000000 00000000 00000000    ................
10110140: 00000000 00000000 00000000 00000000    ................
10110150: 00000000 00000000 00000000 00000000    ................
10110160: 00000000 00000000 00000000 00000000    ................
10110170: 00000000 00000000 00000000 00000000    ................
10110180: 00000000 00000000 00000000 00000000    ................
10110190: 00000000 00000000 00000000 00000000    ................
101101a0: 00000000 00000000 00000000 00000000    ................
101101b0: 00000000 00000000 00000000 00000000    ................
101101c0: 00000000 00000000 00000000 00000000    ................
101101d0: 00000000 00000000 00000000 00000000    ................
101101e0: 00000000 00000000 00000000 00000000    ................
101101f0: 00000000 00000000 00000000 00000000    ................
10110200: 00000000 00000000 00000000 00000000    ................
10110210: 00000000 00000000 00000000 00000000    ................
10110220: 00000000 00000000 00000000 00000000    ................
10110230: 00000000 00000000 00000000 00000000    ................
10110240: 00000000 00000000 00000000 00000000    ................
10110250: 00000000 00000000 00000000 00000000    ................
10110260: 00000000 00000000 00000000 00000000    ................
10110270: 00000000 00000000 00000000 00000000    ................
10110280: 00000000 00000000 00000000 00000000    ................
10110290: 00000000 00000000 00000000 00000000    ................
101102a0: 00000000 00000000 00000000 00000000    ................
101102b0: 00000000 00000000 00000000 00000000    ................
101102c0: 00000000 00000000 00000000 00000000    ................
101102d0: 00000000 00000000 00000000 00000000    ................
101102e0: 00000000 00000000 00000000 00000000    ................
101102f0: 00000000 00000000 00000000 00000000    ................
10110300: 00000000 00000000 00000000 00000000    ................
10110310: 00000000 00000000 00000000 00000000    ................
10110320: 00000000 00000000 00000000 00000000    ................
10110330: 00000000 00000000 00000000 00000000    ................
10110340: 00000000 00000000 00000000 00000000    ................
10110350: 00000000 00000000 00000000 00000000    ................
10110360: 00000000 00000000 00000000 00000000    ................
10110370: 00000000 00000000 00000000 00000000    ................
10110380: 00000000 00000000 00000000 00000000    ................
10110390: 00000000 00000000 00000000 00000000    ................
101103a0: 00000000 00000000 00000000 00000000    ................
101103b0: 00000000 00000000 00000000 00000000    ................
101103c0: 00000000 00000000 00000000 00000000    ................
101103d0: 00000000 00000000 00000000 00000000    ................
101103e0: 00000000 00000000 00000000 00000000    ................
101103f0: 00000000 00000000 00000000 00000000    ................
10110400: 00000000 00000000 00000000 00000000    ................
10110410: 00000000 00000000 00000000 00000000    ................
10110420: 00000000 00000000 00000000 00000000    ................
10110430: 00000000 00000000 00000000 00000000    ................
10110440: 00000000 00000000 00000000 00000000    ................
10110450: 00000000 00000000 00000000 00000000    ................
10110460: 00000000 00000000 00000000 00000000    ................
10110470: 00000000 00000000 00000000 00000000    ................
10110480: 00000000 00000000 00000000 00000000    ................
10110490: 00000000 00000000 00000000 00000000    ................
101104a0: 00000000 00000000 00000000 00000000    ................
101104b0: 00000000 00000000 00000000 00000000    ................
101104c0: 00000000 00000000 00000000 00000000    ................
101104d0: 00000000 00000000 00000000 00000000    ................
101104e0: 00000000 00000000 00000000 00000000    ................
101104f0: 00000000 00000000 00000000 00000000    ................
10110500: 00000000 00000000 00000000 00000000    ................
10110510: 00000000 00000000 00000000 00000000    ................
10110520: 00000000 00000000 00000000 00000000    ................
10110530: 00000000 00000000 00000000 00000000    ................
10110540: 00000000 00000000 00000000 00000000    ................
10110550: 00000000 00000000 00000000 00000000    ................
10110560: 00000000 00000000 00000000 00000000    ................
10110570: 00000000 00000000 00000000 00000000    ................
10110580: 00000000 00000000 00000000 00000000    ................
10110590: 00000000 00000000 00000000 00000000    ................
101105a0: 00000000 00000000 00000000 00000000    ................
101105b0: 00000000 00000000 00000000 00000000    ................
101105c0: 00000000 00000000 00000000 00000000    ................
101105d0: 00000000 00000000 00000000 00000000    ................
101105e0: 00000000 00000000 00000000 00000000    ................
101105f0: 00000000 00000000 00000000 00000000    ................
10110600: 00000000 00000000 00000000 00000000    ................
10110610: 00000000 00000000 00000000 00000000    ................
10110620: 00000000 00000000 00000000 00000000    ................
10110630: 00000000 00000000 00000000 00000000    ................
10110640: 00000000 00000000 00000000 01010404    ................
10110650: 00000000 00000000 00000000 00000000    ................
10110660: 00000000 00000000 00000000 00000000    ................
10110670: 00000000 00000000 00000000 00000000    ................
10110680: 00000000 00000000 00000000 00000000    ................
10110690: 00000000 00000000 00000000 00000000    ................
101106a0: 00000000 00000000 00000000 00000000    ................
101106b0: 00000000 00000000 00000000 00000000    ................
101106c0: 00000000 00000000 00000000 00000000    ................
101106d0: 00000000 00000000 00000000 00000000    ................
101106e0: 00000000 00000000 00000000 00000000    ................
101106f0: 00000000 00000000 00000000 00000000    ................
10110700: 00000000 00000000 00000000 00000000    ................
10110710: 00000000 00000000 00000000 00000000    ................
10110720: 00000000 00000000 00000000 00000000    ................
10110730: 00000000 00000000 00000000 00000000    ................
10110740: 00000000 00000000 00000000 00000000    ................
10110750: 00000000 00000000 00000000 00000000    ................
10110760: 00000000 00000000 00000000 00000000    ................
10110770: 00000000 00000000 00000000 00000000    ................
10110780: 00000000 00000000 00000000 00000000    ................
10110790: 00000000 00000000 00000000 00000000    ................
101107a0: 00000000 00000000 00000000 00000000    ................
101107b0: 00000000 00000000 00000000 00000000    ................
101107c0: 00000000 00000000 00000000 00000000    ................
101107d0: 00000000 00000000 00000000 00000000    ................
101107e0: 00000000 00000000 00000000 00000000    ................
101107f0: 00000000 00000000 00000000 00000000    ................
10110800: 04000000 7fffffff ffc86e5a 00000014    ........Zn......
10110810: 0f000000 00401555 03030303 0000016e    ....U.@.....n...
10110820: 00000000 00000004 00000000 00000000    ................
10110830: 00000000 00080000 0000e40d 09692a44    ............D*i.
10110840: 00001001 00001001 00001002 00000001    ................
10110850: 00002001 00004003 00006005 00008007    . ...@...`......
10110860: 0000a009 0000c00b 0000e00d 0001000f    ................
10110870: ffff506f ffffffff ffffffff ffffffff    oP..............
10110880: 81808100 00000000 00000000 02404040    ............@@@.
10110890: 10007f7f 00000000 00007f7f 0008a301    ................
101108a0: 00000000 00000005 00000005 00000005    ................
101108b0: 00000005 00000005 0000001e 00000000    ................
101108c0: 80001f00 00000000 3f502b28 0002500c    ........(+P?.P..
101108d0: 00000000 00000000 40000000 0000006a    ...........@j...
101108e0: 00000000 00000000 00000000 00000000    ................
101108f0: 00000000 00000000 00000000 00000000    ................
10110900: 00000000 00000000 00000000 00000000    ................
10110910: 00000000 00000000 00000000 00000000    ................
10110920: 00000000 00000000 00000000 00000000    ................
10110930: 00000000 00000000 00000000 00000000    ................
10110940: 00000000 00000000 00000000 00000000    ................
10110950: 00000000 00000000    ........</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167063">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						11 May 2012, 10:18					</div>
				</div>
				<div class="post-content content">
					<p>i&#039;ve flashed the WR5123GN 4M build and it worked for 6 days with &gt; 6 clients in AP mode.<br />Also tested UMTS modem connection and it worked without issue.<br />maybe it&#039;s not the answer you&#039;re hoping for but i suggest to try patching the WR5123GN profile instead</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167096">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						11 May 2012, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>You say nothing of your config. By default openwrt groups port0-port4 of internal switch into 2 vlan. After that two interfaces - eth0.1 and eth0.2 may be configured. I think you have to configure and check/ping both (we don&#039;t known which port physically connected).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167101">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						11 May 2012, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>I applied the patch that adds swconfig support to ramips chips (<a href="http://patchwork.openwrt.org/patch/2159/">http://patchwork.openwrt.org/patch/2159/</a>) and here is the output:</p><div class="codebox"><pre><code>root@bococom1:/# swconfig dev rt305x show
Global attributes:
        enable_vlan: 1
        alternate_vlan_disable: 0
Port 0:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: 0
        lan: 0
        recv_bad: 0
        recv_good: 5383
        pvid: 2
        link: port:0 link:up speed:100baseT full-duplex 
Port 1:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: 0
        lan: 1
        recv_bad: 0
        recv_good: 0
        pvid: 1
        link: port:1 link:down
Port 2:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: 0
        lan: 1
        recv_bad: 0
        recv_good: 0
        pvid: 1
        link: port:2 link:down
Port 3:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: 0
        lan: 1
        recv_bad: 0
        recv_good: 0
        pvid: 1
        link: port:3 link:down
Port 4:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: 0
        lan: 1
        recv_bad: 0
        recv_good: 0
        pvid: 1
        link: port:4 link:down
Port 5:
        disable: 1
        doubletag: 0
        en_vlan: 1
        untag: 1
        led: ???
        lan: 1
        recv_bad: 0
        recv_good: 0
        pvid: 1
        link: port:5 link:down
Port 6:
        disable: 0
        doubletag: 0
        en_vlan: 1
        untag: 0
        led: ???
        lan: ???
        recv_bad: ???
        recv_good: ???
        pvid: 1
        link: port:6 link:up speed:1000baseT full-duplex 
VLAN 1:
        ports: 1 2 3 4 6t 
VLAN 2:
        ports: 0 6t</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167105">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						11 May 2012, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it&#039;s default hardware config. It shows that port0 physically connected (rcvd pkts !=0 and link up). And your active interface eth0.2. So you need configure it properly. By default eth0.2 - WAN <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. Show/see your /etc/config/network.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167107">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						11 May 2012, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>I was booting the patched image without flashing, but when I write it to flash I get the config generated by ramips_setup_rt3x5x_vlans:</p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth0.1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
                              
config switch                 
        option name &#039;rt305x&#039;  
        option reset &#039;1&#039;    
        option enable_vlan &#039;1&#039;
                              
config switch_vlan            
        option device &#039;rt305x&#039;
        option vlan &#039;1&#039;       
        option ports &#039;1 2 3 4  6t&#039;
                                  
config switch_vlan                
        option device &#039;rt305x&#039;    
        option vlan &#039;2&#039;           
        option ports &#039;0  6t&#039;</code></pre></div><p>I tried to ping 192.168.1.2 and got no response. I changed the lan bridge to use eth0.2, restarted the network, and got the same result.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167110">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						11 May 2012, 16:38					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s strange. Please change port0 and port4:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth0.1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
                              
config switch                 
        option name &#039;rt305x&#039;  
        option reset &#039;1&#039;    
        option enable_vlan &#039;1&#039;
                              
config switch_vlan            
        option device &#039;rt305x&#039;
        option vlan &#039;1&#039;       
        option ports &#039;0 1 2 3   6t&#039;
                                  
config switch_vlan                
        option device &#039;rt305x&#039;    
        option vlan &#039;2&#039;           
        option ports &#039;4  6t&#039;</code></pre></div><p>restart network and show swconfig output</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167111">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						11 May 2012, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>I just found that if there&#039;s no config in /etc/config/network for an interface, it is not created and ifconfig -a does not show it. I added a config for eth0.2 and assigned static 192.168.1.1 and I was able to ping my laptop!</p><p>Thanks for the help! I will try what you say, because I want to understand how this works. You know the XDX-RN502R has only one physical ethernet port? I know there&#039;s a switch inside, but that&#039;s just confusing me for now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167114">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						11 May 2012, 17:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elecnix wrote:</cite><blockquote><p>You know the XDX-RN502R has only one physical ethernet port?</p></blockquote></div><p>I see photo <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. And I met the same problem while porting to Dlink DIR-620 revA (rt3052).<br /></p><div class="quotebox"><blockquote><p>I know there&#039;s a switch inside, but that&#039;s just confusing me for now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Welcome to virtual lan world... Good luck!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210737">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">elecnix</div>
					<div class="post-datetime">
						25 Aug 2013, 07:07					</div>
				</div>
				<div class="post-content content">
					<p>My patch was rejected. I do not know why. It is here: <a href="http://patchwork.openwrt.org/patch/2605/">http://patchwork.openwrt.org/patch/2605/</a></p><p>I maintain a git branch for that router here: <a href="https://github.com/elecnix/openwrt/tree/xdx-rn502r">https://github.com/elecnix/openwrt/tree/xdx-rn502r</a> It is currently 400+ commits behind trunk, and I rebase the branch when needed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p297483">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mattic</div>
					<div class="post-datetime">
						26 Oct 2015, 15:07					</div>
				</div>
				<div class="post-content content">
					<p>Hello elecnix - would you like to have a look at - <a href="https://forum.openwrt.org/viewtopic.php?pid=297480#p297480">https://forum.openwrt.org/viewtopic.php â€¦ 80#p297480</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>