<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> No Gigabit Speed WAN with BarrierBreaker/TL-WDR4300</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p258323">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						21 Dec 2014, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys.<br />I have a FFTH 200/100 installed at my home office and since I started using OpenWRT I cannot get 200Mbps downloads anymore.<br />I have tested with the router provided by my ISP and the speeds are just fine: 214Mbps, but with OpenWRT the max I can get it&#039;s 100mbps.<br />The Switch page shows all ports at 1Gbps, the LAN interface at my desktop shows me the same.<br />I think I&#039;m using the last versions available:LuCI Trunk (0.12+svn-r10530) OpenWrt Barrier Breaker 14.07 <br />Any ideas?<br />Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258324">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						21 Dec 2014, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Is QoS on and capped?</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 21 Dec 2014, 16:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258328">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						21 Dec 2014, 18:06					</div>
				</div>
				<div class="post-content content">
					<p>Thanks alphasparc for your response.<br />I don&#039;t have any QoS package installed, so I don&#039;t think that&#039;s the problem. I&#039;m just moved from pfSense looking for a lighter solution and save some power. I have 2 Wan Uplinks, which by the way was working flawlessly in pfSense for Wan Failover, after a lot of pain I gave up from multiwan in OpenWRT, maybe I&#039;m too noobish in OpenWRT world to deal with this. I don&#039;t think going back to pfSense it&#039;s a choice that&#039;s why I&#039;m trying to keep OpenWRT.<br />The problem I&#039;m having right now is not related with Multiwan package since it&#039;s uninstalled and I have just one WAN connected to the router.<br />I don&#039;t know if it&#039;s worth to mention, but my ISP connection is thru a tagged PPPOE, this could be impacting negatively on my speeds? <br />Another point is: Two computers connected to OpenWRT router switch reaches gigabit speeds transfering files between them, but none of them can go above 100mbps on WAN.<br />As I said before, with the router provided by my ISP I can go 214Mbps easily anytime.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258330">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zhadoom</div>
					<div class="post-datetime">
						21 Dec 2014, 18:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>See here: <a href="https://forum.openwrt.org/viewtopic.php?id=51726">https://forum.openwrt.org/viewtopic.php?id=51726</a></p><p>Barrier Breaker ( 14.07 ) suffer from a recently discovered &quot;limitation&quot; that limits the nat performance. It&#039;s already fixed in Chaos Calmer trunks but this still beta.</p><p>Use Attitude Adjustment ( 12.09 ) to not suffer from this limitation. Wdr4300 must support over 250Mb/s ( wan to lan ) using 12.09.</p><p>PS. I&#039;m from Brazil. Do you use Vivo Fibra ?</p>											<p class="post-edited">(Last edited by <strong>zhadoom</strong> on 21 Dec 2014, 18:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258331">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						21 Dec 2014, 18:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zhadoom wrote:</cite><blockquote><p>Hi,</p><p>See here: <a href="https://forum.openwrt.org/viewtopic.php?id=51726">https://forum.openwrt.org/viewtopic.php?id=51726</a></p><p>Barrier Breaker ( 14.07 ) suffer from a recently discovered &quot;limitation&quot; that limits the nat performance. It&#039;s already fixed in Chaos Calmer trunks but this still beta.</p><p>Use Attitude Adjustment ( 12.09 ) to not suffer from this limitation. Wdr4300 must support over 250Mb/s ( wan to lan ) using 12.09.</p><p>PS. I&#039;m from Brazil. Do you use Vivo Fibra ?</p></blockquote></div><p>Yes, Vivo Fibra <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> and I can consider myself happy because I never had a connection or speed problems. It&#039;s almost 8 months unharmed <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. <br />So any chance to get this working on Barrier Breaker? I had a lot...and I mean a LOT of stuff configured, DNS redirections, NAT rules and so on...AFAIK I can&#039;t restore a Barrier Breaker backup on Attitude Adjustment setup.<br />It will be a such pain to make this stuff all over again.<br />Thanks for the hint.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258333">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">zhadoom</div>
					<div class="post-datetime">
						21 Dec 2014, 18:34					</div>
				</div>
				<div class="post-content content">
					<p>There are some users trying Barrier Breaker backports to the solution used in Chaos Calmer.<br />Right now the only solutions to achieve full speed ( over 160Mb/s depending on the router ) using Openwrt are:<br />- a more powerfull hardware that overcame the limitation by brute force ( Ex. wdr4900 )<br />- use chaos calmer trunk ( not recomended since it&#039;s&nbsp; beta stage )<br />- use attitude adjustment ( 12.09 ) since it not suffer from this limitation<br />- watch the topic ( <a href="https://forum.openwrt.org/viewtopic.php?id=51726">https://forum.openwrt.org/viewtopic.php?id=51726</a> ) to see if an stable backported solution is available to the WDR4300. You can look at the this topic too: <a href="https://forum.openwrt.org/viewtopic.php?id=47382">https://forum.openwrt.org/viewtopic.php?id=47382</a> .</p>											<p class="post-edited">(Last edited by <strong>zhadoom</strong> on 21 Dec 2014, 18:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258338">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						21 Dec 2014, 19:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zhadoom wrote:</cite><blockquote><p>There are some users trying Barrier Breaker backports to the solution used in Chaos Calmer.<br />Right now the only solutions to achieve full speed ( over 160Mb/s depending on the router ) using Openwrt are:<br />- a more powerfull hardware that overcame the limitation by brute force ( Ex. wdr4900 )<br />- use chaos calmer trunk ( not recomended since it&#039;s&nbsp; beta stage )<br />- use attitude adjustment ( 12.09 ) since it not suffer from this limitation<br />- watch the topic ( <a href="https://forum.openwrt.org/viewtopic.php?id=51726">https://forum.openwrt.org/viewtopic.php?id=51726</a> ) to see if an stable backported solution is available to the WDR4300. You can look at the this topic too: <a href="https://forum.openwrt.org/viewtopic.php?id=47382">https://forum.openwrt.org/viewtopic.php?id=47382</a> .</p></blockquote></div><p>Just flashed attitude adjustment ( 12.09 ) and solved the problem.<br />Thanks for the help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258998">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						29 Dec 2014, 00:35					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m back and no dice <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />.<br />Max WAN/LAN never go above 180Mbps with AA, it&#039;s better than BB transfer speeds but still disappointing.<br />I know we cannot expect that much from a consumer router using software NAT, maybe it&#039;s time to get hardware NAT<br />working on these little boxes like the manufacturers are doing these days, it&#039;s a matter of survival for OpenWRT I think.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259004">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						29 Dec 2014, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>do you want to try my <a href="https://github.com/gwlim/Openwrt_Firmware/tree/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/Barrier_Breaker/Dec-2014-Image">firmware</a> with optimizations.<br />I have tested them using jperf but not in production.<br />BTW just to get a perspectives on things.<br />If you use lousy Ethernet cables it will cause the negotiations of link speed to drop to 100 or even 10 Mbps.<br />If you set and enable QoS at 200Mbps you will never hit 200Mbps because QoS will reserve bandwidth to provide best effort service.<br />It is the way QoS is suppose to work.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 29 Dec 2014, 03:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259050">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						29 Dec 2014, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi there,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>do you want to try my <a href="https://github.com/gwlim/Openwrt_Firmware/tree/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/Barrier_Breaker/Dec-2014-Image">firmware</a> with optimizations.<br />I have tested them using jperf but not in production.<br />BTW just to get a perspectives on things.<br />If you use lousy Ethernet cables it will cause the negotiations of link speed to drop to 100 or even 10 Mbps.<br />If you set and enable QoS at 200Mbps you will never hit 200Mbps because QoS will reserve bandwidth to provide best effort service.<br />It is the way QoS is suppose to work.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Most MIPS based routers top out at around 50 to 70 Mbps total traffic shaping capability (upstream and downstream combined), indecent on whether qos-scripts ae used or sqm-scripts. So unless you know your router has enough &quot;horse power&quot; software shaping as performed by openwrt is not going to be enough for a 200Mbps link (btw symmetric?)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259053">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						29 Dec 2014, 15:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Hi there,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>do you want to try my <a href="https://github.com/gwlim/Openwrt_Firmware/tree/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/Barrier_Breaker/Dec-2014-Image">firmware</a> with optimizations.<br />I have tested them using jperf but not in production.<br />BTW just to get a perspectives on things.<br />If you use lousy Ethernet cables it will cause the negotiations of link speed to drop to 100 or even 10 Mbps.<br />If you set and enable QoS at 200Mbps you will never hit 200Mbps because QoS will reserve bandwidth to provide best effort service.<br />It is the way QoS is suppose to work.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Most MIPS based routers top out at around 50 to 70 Mbps total traffic shaping capability (upstream and downstream combined), indecent on whether qos-scripts ae used or sqm-scripts. So unless you know your router has enough &quot;horse power&quot; software shaping as performed by openwrt is not going to be enough for a 200Mbps link (btw symmetric?)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>Do you have any test case for that, and what happens when your bandwidth is&nbsp; &gt;&gt;&gt; QoS limits ?<br />From my own testing currently QoS is already working on my 25Mbps subscription when I set the limits it is enforced so I prefer synthetic test that can be run and tested.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 29 Dec 2014, 15:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259082">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						29 Dec 2014, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi alphasparc,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Hi there,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>do you want to try my <a href="https://github.com/gwlim/Openwrt_Firmware/tree/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/Barrier_Breaker/Dec-2014-Image">firmware</a> with optimizations.<br />I have tested them using jperf but not in production.<br />BTW just to get a perspectives on things.<br />If you use lousy Ethernet cables it will cause the negotiations of link speed to drop to 100 or even 10 Mbps.<br />If you set and enable QoS at 200Mbps you will never hit 200Mbps because QoS will reserve bandwidth to provide best effort service.<br />It is the way QoS is suppose to work.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Most MIPS based routers top out at around 50 to 70 Mbps total traffic shaping capability (upstream and downstream combined), indecent on whether qos-scripts ae used or sqm-scripts. So unless you know your router has enough &quot;horse power&quot; software shaping as performed by openwrt is not going to be enough for a 200Mbps link (btw symmetric?)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>Do you have any test case for that, and what happens when your bandwidth is&nbsp; &gt;&gt;&gt; QoS limits ?<br />From my own testing currently QoS is already working on my 25Mbps subscription when I set the limits it is enforced so I prefer synthetic test that can be run and tested.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So I typically run netperf-wrapper&#039;s RRUL test either against a server upstream or against a netperf net server running behind my bottleneck. The symptom of the lack of horsepower is that the total transfer rates (uplink plus downlink if both are shaped) stay well below the configured limit. My own connection (50Mbps/10Mbps) is just within the limits of the wndr3700v2 I use, so I have the same problem you have in actually testing shaper performance.... <br />&nbsp; &nbsp; &nbsp; &nbsp; Have a look at the next to last plots in <a href="http://burntchrome.blogspot.de/2014/08/new-comcast-speeds-new-cerowrt-sqm.html">http://burntchrome.blogspot.de/2014/08/ â€¦ t-sqm.html</a> to get an idea how the shaping looks once the CPU is out of its comfort zone <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> (typically the router will spend most of its cycles on &quot;sirq&quot; or soft interrupts).</p><p>Hope that helps<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259109">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">joaopaulo.mello</div>
					<div class="post-datetime">
						29 Dec 2014, 23:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Hi there,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>do you want to try my <a href="https://github.com/gwlim/Openwrt_Firmware/tree/master/TP-Link_TL-WDR3500-3600-43XX-WM4350R/Barrier_Breaker/Dec-2014-Image">firmware</a> with optimizations.<br />I have tested them using jperf but not in production.<br />BTW just to get a perspectives on things.<br />If you use lousy Ethernet cables it will cause the negotiations of link speed to drop to 100 or even 10 Mbps.<br />If you set and enable QoS at 200Mbps you will never hit 200Mbps because QoS will reserve bandwidth to provide best effort service.<br />It is the way QoS is suppose to work.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Most MIPS based routers top out at around 50 to 70 Mbps total traffic shaping capability (upstream and downstream combined), indecent on whether qos-scripts ae used or sqm-scripts. So unless you know your router has enough &quot;horse power&quot; software shaping as performed by openwrt is not going to be enough for a 200Mbps link (btw symmetric?)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>No worries about lousy cables, all cat6 with cat6 shielded connectors and I don&#039;t use QoS.<br />I have here two uplinks, one FFTH 200/100 and another cable used for failover 30/2.<br />What&#039;s new on your optimized firmware? What transfers do you get?<br />I have one rack server 1.5u that I build for pfSense (i3 quad core 16GB RAM). I have tested a lot of OpenWRT x86 custom images but no one stable enough for use one day after another, the perfomance is sky high but it&#039;s not worth the risk, it&#039;s very experimental and really not optmized for x86 hardware. That&#039;s the reason I have moved from pfSense, which currently is pretty broken IMO, a lot of issues with 2.2. It crashes several times in a daily basis and the 2.1 is older...without support for new hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259117">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						30 Dec 2014, 01:55					</div>
				</div>
				<div class="post-content content">
					<p>Besides compiler optimization, I added QCA patches from codeauroa and some dd-wrt findings.<br />Backported Routing Cache fix as well.<br />Source is available from the github repo if you want to build it yourself.<br />mips74k-barrier-breaker-patch .git<br />Basically it pulls vanilla barrier breaker and patches it accordingly before you build manually.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 30 Dec 2014, 02:31)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>