<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Which method to use USB as pkg destination ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p70341">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						2 Jul 2008, 09:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I would like to try to&nbsp; use my mounted USB as a package destination so that I can install more stuff on my 500gp. There are different methods on the wiki :<br /><a href="http://wiki.openwrt.org/HowToInstallOntoUsbDrive">http://wiki.openwrt.org/HowToInstallOntoUsbDrive</a><br /><a href="http://wiki.openwrt.org/UsbStorageHowto#head-3c6cbace3d9963db44aa1fd1f3fcd09fc64dc92b">http://wiki.openwrt.org/UsbStorageHowto … 9fc64dc92b</a><br /><a href="http://wiki.openwrt.org/PackagesOnExternalMediaHowTo">http://wiki.openwrt.org/PackagesOnExternalMediaHowTo</a></p><p>I would like to ask you which one of those you would recommend for a Asus 500gp. </p><br /><p>Thanks<br />Tex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70342">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">frogonwheels</div>
					<div class="post-datetime">
						2 Jul 2008, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>Tex, I wrote the top one - describing what I did for my Asus 500GP and I find it works quite well.<br />There is some stuff about formatting etc that is fairly universal and explained in the 2nd link - so didn&#039;t repeat that.</p><p>I have Asterisk and XMail working off my usb that get started once the drive is fschk&#039;d and mounted...<br />but the rest of the network stuff doesn&#039;t wait round for the fsck to finish</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70352">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">easter</div>
					<div class="post-datetime">
						2 Jul 2008, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m currently experimenting with Kamikaze trunk on a wl500gp with a 40GB USB hard disc, and look forward to reading other people&#039;s contributions.</p><p>I initially tried getting ipkg to install packages to my drive, but found the packages I tried assumed they&#039;d been installed under / and didn&#039;t like being under /mnt or /opt or whatever. Adding vast numbers of links seems an inelegant solution. (Yes, I did add the extra directories to my PATH and LD_LIBRARY_PATH.)</p><p>I&#039;m now playing with using the pivotroot script from the second of your links, and it seems to be working nicely. I&#039;ve created a 128MB swap partition, a 2GB root partition and a 38GB (or so) /data partition. I&#039;ve added the swap and /data partitions to /etc/config/fstab and they get mounted at boot. I&#039;ve also added a &quot;local&quot; script to /etc/init.d to move a few things from /var to /data/var and redirect syslogd to a file, to keep the ramfs as empty as possible.</p><p>If the usb disc isn&#039;t there at boot time, the new version of /etc/config/fstab and my local script aren&#039;t seen and the unit just boots from flash as normal. I just have to make sure that I keep the flash version of some config files up to date with the disc version.</p><p>I&#039;m a complete beginner at OpenWrt (having used Oleg&#039;s in the past) so don&#039;t put too much faith in my approach.</p>											<p class="post-edited">(Last edited by <strong>easter</strong> on 2 Jul 2008, 15:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70378">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						2 Jul 2008, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>ok thanks.<br />frogonwheels, I&#039;m trying to use your method but I&#039;m a bit confused about the &quot;/etc/rc.common&quot; part.&nbsp; If I understand correctly, I have to copy <br />/etc/rc.common to /usb/etc/rc.common and replace the disable, enable and enabled functions with yours. Is that correct ?</p><p>Thanks,<br />Tex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70387">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						2 Jul 2008, 23:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Tex-Twil wrote:</cite><blockquote><p>ok thanks.<br />frogonwheels, I&#039;m trying to use your method but I&#039;m a bit confused about the &quot;/etc/rc.common&quot; part.&nbsp; If I understand correctly, I have to copy <br />/etc/rc.common to /usb/etc/rc.common and replace the disable, enable and enabled functions with yours. Is that correct ?</p><p>Thanks,<br />Tex</p></blockquote></div><p>ok I got it now. The rc.common just has to stay where it is but the&nbsp; disable, enable and enabled must be modified. I tested it, the K* and S* links are created properly in /usb/etc/rc.d/</p><p>The problem is that when I simply want to start the service, it fails because of a wrong path I guess:</p><div class="codebox"><pre><code>ipkg -d usb install  vsftpd
Installing vsftpd (2.0.6-2) to usb...
Downloading file:///mnt/usbdrive/bin/packages/mipsel/./vsftpd_2.0.6-2_mipsel.ipk
Configuring vsftpd
Done.
root@ap:~# /usb/etc/init.d/vsftpd enable
root@ap:~# ls -alR /usb/
/usb/:
      2 drwxr-xr-x    4 root     root         4096 Jul  2 22:09 .
     26 drwxr-xr-x   11 root     root            0 Jan  1  1970 ..
 322561 drwxr-xr-x    4 root     root         4096 Jul  2 22:23 etc
 129025 drwxr-xr-x    4 root     root         4096 Jul  2 22:15 usr

/usb/etc:
 322561 drwxr-xr-x    4 root     root         4096 Jul  2 22:23 .
      2 drwxr-xr-x    4 root     root         4096 Jul  2 22:09 ..
 322564 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 init.d
 322563 drwxr-xr-x    2 root     root         4096 Jul  2 22:24 rc.d
 322566 -rw-------    1 root     root          364 Jun 13 15:01 vsftpd.conf

/usb/etc/init.d:
 322564 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 .
 322561 drwxr-xr-x    4 root     root         4096 Jul  2 22:23 ..
 322565 -rwxr-xr-x    1 root     root          149 Jul  2 21:24 vsftpd

/usb/etc/rc.d:
 322563 drwxr-xr-x    2 root     root         4096 Jul  2 22:24 .
 322561 drwxr-xr-x    4 root     root         4096 Jul  2 22:23 ..
 322567 lrwxrwxrwx    1 root     root           16 Jul  2 22:24 K50vsftpd -&gt; ../init.d/vsftpd
 322562 lrwxrwxrwx    1 root     root           16 Jul  2 22:24 S50vsftpd -&gt; ../init.d/vsftpd

/usb/usr:
 129025 drwxr-xr-x    4 root     root         4096 Jul  2 22:15 .
      2 drwxr-xr-x    4 root     root         4096 Jul  2 22:09 ..
 129026 drwxr-xr-x    3 root     root         4096 Jul  2 22:13 lib
 129032 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 sbin

/usb/usr/lib:
 129026 drwxr-xr-x    3 root     root         4096 Jul  2 22:13 .
 129025 drwxr-xr-x    4 root     root         4096 Jul  2 22:15 ..
 129027 drwxr-xr-x    3 root     root         4096 Jul  2 22:15 ipkg

/usb/usr/lib/ipkg:
 129027 drwxr-xr-x    3 root     root         4096 Jul  2 22:15 .
 129026 drwxr-xr-x    3 root     root         4096 Jul  2 22:13 ..
 129028 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 info
 129035 -rw-r--r--    1 root     root          188 Jul  2 22:15 status

/usb/usr/lib/ipkg/info:
 129028 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 .
 129027 drwxr-xr-x    3 root     root         4096 Jul  2 22:15 ..
 129031 -rw-r--r--    1 root     root           17 Jun 13 15:01 vsftpd.conffiles
 129030 -rw-r--r--    1 root     root          248 Jun 13 15:01 vsftpd.control
 129034 -rw-r--r--    1 root     root          113 Jul  2 22:15 vsftpd.list

/usb/usr/sbin:
 129032 drwxr-xr-x    2 root     root         4096 Jul  2 22:15 .
 129025 drwxr-xr-x    4 root     root         4096 Jul  2 22:15 ..
 129033 -rwxr-xr-x    1 root     root       151163 Jun 13 15:01 vsftpd</code></pre></div><p>And then<br /></p><div class="codebox"><pre><code>root@ap:~#  /usb/etc/init.d/vsftpd start
/etc/rc.common: eval: line 13: vsftpd: not found</code></pre></div><p>Shouldn&#039;t the export of PATH and LD_LIBRARY_PATH be in /etc/profile or somewhere else ?</p><p>Cheers,<br />Tex</p>											<p class="post-edited">(Last edited by <strong>Tex-Twil</strong> on 2 Jul 2008, 23:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70389">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						3 Jul 2008, 00:10					</div>
				</div>
				<div class="post-content content">
					<p>I also did some minor modification to your script:<br />- it doesn&#039;t tries to start the services if there are no S* files in the rc.d dir<br />- same for the stop<br />- some beautification such as variables for the mount device / mount point<br />- better logging<br />- ..</p><p>Take it or leave it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /><a href="http://openwrt.pastebin.com/f7a9c303f">http://openwrt.pastebin.com/f7a9c303f</a></p><p>edit: in the script I forgot to uncomment the&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#e2fsck -p $DEV line 60.<br />Tex</p>											<p class="post-edited">(Last edited by <strong>Tex-Twil</strong> on 3 Jul 2008, 09:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70410">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						3 Jul 2008, 09:33					</div>
				</div>
				<div class="post-content content">
					<p>Finally, I think there is another issue:<br />vsftpd, for example, can&#039;t find its vsftpd.conf cons it is looking for it in /etc/ and not /usb/etc/. I guess it will be the same for other config files ..</p><p>Tex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70414">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">frogonwheels</div>
					<div class="post-datetime">
						3 Jul 2008, 11:14					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Tex-Twil.&nbsp; I&#039;ve taken a few things from that.&nbsp; Possibly I will extend it to have a defaults/ file to contain the settings.</p><p>The couple of things I&#039;ve installed on the usb drive ( asterisk and xmail) have actually handled it well.&nbsp; Usually you create an /etc/default/&nbsp; entry that specified the config file - though it should be created for you.</p><p>Submit a patch to the maintainer if it doesn&#039;t.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70415">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						3 Jul 2008, 11:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>frogonwheels wrote:</cite><blockquote><p>Usually you create an /etc/default/&nbsp; entry that specified the config file - though it should be created for you.</p></blockquote></div><p>Could you explain more ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70416">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">frogonwheels</div>
					<div class="post-datetime">
						3 Jul 2008, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>By default, when I install asterisk on /usb, it does 2 things - first is to fill in the line</p><div class="codebox"><pre><code>DEST=/usb/</code></pre></div><p>in the init.d file.&nbsp; The second is to create a file ${DEST}/etc/default/asterisk&nbsp; that contains the line </p><div class="codebox"><pre><code>OPTIONS=&quot;-C /usb/etc/asterisk/asterisk.conf&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70466">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						4 Jul 2008, 15:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,<br />FYI: I&#039;ve just tried the 2nd method <a href="http://wiki.openwrt.org/UsbStorageHowto#head-3c6cbace3d9963db44aa1fd1f3fcd09fc64dc92b">http://wiki.openwrt.org/UsbStorageHowto … 9fc64dc92b</a> and it seems to be working fine.</p><p>regards,<br />Tex</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>