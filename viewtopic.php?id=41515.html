<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Openwrt with ZRAM !</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p188290">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						8 Jan 2013, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>Openwrt support ZRAM now !<br />Let&#039;s try it.<br />By default it will automatically use half of system memory as ZRAM.</p><div class="codebox"><pre><code>root@:/# dmesg|grep -i zr
[    1.250000] zram: num_devices not specified. Using default: 1
[    1.250000] zram: Creating 1 devices ...
[   23.660000] Adding 13308k swap on /dev/zram0.  Priority:-1 extents:1 across:13308k SS
root@:/# swapon -s
Filename                                Type            Size    Used    Priority
/dev/zram0                              partition       13308   0       -1
root@:/#</code></pre></div><p>Now, my Linux server, Android mobiles, and openwrt routers also using ZRAM.<br /><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188298">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Chickenbox</div>
					<div class="post-datetime">
						8 Jan 2013, 16:38					</div>
				</div>
				<div class="post-content content">
					<p>Good news !</p><p>May we have some explanation ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188300">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						8 Jan 2013, 16:46					</div>
				</div>
				<div class="post-content content">
					<p>From wikipedia:<br />zRam is an experimental (staging) module of the Linux kernel. It was previously called &quot;compcache&quot;. zRam increases performance by avoiding paging on disk and instead uses a compressed block device in RAM in which paging takes place until it is necessary to use the swap space on the hard disk drive. Since using RAM is faster than using disks, zRam allows Linux to make more use of RAM when swapping/paging is required, especially on older computers with less RAM installed</p><br /><p>So basically it speeds up HDD access, but perhaps more importantly it reduces read/writes to Flash, which IMO has low longevity on linux due to constant r/w access. <br />You do need RAM to utilize this. How much? <br />Back to you johan666</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188301">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Chickenbox</div>
					<div class="post-datetime">
						8 Jan 2013, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Does Openwrt&#039;s kernel support ZRAM ? How do you make use of it ?<br />I guess we must create a device and issue a &quot;swap on&quot; it ?</p><p>ps : sorry for my poor english <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>Chickenbox</strong> on 8 Jan 2013, 16:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188322">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						8 Jan 2013, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>ZRAM supported since trunk r35025<br />no need to create... config....<br />by default, the system script will do that.</p><p>@robthebrew<br />Utilize !? experimental !?<br />Are you kidding me ?<br />Probably you&#039;ve totally forgot why you use linux, openwrt.....<br /><img src="https://forum.openwrt.org/img/smilies/roll.png" width="15" height="15" alt="roll" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188328">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						8 Jan 2013, 20:43					</div>
				</div>
				<div class="post-content content">
					<p>lolz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229460">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						7 Apr 2014, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>hello,<br />i need help to add zram capability to my openwrt image, but step by steps:<br />i try to compile attitude-adjustment image for my Pirelli AGA and i need zram because it has limited resources.<br />if i try latest trunk this one is too heavy for my AGA, so i must compile old 12.09 revision.<br />so i tried the rev 38795 but when i run &#039;make menuconfig&#039; i don&#039;t find zram in the configuration tools.<br />what&#039;s wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229469">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						7 Apr 2014, 18:04					</div>
				</div>
				<div class="post-content content">
					<p>IMHO zram is fully supported in trunk only</p><p>there was some support for Atheros in prior trunk versions</p><p>I did test in DIR-300A1 / Fon2100 but was not very happy with trunk newer trunk releases (after rel37729) <br />even with zram. More RAM than 16mb helps a little.</p><p>Trunk BB 37729 works fine though without zram on 4/16MB on old hardware Fon / DIR300A1<br />(build without IPV6 and other goodies you dont need)</p><p>Seems the new shiny procd/netifd/ubus and JSON stuff eating alot of RAM/CPU power.<br />Lets build a new tower of trash with the &quot;old&quot; router hardware ( quite SAD ) for the GLORY of these new implementations<br />Also never heard about specific heed this will come in such a way.</p><p>Communication in not the strongest part of the developers, system documentation neither.<br />I do wonder where the treashure of information is hidden though. <br />Welcome to wade through Trak - mailinglist - sourcecode to find a peace now and then.</p><p><a href="https://dev.openwrt.org/browser/trunk/package/zram-swap/files/etc/init.d/zram?rev=35028">https://dev.openwrt.org/browser/trunk/p … ?rev=35028</a></p><p><a href="http://patchwork.openwrt.org/patch/1609/">http://patchwork.openwrt.org/patch/1609/</a></p><p>search for zram Bastian Bittdorf</p><br /><p>You may try to build BB trunk @37729 ( or around ) with IPV6 disabled and other goodies (ppp) which you wouldnt need.</p><p>Gives you some RAM headroom to run without zram also</p><p>I&#039;m currently looking at which trunk rev they move from init to procd for my batman-adv builds</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229532">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						8 Apr 2014, 01:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>3zl wrote:</cite><blockquote><p>IMHO zram is fully supported in trunk only</p><p>there was some support for Atheros in prior trunk versions</p><p>I did test in DIR-300A1 / Fon2100 but was not very happy with trunk newer trunk releases (after rel37729) <br />even with zram. More RAM than 16mb helps a little.</p><p>Trunk BB 37729 works fine though without zram on 4/16MB on old hardware Fon / DIR300A1<br />(build without IPV6 and other goodies you dont need)</p></blockquote></div><p>if I understand well:<br />- You say that AA don&#039;t works fine with 16mb, with or not zram.<br />- You say also that Barrier-Breaker works better than Attitude-Adjustment on hw with 16mb or less.</p><p>Well, I have compiled rev newer than rev38795 (is it BarrierBreaker?) and I have tried it on my AGA but it reboot every time, I think due saturation Ram.</p><div class="quotebox"><cite>3zl wrote:</cite><blockquote><p> Communication in not the strongest part of the developers, system documentation neither.<br />I do wonder where the treashure of information is hidden though. <br />Welcome to wade through Trak - mailinglist - sourcecode to find a peace now and then.</p><p><a href="https://dev.openwrt.org/browser/trunk/package/zram-swap/files/etc/init.d/zram?rev=35028">https://dev.openwrt.org/browser/trunk/p … ?rev=35028</a></p><p><a href="http://patchwork.openwrt.org/patch/1609/">http://patchwork.openwrt.org/patch/1609/</a></p><p>search for zram Bastian Bittdorf</p></blockquote></div><p>I know that links but I don&#039;t know how I could use them....</p><div class="quotebox"><cite>3zl wrote:</cite><blockquote><p>You may try to build BB trunk @37729 ( or around ) with IPV6 disabled and other goodies (ppp) which you wouldnt need.</p><p>Gives you some RAM headroom to run without zram also<br />regards<br />3zl</p></blockquote></div><p>I&#039;ll try again to build BB trunk.<br />Please help me: which goodies can disabled if I need to use AGA like &#039;sta&#039; or &#039;repeater&#039;?</p><p>Thank a lot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229535">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 Apr 2014, 01:54					</div>
				</div>
				<div class="post-content content">
					<p>Your Pirelli AGA is a bcm63xx router, isn&#039;t it?, if you want to use wl drivers currently the best option is to use AA, among other things that may fail in trunk revisions.</p><p>You can use zram in <strong>AA 12.09</strong>. Since zram is a kernel thing already present in 3.3 kernels, just build openwrt with zram enabled in the kernel itself:<br /></p><div class="codebox"><pre><code>make kernel_menuconfig</code></pre></div><p>Search for <strong>zram</strong> and enable it.</p><p>Then once the firmware is built and flashed, you can activate it, example 5MB:<br /></p><div class="codebox"><pre><code>echo $((5*1024*1024)) &gt; /sys/block/zram0/disksize
mkswap /dev/zram0
swapon /dev/zram0</code></pre></div><p>You can add these comands to rc.local, or make an init script to activate it earlier.</p><br /><br /><p>more info about zram at:<br /><a href="http://lxr.free-electrons.com/source/drivers/staging/zram/zram.txt?v=3.3">http://lxr.free-electrons.com/source/dr … .txt?v=3.3</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229575">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						8 Apr 2014, 14:13					</div>
				</div>
				<div class="post-content content">
					<p>yes, AGA is a bcm63xx router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229578">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						8 Apr 2014, 14:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>From wikipedia:<br />zRam is an experimental (staging) module of the Linux kernel. It was previously called &quot;compcache&quot;. zRam increases performance by avoiding paging on disk and instead uses a compressed block device in RAM in which paging takes place until it is necessary to use the swap space on the hard disk drive. Since using RAM is faster than using disks, zRam allows Linux to make more use of RAM when swapping/paging is required, especially on older computers with less RAM installed</p></blockquote></div><p>That&#039;s true. However, doesn&#039;t any compression/decompression use up CPU cycles?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229592">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						8 Apr 2014, 17:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>You can use zram in <strong>AA 12.09</strong>. Since zram is a kernel thing already present in 3.3 kernels, just build openwrt with zram enabled in the kernel itself:<br /></p><div class="codebox"><pre><code>make kernel_menuconfig</code></pre></div><p>Search for <strong>zram</strong> and enable it.</p></blockquote></div><p>please tell me what exactly does: &#039;make kernel_menuconfig&#039; .</p><p>Now if i type </p><div class="codebox"><pre><code>svn co svn://svn.openwrt.org/openwrt/branches/attitude_adjustment</code></pre></div><p> it download rev 40423. is it correct?</p>											<p class="post-edited">(Last edited by <strong>gem1978</strong> on 8 Apr 2014, 17:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229595">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						8 Apr 2014, 18:02					</div>
				</div>
				<div class="post-content content">
					<p>&lt;That&#039;s true. However, doesn&#039;t any compression/decompression use up CPU cycles?&gt;</p><p>true..so practically its stops the router from beeing reset by watchdog/low memory <br />but takes quite some efford/ compressing/decompressing which lags responsiveness</p><p>there is some adjustment you can make with &quot;swappiness&quot; a.s.o but practically not much use in old Fon2100/DIR300A1</p><p>I wasnt happy with the solution then and rather went for smaller build with trunk around 37729 (old init instead of procd..)<br />Speaking of atheros branch though.</p><p>Implementation of zram depends on target/kernel &amp; release</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229749">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						9 Apr 2014, 23:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>You can use zram in <strong>AA 12.09</strong>. Since zram is a kernel thing already present in 3.3 kernels, just build openwrt with zram enabled in the kernel itself:<br /></p><div class="codebox"><pre><code>make kernel_menuconfig</code></pre></div><p>Search for <strong>zram</strong> and enable it.</p></blockquote></div><p>I don&#039;t understand.... in order: <br />- &#039;make kernel_menuconfig&#039;&nbsp; <br />- enable zram<br />- &#039;make&#039;<br />After that, I need to do:<br />- &#039;make menuconfig&#039; <br />- search and enable my favorites options<br />- apply patch for the AGA<br />- &#039;make&#039; </p><p>It&#039;s right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229756">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						10 Apr 2014, 00:43					</div>
				</div>
				<div class="post-content content">
					<p>No</p><p>1- &quot;make menuconfig&quot; and select your target<br />2- &quot;make kernel_menuconfig&quot; and enable zram<br />3- make the modifications to the kernel at the build dir for AGA, and at the target dir if you need it.<br />4- &quot;make&quot;</p><p>No idea about the support for the AGA router, if you have a patch for the buildtree, then apply it before step 2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229895">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						11 Apr 2014, 08:40					</div>
				</div>
				<div class="post-content content">
					<p>yes, aga router needs a patch.<br />Here wiki.openwrt.org/toh/pirelli/aga you can find more about it.</p><p>I hope the patch works again...it&#039;s for the rev 33981. I think i will must to adapt it to the last stable rev.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230112">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						13 Apr 2014, 22:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>....<br />2- &quot;make kernel_menuconfig&quot; and enable zram<br />....</p></blockquote></div><p>i don&#039;t find zram in any place....<br />where should I look?</p><p><strong>EDIT</strong><br />i found it:<br /></p><div class="quotebox"><blockquote><p>main menu -&gt;<br /> device drivers -&gt;<br /> Staging drivers -&gt; <br /> &quot;Compressed RAM block device support&quot;</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>gem1978</strong> on 13 Apr 2014, 23:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230116">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						13 Apr 2014, 23:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>Then once the firmware is built and flashed, you can activate it, example 5MB:<br /></p><div class="codebox"><pre><code>echo $((5*1024*1024)) &gt; /sys/block/zram0/disksize
mkswap /dev/zram0
swapon /dev/zram0</code></pre></div><p>You can add these comands to rc.local, or make an init script to activate it earlier.</p></blockquote></div><p>if i want to build&nbsp; a firmware with zram already active?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230118">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						13 Apr 2014, 23:59					</div>
				</div>
				<div class="post-content content">
					<p>then add it to <br /></p><div class="codebox"><pre><code>package/base-files/files/etc/rc.local</code></pre></div><p>in your build root</p><p>Edit: and don&#039;t forget to build it with the package <strong>swap-utils</strong></p>											<p class="post-edited">(Last edited by <strong>danitool</strong> on 14 Apr 2014, 00:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p231358">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						26 Apr 2014, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>what is the difference betwenn yours rc.local and this<br /></p><div class="codebox"><pre><code>echo 100000000 &gt; /sys/block/zram0/disksize
mkswap /dev/zram0
swapon -p 5 /dev/zram0</code></pre></div><p>what does &quot;swapon -p5&quot; ?</p><p><strong>EDIT</strong><br />&quot;-p 5&quot; set priority class.<br />But priority compared to what?</p>											<p class="post-edited">(Last edited by <strong>gem1978</strong> on 29 Apr 2014, 14:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238274">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">rovall</div>
					<div class="post-datetime">
						27 Jun 2014, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s the priority compared to other swap devices.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238292">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">gem1978</div>
					<div class="post-datetime">
						27 Jun 2014, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>Thank you.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>