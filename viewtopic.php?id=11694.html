<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> HowTo configure a Bridged Client with Kamikaze ???</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p52542">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">catrinelc</div>
					<div class="post-datetime">
						19 Jul 2007, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>In the WitheRussian HowTo I found a ClientModeHowto, but it is using this command:</p><p>nvram set wl0_mode=wet</p><p>Does &quot;wet&quot; mode has an equivalent in the Kamikaze release 7.6?<br />Is the Bridged Client Mode available in Kamikaze SVN ?</p><p>Please describe a complete HowTo for Bridged (not Routed) Client mode in Kamikaze !</p><p>Thanx<br />CC</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52722">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nathan_vanan</div>
					<div class="post-datetime">
						24 Jul 2007, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>I tried Bridged client mode in Kamikaze, no luck, did not work for me.<br />Then, I went back to white Russ 0.9, it works great now ....</p><p>In Kamikaze, I modified the /etc/config/wireless file......change ap/sta to wet<br />You can try that too, and let me know if it works.....</p><p>nathan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52913">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						27 Jul 2007, 12:05					</div>
				</div>
				<div class="post-content content">
					<p>Last I heard, a &#039;wet&#039;-compatible mode is <em>never</em> going to be implemented in Kamikaze <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> See <a href="http://forum.openwrt.org/viewtopic.php?id=7189&amp;p=2">http://forum.openwrt.org/viewtopic.php?id=7189&amp;p=2</a></p><p>A possible solution involving parprouted and dhcp-forwarder is outlined here: <a href="http://wiki.openwrt.org/WirelessBridgeWithWPAHowto">http://wiki.openwrt.org/WirelessBridgeWithWPAHowto</a></p><p>Unfortunately, the parprouted home page appears to be down at the moment, and the manpage says it&#039;s only tested with 2.4 kernels: <a href="http://downloads.openwrt.org/people/nico/man/man8/parprouted.8.html">http://downloads.openwrt.org/people/nic … ted.8.html</a></p><p>It has been suggested that ebtables can do MAC NAT. However this by itself won&#039;t be sufficient without some ARP spoofing and some DHCP massaging.</p><p>For now your best bet is to run WhiteRussian, but over time that will become less of a viable solution.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52919">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">catrinelc</div>
					<div class="post-datetime">
						27 Jul 2007, 12:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>candlerb wrote:</cite><blockquote><p>Last I heard, a &#039;wet&#039;-compatible mode is <em>never</em> going to be implemented in Kamikaze <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> See <a href="http://forum.openwrt.org/viewtopic.php?id=7189&amp;p=2">http://forum.openwrt.org/viewtopic.php?id=7189&amp;p=2</a></p></blockquote></div><p>I found that thread already, thanx !</p><p>I don&#039;t understand why this mode is not supported anymore, because it is a very important use case, often needed !!!</p><p>CC</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52925">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						27 Jul 2007, 15:55					</div>
				</div>
				<div class="post-content content">
					<p>just use the regular station mode and bridge it by setting &#039;option network lan&#039; in the wifi-iface section. that&#039;ll bridge the wifi to the lan.<br />the scripts should detect that and enable the wet mode automatically</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52931">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">catrinelc</div>
					<div class="post-datetime">
						27 Jul 2007, 16:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>just use the regular station mode and bridge it by setting &#039;option network lan&#039; in the wifi-iface section. that&#039;ll bridge the wifi to the lan.<br />the scripts should detect that and enable the wet mode automatically</p></blockquote></div><p>Hi nbd<br />First of all, thanx for your fantastic work in OpenWrt !!!</p><p>You mean that the WhiteRussian &quot;wet&quot; mode (bridged client mode)<br />is configured now in kamikaze doing this:<br />&nbsp; &nbsp; uci set wireless.cfg2.mode=sta<br />&nbsp; &nbsp; uci set wireless.cfg2.network=lan<br />?</p><p>I think additional we have to start the br-lan bridge by doing this too:<br />&nbsp; &nbsp; uci set network.lan.type=bridge<br />Correct ?</p><p>CC</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53054">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						29 Jul 2007, 22:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>just use the regular station mode and bridge it by setting &#039;option network lan&#039; in the wifi-iface section. that&#039;ll bridge the wifi to the lan.<br />the scripts should detect that and enable the wet mode automatically</p></blockquote></div><p>OK, I can confirm this does work - very cool!</p><p>I tested with a Buffalo AirStation WHR-G54S and my own build of Kamikaze 7.07. What I did was:<br />(1) ipkg install kmod-brcm-wl wlc (these were missing on my unit, and without them &quot;wifi up&quot; gave odd errors about broadcom not being supported)<br />(2) vi /etc/config/network</p><div class="codebox"><pre><code>...
config interface lan
        option type     bridge
        option ifname   &quot;eth0.0&quot;
        option proto    dhcp
...</code></pre></div><p>(3) vi /etc/config/wireless</p><div class="codebox"><pre><code>config wifi-device      wl0
        option type     broadcom
        option channel  5
        option disabled 0
config wifi-iface
        option device   wl0
        option network  lan
        option mode     sta
        option ssid     MYSSID
        option hidden   0
        option encryption wep
        option key      1122334455</code></pre></div><p>With this, the unit itself was able to join the wireless network. Then, plugging a laptop into a LAN port, I was able to pick up an IP address from the same network. tcpdump on another machine showed the Broadcast flag had been set in the DHCP request; and looking at the ARP cache on another machine, I could see the same MAC address for both the OpenWrt box and the laptop:</p><div class="codebox"><pre><code>$ arp -an
? (10.69.255.103) at 00:16:01:4B:6D:6D [ether] on eth0    # &lt;&lt; the OpenWrt box
? (10.69.255.102) at 00:16:01:4B:6D:6D [ether] on eth0    # &lt;&lt; the laptop</code></pre></div><p>So all in all, this has all been implemented completely.</p><p>Question: is this just enabling the existing functionality in the closed Broadcom 2.4 driver? Which means it may not be available to Atheros users, and/or may be lost when we move to a 2.6 Broadcom driver?</p><p>Regards, Brian.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53115">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						30 Jul 2007, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>What packages does one need to install for this work work, especially with WPA. It&#039;s not clear to me whether some previous packages needed in WR0.9 are preinstalled in Kamikaze.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53125">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						30 Jul 2007, 21:47					</div>
				</div>
				<div class="post-content content">
					<p>All I needed was &#039;wlc&#039; and &#039;kmod-brcm-wl&#039;, but I was using only WEP. For WPA I expect you&#039;ll need &#039;nas&#039; as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53180">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						31 Jul 2007, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>Nas appears to already be installed. If you run ipkg list it says nas. Also I have already configured a clean install of 707 and it connects to a WPA protect WDS so it seems fine to me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53190">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						1 Aug 2007, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>I set up WPA as recommend, using a clean 707 installation. I installed as this topic recommended and it seemed to work, but now it most certainly does not! </p><p>I saw this page but it appears to go much farther than the forum topic above (which is actually confirmed working.<br /><a href="http://wiki.openwrt.org/ClientModeKamikazeStyleHowto?highlight=%28ClientModeKamikazeStyleHowto%29">http://wiki.openwrt.org/ClientModeKamik … leHowto%29</a></p><p>NOTE: could it be that my password has 39 characters? Or that it has semi-colons &#039;;&#039; in it? Other idea is that possibly there is some problem attaching to a 0.9 Whiterussian AP? It&#039;s using:</p><div class="codebox"><pre><code>wl0_akm=psk psk2
wl0_crypto=tkip+aes</code></pre></div><p>If there is anything in the whiterussian AP that&#039;s being connected to that I can change?</p><p>Is WPA supplicant required? They&#039;re all WRT54GS or WRT54GS.</p><p>I have not installed anything and the below is exactly what I have been configuring (except obscured password/SSID). All other values are default and appear to be find when compared to the suggestions in this thread.</p><div class="codebox"><pre><code>uci set system.cfg1.hostname=&#039;hostname&#039;

uci set wireless.wl0.channel=3
uci set wireless.wl0.disabled=0
uci set wireless.cfg2.network=lan
uci set wireless.cfg2.mode=sta
uci set wireless.cfg2.ssid=&#039;yep&#039;
uci set wireless.cfg2.encryption=psk2
uci set wireless.cfg2.key=&#039;blahblah&#039;

uci set network.eth0.vlan0=&quot;0 1 2 3 4 5*&quot;
uci set network.eth0.vlan1=&quot;5&quot;
uci set network.lan.ipaddr=192.168.1.13
uci set network.lan.gateway=192.168.1.10
uci set network.lan.dns=192.168.1.10
uci set network.wan.proto=none

uci commit

rm /etc/init.d/firewall
rm /etc/init.d/dnsmasq</code></pre></div>											<p class="post-edited">(Last edited by <strong>napierzaza</strong> on 1 Aug 2007, 14:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53249">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						2 Aug 2007, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>Arrgh, no one has an idea?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53341">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						3 Aug 2007, 16:13					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I&#039;ve installed WPA-Supplicant and it still does not come up. My other access point is now only running psk2 and TKIP, I tried the other way too (psk and AES) and no such luck. It&#039;s just not coming up into the network for some reason</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53343">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						3 Aug 2007, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Sounds a bit topsy-turvey to me: psk is tkip, and psk2 is aes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53350">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						3 Aug 2007, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>Okay, well I supposed that would be why you don&#039;t have to set both in Kamikaze. It&#039;s weird that you had to previously I guess! That&#039;s one thing to check out!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53356">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						3 Aug 2007, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>Okay, apparently it was the funny settings on the gateway AP with WR0.9. The mode will not work if the system you are connecting to is working with both psk and psk2 (not just the client should be using only one of them!) and also the funny &quot;both&quot; settings I have won&#039;t work either. Nothing needs to be installed, just the settings I have posted above will make it work.</p>											<p class="post-edited">(Last edited by <strong>napierzaza</strong> on 4 Aug 2007, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53401">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">drow</div>
					<div class="post-datetime">
						4 Aug 2007, 22:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>candlerb wrote:</cite><blockquote><p>Question: is this just enabling the existing functionality in the closed Broadcom 2.4 driver? Which means it may not be available to Atheros users, and/or may be lost when we move to a 2.6 Broadcom driver?</p></blockquote></div><p>I&#039;d like to know this too.&nbsp; I tried to set up bridging on one of my new Meraki Minis today, and if I use the setup described in this thread it doesn&#039;t work.&nbsp; Every time the wired device plugged into the mini sends a packet to anything besides the mini, it dumps this to the console:</p><p>br-lan: port 2(ath0) entering disabled state<br />br-lan: port 2(ath0) entering learning state<br />br-lan: topology change detected, propogating<br />br-lan: port 2(ath0) entering forwarding state</p><p>Anyway, I&#039;m guessing from this that &#039;wet&#039; is a linksys specific thing (going along with the WET part numbers on some of their bridges) and that I would need to set up MAC NAT with ebtables myself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p57490">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">jochen</div>
					<div class="post-datetime">
						14 Oct 2007, 23:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drow wrote:</cite><blockquote><div class="quotebox"><cite>candlerb wrote:</cite><blockquote><p>Question: is this just enabling the existing functionality in the closed Broadcom 2.4 driver? Which means it may not be available to Atheros users, and/or may be lost when we move to a 2.6 Broadcom driver?</p></blockquote></div><p>I&#039;d like to know this too.&nbsp; I tried to set up bridging on one of my new Meraki Minis today, and if I use the setup described in this thread it doesn&#039;t work.&nbsp; Every time the wired device plugged into the mini sends a packet to anything besides the mini, it dumps this to the console:</p><p>br-lan: port 2(ath0) entering disabled state<br />br-lan: port 2(ath0) entering learning state<br />br-lan: topology change detected, propogating<br />br-lan: port 2(ath0) entering forwarding state</p><p>Anyway, I&#039;m guessing from this that &#039;wet&#039; is a linksys specific thing (going along with the WET part numbers on some of their bridges) and that I would need to set up MAC NAT with ebtables myself.</p></blockquote></div><p>I see the same with 7.09 on a WGT634U. Using fixed IP adresses, static ARP entries and ebtables, the bridge is working though. Upgrading ebtables could probably remove the need for the ARP entries.</p><p>Jochen</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>