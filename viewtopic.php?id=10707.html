<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> fonera client mode troubles</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p48288">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lospiratos</div>
					<div class="post-datetime">
						12 May 2007, 15:42					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to set up my fonera in client mode so that the PHP-server on it can wget a website.<br />But I have some problems, I have to wait very long before the wifi is connected, and when it&#039;s connected it cannot access any site. (no route to host)<br />Gateway and DNS-server are correct, they point to my router.</p><p>Here are my config files:</p><p>/etc/config/network:</p><div class="codebox"><pre><code>config interface loopback
    option ifname    lo
    option proto    static
    option ipaddr    127.0.0.1
    option netmask    255.0.0.0

config interface lan
    option ifname    &#039;eth0&#039;
    option proto    &#039;static&#039;
    option ipaddr    &#039;192.168.123.3&#039;
    option netmask    &#039;255.255.255.0&#039;
    option gateway    &#039;192.168.123.1&#039;
    option dns    &#039;192.168.123.1&#039;</code></pre></div><p>/etc/config/wireless:</p><div class="codebox"><pre><code>config wifi-device  wifi0
    option type     atheros
    option distance    &#039;200&#039;
    option diversity    &#039;0&#039;
    option txantenna    &#039;0&#039;
    option rxantenna    &#039;0&#039;

config wifi-iface
    option device    wifi0
    option ssid    &#039;HomeWifi&#039;
    option mode    &#039;sta&#039;
    option encryption    &#039;psk&#039;
    option txpower    &#039;18&#039;
    option bgscan    &#039;1&#039;
    option key    &#039;jsdhbfsqdghfh&#039;
    option key1    &#039;&#039;
    option key2    &#039;&#039;
    option key3    &#039;&#039;
    option key4    &#039;&#039;
    option network    &#039;lan&#039;
    option server    &#039;&#039;
    option port    &#039;&#039;</code></pre></div><p>The routing table:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.123.0   *               255.255.255.0   U     0      0        0 eth0
192.168.123.0   *               255.255.255.0   U     0      0        0 ath0
default         192.168.123.1   0.0.0.0         UG    0      0        0 eth0</code></pre></div><p>Wget a google page:</p><div class="codebox"><pre><code>root@OpenWrt:~# wget http://www.google.com
Connecting to www.google.com [64.233.183.147:80]
wget: cannot connect to remote host (64.233.183.147): No route to host</code></pre></div><p>Can somebody help me to fix those problems, please?</p>											<p class="post-edited">(Last edited by <strong>lospiratos</strong> on 12 May 2007, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48289">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						12 May 2007, 15:49					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, client-mode sucks with every WiFi on Linux.</p><p>In my tests with Kamikaze on Fonera I only got routed client-mode with static IP and max. WEP encryption working!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48290">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lospiratos</div>
					<div class="post-datetime">
						12 May 2007, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>Can I see you working config files?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48291">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						12 May 2007, 16:00					</div>
				</div>
				<div class="post-content content">
					<p>Since it was just a test, I lost the config files... Sorry.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48300">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lospiratos</div>
					<div class="post-datetime">
						12 May 2007, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>Maybe somebody else can help me?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48301">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Joachim</div>
					<div class="post-datetime">
						12 May 2007, 20:30					</div>
				</div>
				<div class="post-content content">
					<p>@ lospiratos :<br />well , i think if we know more about your configuration , we can bring a litte bit more sunshine to you&nbsp; :-)<br />maybe it&#039;s a firewall problem , it was very helpfull if you post the output from <br />iptables -L -n -v <br />and<br />iptables -t nat -L -n -v <br />and <br />ps auxww <br />so we can see what iptables do with the incoming data and ps auxww show us if dnsmasq and udhcpc are running .....<br />if you won&#039;t post the firewall rules , please have a look at that and make shure that you have setup your iptables right <br />as far as i know , Iptables on Kamikaze are not configured for incoming data over wifi ( nat firewall , masquerading&nbsp; and so on ...)<br />you can setup&nbsp; iptables yourself , i think it was described in the wiki (client mode ) <br /> have a nice day .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48346">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">lospiratos</div>
					<div class="post-datetime">
						13 May 2007, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>Here is the output of the commands, but I first want that openwrt connects faster to my wifi network, now it takes round 10 minutes to connect.<br />Are my configuration files correct?</p><p>This is my configuration:<br />Internet-----Router))))))))(((((((((Openwrt<br />I want that the php server on openwrt can access internet files.</p><p>And how can I let my Openwrt connect to my router with a script?</p><p>iptables -L -n -v<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# iptables -L -n -v
Chain INPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
  505 57686 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
    0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp option=!2 flags:0x02/0x02
  317 20041 input_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 input_wan  all  --  wan0   *       0.0.0.0/0            0.0.0.0/0
  317 20041 LAN_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     47   --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with tcp-reset
    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
    0     0 TCPMSS     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
    0     0 forwarding_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 forwarding_wan  all  --  wan0   *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  eth0   eth0    0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  eth0   wan0    0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
  855  202K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
   18  1081 output_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
   18  1081 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with tcp-reset
    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable

Chain LAN_ACCEPT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 RETURN     all  --  wan0   *       0.0.0.0/0            0.0.0.0/0
  317 20041 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain forwarding_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination
root@OpenWrt:~#</code></pre></div><p>iptables -t nat -L -n -v<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# iptables -t nat -L -n -v
Chain PREROUTING (policy ACCEPT 350 packets, 20971 bytes)
 pkts bytes target     prot opt in     out     source               destination
   79  3792 NEW        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           state NEW
  350 20971 prerouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 prerouting_wan  all  --  wan0   *       0.0.0.0/0            0.0.0.0/0

Chain POSTROUTING (policy ACCEPT 11 packets, 668 bytes)
 pkts bytes target     prot opt in     out     source               destination
   10   610 postrouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 MASQUERADE  all  --  *      wan0    0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy ACCEPT 11 packets, 668 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain NEW (1 references)
 pkts bytes target     prot opt in     out     source               destination
   79  3792 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0           limit: avg 50/sec burst 100
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain postrouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain prerouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain prerouting_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination
root@OpenWrt:~#</code></pre></div><p>ps auxww <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ps auxww
  PID  Uid     VmSize Stat Command
    1 root        400 S   init
    2 root            SWN [ksoftirqd/0]
    3 root            SW&lt; [events/0]
    4 root            SW&lt; [khelper]
    5 root            SW&lt; [kthread]
   20 root            SW&lt; [kblockd/0]
   31 root            SW  [pdflush]
   32 root            SW  [pdflush]
   33 root            SW&lt; [kswapd0]
   34 root            SW&lt; [aio/0]
   44 root            SW  [mtdblockd]
  151 root            SWN [jffs2_gcd_mtd1]
  159 root        284 S   klogd
  162 root        408 S   logger -s -p 6 -t
  163 root        240 S   init
  189 root        328 S   /sbin/syslogd -C16 -m 0
  391 root        228 S   /sbin/hotplug2 --persistent --max-children 5
 1308 root        328 S   crond -c /etc/crontabs
 1317 root        336 S   /usr/sbin/dropbear -p 22
 1348 root        328 S   httpd -p 80 -h /www -r OpenWrt
 1354 root        288 S   pure-ftpd (SERVER)
 1419 nobody      372 S   dnsmasq -F 192.168.123.100,192.168.123.250,255.255.25
 1429 root       2340 S   php /home/lcd/lcd.php
 3162 root        380 S   /bin/sh /sbin/hotplug-call iface
 3167 root        940 S   wpa_supplicant -Bw -D wext -i ath0 -c /var/run/wpa_su
 3194 root        272 S   /usr/sbin/ntpclient -s -h pool.ntp.org -p 123
 3612 root        560 S   /usr/sbin/dropbear -p 22
 3672 root        468 S   -ash
 4083 root        388 R   ps auxww
root@OpenWrt:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48739">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lospiratos</div>
					<div class="post-datetime">
						19 May 2007, 10:55					</div>
				</div>
				<div class="post-content content">
					<p>anyone?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48759">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						19 May 2007, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:~# route<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />192.168.123.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />192.168.123.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 ath0<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.123.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0</p><p>this is almost surely incorrect, as you have the internet traffic going only over the lan interface, and have the same subnet on both..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49615">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						3 Jun 2007, 14:34					</div>
				</div>
				<div class="post-content content">
					<p>ok. good news. finally routed client-mode (static and dhcp) works now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> everything configured in the config files (/etc/config/network and /etc/config/wireless).</p><p>i have compiled kamikaze_7.06 with latest madwifi driver from /trunk/package/madwifi.</p><p>for my tests i used a fritzbox 7170 (ap) and the fonera (routed client-mode) with wep 128bit, psk and psk2. all works.</p><p>edit: i have updated the wiki page: <a href="http://wiki.openwrt.org/ClientModeKamikazeStyleHowto">ClientModeKamikazeStyleHowto</a></p>											<p class="post-edited">(Last edited by <strong>forum2006</strong> on 3 Jun 2007, 14:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49648">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						3 Jun 2007, 22:12					</div>
				</div>
				<div class="post-content content">
					<p>bridged client mode actually works the same way currently, with only minor changes in the config files, if any of you were considering trying <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.<br />if you are using a madwifi device for the access point you must also tell it to accept bridged traffic<br />option wds 1, on both ends</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53305">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Meltyblood</div>
					<div class="post-datetime">
						3 Aug 2007, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>The end of all fonera/meraki mini client mode troubles (this is directly from the wiki):<br />2.0.1. How to Automatically configure Client/Ad-hoc Client/Client+Repeater Mode on a Fonera or Meraki mini</p><p>Visit Meltyblood&#039;s site for more Openwrt/Legend firmware upgrades: <a href="http://fon.testbox.dk">http://fon.testbox.dk</a> 1. Read the instructions and get the tar.gz package from here <a href="http://fon.testbox.dk/packages/NEW/LEGEND4.5/clientscript/">http://fon.testbox.dk/packages/NEW/LEGE â€¦ entscript/</a></p><p>That&#039;s it. The package of scripts self-installs and will ask you questions to configure your wired and wireless connections. Your current configuration will be backed up and can be restored with the &quot;aprestore&quot; command. Type in &quot;clientmode&quot; after installation to configure client mode. This is currently the easiest and most complete means of having client mode on an Atheros router. These scripts are incompatible with firmwares that use NVRAM. They are included in the Legend Rev4.5 firmware, which will soon be released on the site.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>