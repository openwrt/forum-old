<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Siemens sx762, wrong u-boot environment. (I think)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Mar 2018 and 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=47078&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p216261">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						30 Oct 2013, 22:04					</div>
				</div>
				<div class="post-content content">
					<p>I followed <a href="http://wiki.openwrt.org/toh/gigaset/sx76x">these instructions</a> to install OpenWRT on my sx762 Danube. The link to the primary bootloader was dead, so I took the one from here: <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/lantiq/danube/uboot-lantiq-gigaSX76X_DDRsamsung166_flash/">http://downloads.openwrt.org/attitude_a … 166_flash/</a>. <br />The failsafe webinterface came up, and I flashed OpenWRT from trunk. However, it didn&#039;t boot.</p><p>After connecting serial, I saw a warning that the u-boot environment had the wrong CRC, using default. This is the default:</p><div class="codebox"><pre><code>DANUBE =&gt; printenv
bootcmd=run flash_flash
bootdelay=2
baudrate=115200
loads_echo=
ethaddr=00:01:02:03:04:05
ipaddr=192.168.0.119
ram_addr=0x80500000
kernel_addr=0xb0020000
mtdparts=mtdparts=ifx-nor:256k(uboot)ro,64k(uboot_env)ro,64k(kernel),-(rootfs)
flashargs=setenv bootargs rootfstype=squashfs,jffs2
nfsargs=setenv bootargs root=/dev/nfs rw nfsroot=${serverip}:${rootpath} 
addip=setenv bootargs ${bootargs} ip=${ipaddr}:${serverip}:${gatewayip}:${netmask}:${hostname}:${netdev}:off
addmisc=setenv bootargs ${bootargs} init=/etc/preinit console=ttyS1,115200 ethaddr=${ethaddr} ${mtdparts}
flash_flash=run flashargs addip addmisc;bootm ${kernel_addr}
flash_nfs=run nfsargs addip addmisc;bootm ${kernel_addr}
net_flash=run load_kernel flashargs addip addmisc;bootm ${ram_addr}
net_nfs=run load_kernel nfsargs addip addmisc;bootm ${ram_addr}
load_kernel=tftp ${ram_addr} ${tftppath}openwrt-ifxmips-uImage
update_uboot=tftp 0x80500000 ${tftppath}u-boot.bin;era 0xb0000000 +${filesize};cp.b 0x80500000 0xb0000000 ${filesize}
update_openwrt=tftp ${ram_addr} ${tftppath}openwrt-ifxmips-squashfs.image;era ${kernel_addr} +${filesize};cp.b ${ram_addr} ${kernel_addr} ${filesize}
ethact=lq_cpe_eth
stdin=serial
stdout=serial
stderr=serial
ver=U-Boot 2010.03-svn34185 (Nov 16 2012 - 07:35:05)

Environment size: 1267/65532 bytes</code></pre></div><p>When booting, I get this:</p><div class="codebox"><pre><code>## Booting kernel from Legacy Image at b0020000 ...
   Image Name:   MIPS OpenWrt Linux-3.10.17
   Created:      2013-10-26  15:50:50 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1220482 Bytes =  1.2 MB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.10.17 (Mijzelf@ubuntu) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r38539) ) #2 Sat Oct 26 15:50:02 UTC 2013
&lt;snip&gt;
[    0.000000] Kernel command line: console=ttyLTQ0,115200 init=/etc/preinit
&lt;snip&gt;
[    0.380000] 3 ofpart partitions found on MTD device ltq_nor
[    0.384000] Creating 3 MTD partitions on &quot;ltq_nor&quot;:
[    0.388000] 0x000000000000-0x000000030000 : &quot;uboot&quot;
[    0.396000] 0x000000030000-0x000000040000 : &quot;uboot_env&quot;
[    0.404000] 0x000000040000-0x000000800000 : &quot;firmware&quot;
&lt;snip&gt;
[    0.516000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    0.524000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    0.532000] 1f00             192 mtdblock0  (driver?)
[    0.536000] 1f01              64 mtdblock1  (driver?)
[    0.540000] 1f02            7936 mtdblock2  (driver?)
[    0.544000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>Seeing this it seems to me the command line is not passed to the kernel (console has a different value), and also the command line as constructed by uboot doesn&#039;t seem to contain a &#039;root=&#039; line.<br />I tried to change</p><div class="codebox"><pre><code>flashargs=setenv bootargs root=/dev/mtdblock2 rootfstype=squashfs,jffs2</code></pre></div><p>but that didn&#039;t help. It had no impact on the commandline as seen by the kernel.</p><p>How to proceed?</p>											<p class="post-edited">(Last edited by <strong>Mijzelf</strong> on 1 Nov 2013, 15:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216266">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						30 Oct 2013, 22:29					</div>
				</div>
				<div class="post-content content">
					<p>your u-boot try load kernel on b0020000, but OpenWrt partition table firmware starts at&nbsp; b0040000. you can try change kernel_addr value to 0xb0040000 and run update_openwrt procedure</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216270">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						30 Oct 2013, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>update_openwrt? You mean to tftp a new kernel+rootfs? I guess I&#039;ll have to set a server IP then?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216298">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						31 Oct 2013, 09:06					</div>
				</div>
				<div class="post-content content">
					<p>I mean this string </p><div class="codebox"><pre><code>update_openwrt=tftp ${ram_addr} ${tftppath}openwrt-ifxmips-squashfs.image;era ${kernel_addr} +${filesize};cp.b ${ram_addr} ${kernel_addr} ${filesize}</code></pre></div><p>Yes, you need to run TFTP service on own PC and set server IP same as you PC have.</p><p>But maybe would be better edit <a href="https://dev.openwrt.org/browser/trunk/target/linux/lantiq/dts/GIGASX76X.dts">file</a> where need change partition table. </p><div class="codebox"><pre><code>                                    partition@0 {
                                            label = &quot;uboot&quot;;
                                            reg = &lt;0x0 0x10000&gt;;
                                    };
    
                                    partition@10000 {
                                            label = &quot;uboot_env&quot;;
                                            reg = &lt;0x10000 0x10000&gt;;
                                    };
    
                                    partition@20000 {
                                            label = &quot;firmware&quot;;
                                            reg = &lt;0x20000 0x7e0000&gt;;
                                    };</code></pre></div>											<p class="post-edited">(Last edited by <strong>neryba</strong> on 31 Oct 2013, 10:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216300">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						31 Oct 2013, 09:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>I mean this string </p><div class="codebox"><pre><code>update_openwrt=tftp ${ram_addr} ${tftppath}openwrt-ifxmips-squashfs.image;era ${kernel_addr} +${filesize};cp.b ${ram_addr} ${kernel_addr} ${filesize}</code></pre></div><p>Yes, you need to run TFTP service on own PC and set server IP same as you PC have.</p></blockquote></div><p>I have troubles to get the image via the FailSafe UI.<br />Can I do this also from the bootloader prompt?</p><p>After rebooting and stopping the httpd service I get&nbsp; the SX76X &gt; prompt.</p><p>update_openwrt should work there?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216301">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						31 Oct 2013, 09:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wvdakker wrote:</cite><blockquote><p>update_openwrt should work there?</p></blockquote></div><p>I would even say this is the only place where it works: at the u-boot prompt. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216302">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						31 Oct 2013, 09:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Samweis wrote:</cite><blockquote><div class="quotebox"><cite>wvdakker wrote:</cite><blockquote><p>update_openwrt should work there?</p></blockquote></div><p>I would even say this is the only place where it works: at the u-boot prompt. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>I will try it later this day. I would make my day <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>If it works then an update of the wiki page would be nice.</p>											<p class="post-edited">(Last edited by <strong>wvdakker</strong> on 31 Oct 2013, 10:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216368">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						31 Oct 2013, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><div class="codebox"><pre><code>SX76X =&gt; printenv
baudrate=115200
preboot=echo;echo Type &quot;run flash_nfs&quot; to mount root filesystem over NFS;echo
hwboardid=sx76x-08-32
bootstrap=1
console_dev=ttyS1
validate_images=on
keep_magic=on
netdev=eth0
ramargs=setenv bootargs root=/dev/ram rw
addip=setenv bootargs $(bootargs) ip=$(ipaddr):$(serverip):$(gatewayip):$(netmask):$(hostname):$(netdev):off
ramdisk_addr=B0100000
flash_self=run ramargs addip addmisc;bootm $(kernel_addr) $(ramdisk_addr)
bootfile=runtime.img
primary_boot_file=primary_boot.img
secondary_boot_file=secondary_boot.img
runtime_file=runtime.img
flashargs=setenv bootargs root=/dev/mtdblock1 rootfstype=squashfs
flash_flash=run flashargs addmisc; bootm $(kernel_addr)
update_primary=tftpboot 80400000 $(primary_boot_file);upgrade primary 80400000 $(filesize) 0
update_secondary=tftpboot 80400000 $(secondary_boot_file);upgrade secondary 80400000 $(filesize) 0
update_runtime=tftpboot 80400000 $(runtime_file);upgrade runtime 80400000 $(filesize) 0
reset_nvram=erase 0xB000E000 0xB000EBFF 1
addmisc=setenv bootargs $(bootargs) ethaddr=$(ethaddr) panic=1
tftp_RootDir=tftpboot
tftp_DeviceDir=porta_danube
tftp_Rootfspath=root
kernelfile=uImage
nfsargs=setenv bootargs root=/dev/nfs rw
add_nfsrootfs=setenv bootargs $(bootargs) nfsroot=/$(tftp_RootDir)/$(tftp_DeviceDir)/$(tftp_Rootfspath)
flash_nfs=run nfsargs add_nfsrootfs addip addmisc;bootm $(kernel_addr)
nfs_flash=tftp 0x80400000 $(kernelfile);run flashargs addip addmisc;bootm 0x80400000
nfs_nfs=tftp 0x80400000 $(kernelfile);run nfsargs add_nfsrootfs addip addmisc;bootm 0x80400000
primary_version=v4.1.24.52.12
silent=0
rnd_num=
hwid=Q705-M121
ethcnt=8
boardid=sx762
usbpower=1
options=1
customer=0
platform_type=2
variant=adsl
desc=LK027210325
ethaddr=98:8B:5D:F1:F4:D8
default_variant=adsl
stdin=serial
stdout=serial
stderr=serial
ipaddr=192.168.1.1
serverip=192.168.1.16
gatewayip=192.168.1.1
kernel_addr=0xB0020000
ram_addr=0x80100000
bootdelay=2
bootcmd=httpd
ethact=lq_cpe_eth
ver=U-Boot 2010.03 (Oct 17 2012 - 01:54:36)</code></pre></div><p>I tried to get the image with the update-runtime command. I noticed I had an older version then Mijzelf had.<br />After sniffering the ethernet port I saw the arp requests from the router: who has 192.168.1.16 (server, which is my laptop).<br />My laptop answered with the MAC address. However&nbsp; the router keeps arping and does not see the arp replies from my system.</p><div class="codebox"><pre><code>4296    176.113574000    SagemCom_f1:f4:d8    Broadcast    ARP    60    Who has 192.168.1.16?  Tell 192.168.1.1
4297    176.113621000    HewlettP_87:be:f7    SagemCom_f1:f4:d8    ARP    42    192.168.1.16 is at 08:2e:5f:87:be:f7</code></pre></div><p>If I ping the router in the meantime I get a normal ICMP reply.</p><p>What is wrong here. Is there a faulty version? Mijzelf can you give me a link to your version?</p><p>thx.</p>											<p class="post-edited">(Last edited by <strong>wvdakker</strong> on 31 Oct 2013, 20:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216370">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						31 Oct 2013, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>I downloaded the secondary bootloader and openwrt from the links in the wiki:<br /><a href="https://sx76x-openwrt-danube.googlecode.com/svn/trunk/secondary-uboot/secondary_boot.img">https://sx76x-openwrt-danube.googlecode … y_boot.img</a> and <a href="http://sx76x-openwrt-danube.googlecode.com/svn/trunk/img/openwrt-lantiq-danube-GIGASX76X-allparts.image.">http://sx76x-openwrt-danube.googlecode. … rts.image.</a> After flashing the secondary bootloader, I uploaded openwrt using the Failsafe webserver. That worked fine, and I continued to replace the 1st bootloader.<br />That worked, but then I got in troubles.</p><p>I&#039;m at the moment building a new image, with the changed flash partitions, as suggested by neryba.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216385">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						31 Oct 2013, 23:26					</div>
				</div>
				<div class="post-content content">
					<p>But your secondary bootloader is not the same a I have.<br />You have the update_openwrt command. Your printenv settings are different.</p><p>Mine: ver=U-Boot 2010.03 (Oct 17 2012 - 01:54:36<br />Yours:&nbsp; ver=U-Boot 2010.03-svn34185 (Nov 16 2012 - 07:35:05)</p><p>It looks like the TCP/IP stack is not working very well. On the other hand..... why<br />am I the first to notice that <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216387">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						31 Oct 2013, 23:44					</div>
				</div>
				<div class="post-content content">
					<p>I exchanged my <em>primary</em> bootloader. </p><p>And indeed it has a bad networking driver. I do not succeed in uploading something.<br /></p><div class="codebox"><pre><code>DANUBE =&gt; httpd
starting httpd server from server 192.168.0.1
http start
........request for file /
.............expecting 4718854 bytes
received data will be stored at 80500000
521 / 4718596
1681 / 4718596
2841 / 4718596
.4001 / 4718596
..5161 / 4718596
......................6321 / 4718596
7481 / 4718596
..............................................................................8641 / 4718596
......................................................................................................................................................................
10961 / 4718596</code></pre></div><p>In wireshark I see a lot of retransmits, and the times in between gets longer and longer, and eventually times out.<br />So far I tried another cable, another port on the router, halfduplex, 10Mbit, smaller MTU. Nothing works.<br />Tftp has similar problems, and it seems this u-boot doesn&#039;t support serial upload.</p><p>Tomorrow I&#039;ll try a different host, if nobody has a better idea.</p><p>/edit: Does anybody know a way to retransmit quickly, and do it a lot of times, if no ack is received? </p><p>A strange thing is that the openwrt which is currently in the box, is uploaded using the failsafe server of the current u-boot. So it *has* worked.</p>											<p class="post-edited">(Last edited by <strong>Mijzelf</strong> on 31 Oct 2013, 23:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216400">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						1 Nov 2013, 08:06					</div>
				</div>
				<div class="post-content content">
					<p>Only thing I can upload is the secondary bootloader. After clearing it with <br /></p><div class="codebox"><pre><code>//unprotect sectors
protect off 1:0-20

//first copy nvram to new address:
era 0xb0010000 0xb001ffff
cp.b 0xb000e000 0xb0010000 0x2000</code></pre></div><p>The primary bootloader kicks in and I can upload a secondary bootloader without<br />any problems.<br />After a httpd start I also the request for file /, then expecting the file size (which is the actual size of the file I upload, so there is <br />communication).<br />So TFTP and HTTP doesnt work in de secondary bootloader I downloaded. Ping is going ok.</p><p>Searching the internet for the fileversion Mijzelf used ended up in a -uboot.bin file. But this looks like a primary bootloader and is 130kB in size.</p>											<p class="post-edited">(Last edited by <strong>wvdakker</strong> on 1 Nov 2013, 08:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216428">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						1 Nov 2013, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>? I gave the links to both bootloaders I used. Both are exactly 64kB.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216457">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						1 Nov 2013, 17:22					</div>
				</div>
				<div class="post-content content">
					<p>Found the problem with the &#039;bad&#039; TCP connection. It looks like the httpd server messed things up.</p><p>Stopping the boot proces before the httpd services start. Solved things.</p><p>After updating the primairy boot loader I ended up with a dead system:</p><div class="codebox"><pre><code>ROM VER: 1.0.3
CFG 01
Read EEPROMX
 X</code></pre></div><p>Holding the reset button and unplugging the power and reinserting it doesnt change anything.<br />Also the led from PORT1 is not on. The link stays down.<br />It look like the primary bootloader is not loaded well.</p><p>Any ideas to solve it? Or have I a dead-duck?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216460">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">jaceq</div>
					<div class="post-datetime">
						1 Nov 2013, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s dead...</p><p>Only 2 ways: 1. jtag OR 2. external programmer (and de-soldering your flash).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216461">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						1 Nov 2013, 17:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wvdakker wrote:</cite><blockquote><p>Solved things.</p></blockquote></div><p>What? How?<br /></p><div class="quotebox"><blockquote><p>Any ideas to solve it?</p></blockquote></div><p>According to the <a href="http://wiki.openwrt.org/toh/gigaset/sx76x#uart">wiki</a> you can short 4 solder islands, and upload a (provided) u-boot over serial.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216462">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						1 Nov 2013, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>I solved the TCP/IP problem by interrupting the autoboot proces before the httpd kicks in.</p><p>If I stop the autoboot proces.... tftpboot en tftp works ok and I can uplad firmware.<br />If I stop the autoboot proces, then start httpd and stop it.... tftpboot and tftp fails.</p><p>So my conclusion..... the httpd service is corrupting the tcp/ip stack.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216474">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						1 Nov 2013, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Update:</p><p>After shorting the uboot-1 and uboot-2 islands as mentioned in the wiki I managed to get the router back.</p><div class="codebox"><pre><code>ROM VER: 1.0.3
CFG 04
Read EEPROMX
 X
UART

/* upload the uboot.asc file */

U-Boot 2013.01 (Oct 31 2013 - 10:36:04) sx76x

Board: Gigaset sx76x
SoC:   Lantiq Danube-S v1.5
CPU:   111.111 MHz
IO:    111.111 MHz
BUS:   55.556 MHz
BOOT:  UART
DRAM:  32 MiB
Flash: 8 MiB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ltq-eth
Hit any key to stop autoboot:  0 
GIGASX76X # setenv ipaddr 192.168.1.1
GIGASX76X # setenv serverip 192.168.1.16
GIGASX76X # setenv ethaddr 00:11:22:33:44:55
GIGASX76X # run addip
GIGASX76X # run addeth
GIGASX76X # printenv
addconsole=setenv bootargs $bootargs console=$consoledev,$baudrate
addeth=setenv bootargs $bootargs ethaddr=$ethaddr
addip=setenv bootargs $bootargs ip=$ipaddr:$serverip::::$netdev:off
addmachtype=setenv bootargs $bootargs machtype=GIGASX76X
baudrate=115200
bootargs=ip=192.168.1.1:::::eth0:off ethaddr=00:11:22:33:44:55
bootcmd=run addeth; bootm ${kernel_addr}
bootdelay=2
consoledev=ttyLTQ1
ethact=ltq-eth
ethaddr=00:11:22:33:44:55
ipaddr=192.168.1.1
kernel_addr=0xB0040000
load-uboot-nor=tftpboot u-boot.bin
load-uboot-norspl=tftpboot u-boot.ltq.norspl
load-uboot-norspl-lzma=tftpboot u-boot.ltq.lzma.norspl
load-uboot-norspl-lzo=tftpboot u-boot.ltq.lzo.norspl
loadaddr=0x81000000
netdev=eth0
serverip=192.168.1.16
stderr=serial
stdin=serial
stdout=serial
update-uboot-nor=run load-uboot-nor write-uboot-nor
write-uboot-nor=protect off 0xB0000000 +$filesize &amp;&amp; erase 0xB0000000 +$filesize &amp;&amp; cp.b $fileaddr 0xB0000000 $filesize

Environment size: 984/2044 bytest   
GIGASX76X # run update-uboot-nor            
Using ltq-eth device
TFTP from server 192.168.1.16; our IP address is 192.168.1.1
Filename &#039;u-boot.bin&#039;.
Load address: 0x81000000
Loading: ###################################
         2.2 MiB/s
done
Bytes transferred = 178668 (2b9ec hex)
.......... done
Un-Protected 10 sectors

.......... done
Erased 10 sectors
Copy to Flash... 10....9....8....7....6....5....4....3....2....1....done</code></pre></div><p>However, after booting the bootloader doesnt kick in and I am back in the </p><div class="codebox"><pre><code>ROM VER: 1.0.3
CFG 01
Read EEPROMX
 X</code></pre></div><p>It looks like the update-uboot-nor doesnt store the flash right.<br />Or am I missing something here?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216495">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						2 Nov 2013, 10:21					</div>
				</div>
				<div class="post-content content">
					<p>Where does that u-boot-nor come from? Mine is only 64k. If you are interested, I have a backup of the original primary bootloader.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216503">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						2 Nov 2013, 11:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mijzelf wrote:</cite><blockquote><p>Where does that u-boot-nor come from? Mine is only 64k. If you are interested, I have a backup of the original primary bootloader.</p></blockquote></div><p>I have much progress. Router is alive again.</p><p>I downloaded the bootloader from <a href="http://downloads.openwrt.org/snapshots/trunk/lantiq/uboot-lantiq-gigasx76x_nor/.">http://downloads.openwrt.org/snapshots/ … x76x_nor/.</a></p><p>It boots ok.I can even ping from the CLI my laptop interface. Tftpboot is working ok.</p><div class="codebox"><pre><code>ROM VER: 1.0.3
CFG 01
Read EEPROMX
 X


U-Boot 2013.01 (Oct 31 2013 - 10:35:47) sx76x

Board: Gigaset sx76x
SoC:   Lantiq Danube-S v1.5
CPU:   333.333 MHz
IO:    166.667 MHz
BUS:   83.333 MHz
BOOT:  NOR
DRAM:  32 MiB
Flash: 8 MiB
In:    serial
Out:   serial
Err:   serial
Net:   ltq-eth
Hit any key to stop autoboot:  0 
GIGASX76X # </code></pre></div><div class="codebox"><pre><code>GIGASX76X # help
?       - alias for &#039;help&#039;
base    - print or set address offset
bdinfo  - print Board Info structure
bootm   - boot application image from memory
bootp   - boot image via network using BOOTP/TFTP protocol
cmp     - memory compare
cp      - memory copy
crc32   - checksum calculation
editenv - edit environment variable
env     - environment handling commands
erase   - erase FLASH memory
exit    - exit script
false   - do nothing, unsuccessfully
flinfo  - print FLASH memory information
go      - start application at address &#039;addr&#039;
help    - print command description/usage
iminfo  - print header information for application image
loadb   - load binary file over serial line (kermit mode)
loads   - load S-Record file over serial line
loady   - load binary file over serial line (ymodem mode)
loop    - infinite loop on address range
md      - memory display
mdio    - MDIO utility commands
mii     - MII utility commands
mm      - memory modify (auto-incrementing address)
mtest   - simple RAM read/write test
mw      - memory write (fill)
nm      - memory modify (constant address)
ping    - send ICMP ECHO_REQUEST to network host
printenv- print environment variables
protect - enable or disable FLASH write protection
reset   - Perform RESET of the CPU
run     - run commands in an environment variable
saveenv - save environment variables to persistent storage
setenv  - set environment variables
showvar - print local hushshell variables
test    - minimal test like /bin/sh
tftpboot- boot image via network using TFTP protocol
true    - do nothing, successfully
version - print monitor, compiler and linker version</code></pre></div><div class="codebox"><pre><code>GIGASX76X # printenv
addconsole=setenv bootargs $bootargs console=$consoledev,$baudrate
addeth=setenv bootargs $bootargs ethaddr=$ethaddr
addip=setenv bootargs $bootargs ip=$ipaddr:$serverip::::$netdev:off
addmachtype=setenv bootargs $bootargs machtype=GIGASX76X
baudrate=115200
bootargs=ethaddr=00:11:22:33:44:55 ethaddr=00:11:22:33:44:55 ethaddr=00:11:22:33:44:55
bootcmd=run addeth; bootm ${kernel_addr}
bootdelay=2
consoledev=ttyLTQ1
ethact=ltq-eth
ethaddr=00:11:22:33:44:55
fileaddr=8040000
filesize=FFCF
ipaddr=192.168.1.1
kernel_addr=0xB0040000
load-uboot-nor=tftpboot u-boot.bin
load-uboot-norspl=tftpboot u-boot.ltq.norspl
load-uboot-norspl-lzma=tftpboot u-boot.ltq.lzma.norspl
load-uboot-norspl-lzo=tftpboot u-boot.ltq.lzo.norspl
loadaddr=0x81000000
netdev=eth0
serverip=192.168.1.16
stderr=serial
stdin=serial
stdout=serial
update-uboot-nor=run load-uboot-nor write-uboot-nor
write-uboot-nor=protect off 0xB0000000 +$filesize &amp;&amp; erase 0xB0000000 +$filesize &amp;&amp; cp.b $fileaddr 0xB0000000 $filesize

Environment size: 1041/8188 bytes</code></pre></div><p>Question now is.... how can I get the other bootloaders into memory?</p><p>I sure need to upload the secondary_bootloader. I even think I miss the primary_bootloader.<br />I can tftpboot them. However at which memory address I must store them?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216505">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						2 Nov 2013, 11:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wvdakker wrote:</cite><blockquote><p>It looks like the update-uboot-nor doesnt store the flash right.<br />Or am I missing something here?</p></blockquote></div><p>No, you are right.<br />Via U-Art you only upload the bootloader.asc to RAM.<br />On a reset you are back to were you were, unless you upload and flash a working u-boot-nor image.</p><p>If you have difficulties uploading an image over the network, you can upload via serial connection. Either build your own u-boot with sources from <a href="https://github.com/danielschwierzeck/u-boot-lantiq"> here</a>, which has loadx. Or use <a href="https://forum.openwrt.org/viewtopic.php?pid=183315#p183315">ubootwrite.py</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216511">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						2 Nov 2013, 11:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wvdakker wrote:</cite><blockquote><p>Question now is.... how can I get the other bootloaders into memory?</p><p>I sure need to upload the secondary_bootloader. I even think I miss the primary_bootloader.<br />I can tftpboot them. However at which memory address I must store them?</p></blockquote></div><p>You don&#039;t need a secondary bootloader. The only purpose of that secundary bootloader was to ensure only signed (by Siemens) firmware could be uploaded. Now you&#039;ve got an open bootloader, which is capable to load openwrt directly.</p><p>This bootloader is 3*64kB in size, 64kB for the environment, means that openwrt should be flashed @4*64kB, which is 0x040000. Your environment shows a &#039;kernel_addr=0xB0040000&#039;, so I guess you&#039;ll have to store it there.</p><p>I guess you&#039;ll need an openwrt which is aware of that address. I had (and still have) a 64kB bootloader, while my flash mapping in the kernel had 192kB reserved for it. I think that is the reason my kernel can&#039;t find it&#039;s rootfs. It&#039;s searching at the wrong place in flash. It thinks it is flashed at 256kB, while it is at 128kB.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216522">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">wvdakker</div>
					<div class="post-datetime">
						2 Nov 2013, 12:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mijzelf wrote:</cite><blockquote><p>This bootloader is 3*64kB in size, 64kB for the environment, means that openwrt should be flashed @4*64kB, which is 0x040000. Your environment shows a &#039;kernel_addr=0xB0040000&#039;, so I guess you&#039;ll have to store it there.</p><p>I guess you&#039;ll need an openwrt which is aware of that address. I had (and still have) a 64kB bootloader, while my flash mapping in the kernel had 192kB reserved for it. I think that is the reason my kernel can&#039;t find it&#039;s rootfs. It&#039;s searching at the wrong place in flash. It thinks it is flashed at 256kB, while it is at 128kB.</p></blockquote></div><p>Ok. I understand.</p><p>I upload the kernel image <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/lantiq/danube/openwrt-lantiq-danube-GIGASX76X-squashfs.image">http://downloads.openwrt.org/attitude_a … shfs.image</a> and renamed it into runtime.img.</p><p>After entering:</p><div class="codebox"><pre><code>tftpboot $loadaddr runtime.img
protect off 1:0-20
cp.b $loadaddr $kernel_addr $filesize</code></pre></div><p>this worked whitout errors.</p><p>and starting it with</p><div class="codebox"><pre><code>bootcmd</code></pre></div><p>gave a wrong image message.</p><p>Close... but no sigar .... yet</p>											<p class="post-edited">(Last edited by <strong>wvdakker</strong> on 2 Nov 2013, 12:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216530">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						2 Nov 2013, 13:46					</div>
				</div>
				<div class="post-content content">
					<p>Two thoughts: </p><p>1) In my logs I found this:</p><div class="codebox"><pre><code>DANUBE =&gt; flinfo

Bank # 1: CFI conformant FLASH (16 x 16)  Size: 8 MB in 135 Sectors
  AMD Standard command set, Manufacturer ID: 0x01, Device ID: 0x227E
  Erase timeout: 16384 ms, write timeout: 2 ms
  Buffer write timeout: 5 ms, buffer size: 32 bytes

  Sector Start Addresses:
  B0000000        B0002000        B0004000        B0006000        B0008000      
  B000A000        B000C000        B000E000        B0010000   RO   B0020000      
  B0030000        B0040000        B0050000        B0060000        B0070000      
  B0080000        B0090000        B00A0000        B00B0000        B00C0000      
  B00D0000        B00E0000        B00F0000        B0100000        B0110000      
  B0120000        B0130000        B0140000        B0150000        B0160000      
  B0170000        B0180000        B0190000        B01A0000        B01B0000      
  B01C0000        B01D0000        B01E0000        B01F0000        B0200000      
  B0210000        B0220000        B0230000        B0240000        B0250000      
  B0260000        B0270000        B0280000        B0290000        B02A0000      
  B02B0000        B02C0000        B02D0000        B02E0000        B02F0000      
  B0300000        B0310000        B0320000        B0330000        B0340000      
  B0350000        B0360000        B0370000        B0380000        B0390000      
  B03A0000        B03B0000        B03C0000        B03D0000        B03E0000      
  B03F0000        B0400000        B0410000        B0420000        B0430000      
  B0440000        B0450000        B0460000        B0470000        B0480000      
  B0490000        B04A0000        B04B0000        B04C0000        B04D0000      
  B04E0000        B04F0000        B0500000        B0510000        B0520000      
  B0530000        B0540000        B0550000        B0560000        B0570000      
  B0580000        B0590000        B05A0000        B05B0000        B05C0000      
  B05D0000        B05E0000        B05F0000        B0600000        B0610000      
  B0620000        B0630000        B0640000        B0650000        B0660000      
  B0670000        B0680000        B0690000        B06A0000        B06B0000      
  B06C0000        B06D0000        B06E0000        B06F0000        B0700000      
  B0710000        B0720000        B0730000        B0740000        B0750000      
  B0760000        B0770000        B0780000        B0790000        B07A0000      
  B07B0000        B07C0000        B07D0000        B07E0000        B07F0000      </code></pre></div><p>So the flash has 135 sectors. (With a different size, somehow) You unprotected the first 20 or 21 sectors,&nbsp; which is not enough to flash the 3MB image. If unprotecting is necessary, you only flashed the first few kB&#039;s. On the other hand, there is an RO sign around 128kB, so maybe only the u-boot code is supposed to be protected. Which makes sense.&nbsp; </p><p>2) According to my listing in the first post, update_openwrt is done this way:</p><div class="codebox"><pre><code>tftp ${ram_addr} ${tftppath}openwrt-ifxmips-squashfs.image;era ${kernel_addr} +${filesize};cp.b ${ram_addr} ${kernel_addr} ${filesize}</code></pre></div><p>I don&#039;t see that you erased the flash, before copying the image.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216552">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">Mijzelf</div>
					<div class="post-datetime">
						2 Nov 2013, 18:18					</div>
				</div>
				<div class="post-content content">
					<p>Got it working:</p><div class="codebox"><pre><code>tftp firmware.img
Using ltq-eth device
TFTP from server 192.168.1.25; our IP address is 192.168.1.1
Filename &#039;firmware.img&#039;.
Load address: 0x81000000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         ##############################################################
         1.4 MiB/s
done
Bytes transferred = 4718596 (480004 hex)
GIGASX76X # protect off $kernel_addr +$filesize
......................................................................... done
Un-Protected 73 sectors
GIGASX76X # erase $kernel_addr +$filesize

......................................................................... done
Erased 73 sectors
GIGASX76X # cp.b $fileaddr $kernel_addr $filesize
Copy to Flash... 10....9....8....7....6....5....4....3....2....1....done
GIGASX76X # reset&lt;FD&gt;
ROM VER: 1.0.3
CFG 01
Read EEPROMX
 X


U-Boot 2013.01 (Oct 26 2013 - 12:18:03) sx76x

Board: Gigaset sx76x
SoC:   Lantiq Danube-S v1.3
CPU:   333.333 MHz
IO:    166.667 MHz
BUS:   83.333 MHz
BOOT:  NOR
DRAM:  32 MiB
Flash: 8 MiB
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ltq-eth
Hit any key to stop autoboot:  0 
## Booting kernel from Legacy Image at b0040000 ...
   Image Name:   MIPS OpenWrt Linux-3.10.17
   Created:      2013-11-02  14:40:01 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1219783 Bytes = 1.2 MiB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.10.17 (Mijzelf@ubuntu) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r38539) ) #4 Sat Nov 2 14:39:16 UTC 2013
[    0.000000] SoC: Danube rev 1.3
&lt;snip&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=47078&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>