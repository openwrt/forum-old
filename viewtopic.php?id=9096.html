<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWrt for Sweex WF514 / LC000060?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p41112">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">meeuw</div>
					<div class="post-datetime">
						20 Jan 2007, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>I&#039;d like to install OpenWrt on my Sweex WF514 (aka LC000060), according to the firmware (google for <br />LC000060_firm_200713T2.zip) the firmware already contains linux:</p><p>od -t x1 -t a WF514-200713T2.img<br /></p><div class="codebox"><pre><code>0020020 55 6e 63 6f 6d 70 72 65 73 73 69 6e 67 20 4c 69
          U   n   c   o   m   p   r   e   s   s   i   n   g  sp   L   i
0020040 6e 75 78 2e 2e 2e 20 0a 00 00 00 00 4f 6b 2c 20
          n   u   x   .   .   .  sp  nl nul nul nul nul   O   k   ,  sp
0020060 62 6f 6f 74 69 6e 67 20 74 68 65 20 6b 65 72 6e
          b   o   o   t   i   n   g  sp   t   h   e  sp   k   e   r   n
0020100 65 6c 2e 0a 00 00 00 00 1f 8b 08 08 a4 70 0f 41
          e   l   .  nl nul nul nul nul  us  vt  bs  bs   $   p  si   A
0020120 02 0b 55 4e 45 58 2d 47 49 53 4c 2d 54 2d 4c 32
        stx  vt   U   N   E   X   -   G   I   S   L   -   T   -   L   2
0020140 2d 32 30 30 37 31 33 54 32 5f 55 2e 62 69 6e 00
          -   2   0   0   7   1   3   T   2   _   U   .   b   i   n nul
0020160 ec 5c 7f 6c 14 d7 9d ff ce cc da ac cd 02 6b 7b
          l   \ del   l dc4   W  gs del   N   L   Z   ,   M stx   k   {
0020200 0d 6b 6a f0 6e 76 c7 5e 82 8f 2c 61 09 76 b3 09
         cr   k   j   p   n   v   G   ^ stx  si   ,   a  ht   v   3  ht</code></pre></div><p>I&#039;ve attached an serial cable to the board (MAX232) and the bootlog shows the following:<br /></p><div class="codebox"><pre><code>Power-On Self Testing...
Testing SYS Controller...
Testing MEM Controller...
SDRAM Configuration:ROW11_COL8_BANK2
Testing SDRAM Memory ...
From 0x80000000 - 0x807FFFFF
Testing CPU Data RAM...
Testing CPU Internal Registers...
Testing Timer 0...
Testing Timer 1...
Testing DMA Controller...
Testing INT Controller...
Testing PCMCIA Controller...
Testing USB Controller...
Testing Ethernet 0 MAC...
Testing Ethernet 1 MAC...
Testing Cardbus...
Testing PCI...
Power-On Self Test Passed








          Bootloader Version 00-03-02, Aug 29 2003 21:45:21



       Copyright 2003. All rights reserved. 








Press any key to stop auto-boot...
 0
auto-booting...

========POR reset========
****** Now used Flash Size: 1MB ******

Start of heap: 0x8065b390
End of heap: 0x80800000
register_function
Initializing LANSW!
Initializing LANSW done!
ifdata.if_name[0] is eth0
ifdata.if_name[0] is eth1
ifdata.if_name[0] is wls0

Firmware Version: 20-07-13T2, Aug 02 2004 11:53:05
Copyright 2002-2003. All rights reserved. 
Scanning PCI Bus...
    scan PCI deviceNo=1
      Found ISL3890 Wireless Device: PCIDEV=1, DEVNUM=4, NICNO=0
***iface=2, dev_num=4
pk_init:bigbufsiz[800]=2048 
PHY is switch controller ***IP175A***!
Network PORT 1 &lt;--&gt; 100M Full Duplex

WLAN0 Zone Number is 0
******** WLAN Disabled *******
******* AP CONFIG LAUNCHED *******
******** Isolated Disabled *******
********prohibited configuration Disabled *******
WLS Channel number is 6 
Finished wlan firmware download
br0: port 0.0.0.1(eth1 rootport) entering listening state
br0: port 0.0.0.2(wls0 rootport) entering listening state
NAT/Firewall starting...
MaxSessionNumber: 65536
NAT/Firewall started!
Now try to get the configuration file...
interface eth1 uses following ip settings: 192.168.62.1/255.255.255.0
Initialization of NAT/Firewall policy database succeeded!
load_pptp_wan: encryption option=e1
sleep...
SD9218&gt; 
L2TP: started
network_thread started
sg_wlan_1x_init
WPA disabled!
hapd-&gt;device=80355714
WPA init.....
1x is disbled(0)!
dhcp_update_table called, iface=1
start_ip=192.168.62.50, end_ip=192.168.62.100
route_cfg_update: dycfg.tx_protocol=0, dycfg.rx_protocol=0, dycfg.mode=0
br0: port 0.0.0.2(wls0 rootport) entering learning state
br0: port 0.0.0.1(eth1 rootport) entering learning state
br0: port 0.0.0.2(wls0 rootport) entering forwarding state
br0: topology change detected, propagating
br0: port 0.0.0.1(eth1 rootport) entering forwarding state
br0: topology change detected, propagating
dhcp_update_table return</code></pre></div><p>Entering help on the SD9218 promp shows the following:<br /></p><div class="codebox"><pre><code>   general         - main menu
   sysconfig       - sysconfig menu
   ifconfig        - ifconfig menu
   debug           - system debug menu
   diagnostic      - diagnostic aid menu
   dhcpsrv         - DHCP server
   firewall        - firewall menu
   sntp            - SNTP menu
   wdog            - Watch dog menu
   log             - WAN log menu
   mppp            - PPP managemnt menu
   wlan            - wlan menu
   pppoe           - pppoe menu
   pptp            - PPTP
   u_mctestc       - u_mctest client menu
   ping            - menu to set/view values for ping
   tftps           - tftp server menu
   rip             - RIP menu
   l2tp            - L2TP menu
   wpa             - wpa menu</code></pre></div><p>These are pictures of the board:<br /><span class="postimg"><img src="http://members.chello.nl/d.marinus1/sweex/0001.png" alt="http://members.chello.nl/d.marinus1/sweex/0001.png" /></span><br /><span class="postimg"><img src="http://members.chello.nl/d.marinus1/sweex/0002.png" alt="http://members.chello.nl/d.marinus1/sweex/0002.png" /></span></p><p>The Mini PCI card is an ISL3890</p><p>Could someone please give me some hints / suggestions how I could run openwrt on this board?</p><p>Many thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41113">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">GoldServe</div>
					<div class="post-datetime">
						20 Jan 2007, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>Looks like with 1MB space, you won&#039;t be too successful.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41116">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">meeuw</div>
					<div class="post-datetime">
						20 Jan 2007, 17:08					</div>
				</div>
				<div class="post-content content">
					<p>The boot menu shows the following:</p><div class="codebox"><pre><code>                       Main menu

        ?         - print this menu
        f         - load from Flash and go
        l         - load from TFTP server to SDRAM (no save to Flash, no go)
        L         - load from TFTP server to SDRAM and go (no save to Flash)
        @         - load from TFTP server to SDRAM,save to Flash and go
        g         - go from address
        b         - show boot parameters
        c         - change boot parameters
        d         - display factory default parameters
        m         - modify/set factory default parameters
        p         - ping test (ping other station from the target)
        r         - read memory
        s         - change mac address only
        w         - write memory</code></pre></div><p>Maybe I could/should use the load from TFTP server to SDRAM and go to overcome the 1MB flash limit?</p><p>There seems to be 8 MB SDRAM present, is this sufficient?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p41137">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						20 Jan 2007, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>8mb ram is sufficient to run linux, but you will find it hard to do more then very specific tasks. loading from tftp to ram is very useful for testing, as it&#039;s fast and doesn&#039;t use flash cycles, but i&#039;d think you&#039;d want to get something fit into the flash for more normal use <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /><a href="http://www.silicon-data.com/soc_9218.html">http://www.silicon-data.com/soc_9218.html</a> ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p42472">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">neteagle</div>
					<div class="post-datetime">
						11 Feb 2007, 09:35					</div>
				</div>
				<div class="post-content content">
					<p>It seems to use RTOS TX image format. Anyone know this format? I have the LC00060. I&#039;m interested in testing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52367">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">art103</div>
					<div class="post-datetime">
						16 Jul 2007, 00:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi, <br />I have a similar system, however it is inside a NC1200 WiFi enabled IP Camera. <br />So far I have hacked around, and added a serial port for debug and a USB port (it looks as though you can do the same with the LC000060 by populating the filter U3 and USB connctor J3).<br />I get debug saying that my USB memory stick has enumerated, but I don&#039;t have enough RAM to mount it (16MB RAM, 4MB Flash)</p><p>The bootloader is the same as above, and requires a specially formatted image file to TFTP correctly. <br />I have written some code that does this. </p><p>I am now at the stage where I am trying to modify the initrd image which ends up as the rootfs for the device after boot. <br />My motivation behind this is that the current firmware is too unstable, and can only stream images for about 4 hours, so I am re-using the hardware. <br />Unfortunately the manufacturer has not been forthcoming in providing the SD9218 linux kernel source - this is a shame, as it is the only step left to get this system on the open road!</p><p>It is running linux-2.4.17_mvl21, presumably from the <a href="http://www.silicon-data.com.tw/software_linuxBSP.html">http://www.silicon-data.com.tw/software_linuxBSP.html</a> board support package.</p><br /><p>The following are my notes whilst trying to reverse engineer this thing:<br /></p><div class="codebox"><pre><code>Data organisation:
0x80010000 == Offset 0x00000070 (kernel?)
0x80100000 == Offset 0x000F0070
0x80200000 == offset 0x001f0070 (initrd)

The information below was learned from the NC1200-W10 firmware 
(C61200-WX-2.00.01-61002-A0.img)

Image file format: 
File length = 0x27CF28

Header specific to the NC1200.
00 00 00 00 - unknown
00 27 ce f8 - data length? (file length - 0x30)
34 12 00 00 - unknown
04 9a 4f ba - unknown
40 00 93 bb - unknown
63 29 32 3c - unknown
2e 25 24 61 - unknown
65 40 71 00 - unknown
73 53 32 24 - unknown
37 5f 26 28 - unknown
40 30 49 7d - unknown
75 79 30 26 - unknown 

Header common to NC1200 and Sweex WF514 / LC000060
(This is what the bootloader tftp requires)
27 05 19 56 - Header Magic
ba 92 6e af - Header checksum (32-bit CRC init 0, XOR 0)
45 20 9f 14 - unknown
00 27 ce b8 - Data length
80 01 00 00 - Load address
80 01 00 00 - Entry point
a3 5a b4 66 - Data Checksum (32-bit CRC init 0, XOR 0)
12 0c 02 00 - Image type (12 0c 02 01 = R3000C RtosTx Kernel Image (gzip compressed)?)
                         (12 0c 02 00 = R3000C RtosTx Kernel Image (uncompressed)?)
32 bytes    - ASCII description for data.



Some offsets into the main .img file: 
(gzip data)
0x00003440 - gzipped data for the Linux kernel and filesystem (must be kernel + initrd)
Within this gzipped data, 
offset:
0x001f0000 - ramdisk ext2 filesystem. 

dd if=C61200-WX-2.00.01-61002-A0.img bs=13376 skip=1 of=offset_00003440
dd if=offset_00003440 bs=2031616 skip=1 of=offset_001f0000.gz

gunzip offset_001f0000.gz
mount -o loop offset_001f0000 mountpoint
This is the RAM disk mounted at boot.
umount mountpoint
gzip -9 offset_001f0000</code></pre></div><p>Source code for create_header:<br /></p><div class="codebox"><pre><code>/* This is a hacked up application that will add a header to raw data
 * for loading into a SD9218 SoC. */
 
 /* It is completely dumb, and will probably wreck your hardware */
 /* You have been warned :) */
 

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;

static const unsigned long crcTable[256] = 
{
    0x00000000L,0x77073096L,0xee0e612cL,0x990951baL,
    0x076dc419L,0x706af48fL,0xe963a535L,0x9e6495a3L,
    0x0edb8832L,0x79dcb8a4L,0xe0d5e91eL,0x97d2d988L,
    0x09b64c2bL,0x7eb17cbdL,0xe7b82d07L,0x90bf1d91L,
    0x1db71064L,0x6ab020f2L,0xf3b97148L,0x84be41deL,
    0x1adad47dL,0x6ddde4ebL,0xf4d4b551L,0x83d385c7L,
    0x136c9856L,0x646ba8c0L,0xfd62f97aL,0x8a65c9ecL,
    0x14015c4fL,0x63066cd9L,0xfa0f3d63L,0x8d080df5L,
    0x3b6e20c8L,0x4c69105eL,0xd56041e4L,0xa2677172L,
    0x3c03e4d1L,0x4b04d447L,0xd20d85fdL,0xa50ab56bL,
    0x35b5a8faL,0x42b2986cL,0xdbbbc9d6L,0xacbcf940L,
    0x32d86ce3L,0x45df5c75L,0xdcd60dcfL,0xabd13d59L,
    0x26d930acL,0x51de003aL,0xc8d75180L,0xbfd06116L,
    0x21b4f4b5L,0x56b3c423L,0xcfba9599L,0xb8bda50fL,
    0x2802b89eL,0x5f058808L,0xc60cd9b2L,0xb10be924L,
    0x2f6f7c87L,0x58684c11L,0xc1611dabL,0xb6662d3dL,
    0x76dc4190L,0x01db7106L,0x98d220bcL,0xefd5102aL,
    0x71b18589L,0x06b6b51fL,0x9fbfe4a5L,0xe8b8d433L,
    0x7807c9a2L,0x0f00f934L,0x9609a88eL,0xe10e9818L,
    0x7f6a0dbbL,0x086d3d2dL,0x91646c97L,0xe6635c01L,
    0x6b6b51f4L,0x1c6c6162L,0x856530d8L,0xf262004eL,
    0x6c0695edL,0x1b01a57bL,0x8208f4c1L,0xf50fc457L,
    0x65b0d9c6L,0x12b7e950L,0x8bbeb8eaL,0xfcb9887cL,
    0x62dd1ddfL,0x15da2d49L,0x8cd37cf3L,0xfbd44c65L,
    0x4db26158L,0x3ab551ceL,0xa3bc0074L,0xd4bb30e2L,
    0x4adfa541L,0x3dd895d7L,0xa4d1c46dL,0xd3d6f4fbL,
    0x4369e96aL,0x346ed9fcL,0xad678846L,0xda60b8d0L,
    0x44042d73L,0x33031de5L,0xaa0a4c5fL,0xdd0d7cc9L,
    0x5005713cL,0x270241aaL,0xbe0b1010L,0xc90c2086L,
    0x5768b525L,0x206f85b3L,0xb966d409L,0xce61e49fL,
    0x5edef90eL,0x29d9c998L,0xb0d09822L,0xc7d7a8b4L,
    0x59b33d17L,0x2eb40d81L,0xb7bd5c3bL,0xc0ba6cadL,
    0xedb88320L,0x9abfb3b6L,0x03b6e20cL,0x74b1d29aL,
    0xead54739L,0x9dd277afL,0x04db2615L,0x73dc1683L,
    0xe3630b12L,0x94643b84L,0x0d6d6a3eL,0x7a6a5aa8L,
    0xe40ecf0bL,0x9309ff9dL,0x0a00ae27L,0x7d079eb1L,
    0xf00f9344L,0x8708a3d2L,0x1e01f268L,0x6906c2feL,
    0xf762575dL,0x806567cbL,0x196c3671L,0x6e6b06e7L,
    0xfed41b76L,0x89d32be0L,0x10da7a5aL,0x67dd4accL,
    0xf9b9df6fL,0x8ebeeff9L,0x17b7be43L,0x60b08ed5L,
    0xd6d6a3e8L,0xa1d1937eL,0x38d8c2c4L,0x4fdff252L,
    0xd1bb67f1L,0xa6bc5767L,0x3fb506ddL,0x48b2364bL,
    0xd80d2bdaL,0xaf0a1b4cL,0x36034af6L,0x41047a60L,
    0xdf60efc3L,0xa867df55L,0x316e8eefL,0x4669be79L,
    0xcb61b38cL,0xbc66831aL,0x256fd2a0L,0x5268e236L,
    0xcc0c7795L,0xbb0b4703L,0x220216b9L,0x5505262fL,
    0xc5ba3bbeL,0xb2bd0b28L,0x2bb45a92L,0x5cb36a04L,
    0xc2d7ffa7L,0xb5d0cf31L,0x2cd99e8bL,0x5bdeae1dL,
    0x9b64c2b0L,0xec63f226L,0x756aa39cL,0x026d930aL,
    0x9c0906a9L,0xeb0e363fL,0x72076785L,0x05005713L,
    0x95bf4a82L,0xe2b87a14L,0x7bb12baeL,0x0cb61b38L,
    0x92d28e9bL,0xe5d5be0dL,0x7cdcefb7L,0x0bdbdf21L,
    0x86d3d2d4L,0xf1d4e242L,0x68ddb3f8L,0x1fda836eL,
    0x81be16cdL,0xf6b9265bL,0x6fb077e1L,0x18b74777L,
    0x88085ae6L,0xff0f6a70L,0x66063bcaL,0x11010b5cL,
    0x8f659effL,0xf862ae69L,0x616bffd3L,0x166ccf45L,
    0xa00ae278L,0xd70dd2eeL,0x4e048354L,0x3903b3c2L,
    0xa7672661L,0xd06016f7L,0x4969474dL,0x3e6e77dbL,
    0xaed16a4aL,0xd9d65adcL,0x40df0b66L,0x37d83bf0L,
    0xa9bcae53L,0xdebb9ec5L,0x47b2cf7fL,0x30b5ffe9L,
    0xbdbdf21cL,0xcabac28aL,0x53b39330L,0x24b4a3a6L,
    0xbad03605L,0xcdd70693L,0x54de5729L,0x23d967bfL,
    0xb3667a2eL,0xc4614ab8L,0x5d681b02L,0x2a6f2b94L,
    0xb40bbe37L,0xc30c8ea1L,0x5a05df1bL,0x2d02ef8dL
};

unsigned int calculateCrc(unsigned int crc, unsigned char * pucData, unsigned int length)
{
    unsigned int i;

    for(i = 0; i &lt; length; i++)
    {
        crc = crcTable[(crc ^ pucData[i]) &amp; 0xff] ^ (crc &gt;&gt; 8);
    }

    return crc;
}

write32ToBE(unsigned char *data, unsigned int value)
{
    *data++ = ((value &gt;&gt; 24) &amp; 0xFF);
    *data++ = ((value &gt;&gt; 16) &amp; 0xFF);
    *data++ = ((value &gt;&gt; 8) &amp; 0xFF);
    *data++ = ((value &gt;&gt; 0) &amp; 0xFF);
}

unsigned int read32FromBE(unsigned char *data)
{
    unsigned int value;

    value =  ((*data++ &lt;&lt; 24) &amp; 0xFF000000);
    value |= ((*data++ &lt;&lt; 16) &amp; 0x00FF0000);
    value |= ((*data++ &lt;&lt;  8) &amp; 0x0000FF00);
    value |= ((*data++ &lt;&lt;  0) &amp; 0x000000FF);

    return value;
}

unsigned int read16FromBE(unsigned char *data)
{
    unsigned int value;

    value = ((*data++ &lt;&lt;  8) &amp; 0x0000FF00);
    value |= ((*data++ &lt;&lt;  0) &amp; 0x000000FF);

    return value;
}

int main (int argc, char **argv)
{
    FILE *inFile, *outFile;
    char *filename;
    char outFileName[]=&quot;zrtos.img&quot;;
    long dataLength = 0;
    int i, j;
    unsigned char *ptr;
    unsigned char readBuffer[1024];
    unsigned char headerBuffer[64];
    int bytesRead;

    unsigned int headerChecksum = 0;
    unsigned int dataChecksum = 0;
    unsigned int loadAddress = 0x80010000;
    unsigned int entryAddress = 0x80010000;
    unsigned int imageType = 0x120C0200;

    if (argc != 2)
    {
        printf(&quot;Please supply %s &lt;filename&gt;\r\n&quot;, argv[0]);
        return 1;
    }

    filename = argv[1];

    printf(&quot;Creating SD9218 boot image...\r\n&quot;);

    inFile = fopen(filename, &quot;rb&quot;);
    if (inFile == NULL)
    {
        printf(&quot;Unable to open %s for reading.\r\n&quot;, filename);
        return -1;
    }
    outFile = fopen(outFileName, &quot;wb&quot;);
    if (outFile == NULL)
    {
        printf(&quot;Unable to open %s for writing.\r\n&quot;, outFileName);
        return -1;
    }

    // Ok, we have our source and destination files, lets generate the header.
    
    if (fseek(inFile, 0, SEEK_END))
    {
        printf(&quot;Unable to get file length.\r\n&quot;);
        return -1;
    }
    dataLength = ftell(inFile);
    rewind(inFile);
    
    if (dataLength == 0)
    {
        printf(&quot;Please supply a file with some data in it!\r\n&quot;);
        return -1;
    }

    // Reserve 64 bytes for the header.
    memset(headerBuffer, 0, sizeof(headerBuffer));
    fwrite(headerBuffer, 1, sizeof(headerBuffer), outFile);

    dataChecksum = 0;
    for (i=0; (i&lt;dataLength) &amp;&amp; (bytesRead &gt; 0); i+=bytesRead)
    {
        bytesRead = fread(readBuffer, 1, sizeof(readBuffer), inFile);
        fwrite(readBuffer, 1, bytesRead, outFile);
        dataChecksum = calculateCrc(dataChecksum, readBuffer, bytesRead);
    }

    // Now populate the header.
    write32ToBE(&amp;headerBuffer[0], 0x27051956);    // Magic number
    write32ToBE(&amp;headerBuffer[4], 0x00000000); // Header Checksum
    write32ToBE(&amp;headerBuffer[8], 0x45209f14);    // Unknown
    write32ToBE(&amp;headerBuffer[12], dataLength);    // Data Length
    write32ToBE(&amp;headerBuffer[16], loadAddress);    // Load Address
    write32ToBE(&amp;headerBuffer[20], entryAddress);    // Entry Point
    write32ToBE(&amp;headerBuffer[24], dataChecksum);    // Data Checksum
    write32ToBE(&amp;headerBuffer[28], imageType);    // Image Type
    strcpy(&amp;headerBuffer[32], &quot;LinuxImage&quot;);

    // Calculate the header checksum.
    // (This isn&#039;t a checksum at all, it&#039;s a CRC...
    headerChecksum = calculateCrc(0, headerBuffer, sizeof(headerBuffer));

    write32ToBE(&amp;headerBuffer[4], headerChecksum); // Header Checksum

    printf(&quot;Data Size:        %d Bytes\r\n&quot;, dataLength);
    printf(&quot;Load Address:     0x%08X\r\n&quot;, loadAddress);
    printf(&quot;Entry Point:      0x%08X\r\n&quot;, entryAddress);
    printf(&quot;Header Checksum:  0x%08X\r\n&quot;, headerChecksum);
    printf(&quot;Image Checksum:   0x%08X\r\n&quot;, dataChecksum);

    rewind(outFile);
    fwrite(headerBuffer, 1, sizeof(headerBuffer), outFile);

    fclose (outFile);
    fclose (inFile);

    return 0;
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52669">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">art103</div>
					<div class="post-datetime">
						23 Jul 2007, 15:40					</div>
				</div>
				<div class="post-content content">
					<p>For anyone that cares, I have now successfully built and deployed my own root filesystem onto the NC1200-W10 IP camera (uses the SD9218 SoC). </p><p>Original image (required by script) is available from the manufacturer here:<br /><a href="http://www.aviptek.com/dowmload%20firmware/NC%201200%20Firmware/C61200-WX-2.00.01-61002-A0.rar">http://www.aviptek.com/dowmload%20firmw â€¦ 002-A0.rar</a></p><p>Using buildroot, MIPS I generic, big endian, softfloat and a minimal package selection, generate a new ramdisk with the apps that you require. </p><p>To create the ramdisk: <br /></p><div class="codebox"><pre><code>dd if=/dev/zero of=ramdisk bs=1024 count=6144
mkfs.ext2 ramdisk
mkdir mnt
mount -o loop ramdisk mnt</code></pre></div><p>Now untar the rootfs generated by buildroot into the new ramdisk (mounted on mnt). </p><div class="codebox"><pre><code>umount mnt
gzip -9 ramdisk</code></pre></div><div class="codebox"><pre><code>#!/bin/bash

echo &quot;Replacing ramdisk with $1&quot;

# Extract the Kernel from firmware image
dd if=C61200-WX-2.00.01-61002-A0.img bs=13376 skip=1 of=kernel.gz
cp C61200-WX-2.00.01-61002-A0.img C61200-WX-custom.img
gunzip kernel.gz
# Overwrite the existing ramdisk with our new one
dd if=/dev/zero of=kernel bs=1 seek=2031616 conv=notrunc count=1929216
dd if=$1 of=kernel bs=2031616 seek=1 conv=notrunc
gzip kernel -v9

# Clear a space for our image.
dd if=/dev/zero of=C61200-WX-custom.img bs=13376 seek=1 conv=notrunc count=192

# Put it back into the firmware image.
dd if=kernel.gz of=C61200-WX-custom.img bs=13376 seek=1 conv=notrunc
rm kernel.gz

# Create a tftp compatible image
dd if=C61200-WX-custom.img of=C61200-WX-custom.raw bs=112 skip=1
./create_header C61200-WX-custom.raw

rm C61200-WX-custom.raw</code></pre></div><p>This script will keep the existing kernel, but replace the ramdisk with a new one (./&lt;script name&gt; ramdisk.gz).</p><p>The output is a file &quot;zrtos.img&quot; fire up a tftp server, and point the bootloader of the SD9218 towards this file. <br />If you use the option &#039;L&#039; in the bootloader, it will load the file into RAM, verify it, then boot it. <br />DO NOT use the &#039;@&#039; option until you want to flash it permanently.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54137">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">neteagle</div>
					<div class="post-datetime">
						18 Aug 2007, 09:18					</div>
				</div>
				<div class="post-content content">
					<p>Can you describe in details how to populate USB (J3, U3 of LC000060) ?<br />The offset 0x00003440 of LC000060 image isn&#039;t correct.<br />The kernel offset is 0x00002048. How find the correct ramdisk offset ?</p>											<p class="post-edited">(Last edited by <strong>neteagle</strong> on 18 Aug 2007, 10:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54176">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">art103</div>
					<div class="post-datetime">
						19 Aug 2007, 01:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi neteagle, <br />I have not populated this board, the NC1200 camera PCB is completely different.<br />However, looking at just the images above, J3 looks like a standard USB connector (butcher an old USB HUB or something for one). <br />U3 looks like a USB filter IC. <br /><span class="postimg"><img src="http://www.artaylor.co.uk/nc1200/001.jpg" alt="http://www.artaylor.co.uk/nc1200/001.jpg" /></span><br />Pins 1 and 5 should connect together. <br />Pins 4 and 8 should connect together. <br />Pins 2 and 6 should be connected with a 33 Ohm resistor.<br />Pins 3 and 7 should be connected with a 33 Ohm resistor.<br />Connect a 15K resistor between pins 2 and 4.<br />Connect a 15K resistor between pins 3 and 4.</p><p>As I said, I don&#039;t know if this will work, but it looks like it should (standard USB line matching).</p><p>Regarding the ramdisk offset - I wrote a script that went through the whole binary looking for gzip headers. <br /><a href="http://www.artaylor.co.uk/nc1200/find_gzips.c.gz">http://www.artaylor.co.uk/nc1200/find_gzips.c.gz</a></p><p>If it finds a header, it dumps the data to a file. <br />I then ran <br /></p><div class="codebox"><pre><code>for file in `ls *.gz`; do gunzip $file; done</code></pre></div><p>To see if it was valid data. </p><p>I then worked out how long the original data was by re-gzipping (with -9 for max compression) to see what size it compressed back to.<br />I made my script zero out this area and put a new gzip back in it&#039;s place. <br />You will need to do this both for the ramdisk, and the gzipped kernel image. <br />(There is a gzip inside a gzip). </p><p>I hope this makes sense!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54475">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">neteagle</div>
					<div class="post-datetime">
						23 Aug 2007, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>I found only the gzipped kernel:<br />UNEX-GISL-T-L2-200713T5_U.bin 1,83Mb uncompressed.</p><p>No gzipped ramdisk.</p><p><img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54477">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">neteagle</div>
					<div class="post-datetime">
						23 Aug 2007, 18:18					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s the J213 serial port pinout ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54490">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">art103</div>
					<div class="post-datetime">
						24 Aug 2007, 08:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi neteagle, </p><p>I have no idea what the pinout is! <br />On my camera board, I got an oscilloscope and probed each pin at boot until I saw serial data. <br />I then guessed which pin I thought would be RX, and tried it. (You&#039;ll need to make a 3.3v to RS232 serial converter too).</p><p>Regarding the kernel, <br />the ramdisk is embedded in the kernel - you will need to run the find_gzips exe on the .bin to find the ramdisk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70107">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">hi_five</div>
					<div class="post-datetime">
						26 Jun 2008, 05:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>art103 wrote:</cite><blockquote><p>I have no idea what the pinout is! <br />On my camera board, I got an oscilloscope and probed each pin at boot until I saw serial data. <br />I then guessed which pin I thought would be RX, and tried it. (You&#039;ll need to make a 3.3v to RS232 serial converter too).</p></blockquote></div><p>1) You didn&#039;t guess correctly and blew your board.<br />2) You&#039;re blind and can&#039;t see the soldered wire on your board.<br />3) You really have no clue and enjoy posting on info you really know nothing about.<br />4) You don&#039;t believe in free information and just want to be an ass.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70370">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">art103</div>
					<div class="post-datetime">
						2 Jul 2008, 20:16					</div>
				</div>
				<div class="post-content content">
					<p>I would like to repond to hi_five&#039;s very kind and constructive comments: </p><p>1) My guess was only for the TX pin, and it was a good guess as I got to an interactive shell. My board is still fine.<br />2) No, I just don&#039;t have much spare time, and going up into the loft to retrieve and pull apart my camera didn&#039;t really appeal.<br />3) I enjoy posting, as I hope some one will pick up the work I have started and make further progress. <br />I&#039;d like to see you reverse engineer the image format and re-create your own rootfs - I assume the reason for your comments is that you can&#039;t <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> <br />4) I think free information is essential. If you opened your eyes a little, you would see a number of (software) projects that I have undertaken and fed back into the community.</p><p>Below is an image of the serial pinout. You need a SP3232 or equivalent RS232 convertor. </p><p>TX and RX are relative to the Camera, not the PC. </p><p><span class="postimg"><img src="http://www.artaylor.co.uk/nc1200/002.jpg" alt="http://www.artaylor.co.uk/nc1200/002.jpg" /></span></p><p>neteagle: <br />The image that you found looks like the correct one, you need to compile and run the find_gzips.c code that I posted to find the offset into the image where the embedded ramdisk is stored.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>