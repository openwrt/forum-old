<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TL-WR1041N has support now!</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p161571">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kyokyowin</div>
					<div class="post-datetime">
						21 Mar 2012, 02:41					</div>
				</div>
				<div class="post-content content">
					<p>This is from chinese forum~</p><p>It is the patch ,please submit it~~</p><br /><p>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c<br />===================================================================<br />--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c&nbsp; &nbsp; (revision 0)<br />+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c&nbsp; &nbsp; (revision 0)<br />@@ -0,0 +1,242 @@<br />+/*<br />+ * Atheros DB120 reference board support<br />+ *<br />+ * Copyright (c) 2011 Qualcomm Atheros<br />+ * Copyright (c) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;<br />+ *<br />+ * All rights reserved.<br />+ *<br />+ * Redistribution and use in source and binary forms, with or without<br />+ * modification, are permitted (subject to the limitations in the<br />+ * disclaimer below) provided that the following conditions are met:<br />+ *<br />+ *&nbsp; * Redistributions of source code must retain the above copyright<br />+ *&nbsp; &nbsp; notice, this list of conditions and the following disclaimer.<br />+ *<br />+ *&nbsp; * Redistributions in binary form must reproduce the above copyright<br />+ *&nbsp; &nbsp; notice, this list of conditions and the following disclaimer in the<br />+ *&nbsp; &nbsp; documentation and/or other materials provided with the<br />+ *&nbsp; &nbsp; distribution.<br />+ *<br />+ *&nbsp; * Neither the name of Qualcomm Atheros nor the names of its<br />+ *&nbsp; &nbsp; contributors may be used to endorse or promote products derived<br />+ *&nbsp; &nbsp; from this software without specific prior written permission.<br />+ *<br />+ * NO EXPRESS OR IMPLIED LICENSES TO ANY PARTY&#039;S PATENT RIGHTS ARE<br />+ * GRANTED BY THIS LICENSE.&nbsp; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT<br />+ * HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED<br />+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF<br />+ * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE<br />+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<br />+ * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<br />+ * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<br />+ * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR<br />+ * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,<br />+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE<br />+ * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN<br />+ * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br />+ */<br />+<br />+#include &lt;linux/mtd/mtd.h&gt;<br />+#include &lt;linux/mtd/partitions.h&gt;<br />+#include &lt;linux/pci.h&gt;<br />+#include &lt;linux/phy.h&gt;<br />+#include &lt;linux/platform_device.h&gt;<br />+#include &lt;linux/ath9k_platform.h&gt;<br />+#include &lt;linux/ar8216_platform.h&gt;<br />+<br />+#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;<br />+<br />+#include &quot;common.h&quot;<br />+#include &quot;dev-ap9x-pci.h&quot;<br />+#include &quot;dev-eth.h&quot;<br />+#include &quot;dev-gpio-buttons.h&quot;<br />+#include &quot;dev-leds-gpio.h&quot;<br />+#include &quot;dev-m25p80.h&quot;<br />+#include &quot;dev-spi.h&quot;<br />+#include &quot;dev-usb.h&quot;<br />+#include &quot;dev-wmac.h&quot;<br />+#include &quot;machtypes.h&quot;<br />+<br />+#define DB120_GPIO_LED_USB&nbsp; &nbsp; &nbsp; &nbsp; 11<br />+#define DB120_GPIO_LED_WLAN_5G&nbsp; &nbsp; &nbsp; &nbsp; 12<br />+#define DB120_GPIO_LED_WLAN_2G&nbsp; &nbsp; &nbsp; &nbsp; 13<br />+#define DB120_GPIO_LED_STATUS&nbsp; &nbsp; &nbsp; &nbsp; 14<br />+#define DB120_GPIO_LED_WPS&nbsp; &nbsp; &nbsp; &nbsp; 15<br />+<br />+#define DB120_GPIO_BTN_WPS&nbsp; &nbsp; &nbsp; &nbsp; 16<br />+<br />+#define DB120_KEYS_POLL_INTERVAL&nbsp; &nbsp; 20&nbsp; &nbsp; /* msecs */<br />+#define DB120_KEYS_DEBOUNCE_INTERVAL&nbsp; &nbsp; (3 * DB120_KEYS_POLL_INTERVAL)<br />+<br />+#define DB120_MAC0_OFFSET&nbsp; &nbsp; &nbsp; &nbsp; 0<br />+#define DB120_MAC1_OFFSET&nbsp; &nbsp; &nbsp; &nbsp; 6<br />+#define DB120_WMAC_CALDATA_OFFSET&nbsp; &nbsp; 0x1000<br />+#define DB120_PCIE_CALDATA_OFFSET&nbsp; &nbsp; 0x5000<br />+<br />+static struct mtd_partition db120_partitions[] = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;u-boot&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x040000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .mask_flags&nbsp; &nbsp; = MTD_WRITEABLE,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;u-boot-env&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x040000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;rootfs&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x050000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x2b0000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;uImage&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x300000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x0e0000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;NVRAM&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x3E0000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;ART&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x3F0000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .mask_flags&nbsp; &nbsp; = MTD_WRITEABLE,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct flash_platform_data db120_flash_data = {<br />+&nbsp; &nbsp; .parts&nbsp; &nbsp; &nbsp; &nbsp; = db120_partitions,<br />+&nbsp; &nbsp; .nr_parts&nbsp; &nbsp; = ARRAY_SIZE(db120_partitions),<br />+};<br />+<br />+static struct gpio_led db120_leds_gpio[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:status&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_STATUS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wps&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WPS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wlan-5g&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WLAN_5G,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wlan-2g&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WLAN_2G,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:usb&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_USB,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct gpio_keys_button db120_gpio_keys[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;WPS button&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = KEY_WPS_BUTTON,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = DB120_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_BTN_WPS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static struct ar8327_pad_cfg db120_ar8327_pad0_cfg = {<br />+&nbsp; &nbsp; .mode = AR8327_PAD_MAC_RGMII,<br />+&nbsp; &nbsp; .txclk_delay_en = true,<br />+&nbsp; &nbsp; .rxclk_delay_en = true,<br />+&nbsp; &nbsp; .txclk_delay_sel = AR8327_CLK_DELAY_SEL1,<br />+&nbsp; &nbsp; .rxclk_delay_sel = AR8327_CLK_DELAY_SEL2,<br />+};<br />+<br />+static struct ar8327_platform_data db120_ar8327_data = {<br />+&nbsp; &nbsp; .pad0_cfg = &amp;db120_ar8327_pad0_cfg,<br />+&nbsp; &nbsp; .cpuport_cfg = {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .force_link = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .speed = AR8327_PORT_SPEED_1000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .duplex = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .txpause = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .rxpause = 1,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct mdio_board_info db120_mdio0_info[] = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .bus_id = &quot;ag71xx-mdio.0&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .phy_addr = 0,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .platform_data = &amp;db120_ar8327_data,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static void __init db120_gmac_setup(void)<br />+{<br />+&nbsp; &nbsp; void __iomem *base;<br />+&nbsp; &nbsp; u32 t;<br />+<br />+&nbsp; &nbsp; base = ioremap(AR934X_GMAC_BASE, AR934X_GMAC_SIZE);<br />+<br />+&nbsp; &nbsp; t = __raw_readl(base + AR934X_GMAC_REG_ETH_CFG);<br />+&nbsp; &nbsp; t &amp;= ~(AR934X_ETH_CFG_RGMII_GMAC0 | AR934X_ETH_CFG_MII_GMAC0 |<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; AR934X_ETH_CFG_MII_GMAC0 | AR934X_ETH_CFG_SW_ONLY_MODE);<br />+&nbsp; &nbsp; t |= AR934X_ETH_CFG_RGMII_GMAC0 | AR934X_ETH_CFG_SW_ONLY_MODE;<br />+<br />+&nbsp; &nbsp; __raw_writel(t, base + AR934X_GMAC_REG_ETH_CFG);<br />+<br />+&nbsp; &nbsp; iounmap(base);<br />+}<br />+<br />+static void __init tl_wr1041n_setup(void)<br />+{<br />+&nbsp; &nbsp; u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);<br />+<br />+&nbsp; &nbsp; ath79_gpio_output_select(DB120_GPIO_LED_USB, AR934X_GPIO_OUT_GPIO);<br />+&nbsp; &nbsp; ath79_register_m25p80(&amp;db120_flash_data);<br />+<br />+&nbsp; &nbsp; ath79_register_leds_gpio(-1, ARRAY_SIZE(db120_leds_gpio),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; db120_leds_gpio);<br />+&nbsp; &nbsp; ath79_register_gpio_keys_polled(-1, DB120_KEYS_POLL_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ARRAY_SIZE(db120_gpio_keys),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db120_gpio_keys);<br />+&nbsp; &nbsp; ath79_register_usb();<br />+&nbsp; &nbsp; ath79_register_wmac(art + DB120_WMAC_CALDATA_OFFSET, NULL);<br />+&nbsp; &nbsp; ap91_pci_init(art + DB120_PCIE_CALDATA_OFFSET, NULL);<br />+<br />+&nbsp; &nbsp; db120_gmac_setup();<br />+<br />+&nbsp; &nbsp; ath79_register_mdio(1, 0x0);<br />+&nbsp; &nbsp; ath79_register_mdio(0, 0x0);<br />+<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth0_data.mac_addr, art + DB120_MAC0_OFFSET, 0);<br />+<br />+&nbsp; &nbsp; mdiobus_register_board_info(db120_mdio0_info,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;ARRAY_SIZE(db120_mdio0_info));<br />+<br />+&nbsp; &nbsp; /* GMAC0 is connected to an AR8327 switch */<br />+&nbsp; &nbsp; ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;<br />+&nbsp; &nbsp; ath79_eth0_data.phy_mask = BIT(0);<br />+&nbsp; &nbsp; ath79_eth0_data.mii_bus_dev = &amp;ath79_mdio0_device.dev;<br />+&nbsp; &nbsp; ath79_register_eth(0);<br />+<br />+&nbsp; &nbsp; /* GMAC1 is connected to the internal switch */<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth1_data.mac_addr, art + DB120_MAC1_OFFSET, 0);<br />+&nbsp; &nbsp; ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;<br />+&nbsp; &nbsp; ath79_eth1_data.speed = SPEED_1000;<br />+&nbsp; &nbsp; ath79_eth1_data.duplex = DUPLEX_FULL;<br />+<br />+&nbsp; &nbsp; ath79_register_eth(1);<br />+}<br />+<br />+MIPS_MACHINE(ATH79_MACH_TL_WR1041N, &quot;TL-WR1041N&quot;, &quot;TP-LINK TL-WR1041N-V2&quot;,<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; tl_wr1041n_setup);<br />Index: target/linux/ar71xx/image/Makefile<br />===================================================================<br />--- target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (working copy)<br />@@ -918,6 +918,11 @@<br /> &nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr941nd-v4,$(tlwr941v4_cmdline),0x09410004,1,4M)<br /> endef</p><p>+tlwr1041_cmdline=board=TL-WR1041N console=ttyS0,115200<br />+define Image/Build/Profile/TLWR1041<br />+&nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr1041n-v2,$(tlwr1041_cmdline),0x10410002,1,4M)<br />+endef<br />+<br /> tlwr1043_cmdline=board=TL-WR1043ND console=ttyS0,115200<br /> define Image/Build/Profile/TLWR1043<br /> &nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr1043nd-v1,$(tlwr1043_cmdline),0x10430001,1,8M)<br />@@ -1056,6 +1061,7 @@<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR841,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR842,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR941,$(1))<br />+&nbsp; &nbsp; $(call Image/Build/Profile/TLWR1041,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR1043,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR2543,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/UBNT,$(1))<br />Index: target/linux/ar71xx/config-3.2<br />===================================================================<br />--- target/linux/ar71xx/config-3.2&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/config-3.2&nbsp; &nbsp; (working copy)<br />@@ -56,6 +56,7 @@<br /> CONFIG_ATH79_MACH_TL_MR3X20=y<br /> CONFIG_ATH79_MACH_TL_WA901ND=y<br /> CONFIG_ATH79_MACH_TL_WA901ND_V2=y<br />+CONFIG_ATH79_MACH_TL_WR1041N=y<br /> CONFIG_ATH79_MACH_TL_WR1043ND=y<br /> CONFIG_ATH79_MACH_TL_WR2543N=y<br /> CONFIG_ATH79_MACH_TL_WR703N=y<br />Index: target/linux/ar71xx/config-3.3<br />===================================================================<br />--- target/linux/ar71xx/config-3.3&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/config-3.3&nbsp; &nbsp; (working copy)<br />@@ -57,6 +57,7 @@<br /> CONFIG_ATH79_MACH_TL_MR3X20=y<br /> CONFIG_ATH79_MACH_TL_WA901ND=y<br /> CONFIG_ATH79_MACH_TL_WA901ND_V2=y<br />+CONFIG_ATH79_MACH_TL_WR1041N=y<br /> CONFIG_ATH79_MACH_TL_WR1043ND=y<br /> CONFIG_ATH79_MACH_TL_WR2543N=y<br /> CONFIG_ATH79_MACH_TL_WR703N=y<br />Index: target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch<br />===================================================================<br />--- target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (working copy)<br />@@ -1,6 +1,6 @@<br /> --- a/arch/mips/ath79/machtypes.h<br /> +++ b/arch/mips/ath79/machtypes.h<br />-@@ -16,17 +16,81 @@<br />+@@ -16,17 +16,82 @@<br />&nbsp; <br />&nbsp; enum ath79_mach_type {<br />&nbsp; &nbsp; &nbsp; ATH79_MACH_GENERIC = 0,<br />@@ -47,6 +47,7 @@<br /> +&nbsp; &nbsp; ATH79_MACH_TL_MR3420,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-MR3420 */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WA901ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND_V2,&nbsp; &nbsp; /* TP-LINK TL-WA901ND v2 */<br />++&nbsp; &nbsp; ATH79_MACH_TL_WR1041N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041N */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR1043ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR2543N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR2543N/ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR703N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR703N */<br />@@ -188,7 +189,7 @@<br />&nbsp; config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp; bool &quot;Atheros PB44 reference board&quot;<br />&nbsp; &nbsp; &nbsp; select SOC_AR71XX<br />-@@ -54,6 +137,369 @@ config ATH79_MACH_PB44<br />+@@ -54,6 +137,379 @@ config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Say &#039;Y&#039; here if you want your kernel to support the<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Atheros PB44 reference board.<br />&nbsp; <br />@@ -516,6 +517,16 @@<br /> +&nbsp; &nbsp; select ATH79_DEV_M25P80<br /> +&nbsp; &nbsp; select ATH79_DEV_WMAC<br /> +<br />++config ATH79_MACH_TL_WR1041N<br />++&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1041N support&quot;<br />++&nbsp; &nbsp; select SOC_AR934X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br /> +config ATH79_MACH_TL_WR1043ND<br /> +&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1043ND support&quot;<br /> +&nbsp; &nbsp; select SOC_AR913X<br />@@ -620,7 +631,7 @@<br />&nbsp; endif<br /> --- a/arch/mips/ath79/Makefile<br /> +++ b/arch/mips/ath79/Makefile<br />-@@ -36,8 +36,56 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />+@@ -36,8 +36,57 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />&nbsp; #<br />&nbsp; # Machines<br />&nbsp; #<br />@@ -661,6 +672,7 @@<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR741ND_V4)&nbsp; &nbsp; += mach-tl-wr741nd-v4.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR841N_V1)&nbsp; &nbsp; += mach-tl-wr841n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR941ND)&nbsp; &nbsp; += mach-tl-wr941nd.o<br />++obj-$(CONFIG_ATH79_MACH_TL_WR1041N)&nbsp; &nbsp; += mach-tl-wr1041n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR1043ND)&nbsp; &nbsp; += mach-tl-wr1043nd.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR2543N)&nbsp; &nbsp; += mach-tl-wr2543n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR703N)&nbsp; &nbsp; += mach-tl-wr703n.o<br />Index: target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch<br />===================================================================<br />--- target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (working copy)<br />@@ -1,6 +1,6 @@<br /> --- a/arch/mips/ath79/machtypes.h<br /> +++ b/arch/mips/ath79/machtypes.h<br />-@@ -16,17 +16,81 @@<br />+@@ -16,17 +16,82 @@<br />&nbsp; <br />&nbsp; enum ath79_mach_type {<br />&nbsp; &nbsp; &nbsp; ATH79_MACH_GENERIC = 0,<br />@@ -47,6 +47,7 @@<br /> +&nbsp; &nbsp; ATH79_MACH_TL_MR3420,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-MR3420 */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WA901ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND_V2,&nbsp; &nbsp; /* TP-LINK TL-WA901ND v2 */<br />++&nbsp; &nbsp; ATH79_MACH_TL_WR1041N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041N */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR1043ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR2543N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR2543N/ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR703N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR703N */<br />@@ -188,7 +189,7 @@<br />&nbsp; config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp; bool &quot;Atheros PB44 reference board&quot;<br />&nbsp; &nbsp; &nbsp; select SOC_AR71XX<br />-@@ -54,6 +137,369 @@ config ATH79_MACH_PB44<br />+@@ -54,6 +137,370 @@ config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Say &#039;Y&#039; here if you want your kernel to support the<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Atheros PB44 reference board.<br />&nbsp; <br />@@ -516,6 +517,16 @@<br /> +&nbsp; &nbsp; select ATH79_DEV_M25P80<br /> +&nbsp; &nbsp; select ATH79_DEV_WMAC<br /> +<br />++config ATH79_MACH_TL_WR1041N<br />++&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1041N support&quot;<br />++&nbsp; &nbsp; select SOC_AR934X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br /> +config ATH79_MACH_TL_WR1043ND<br /> +&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1043ND support&quot;<br /> +&nbsp; &nbsp; select SOC_AR913X<br />@@ -620,7 +631,7 @@<br />&nbsp; endif<br /> --- a/arch/mips/ath79/Makefile<br /> +++ b/arch/mips/ath79/Makefile<br />-@@ -36,8 +36,56 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />+@@ -36,8 +36,57 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />&nbsp; #<br />&nbsp; # Machines<br />&nbsp; #<br />@@ -661,6 +672,7 @@<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR741ND_V4)&nbsp; &nbsp; += mach-tl-wr741nd-v4.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR841N_V1)&nbsp; &nbsp; += mach-tl-wr841n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR941ND)&nbsp; &nbsp; += mach-tl-wr941nd.o<br />++obj-$(CONFIG_ATH79_MACH_TL_WR1041N)&nbsp; &nbsp; += mach-tl-wr1041n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR1043ND)&nbsp; &nbsp; += mach-tl-wr1043nd.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR2543N)&nbsp; &nbsp; += mach-tl-wr2543n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR703N)&nbsp; &nbsp; += mach-tl-wr703n.o<br />Index: target/linux/ar71xx/base-files/lib/ar71xx.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (working copy)<br />@@ -97,6 +97,9 @@<br /> &nbsp; &nbsp; &quot;094100&quot;*)<br /> &nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR941N/ND&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; &quot;104100&quot;*)<br />+&nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR1041N&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; &quot;104300&quot;*)<br /> &nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR1043N/ND&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />@@ -265,6 +268,9 @@<br /> &nbsp; &nbsp; *TEW-673GRU)<br /> &nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tew-673gru&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; *TL-WR1041N)<br />+&nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tl-wr1041n-v2&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; *TL-WR1043ND)<br /> &nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tl-wr1043nd&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (working copy)<br />@@ -136,6 +136,7 @@<br /> &nbsp; &nbsp; tl-wr841n-v1 | \<br /> &nbsp; &nbsp; tl-wr841n-v7 | \<br /> &nbsp; &nbsp; tl-wr941nd | \<br />+&nbsp; &nbsp; tl-wr1041n-v2 | \<br /> &nbsp; &nbsp; tl-wr1043nd | \<br /> &nbsp; &nbsp; tl-wr2543n)<br /> &nbsp; &nbsp; &nbsp; &nbsp; [ &quot;$magic&quot; != &quot;0100&quot; ] &amp;&amp; {<br />Index: target/linux/ar71xx/base-files/etc/uci-defaults/network<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/uci-defaults/network&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/etc/uci-defaults/network&nbsp; &nbsp; (working copy)<br />@@ -20,6 +20,7 @@<br /> &nbsp; &nbsp; ucidef_set_interface_lan &quot;eth0 eth1&quot;<br /> &nbsp; &nbsp; ;;</p><p>+tl-wr1041n-v2 |\<br /> db120)<br /> &nbsp; &nbsp; ucidef_set_interfaces_lan_wan &quot;eth0.1 eth1&quot; &quot;eth0.2&quot;<br /> &nbsp; &nbsp; ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;<br />Index: target/linux/ar71xx/base-files/etc/diag.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (working copy)<br />@@ -109,6 +109,7 @@<br /> &nbsp; &nbsp; tl-mr3420 | \<br /> &nbsp; &nbsp; tl-wa901nd | \<br /> &nbsp; &nbsp; tl-wa901nd-v2 | \<br />+&nbsp; &nbsp; tl-wr1041n-v2 | \<br /> &nbsp; &nbsp; tl-wr1043nd | \<br /> &nbsp; &nbsp; tl-wr741nd | \<br /> &nbsp; &nbsp; tl-wr741nd-v4 | \<br />Index: target/linux/ar71xx/generic/profiles/tp-link.mk<br />===================================================================<br />--- target/linux/ar71xx/generic/profiles/tp-link.mk&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/generic/profiles/tp-link.mk&nbsp; &nbsp; (working copy)<br />@@ -149,6 +149,16 @@<br /> $(eval $(call Profile,TLWR941))</p> <br /><p>+define Profile/TLWR1041<br />+&nbsp; &nbsp; NAME:=TP-LINK TL-WR1041N<br />+&nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev<br />+endef<br />+<br />+define Profile/TLWR1041/Description<br />+&nbsp; &nbsp; Package set optimized for the TP-LINK TL-WR1041N<br />+endef<br />+$(eval $(call Profile,TLWR1041))<br />+<br /> define Profile/TLWR1043<br /> &nbsp; &nbsp; NAME:=TP-LINK TL-WR1043N/ND<br /> &nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161575">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						21 Mar 2012, 03:40					</div>
				</div>
				<div class="post-content content">
					<p>Openssl Benchmark please!<br />Thanks <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Add a Wiki Page as well.</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 21 Mar 2012, 03:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161578">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kyokyowin</div>
					<div class="post-datetime">
						21 Mar 2012, 04:10					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t know how to do this...<br /></p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Openssl Benchmark please!<br />Thanks <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Add a Wiki Page as well.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161582">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">chinawrj</div>
					<div class="post-datetime">
						21 Mar 2012, 07:05					</div>
				</div>
				<div class="post-content content">
					<p>??????????????????????????????<br />????????????????JS???????????????<br />?????????<br /></p><div class="quotebox"><cite>kyokyowin wrote:</cite><blockquote><p>This is from chinese forum~</p><p>It is the patch ,please submit it~~</p><br /><p>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c<br />===================================================================<br />--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c&nbsp; &nbsp; (revision 0)<br />+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr1041n.c&nbsp; &nbsp; (revision 0)<br />@@ -0,0 +1,242 @@<br />+/*<br />+ * Atheros DB120 reference board support<br />+ *<br />+ * Copyright (c) 2011 Qualcomm Atheros<br />+ * Copyright (c) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;<br />+ *<br />+ * All rights reserved.<br />+ *<br />+ * Redistribution and use in source and binary forms, with or without<br />+ * modification, are permitted (subject to the limitations in the<br />+ * disclaimer below) provided that the following conditions are met:<br />+ *<br />+ *&nbsp; * Redistributions of source code must retain the above copyright<br />+ *&nbsp; &nbsp; notice, this list of conditions and the following disclaimer.<br />+ *<br />+ *&nbsp; * Redistributions in binary form must reproduce the above copyright<br />+ *&nbsp; &nbsp; notice, this list of conditions and the following disclaimer in the<br />+ *&nbsp; &nbsp; documentation and/or other materials provided with the<br />+ *&nbsp; &nbsp; distribution.<br />+ *<br />+ *&nbsp; * Neither the name of Qualcomm Atheros nor the names of its<br />+ *&nbsp; &nbsp; contributors may be used to endorse or promote products derived<br />+ *&nbsp; &nbsp; from this software without specific prior written permission.<br />+ *<br />+ * NO EXPRESS OR IMPLIED LICENSES TO ANY PARTY&#039;S PATENT RIGHTS ARE<br />+ * GRANTED BY THIS LICENSE.&nbsp; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT<br />+ * HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED<br />+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF<br />+ * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE<br />+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<br />+ * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<br />+ * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<br />+ * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR<br />+ * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,<br />+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE<br />+ * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN<br />+ * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<br />+ */<br />+<br />+#include &lt;linux/mtd/mtd.h&gt;<br />+#include &lt;linux/mtd/partitions.h&gt;<br />+#include &lt;linux/pci.h&gt;<br />+#include &lt;linux/phy.h&gt;<br />+#include &lt;linux/platform_device.h&gt;<br />+#include &lt;linux/ath9k_platform.h&gt;<br />+#include &lt;linux/ar8216_platform.h&gt;<br />+<br />+#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;<br />+<br />+#include &quot;common.h&quot;<br />+#include &quot;dev-ap9x-pci.h&quot;<br />+#include &quot;dev-eth.h&quot;<br />+#include &quot;dev-gpio-buttons.h&quot;<br />+#include &quot;dev-leds-gpio.h&quot;<br />+#include &quot;dev-m25p80.h&quot;<br />+#include &quot;dev-spi.h&quot;<br />+#include &quot;dev-usb.h&quot;<br />+#include &quot;dev-wmac.h&quot;<br />+#include &quot;machtypes.h&quot;<br />+<br />+#define DB120_GPIO_LED_USB&nbsp; &nbsp; &nbsp; &nbsp; 11<br />+#define DB120_GPIO_LED_WLAN_5G&nbsp; &nbsp; &nbsp; &nbsp; 12<br />+#define DB120_GPIO_LED_WLAN_2G&nbsp; &nbsp; &nbsp; &nbsp; 13<br />+#define DB120_GPIO_LED_STATUS&nbsp; &nbsp; &nbsp; &nbsp; 14<br />+#define DB120_GPIO_LED_WPS&nbsp; &nbsp; &nbsp; &nbsp; 15<br />+<br />+#define DB120_GPIO_BTN_WPS&nbsp; &nbsp; &nbsp; &nbsp; 16<br />+<br />+#define DB120_KEYS_POLL_INTERVAL&nbsp; &nbsp; 20&nbsp; &nbsp; /* msecs */<br />+#define DB120_KEYS_DEBOUNCE_INTERVAL&nbsp; &nbsp; (3 * DB120_KEYS_POLL_INTERVAL)<br />+<br />+#define DB120_MAC0_OFFSET&nbsp; &nbsp; &nbsp; &nbsp; 0<br />+#define DB120_MAC1_OFFSET&nbsp; &nbsp; &nbsp; &nbsp; 6<br />+#define DB120_WMAC_CALDATA_OFFSET&nbsp; &nbsp; 0x1000<br />+#define DB120_PCIE_CALDATA_OFFSET&nbsp; &nbsp; 0x5000<br />+<br />+static struct mtd_partition db120_partitions[] = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;u-boot&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x040000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .mask_flags&nbsp; &nbsp; = MTD_WRITEABLE,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;u-boot-env&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x040000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;rootfs&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x050000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x2b0000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;uImage&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x300000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x0e0000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;NVRAM&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x3E0000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;ART&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .offset&nbsp; &nbsp; &nbsp; &nbsp; = 0x3F0000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .size&nbsp; &nbsp; &nbsp; &nbsp; = 0x010000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .mask_flags&nbsp; &nbsp; = MTD_WRITEABLE,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct flash_platform_data db120_flash_data = {<br />+&nbsp; &nbsp; .parts&nbsp; &nbsp; &nbsp; &nbsp; = db120_partitions,<br />+&nbsp; &nbsp; .nr_parts&nbsp; &nbsp; = ARRAY_SIZE(db120_partitions),<br />+};<br />+<br />+static struct gpio_led db120_leds_gpio[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:status&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_STATUS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wps&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WPS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wlan-5g&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WLAN_5G,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:wlan-2g&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_WLAN_2G,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;db120:green:usb&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_LED_USB,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct gpio_keys_button db120_gpio_keys[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;WPS button&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = KEY_WPS_BUTTON,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = DB120_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = DB120_GPIO_BTN_WPS,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static struct ar8327_pad_cfg db120_ar8327_pad0_cfg = {<br />+&nbsp; &nbsp; .mode = AR8327_PAD_MAC_RGMII,<br />+&nbsp; &nbsp; .txclk_delay_en = true,<br />+&nbsp; &nbsp; .rxclk_delay_en = true,<br />+&nbsp; &nbsp; .txclk_delay_sel = AR8327_CLK_DELAY_SEL1,<br />+&nbsp; &nbsp; .rxclk_delay_sel = AR8327_CLK_DELAY_SEL2,<br />+};<br />+<br />+static struct ar8327_platform_data db120_ar8327_data = {<br />+&nbsp; &nbsp; .pad0_cfg = &amp;db120_ar8327_pad0_cfg,<br />+&nbsp; &nbsp; .cpuport_cfg = {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .force_link = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .speed = AR8327_PORT_SPEED_1000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .duplex = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .txpause = 1,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .rxpause = 1,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static struct mdio_board_info db120_mdio0_info[] = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .bus_id = &quot;ag71xx-mdio.0&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .phy_addr = 0,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .platform_data = &amp;db120_ar8327_data,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static void __init db120_gmac_setup(void)<br />+{<br />+&nbsp; &nbsp; void __iomem *base;<br />+&nbsp; &nbsp; u32 t;<br />+<br />+&nbsp; &nbsp; base = ioremap(AR934X_GMAC_BASE, AR934X_GMAC_SIZE);<br />+<br />+&nbsp; &nbsp; t = __raw_readl(base + AR934X_GMAC_REG_ETH_CFG);<br />+&nbsp; &nbsp; t &amp;= ~(AR934X_ETH_CFG_RGMII_GMAC0 | AR934X_ETH_CFG_MII_GMAC0 |<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; AR934X_ETH_CFG_MII_GMAC0 | AR934X_ETH_CFG_SW_ONLY_MODE);<br />+&nbsp; &nbsp; t |= AR934X_ETH_CFG_RGMII_GMAC0 | AR934X_ETH_CFG_SW_ONLY_MODE;<br />+<br />+&nbsp; &nbsp; __raw_writel(t, base + AR934X_GMAC_REG_ETH_CFG);<br />+<br />+&nbsp; &nbsp; iounmap(base);<br />+}<br />+<br />+static void __init tl_wr1041n_setup(void)<br />+{<br />+&nbsp; &nbsp; u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);<br />+<br />+&nbsp; &nbsp; ath79_gpio_output_select(DB120_GPIO_LED_USB, AR934X_GPIO_OUT_GPIO);<br />+&nbsp; &nbsp; ath79_register_m25p80(&amp;db120_flash_data);<br />+<br />+&nbsp; &nbsp; ath79_register_leds_gpio(-1, ARRAY_SIZE(db120_leds_gpio),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; db120_leds_gpio);<br />+&nbsp; &nbsp; ath79_register_gpio_keys_polled(-1, DB120_KEYS_POLL_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ARRAY_SIZE(db120_gpio_keys),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; db120_gpio_keys);<br />+&nbsp; &nbsp; ath79_register_usb();<br />+&nbsp; &nbsp; ath79_register_wmac(art + DB120_WMAC_CALDATA_OFFSET, NULL);<br />+&nbsp; &nbsp; ap91_pci_init(art + DB120_PCIE_CALDATA_OFFSET, NULL);<br />+<br />+&nbsp; &nbsp; db120_gmac_setup();<br />+<br />+&nbsp; &nbsp; ath79_register_mdio(1, 0x0);<br />+&nbsp; &nbsp; ath79_register_mdio(0, 0x0);<br />+<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth0_data.mac_addr, art + DB120_MAC0_OFFSET, 0);<br />+<br />+&nbsp; &nbsp; mdiobus_register_board_info(db120_mdio0_info,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;ARRAY_SIZE(db120_mdio0_info));<br />+<br />+&nbsp; &nbsp; /* GMAC0 is connected to an AR8327 switch */<br />+&nbsp; &nbsp; ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;<br />+&nbsp; &nbsp; ath79_eth0_data.phy_mask = BIT(0);<br />+&nbsp; &nbsp; ath79_eth0_data.mii_bus_dev = &amp;ath79_mdio0_device.dev;<br />+&nbsp; &nbsp; ath79_register_eth(0);<br />+<br />+&nbsp; &nbsp; /* GMAC1 is connected to the internal switch */<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth1_data.mac_addr, art + DB120_MAC1_OFFSET, 0);<br />+&nbsp; &nbsp; ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;<br />+&nbsp; &nbsp; ath79_eth1_data.speed = SPEED_1000;<br />+&nbsp; &nbsp; ath79_eth1_data.duplex = DUPLEX_FULL;<br />+<br />+&nbsp; &nbsp; ath79_register_eth(1);<br />+}<br />+<br />+MIPS_MACHINE(ATH79_MACH_TL_WR1041N, &quot;TL-WR1041N&quot;, &quot;TP-LINK TL-WR1041N-V2&quot;,<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; tl_wr1041n_setup);<br />Index: target/linux/ar71xx/image/Makefile<br />===================================================================<br />--- target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (working copy)<br />@@ -918,6 +918,11 @@<br /> &nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr941nd-v4,$(tlwr941v4_cmdline),0x09410004,1,4M)<br /> endef</p><p>+tlwr1041_cmdline=board=TL-WR1041N console=ttyS0,115200<br />+define Image/Build/Profile/TLWR1041<br />+&nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr1041n-v2,$(tlwr1041_cmdline),0x10410002,1,4M)<br />+endef<br />+<br /> tlwr1043_cmdline=board=TL-WR1043ND console=ttyS0,115200<br /> define Image/Build/Profile/TLWR1043<br /> &nbsp; &nbsp; $(call Image/Build/Template/$(fs_64kraw)/$(1),TPLINK,tl-wr1043nd-v1,$(tlwr1043_cmdline),0x10430001,1,8M)<br />@@ -1056,6 +1061,7 @@<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR841,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR842,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR941,$(1))<br />+&nbsp; &nbsp; $(call Image/Build/Profile/TLWR1041,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR1043,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/TLWR2543,$(1))<br /> &nbsp; &nbsp; $(call Image/Build/Profile/UBNT,$(1))<br />Index: target/linux/ar71xx/config-3.2<br />===================================================================<br />--- target/linux/ar71xx/config-3.2&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/config-3.2&nbsp; &nbsp; (working copy)<br />@@ -56,6 +56,7 @@<br /> CONFIG_ATH79_MACH_TL_MR3X20=y<br /> CONFIG_ATH79_MACH_TL_WA901ND=y<br /> CONFIG_ATH79_MACH_TL_WA901ND_V2=y<br />+CONFIG_ATH79_MACH_TL_WR1041N=y<br /> CONFIG_ATH79_MACH_TL_WR1043ND=y<br /> CONFIG_ATH79_MACH_TL_WR2543N=y<br /> CONFIG_ATH79_MACH_TL_WR703N=y<br />Index: target/linux/ar71xx/config-3.3<br />===================================================================<br />--- target/linux/ar71xx/config-3.3&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/config-3.3&nbsp; &nbsp; (working copy)<br />@@ -57,6 +57,7 @@<br /> CONFIG_ATH79_MACH_TL_MR3X20=y<br /> CONFIG_ATH79_MACH_TL_WA901ND=y<br /> CONFIG_ATH79_MACH_TL_WA901ND_V2=y<br />+CONFIG_ATH79_MACH_TL_WR1041N=y<br /> CONFIG_ATH79_MACH_TL_WR1043ND=y<br /> CONFIG_ATH79_MACH_TL_WR2543N=y<br /> CONFIG_ATH79_MACH_TL_WR703N=y<br />Index: target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch<br />===================================================================<br />--- target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/patches-3.2/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (working copy)<br />@@ -1,6 +1,6 @@<br /> --- a/arch/mips/ath79/machtypes.h<br /> +++ b/arch/mips/ath79/machtypes.h<br />-@@ -16,17 +16,81 @@<br />+@@ -16,17 +16,82 @@<br />&nbsp; <br />&nbsp; enum ath79_mach_type {<br />&nbsp; &nbsp; &nbsp; ATH79_MACH_GENERIC = 0,<br />@@ -47,6 +47,7 @@<br /> +&nbsp; &nbsp; ATH79_MACH_TL_MR3420,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-MR3420 */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WA901ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND_V2,&nbsp; &nbsp; /* TP-LINK TL-WA901ND v2 */<br />++&nbsp; &nbsp; ATH79_MACH_TL_WR1041N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041N */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR1043ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR2543N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR2543N/ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR703N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR703N */<br />@@ -188,7 +189,7 @@<br />&nbsp; config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp; bool &quot;Atheros PB44 reference board&quot;<br />&nbsp; &nbsp; &nbsp; select SOC_AR71XX<br />-@@ -54,6 +137,369 @@ config ATH79_MACH_PB44<br />+@@ -54,6 +137,379 @@ config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Say &#039;Y&#039; here if you want your kernel to support the<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Atheros PB44 reference board.<br />&nbsp; <br />@@ -516,6 +517,16 @@<br /> +&nbsp; &nbsp; select ATH79_DEV_M25P80<br /> +&nbsp; &nbsp; select ATH79_DEV_WMAC<br /> +<br />++config ATH79_MACH_TL_WR1041N<br />++&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1041N support&quot;<br />++&nbsp; &nbsp; select SOC_AR934X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br /> +config ATH79_MACH_TL_WR1043ND<br /> +&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1043ND support&quot;<br /> +&nbsp; &nbsp; select SOC_AR913X<br />@@ -620,7 +631,7 @@<br />&nbsp; endif<br /> --- a/arch/mips/ath79/Makefile<br /> +++ b/arch/mips/ath79/Makefile<br />-@@ -36,8 +36,56 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />+@@ -36,8 +36,57 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />&nbsp; #<br />&nbsp; # Machines<br />&nbsp; #<br />@@ -661,6 +672,7 @@<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR741ND_V4)&nbsp; &nbsp; += mach-tl-wr741nd-v4.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR841N_V1)&nbsp; &nbsp; += mach-tl-wr841n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR941ND)&nbsp; &nbsp; += mach-tl-wr941nd.o<br />++obj-$(CONFIG_ATH79_MACH_TL_WR1041N)&nbsp; &nbsp; += mach-tl-wr1041n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR1043ND)&nbsp; &nbsp; += mach-tl-wr1043nd.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR2543N)&nbsp; &nbsp; += mach-tl-wr2543n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR703N)&nbsp; &nbsp; += mach-tl-wr703n.o<br />Index: target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch<br />===================================================================<br />--- target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch&nbsp; &nbsp; (working copy)<br />@@ -1,6 +1,6 @@<br /> --- a/arch/mips/ath79/machtypes.h<br /> +++ b/arch/mips/ath79/machtypes.h<br />-@@ -16,17 +16,81 @@<br />+@@ -16,17 +16,82 @@<br />&nbsp; <br />&nbsp; enum ath79_mach_type {<br />&nbsp; &nbsp; &nbsp; ATH79_MACH_GENERIC = 0,<br />@@ -47,6 +47,7 @@<br /> +&nbsp; &nbsp; ATH79_MACH_TL_MR3420,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-MR3420 */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WA901ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WA901ND_V2,&nbsp; &nbsp; /* TP-LINK TL-WA901ND v2 */<br />++&nbsp; &nbsp; ATH79_MACH_TL_WR1041N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041N */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR1043ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR1041ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR2543N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR2543N/ND */<br /> +&nbsp; &nbsp; ATH79_MACH_TL_WR703N,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR703N */<br />@@ -188,7 +189,7 @@<br />&nbsp; config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp; bool &quot;Atheros PB44 reference board&quot;<br />&nbsp; &nbsp; &nbsp; select SOC_AR71XX<br />-@@ -54,6 +137,369 @@ config ATH79_MACH_PB44<br />+@@ -54,6 +137,370 @@ config ATH79_MACH_PB44<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Say &#039;Y&#039; here if you want your kernel to support the<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;Atheros PB44 reference board.<br />&nbsp; <br />@@ -516,6 +517,16 @@<br /> +&nbsp; &nbsp; select ATH79_DEV_M25P80<br /> +&nbsp; &nbsp; select ATH79_DEV_WMAC<br /> +<br />++config ATH79_MACH_TL_WR1041N<br />++&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1041N support&quot;<br />++&nbsp; &nbsp; select SOC_AR934X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br /> +config ATH79_MACH_TL_WR1043ND<br /> +&nbsp; &nbsp; bool &quot;TP-LINK TL-WR1043ND support&quot;<br /> +&nbsp; &nbsp; select SOC_AR913X<br />@@ -620,7 +631,7 @@<br />&nbsp; endif<br /> --- a/arch/mips/ath79/Makefile<br /> +++ b/arch/mips/ath79/Makefile<br />-@@ -36,8 +36,56 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />+@@ -36,8 +36,57 @@ obj-$(CONFIG_ATH79_PCI_ATH9K_FIXUP)&nbsp; &nbsp; += p<br />&nbsp; #<br />&nbsp; # Machines<br />&nbsp; #<br />@@ -661,6 +672,7 @@<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR741ND_V4)&nbsp; &nbsp; += mach-tl-wr741nd-v4.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR841N_V1)&nbsp; &nbsp; += mach-tl-wr841n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR941ND)&nbsp; &nbsp; += mach-tl-wr941nd.o<br />++obj-$(CONFIG_ATH79_MACH_TL_WR1041N)&nbsp; &nbsp; += mach-tl-wr1041n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR1043ND)&nbsp; &nbsp; += mach-tl-wr1043nd.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR2543N)&nbsp; &nbsp; += mach-tl-wr2543n.o<br /> +obj-$(CONFIG_ATH79_MACH_TL_WR703N)&nbsp; &nbsp; += mach-tl-wr703n.o<br />Index: target/linux/ar71xx/base-files/lib/ar71xx.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (working copy)<br />@@ -97,6 +97,9 @@<br /> &nbsp; &nbsp; &quot;094100&quot;*)<br /> &nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR941N/ND&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; &quot;104100&quot;*)<br />+&nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR1041N&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; &quot;104300&quot;*)<br /> &nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR1043N/ND&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />@@ -265,6 +268,9 @@<br /> &nbsp; &nbsp; *TEW-673GRU)<br /> &nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tew-673gru&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; *TL-WR1041N)<br />+&nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tl-wr1041n-v2&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; *TL-WR1043ND)<br /> &nbsp; &nbsp; &nbsp; &nbsp; name=&quot;tl-wr1043nd&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (working copy)<br />@@ -136,6 +136,7 @@<br /> &nbsp; &nbsp; tl-wr841n-v1 | \<br /> &nbsp; &nbsp; tl-wr841n-v7 | \<br /> &nbsp; &nbsp; tl-wr941nd | \<br />+&nbsp; &nbsp; tl-wr1041n-v2 | \<br /> &nbsp; &nbsp; tl-wr1043nd | \<br /> &nbsp; &nbsp; tl-wr2543n)<br /> &nbsp; &nbsp; &nbsp; &nbsp; [ &quot;$magic&quot; != &quot;0100&quot; ] &amp;&amp; {<br />Index: target/linux/ar71xx/base-files/etc/uci-defaults/network<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/uci-defaults/network&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/etc/uci-defaults/network&nbsp; &nbsp; (working copy)<br />@@ -20,6 +20,7 @@<br /> &nbsp; &nbsp; ucidef_set_interface_lan &quot;eth0 eth1&quot;<br /> &nbsp; &nbsp; ;;</p><p>+tl-wr1041n-v2 |\<br /> db120)<br /> &nbsp; &nbsp; ucidef_set_interfaces_lan_wan &quot;eth0.1 eth1&quot; &quot;eth0.2&quot;<br /> &nbsp; &nbsp; ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;<br />Index: target/linux/ar71xx/base-files/etc/diag.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (working copy)<br />@@ -109,6 +109,7 @@<br /> &nbsp; &nbsp; tl-mr3420 | \<br /> &nbsp; &nbsp; tl-wa901nd | \<br /> &nbsp; &nbsp; tl-wa901nd-v2 | \<br />+&nbsp; &nbsp; tl-wr1041n-v2 | \<br /> &nbsp; &nbsp; tl-wr1043nd | \<br /> &nbsp; &nbsp; tl-wr741nd | \<br /> &nbsp; &nbsp; tl-wr741nd-v4 | \<br />Index: target/linux/ar71xx/generic/profiles/tp-link.mk<br />===================================================================<br />--- target/linux/ar71xx/generic/profiles/tp-link.mk&nbsp; &nbsp; (revision 31014)<br />+++ target/linux/ar71xx/generic/profiles/tp-link.mk&nbsp; &nbsp; (working copy)<br />@@ -149,6 +149,16 @@<br /> $(eval $(call Profile,TLWR941))</p> <br /><p>+define Profile/TLWR1041<br />+&nbsp; &nbsp; NAME:=TP-LINK TL-WR1041N<br />+&nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev<br />+endef<br />+<br />+define Profile/TLWR1041/Description<br />+&nbsp; &nbsp; Package set optimized for the TP-LINK TL-WR1041N<br />+endef<br />+$(eval $(call Profile,TLWR1041))<br />+<br /> define Profile/TLWR1043<br /> &nbsp; &nbsp; NAME:=TP-LINK TL-WR1043N/ND<br /> &nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163225">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">go2net</div>
					<div class="post-datetime">
						4 Apr 2012, 06:11					</div>
				</div>
				<div class="post-content content">
					<p>thanks for sharing,&nbsp; I have seen something in this link <a href="http://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=75457">http://www.right.com.cn/forum/forum.php  ;tid=75457</a>, but no more updating now, hope this model can be official support by OpenWRT group</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166204">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">go2net</div>
					<div class="post-datetime">
						1 May 2012, 05:05					</div>
				</div>
				<div class="post-content content">
					<p>one Chinese guy has release a workable firmware for WR1041n, I have tested it, it can be flashed into WR1041 via WEB, link is here <a href="http://www.right.com.cn/forum/thread-78312-1-1.html">http://www.right.com.cn/forum/thread-78312-1-1.html</a>, you can also download it from (sorry, author PM me to remove direct download link) directly, if you want to forward it, please make note that who is author.</p><p>And please note, this release have no relationship with release of first floor guy.</p>											<p class="post-edited">(Last edited by <strong>go2net</strong> on 2 May 2012, 18:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166216">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ldpinney</div>
					<div class="post-datetime">
						1 May 2012, 10:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>go2net wrote:</cite><blockquote><p>one Chinese guy has release a workable firmware for WR1041n, I have tested it, it can be flashed into WR1041 via WEB, link is here <a href="http://www.right.com.cn/forum/thread-78312-1-1.html">http://www.right.com.cn/forum/thread-78312-1-1.html</a>, you can also download it from <a href="http://www.kuaipan.cn/file/id_49124972643221527.html">http://www.kuaipan.cn/file/id_49124972643221527.html</a> directly, if you want to forward it, please make note that who is author.</p></blockquote></div><p>@go2net I&#039;m looking for something useful for my wdr4310......I can&#039;t seem to open the &quot;right.com.cn&quot; link... Oh nevermind...just remove the &quot;,&quot; after the html.......I have the *.bin file but I&#039;d really like to have the patch files for my wdr4310 seems both are DB120 reference board types but no machine profiles are defined in trunk yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166338">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">go2net</div>
					<div class="post-datetime">
						2 May 2012, 18:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ldpinney wrote:</cite><blockquote><div class="quotebox"><cite>go2net wrote:</cite><blockquote><p>one Chinese guy has release a workable firmware for WR1041n, I have tested it, it can be flashed into WR1041 via WEB, link is here <a href="http://www.right.com.cn/forum/thread-78312-1-1.html">http://www.right.com.cn/forum/thread-78312-1-1.html</a>, you can also download it from <a href="http://www.kuaipan.cn/file/id_49124972643221527.html">http://www.kuaipan.cn/file/id_49124972643221527.html</a> directly, if you want to forward it, please make note that who is author.</p></blockquote></div><p>@go2net I&#039;m looking for something useful for my wdr4310......I can&#039;t seem to open the &quot;right.com.cn&quot; link... Oh nevermind...just remove the &quot;,&quot; after the html.......I have the *.bin file but I&#039;d really like to have the patch files for my wdr4310 seems both are DB120 reference board types but no machine profiles are defined in trunk yet.</p></blockquote></div><p>Sorry guy, I have no such device, and I also did not setup a environment for openwrt compiling, I think you can try to search other thread about this router.</p><br /><p>Oh, I found the same author of previous link have a try on this device, you can check it from this link <a href="http://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=78058&amp;reltid=78312&amp;pre_pos=4&amp;ext=CB">http://www.right.com.cn/forum/forum.php  amp;ext=CB</a></p>											<p class="post-edited">(Last edited by <strong>go2net</strong> on 2 May 2012, 18:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166378">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">eastwoodnet</div>
					<div class="post-datetime">
						3 May 2012, 03:26					</div>
				</div>
				<div class="post-content content">
					<p>hello guy i need help about the 841n v8, where is the TTL ? could you have something update about this device?<br />THX<br /></p><div class="quotebox"><cite>go2net wrote:</cite><blockquote><p>one Chinese guy has release a workable firmware for WR1041n, I have tested it, it can be flashed into WR1041 via WEB, link is here <a href="http://www.right.com.cn/forum/thread-78312-1-1.html">http://www.right.com.cn/forum/thread-78312-1-1.html</a>, you can also download it from (sorry, author PM me to remove direct download link) directly, if you want to forward it, please make note that who is author.</p><p>And please note, this release have no relationship with release of first floor guy.</p></blockquote></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>