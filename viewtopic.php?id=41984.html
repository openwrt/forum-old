<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TL-MR3020/3040 with 3G-USB-Dongle (k5005) and extroot - cold boot prob</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p190364">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						30 Jan 2013, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve followed the instructions on <a href="http://wiki.openwrt.org/doc/recipes/3gdongle">http://wiki.openwrt.org/doc/recipes/3gdongle</a> and <a href="http://wiki.openwrt.org/doc/howto/extroot">http://wiki.openwrt.org/doc/howto/extroot</a> to get my 3G-USB-dongle (Vodafone K5005) to work with my TL-MR3020.</p><p>Without extroot the dongle works via umts fine and I could successfully mount the micro-sd card within (e.g. /home).</p><p>After I activate to extroot a cold-boot did&#039;nt come up.</p><p>First it seems ok.<br /></p><div class="codebox"><pre><code>[    8.410000] USB Mass Storage support registered.
[    8.650000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[    8.800000] scsi0 : usb-storage 1-1:1.0
[    8.810000] scsi1 : usb-storage 1-1:1.1
[    9.800000] scsi 0:0:0:0: CD-ROM            Vodafone CD ROM (Huawei)  2.31 PQ: 0 ANSI: 0
[    9.810000] scsi 1:0:0:0: Direct-Access     Vodafone Storage (Huawei) 2.31 PQ: 0 ANSI: 2
[    9.820000] sd 1:0:0:0: [sda] 3862528 512-byte logical blocks: (1.97 GB/1.84 GiB)
[    9.830000] sd 1:0:0:0: [sda] Write Protect is off
[    9.840000] sd 1:0:0:0: [sda] Mode Sense: 0f 0e 00 00
[    9.840000] sd 1:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn&#039;t support DPO or FUA
[    9.850000]  sda: sda1
[    9.860000] sd 1:0:0:0: [sda] Attached SCSI removable disk
[   28.960000] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem
[   31.390000] EXT4-fs (sda1): recovery complete
[   31.850000] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[   33.000000] eth0: link down</code></pre></div><p>but after usb-serial is loading, the filesystem is readonly mounted.<br /></p><div class="codebox"><pre><code>[   35.590000] usbcore: registered new interface driver usbserial
[   35.590000] usbcore: registered new interface driver usbserial_generic
[   35.600000] usbserial: USB Serial support registered for generic
[   35.690000] usbcore: registered new interface driver option
[   35.690000] usbserial: USB Serial support registered for GSM modem (1-port)
[   39.230000] usb 1-1: USB disconnect, device number 2
[   39.280000] Aborting journal on device sda1-8.
[   39.280000] JBD2: Error -5 detected when updating journal superblock for sda1-8.
[   39.300000] journal commit I/O error
[   39.320000] sd 1:0:0:0: [sda] Synchronizing SCSI cache
[   39.320000] sd 1:0:0:0: [sda]  
[   39.320000] Result: hostbyte=0x01 driverbyte=0x00
[   39.740000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #96583: comm ppp.sh: reading directory lblock 0
[   40.060000] EXT4-fs error (device sda1): ext4_journal_start_sb:349: Detected aborted journal
[   40.070000] EXT4-fs (sda1): Remounting filesystem read-only
[   40.120000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #16106: comm hotplug-call: reading directory lblock 0
[   40.330000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #96653: comm 3g.sh: reading directory lblock 0
[   40.400000] eth0: link up (100Mbps/Full duplex)
[   40.590000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #8071: comm udhcpc: reading directory lblock 0
[   40.670000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #16097: comm dhcp.script: reading directory lblock 0
[   41.420000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #8049: comm hotplug-call: reading directory lblock 0</code></pre></div><p>many EXT4-fs error follows, but the GSM modem starts successfully</p><div class="codebox"><pre><code>[   44.260000] usb 1-1: new high-speed USB device number 3 using ehci-platform
[   44.410000] option 1-1:1.0: GSM modem (1-port) converter detected
[   44.420000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[   44.420000] option 1-1:1.1: GSM modem (1-port) converter detected
[   44.430000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1
[   44.440000] option 1-1:1.2: GSM modem (1-port) converter detected
[   44.440000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB2
[   44.460000] scsi2 : usb-storage 1-1:1.5
[   44.460000] scsi3 : usb-storage 1-1:1.6
[   45.140000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #96653: comm S45firewall: reading directory lblock 0
[   45.320000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #8049: comm iptables: reading directory lblock 0</code></pre></div><p>I did a reboot, and voila, everything works fine.</p><div class="codebox"><pre><code>[    0.000000] Linux version 3.7.4 (openwrt@OpenWRTBuild) (gcc version 4.6.4 20121210 (prerelease) (Linaro GCC 4.6-2012.12) ) #1 Tue Jan 29 10:20:08 MST 2013
[    0.000000] MyLoader: sysp=444ba8b5, boardp=5fbcaeef, parts=ebc66edc
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 00019374 (MIPS 24Kc)
[    0.000000] SoC: Atheros AR9330 rev 1
[    0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] On node 0 totalpages: 8192
[    0.000000] free_area_init_node: node 0, pgdat 80309e60, node_mem_map 81000000
[    0.000000]   Normal zone: 64 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 8128 pages, LIFO batch:0
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
[    0.000000] pcpu-alloc: [0] 0 
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=TL-MR3020 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] __ex_table already sorted, skipping sort
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 28788k/32768k available (2231k kernel code, 3980k reserved, 586k data, 252k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.080000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is TP-LINK TL-MR3020
[    0.350000] bio: create slab &lt;bio-0&gt; at 0
[    0.350000] Switching to clocksource MIPS
[    0.360000] NET: Registered protocol family 2
[    0.360000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    0.370000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.370000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.380000] TCP: reno registered
[    0.380000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.390000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.400000] NET: Registered protocol family 1
[    0.400000] PCI: CLS 0 bytes, default 32
[    0.420000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.420000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.430000] msgmni has been set to 56
[    0.440000] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)
[    0.440000] io scheduler noop registered
[    0.450000] io scheduler deadline registered (default)
[    0.450000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.460000] ar933x-uart: ttyATH0 at MMIO 0x18020000 (irq = 11) is a AR933X UART
[    0.470000] console [ttyATH0] enabled, bootconsole disabled
[    0.480000] ath79-spi ath79-spi: master is unqueued, this is deprecated
[    0.490000] m25p80 spi0.0: found s25sl032p, expected m25p80
[    0.490000] m25p80 spi0.0: s25sl032p (4096 Kbytes)
[    0.500000] 5 tp-link partitions found on MTD device spi0.0
[    0.500000] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    0.510000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;
[    0.520000] 0x000000020000-0x00000011b4f0 : &quot;kernel&quot;
[    0.520000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.530000] 0x00000011b4f0-0x0000003f0000 : &quot;rootfs&quot;
[    0.540000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.550000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    0.560000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2A0000, len=150000 
[    0.560000] 0x0000002a0000-0x0000003f0000 : &quot;rootfs_data&quot;
[    0.570000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    0.580000] 0x000000020000-0x0000003f0000 : &quot;firmware&quot;
[    0.600000] libphy: ag71xx_mdio: probed
[    0.610000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
[    1.160000] ag71xx ag71xx.0 eth0: connected to PHY at ag71xx-mdio.1:04 [uid=004dd041, driver=Generic PHY]
[    1.170000] TCP: cubic registered
[    1.170000] NET: Registered protocol family 17
[    1.180000] Bridge firewalling registered
[    1.180000] 8021q: 802.1Q VLAN Support v1.8
[    1.190000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
[    1.200000] Freeing unused kernel memory: 252k freed
[    3.440000] Registered led device: tp-link:green:3g
[    3.440000] Registered led device: tp-link:green:wlan
[    3.440000] Registered led device: tp-link:green:lan
[    3.440000] Registered led device: tp-link:green:wps
[    6.160000] eth0: link up (100Mbps/Full duplex)
[    6.770000] jffs2: notice: (455) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (1 unchecked, 0 orphan) and 9 of xref (0 dead, 0 orphan) found.
[    7.610000] SCSI subsystem initialized
[    7.780000] usbcore: registered new interface driver usbfs
[    7.790000] usbcore: registered new interface driver hub
[    7.790000] usbcore: registered new device driver usb
[    8.300000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    8.300000] ehci-platform ehci-platform: Generic Platform EHCI Controller
[    8.310000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
[    8.350000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
[    8.370000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
[    8.370000] hub 1-0:1.0: USB hub found
[    8.370000] hub 1-0:1.0: 1 port detected
[    8.390000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
[    8.450000] Initializing USB Mass Storage driver...
[    8.460000] usbcore: registered new interface driver usb-storage
[    8.460000] USB Mass Storage support registered.
[    8.700000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[    8.860000] scsi0 : usb-storage 1-1:1.5
[    8.860000] scsi1 : usb-storage 1-1:1.6
[    9.860000] scsi 0:0:0:0: CD-ROM            Vodafone CD ROM (Huawei)  2.31 PQ: 0 ANSI: 0
[    9.860000] scsi 1:0:0:0: Direct-Access     Vodafone Storage (Huawei) 2.31 PQ: 0 ANSI: 2
[    9.870000] sd 1:0:0:0: [sda] 3862528 512-byte logical blocks: (1.97 GB/1.84 GiB)
[    9.890000] sd 1:0:0:0: [sda] Write Protect is off
[    9.890000] sd 1:0:0:0: [sda] Mode Sense: 0f 0e 00 00
[    9.890000] sd 1:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn&#039;t support DPO or FUA
[    9.910000]  sda: sda1
[    9.920000] sd 1:0:0:0: [sda] Attached SCSI removable disk
[   29.000000] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem
[   30.450000] EXT4-fs (sda1): recovery complete
[   30.460000] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[   30.670000] eth0: link down
[   31.260000] Compat-drivers backport release: compat-drivers-2013-01-08-3
[   31.270000] Backport based on wireless-testing.git master-2013-01-07
[   31.280000] compat.git: wireless-testing.git
[   31.310000] cfg80211: Calling CRDA to update world regulatory domain
[   31.320000] cfg80211: World regulatory domain updated:
[   31.320000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[   31.330000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   31.340000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   31.350000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   31.350000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   31.360000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   32.120000] ath: EEPROM regdomain: 0x0
[   32.120000] ath: EEPROM indicates default country code should be used
[   32.120000] ath: doing EEPROM country-&gt;regdmn map search
[   32.120000] ath: country maps to regdmn code: 0x3a
[   32.120000] ath: Country alpha2 being used: US
[   32.120000] ath: Regpair used: 0x3a
[   32.130000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
[   32.130000] Registered led device: ath9k-phy0
[   32.130000] ieee80211 phy0: Atheros AR9330 Rev:1 mem=0xb8100000, irq=2
[   32.140000] cfg80211: Calling CRDA for country: US
[   32.140000] cfg80211: Regulatory domain changed to country: US
[   32.140000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[   32.150000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
[   32.160000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
[   32.170000] cfg80211:   (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   32.180000] cfg80211:   (5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   32.180000] cfg80211:   (5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   32.190000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
[   32.490000] PPP generic driver version 2.4.2
[   32.710000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   32.840000] NET: Registered protocol family 24
[   32.900000] nf_conntrack version 0.5.0 (453 buckets, 1812 max)
[   33.300000] usbcore: registered new interface driver usbserial
[   33.310000] usbcore: registered new interface driver usbserial_generic
[   33.310000] usbserial: USB Serial support registered for generic
[   33.410000] usbcore: registered new interface driver option
[   33.410000] usbserial: USB Serial support registered for GSM modem (1-port)
[   33.420000] option 1-1:1.0: GSM modem (1-port) converter detected
[   33.420000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[   33.430000] option 1-1:1.1: GSM modem (1-port) converter detected
[   33.440000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1
[   33.440000] option 1-1:1.2: GSM modem (1-port) converter detected
[   33.450000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB2
[   38.870000] eth0: link up (100Mbps/Full duplex)</code></pre></div><p>...but how could I get cold-boot work ?</p><p>BTW: same on TL-MR3040, same on ext4</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190461">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						30 Jan 2013, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Find out more...</p><p>it seems, that the overlay isnt correct mounted during cold boot</p><div class="codebox"><pre><code>root@OpenWrt:/# mount
rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro,relatime)
proc on /proc type proc (rw,noatime)
sysfs on /sys type sysfs (rw,noatime)
tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noatime)
tmpfs on /dev type tmpfs (rw,noatime,size=512k,mode=755)
devpts on /dev/pts type devpts (rw,noatime,mode=600)
/dev/sda1 on /overlay type ext3 (ro,sync,relatime,data=ordered)
overlayfs:/overlay on / type overlayfs (rw,noatime,lowerdir=/,upperdir=/overlay)
debugfs on /sys/kernel/debug type debugfs (rw,noatime)</code></pre></div><p>the sd card isnt sda1 like in warm boot, there is no sda, sd card is now sdb1</p><div class="codebox"><pre><code>bsg                 mtd4                pts                 ttyS3
bus                 mtd4ro              random              ttyS4
console             mtd5                sdb                 ttyS5
cpu_dma_latency     mtd5ro              sdb1                ttyS6
full                mtdblock0           shm                 ttyS7
kmsg                mtdblock1           tty                 ttyS8
log                 mtdblock2           ttyATH0             ttyS9
mem                 mtdblock3           ttyS0               ttyUSB0
mtd0                mtdblock4           ttyS1               ttyUSB1
mtd0ro              mtdblock5           ttyS10              ttyUSB2</code></pre></div><p>But I have no idea why the sd card is sometimes sdb1 and sometimes sda1</p><p>Could remounting the overlay-filesystem help ? Hints anyone?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190502">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Guzz</div>
					<div class="post-datetime">
						31 Jan 2013, 09:57					</div>
				</div>
				<div class="post-content content">
					<p>As far as I know, it&#039;s best to mount the drive you&#039;re using for extroot with its UUID. (see fstab)</p><p>Depending on which partition is mounted first it will be called sda1 / sdb1 etc, they can be swapped on boot respective to last boot.</p><p>If you don&#039;t mind, could you post the steps you took to get extroot? I&#039;ve been having some issues myself.</p><p>Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190514">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						31 Jan 2013, 13:28					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your answer. I have already try UUID, but using UUID in fstab extroot didnt work, because the mounting of the overlayfs didnt work correct.</p><p>I will post some more information later that day, because I&#039;m not at home.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190520">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Guzz</div>
					<div class="post-datetime">
						31 Jan 2013, 14:36					</div>
				</div>
				<div class="post-content content">
					<p>No way! Really? I was just struggling with the same issue. I would loooove to have some more flash memory without sacrificing LuCi</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190585">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						1 Feb 2013, 10:17					</div>
				</div>
				<div class="post-content content">
					<p>this ist my working configuration of extroot with 3g, but only on warm boot, not after cold boot</p><div class="codebox"><pre><code>root@OpenWrt:~# df -hk
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.8G     38.0M      1.7G   2% /
/dev/root                 1.5M      1.5M         0 100% /rom
tmpfs                    14.2M     84.0K     14.1M   1% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/sda1                 1.8G     38.0M      1.7G   2% /overlay
overlayfs:/overlay        1.8G     38.0M      1.7G   2% /</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig
3g-wan    Link encap:Point-to-Point Protocol  
          inet addr:10.13.182.202  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:95 errors:0 dropped:0 overruns:0 frame:0
          TX packets:99 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:7456 (7.2 KiB)  TX bytes:7266 (7.0 KiB)

eth0      Link encap:Ethernet  HWaddr 64:70:02:78:86:52  
          inet addr:192.168.2.162  Bcast:192.168.2.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1268 errors:0 dropped:23 overruns:0 frame:0
          TX packets:372 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:135049 (131.8 KiB)  TX bytes:47682 (46.5 KiB)
          Interrupt:4 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:16 errors:0 dropped:0 overruns:0 frame:0
          TX packets:16 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1584 (1.5 KiB)  TX bytes:1584 (1.5 KiB)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# opkg list-installed
base-files - 129-r35362
blkid - 2.21.2-1
block-mount - 0.2.0-10
busybox - 1.19.4-6
chat - 2.4.5-9
comgt - 0.32-21
dnsmasq - 2.62-3
dropbear - 2012.55-2
firewall - 2-57
hotplug2 - 1.0-beta-4
iptables - 1.4.10-4
iw - 3.6-1
jshn - 2013-01-13-c360ec576c5a0fe85e6665d07a091264b714a399
kernel - 3.7.4-1-f9e1b62c334875d866bcd4a49b711bcf
kmod-ath - 3.7.4+2013-01-07-1
kmod-ath9k - 3.7.4+2013-01-07-1
kmod-ath9k-common - 3.7.4+2013-01-07-1
kmod-cfg80211 - 3.7.4+2013-01-07-1
kmod-crypto-aes - 3.7.4-1
kmod-crypto-arc4 - 3.7.4-1
kmod-crypto-core - 3.7.4-1
kmod-crypto-hash - 3.7.4-1
kmod-crypto-manager - 3.7.4-1
kmod-fs-ext4 - 3.7.4-1
kmod-gpio-button-hotplug - 3.7.4-1
kmod-ipt-conntrack - 3.7.4-1
kmod-ipt-core - 3.7.4-1
kmod-ipt-nat - 3.7.4-1
kmod-ipt-nathelper - 3.7.4-1
kmod-leds-gpio - 3.7.4-1
kmod-ledtrig-default-on - 3.7.4-1
kmod-ledtrig-netdev - 3.7.4-1
kmod-ledtrig-timer - 3.7.4-1
kmod-ledtrig-usbdev - 3.7.4-1
kmod-lib-crc-ccitt - 3.7.4-1
kmod-lib-crc16 - 3.7.4-1
kmod-mac80211 - 3.7.4+2013-01-07-1
kmod-nls-base - 3.7.4-1
kmod-ppp - 3.7.4-1
kmod-pppoe - 3.7.4-1
kmod-pppox - 3.7.4-1
kmod-scsi-core - 3.7.4-1
kmod-usb-core - 3.7.4-1
kmod-usb-ohci - 3.7.4-1
kmod-usb-serial - 3.7.4-1
kmod-usb-serial-option - 3.7.4-1
kmod-usb-serial-wwan - 3.7.4-1
kmod-usb-storage - 3.7.4-1
kmod-usb2 - 3.7.4-1
kmod-wdt-ath79 - 3.7.4-1
libblkid - 2.21.2-1
libblobmsg-json - 2013-01-13-c360ec576c5a0fe85e6665d07a091264b714a399
libc - 0.9.33.2-1
libgcc - 4.6-linaro-1
libip4tc - 1.4.10-4
libjson - 0.9-2
libnl-tiny - 0.1-3
libpthread - 0.9.33.2-1
librt - 0.9.33.2-1
libubox - 2013-01-13-c360ec576c5a0fe85e6665d07a091264b714a399
libubus - 2013-01-13-bf566871bd6a633e4504c60c6fc55b2a97305a50
libuci - 2013-01-04.1-1
libusb - 0.1.12-3
libusb-1.0 - 1.0.9-1
libuuid - 2.21.2-1
libxtables - 1.4.10-4
mtd - 20
netifd - 2013-01-28.2-889f3236fde274d6ebff23fe62c5cd66ed8b3eb7
opkg - 618-3
ppp - 2.4.5-9
ppp-mod-pppoe - 2.4.5-9
procd - 2012-12-20-d343dd9e9a64d4ae7d225ea29169e97fa8d116a1
swap-utils - 2.21.2-1
swconfig - 10
uboot-envtools - 2012.04.01-1
ubus - 2013-01-13-bf566871bd6a633e4504c60c6fc55b2a97305a50
ubusd - 2013-01-13-bf566871bd6a633e4504c60c6fc55b2a97305a50
uci - 2013-01-04.1-1
usb-modeswitch - 1.2.5-1
usb-modeswitch-data - 20121109-2
usbutils - 005-1
wpad-mini - 20120910-1
zlib - 1.2.7-1</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/fstab
config global automount
    option from_fstab 1
    option anon_mount 1
    
config global autoswap
    option from_fstab 1
    option anon_swap 0
    
config mount
    option target    /overlay
    option device   /dev/sda1
    option fstype    ext3
    option options    rw,sync
    option enabled  1    
    option enabled_fsck 0</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcp&#039;
        option hostname &#039;h0bini-ap&#039;
        
config interface &#039;wan&#039;
        option ifname  &#039;ppp0&#039;
        option device  &#039;/dev/ttyUSB0&#039;
        option apn     &#039;web.vodafone.de&#039;
        option service &#039;umts&#039;
        option proto   &#039;3g&#039;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/usb_modeswitch.d/12d1:14c3
# K5005 Vodafone/Huawei

TargetVendor=  0x12d1
TargetProduct= 0x14c8

MessageContent=&quot;55534243123456780000000000000011062000000100000000000000000000&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190586">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						1 Feb 2013, 10:30					</div>
				</div>
				<div class="post-content content">
					<p>Same with uuid in modifed fstab, works on warm-boot too.</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/fstab
config global automount
    option from_fstab 1
    option anon_mount 1
    
config global autoswap
    option from_fstab 1
    option anon_swap 0
    
config mount
    option target    /overlay
    option uuid     5da54abb-e226-4cba-989d-b1761d638333 
    option fstype    ext3
    option options    rw,sync
    option enabled  1    
    option enabled_fsck 0

config swap
    option device    /dev/sda2
    option enabled    0</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# df -hk
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.8G     38.0M      1.7G   2% /
/dev/root                 1.5M      1.5M         0 100% /rom
tmpfs                    14.2M     80.0K     14.1M   1% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/sda1                 1.8G     38.0M      1.7G   2% /overlay
overlayfs:/overlay        1.8G     38.0M      1.7G   2% /</code></pre></div><p>but also not on cold boot :-(</p><div class="codebox"><pre><code>[   31.510000] PPP generic driver version 2.4.2
[   31.730000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   31.860000] NET: Registered protocol family 24
[   31.920000] nf_conntrack version 0.5.0 (453 buckets, 1812 max)
[   32.320000] usbcore: registered new interface driver usbserial
[   32.320000] usbcore: registered new interface driver usbserial_generic
[   32.330000] usbserial: USB Serial support registered for generic
[   32.420000] usbcore: registered new interface driver option
[   32.420000] usbserial: USB Serial support registered for GSM modem (1-port)
[   35.880000] usb 1-1: USB disconnect, device number 2
[   35.910000] Aborting journal on device sda1-8.
[   35.910000] JBD2: Error -5 detected when updating journal superblock for sda1-8.
[   35.940000] journal commit I/O error
[   35.940000] sd 1:0:0:0: [sda] Synchronizing SCSI cache
[   35.940000] sd 1:0:0:0: [sda]  
[   35.950000] Result: hostbyte=0x01 driverbyte=0x00
[   36.490000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #96583: comm ppp.sh: reading directory lblock 0
[   36.850000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #16106: </code></pre></div><p>same problem, no more /dev/sda1</p><div class="codebox"><pre><code>root@OpenWrt:/# ls /dev/
bsg                 mtd4                pts                 ttyS3
bus                 mtd4ro              random              ttyS4
console             mtd5                sdb                 ttyS5
cpu_dma_latency     mtd5ro              sdb1                ttyS6</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190602">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Guzz</div>
					<div class="post-datetime">
						1 Feb 2013, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>So this is with the 3G modem and flash drive plugged in? Maybe we could figure something out so that the 3G modem only gets power after succesfull boot?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190638">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						1 Feb 2013, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>I have found, that the reason isn&#039;t the 3G modem.</p><p>I habe disabled the following modules in /etc/modules.d<br />60-usb-serial<br />61-usb-serial-wwan<br />65-usb-serial-option</p><p>the same behaviour on cold boot.</p><p>I think its not a driver problem, but somtehing in the startup-skripts.</p><p>e.g.&nbsp; <br />USB hotplug scripts are run several times <br /><a href="https://dev.openwrt.org/ticket/10480">https://dev.openwrt.org/ticket/10480</a></p><p>I will try to remount the overlayfs via rc.local as a workaround , but still I have no success.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191056">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						5 Feb 2013, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>the reason is usb_modeswitch.</p><p>if I didnt install the usb-modeswitch-data package and switch the usb-mode via commandline, i see this error too.</p><div class="codebox"><pre><code>root@OpenWrt:~# lsusb
Bus 001 Device 002: ID 12d1:14c3 Huawei Technologies Co., Ltd. 
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
root@OpenWrt:~# ls /dev
bsg                 mtd3ro              ppp                 ttyS14
bus                 mtd4                ptmx                ttyS15
console             mtd4ro              pts                 ttyS2
cpu_dma_latency     mtd5                random              ttyS3
full                mtd5ro              sda                 ttyS4
kmsg                mtdblock0           sda1                ttyS5
log                 mtdblock1           shm                 ttyS6
mem                 mtdblock2           tty                 ttyS7
mtd0                mtdblock3           ttyATH0             ttyS8
mtd0ro              mtdblock4           ttyS0               ttyS9
mtd1                mtdblock5           ttyS1               urandom
mtd1ro              network_latency     ttyS10              watchdog
mtd2                network_throughput  ttyS11              zero
mtd2ro              null                ttyS12
mtd3                port                ttyS13
root@OpenWrt:~# usb_modeswitch -v 12d1 -p 14c3 -V 12d1 -P 14c8 -M &quot;5553424312345
6780000000000000011062000000100000000000000000000&quot; -n 1
Looking for target devices ...
 No devices in target mode or class found
Looking for default devices ...
   found matching product ID
   adding device
 Found device in default mode, class or configuration (1)
Accessing device 002 on bus 001 ...
Getting the current device configuration ...
 OK, got current device configuration (1)
Using interface number 0
Using endpoints 0x01 (out) and 0x81 (in)
Inquiring device details; driver will be detached ...
Looking for active driver ...
 OK, driver found; name unknown, limitation of libusb1
 OK, driver &quot;unkown&quot; detached

SCSI inquiry data (for identification)
-------------------------
  Vendor String: Vodafone
   Model String: CD ROM (Huawei) 
Revision String: 2.31
-------------------------

USB description data (for identification)
-------------------------
Manufacturer: Vodafone Group (Huawei) 
     Product: Vodafone Mobile Broadband (Huawei) 
  Serial No.: not provided
-------------------------
Setting up communication with interface 0
Using endpoint 0x01 for message sending ...
Trying to send message 1 to endpoint 0x01 ...
 Sending the message returned error -6. Trying to continue
Reading the response to message 1 (CSW) ...
 Response reading got error -6
 Device is gone, skipping any further commands
-&gt; Run lsusb to note any changes. Bye.

root@OpenWrt:~# lsusb
Bus 001 Device 003: ID 12d1:14c8 Huawei Technologies Co., Ltd. 
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div><p>After that, I loose /dev/sda1</p><div class="codebox"><pre><code>[  236.900000] usb 1-1: usbfs: process 1570 (usb_modeswitch) did not claim interface 0 before use
[  236.910000] usb 1-1: USB disconnect, device number 2
[  236.920000] sd 1:0:0:0: [sda] Synchronizing SCSI cache
[  236.920000] sd 1:0:0:0: [sda]  
[  236.930000] Result: hostbyte=0x01 driverbyte=0x00
[  236.960000] EXT4-fs error (device sda1): __ext4_get_inode_loc:3679: inode #16109: block 65538: comm hotplug-call: unable to read itable block
[  236.980000] EXT4-fs error (device sda1) in ext4_reserve_inode_write:4540: IO failure
[  237.060000] EXT4-fs error (device sda1): __ext4_get_inode_loc:3679: inode #16111: block 65538: comm hotplug-call: unable to read itable block
[  237.070000] EXT4-fs error (device sda1) in ext4_reserve_inode_write:4540: IO failure
[  237.090000] EXT4-fs error (device sda1): ext4_find_entry:1242: inode #16111: comm ls: reading directory lblock 0
[  241.900000] usb 1-1: new high-speed USB device number 3 using ehci-platform
[  242.050000] jbd2_journal_bmap: journal block not found at offset 35 on sda1-8
[  242.050000] Aborting journal on device sda1-8.
[  242.060000] Buffer I/O error on device sda1, logical block 197113
[  242.060000] lost page write due to I/O error on sda1
[  242.070000] JBD2: Error -5 detected when updating journal superblock for sda1-8.
[  242.090000] scsi2 : usb-storage 1-1:1.5
[  242.100000] scsi3 : usb-storage 1-1:1.6
[  243.090000] scsi 2:0:0:0: CD-ROM            Vodafone CD ROM (Huawei)  2.31 PQ: 0 ANSI: 0
[  243.100000] scsi 3:0:0:0: Direct-Access     Vodafone Storage (Huawei) 2.31 PQ: 0 ANSI: 2
[  243.110000] sd 3:0:0:0: [sdb] 3862528 512-byte logical blocks: (1.97 GB/1.84 GiB)
[  243.110000] sd 3:0:0:0: [sdb] Write Protect is off
[  243.120000] sd 3:0:0:0: [sdb] Mode Sense: 0f 0e 00 00
[  243.130000] sd 3:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn&#039;t support DPO or FUA
[  243.140000]  sdb: sdb1
[  243.150000] sd 3:0:0:0: [sdb] Attached SCSI removable disk
root@OpenWrt:~# ls /dev
bsg                 mtd3ro              ppp                 ttyS14
bus                 mtd4                ptmx                ttyS15
console             mtd4ro              pts                 ttyS2
cpu_dma_latency     mtd5                random              ttyS3
full                mtd5ro              sdb                 ttyS4
kmsg                mtdblock0           sdb1                ttyS5</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191423">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">omg1</div>
					<div class="post-datetime">
						8 Feb 2013, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>When I am copying the full image from / to the usb disk (pivot root), i use as instructed in the wiki, the following sequence:</p><p>mkdir -p /tmp/cproot<br />mount --bind / /tmp/cproot<br />tar -C /tmp/cproot -cvf - . | tar -C /mnt/sda1 -xf -<br />umount /tmp/cproot</p><p>So first, I have a lot of symlinks failing.... That can&#039;t be good right?</p><p>Two questions, (1) why I don&#039;t I copy the full / to the usb memory. (2) can I use a vfat device?</p><p>Any help would be appreciated,<br />Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191485">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">m3130r</div>
					<div class="post-datetime">
						9 Feb 2013, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>dont use vfat, thats the reason, why the symlinks fail. use ext4, ext3 instead</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192375">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">goodjob</div>
					<div class="post-datetime">
						18 Feb 2013, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>hey guys same here! I have exact problem with usb-modeswitch and Huawei E392 <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />It seems that we should some how switch usb mode _before_&nbsp; fstab. May be this will help us.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192383">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">goodjob</div>
					<div class="post-datetime">
						18 Feb 2013, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>it seems that some solution is there: <a href="http://ubuntuforums.org/archive/index.php/t-1473228.html">http://ubuntuforums.org/archive/index.p â€¦ 73228.html</a><br />&quot;I had to edit the file /lib/udev/rules.d/61-option-modem-modeswitch.rules<br />and added the line</p><p>ATTRS{idVendor}==&quot;12d1&quot;, ATTRS{idProduct}==&quot;1003&quot;, RUN+=&quot;modem-modeswitch -v 0x%s{idVendor} -p 0x%s{idProduct} -t option-zerocd&quot;</p><p>After a reboot, the Huawei E160 worked perfectly!!!&quot;</p><p>So we should do the same thing in our situation and I think it will work (but usb-modeswitch must be removed).</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>