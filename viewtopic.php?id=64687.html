<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Intended way to update OpenSSL</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 8 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p322854">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						7 May 2016, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>Dear All,</p><p>I&#039;m using &quot;Chaos Calmer 15.05.1&quot; together with OpenVPN and OpenSSL (opkg openvpn-openssl).</p><p>Due to the fact that many critical security issues have been fixed in OpenSSL recently, I&#039;d like to update my OpenWRT installation.</p><p>I tried to find out the &quot;intended way&quot; to do that, but I wasn&#039;t successful.</p><p>Can someone please tell me how to update OpenSSL (in my setup) to the latest version?</p><br /><p>I already found changeset 49295 (see below) which seem to cover that issue. But when I tried &quot;opkg update / opkg list-upgradable&quot; no new package showed up.</p><p>Do I just&nbsp; have to wait a little bit longer? Where can I see, when the new package will be released?<br />Do I have to compile and upgrade the package manually?<br />Do I have to install the latest build of 15.05.01?<br />Do I&nbsp; have to install the latest trunk build?</p><p>I&#039;m only interested in the &quot;intended way&quot;... of course, there might be several ways, but what is the &quot;security design&quot; of OpenWRT?</p><p>Thank you in advance<br />oil_lamp</p><br /><p>Changeset 49295 <br />---<br />&quot; openssl: Update to version 1.0.2h</p><p>Bump to the latest version, fixes several security issues:</p><p>&nbsp; &nbsp; CVE-2016-2107, CVE-2016-2105, CVE-2016-2106, CVE-2016-2109, CVE-2016-2176 &quot;<br />---</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p322855">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						7 May 2016, 10:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>oil_lamp wrote:</cite><blockquote><p>Do I just&nbsp; have to wait a little bit longer? Where can I see, when the new package will be released?<br />Do I have to compile and upgrade the package manually?<br />Do I have to install the latest build of 15.05.01?<br />Do I&nbsp; have to install the latest trunk build?</p></blockquote></div><p>Waiting is good. Probably ~9 months.<br />No.<br />There is no &#039;latest&#039;.<br />Depends on the urgency.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p322975">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						8 May 2016, 15:53					</div>
				</div>
				<div class="post-content content">
					<p>Thank you Max.</p><p>So it looks lile there is no easy and user-friendly way to upgrade OpenSSL.</p><p>Does someone else know an intended way to upgrade OpenSSL?</p><p>How would you upgrade OpenSSL anyway?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323012">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						8 May 2016, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, <strong>oil_lamp</strong>, for bringing this topic up.</p><p>I&#039;m also interested in updating/fixing this library.</p><p>There is a way to do it - it requires to have one&#039;s own build environmet.<br />Then one will be able to &quot;pull&quot; this patch and obtain the fixed version of OpenSSL.</p><p>Right now I&#039;m studying the OpenWrt documentation for the exact instructions...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323030">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						8 May 2016, 23:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi booBot,</p><p>thank you for that hint. I will also have a look at the build environment - however it sounds like a lot of effort.</p><p>Therefore I will try to understand the new/fixed vulnerabilities in more detail. As the effort to fix them is higher than expected, it makes sense to spend additional time and investigate, what the impact on my environment would be.</p><p>I still want to believe that if there is a really serious security issue, someone from the OpenWRT team would fix it (call me dreamer <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />)</p><p>Kind Regards<br />oil_lamp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323069">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 May 2016, 10:59					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it IS difficult (for me as a novice) to patch OpenSSL to the current release level.</p><p>In the download section for the trunk (the &quot;snapshot&quot;) they&#039;ve published the current version already.</p><p>I&#039;ll try that file right now...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323098">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 May 2016, 13:34					</div>
				</div>
				<div class="post-content content">
					<p>As shown <a href="https://dev.openwrt.org/changeset/49295">here</a> I just edited the <strong>package/libs/openssl/Makefile</strong>:<br />PKG_VERSION to 1.0.2h<br />and<br />PKG_MD5SUM to the new value.</p><p>Then I&#039;ve re-run <strong>make PROFILE=<em>my_hardware_profile_name</em></strong> - and the patched libopenssl was created.</p><p>I hope this is how to do it properly.<br />Will report if it does not break my asterisk v1.8....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323119">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 May 2016, 16:06					</div>
				</div>
				<div class="post-content content">
					<p>Yes, my asterisk v1.8 works fine with this update.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323264">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						10 May 2016, 22:15					</div>
				</div>
				<div class="post-content content">
					<p>Congratualtions! Maybe you can share your experience with your own version after a while?<br />E.g. can you still download packages from the opkg repository, does it contain all elements of the standarf package?</p><p>I also made progress with my investigations.</p><p>OpenSSL 1.0.2h fixes two &quot;high&quot; vulnerabilities (<a href="https://www.openssl.org/news/secadv/20160503.txt">https://www.openssl.org/news/secadv/20160503.txt</a>).</p><p>1. CVE-2016-2108<br />Result: The standard OpenSSL version (1.0.2g) in CC15.05.1 is not affected.</p><p>The issue is based on the combination of two bugs.<br />The first bug is fixed in 1.0.2.g (perhaps in an earlier version, I haven&#039;t checked)<br /></p><div class="quotebox"><blockquote><p>This issue affected versions of OpenSSL prior to April 2015. The bug<br />causing the vulnerability was fixed on April 18th 2015, and released<br />as part of the June 11th 2015 security releases</p></blockquote></div><p>Furthermore the advisory says:<br /></p><div class="quotebox"><blockquote><p>This vulnerability is a combination of two bugs, neither of which<br />individually has security impact.</p></blockquote></div><p>2. CVE-2016-2107<br />Result: Not sure yet</p><p>a) It only affects chipsets which support AES-NI &gt;&gt; I try to find out if my router supports it &gt;&gt; not that easy<br />b) As far as I understand, the attacker needs to send data to OpenSSL and needs to interpret the response. In my case, I think I have an environment, where the attacker doesn&#039;t get the response because of another security mechanism &gt;&gt; not easy to find out</p><p>Disclaimer:<br />I&#039;m not a security expert, I just try my best to come to the right conclusions</p><p>If there is someone who can add something to my theories I would appreciate that very much.</p><p>Regards<br />oil_lamp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323308">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						11 May 2016, 10:11					</div>
				</div>
				<div class="post-content content">
					<p>1.0.2h backported to 15.05.1:<br /><a href="https://dev.openwrt.org/changeset/49363">https://dev.openwrt.org/changeset/49363</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323324">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						11 May 2016, 11:50					</div>
				</div>
				<div class="post-content content">
					<p><strong>oil_lamp</strong>, the compiled result looks exactly the way all official OpenWrt modules do: <em>libopenssl_1.0.2h<strong>-1</strong>_ramips_24kec.ipk</em>, it is installable from a local folder (<strong><em>opkg install /tmp/libopenssl_1.0.2h-1_ramips_24kec.ipk</em></strong>).<br />So, I think it IS the way to get patched/fixed components as soon as they are published by their authors - without an unneeded delay.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323325">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						11 May 2016, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve asked on another forum - they say it is possible to get non-kernel modules directly from <a href="https://downloads.openwrt.org/snapshots/trunk/">trunk</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323350">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						11 May 2016, 14:19					</div>
				</div>
				<div class="post-content content">
					<p>i&#039;ve tried to install the trunk openssl but it broke my libc so i was forced to reinstall the firmware (major issue) because CC used uClibc and trunk uses musl so i&#039;ve compiled my own openssl and openvpn.<br />if you need the brcm47xx_mips74k CC version you can find it here:<br />- <a href="https://db.tt/74J6ZYbt">libopenssl_1.0.2h-1_brcm47xx.ipk</a><br />- <a href="http:////db.tt/d6TbkCuJ">openvpn-openssl_2.3.11-5_brcm47xx.ipk</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323447">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						12 May 2016, 01:12					</div>
				</div>
				<div class="post-content content">
					<p>Thank you all for your comments.</p><p>I&#039;m new to openWrt so I&#039;d like to sum it up:</p><br /><p>1. BooBot: you created your own build environment which is<br />- specific to your hardware<br />- able to compile versions of single packages (no need to reinstall the whole software)<br />- self-compiled packages can be installed via standard opkg (with link to local file as described in comment 11)</p><p>2. BooBot: in order the compile the new version of a single package, you modified a config file &quot;Makefile&quot; and ran the compile process as described in comment 7</p><p>3. @tmo26 if I read your comment 10 right, you did the modifaction BooBot mentioned in the &quot;official&quot; OpenWrt build environment.<br />- Is that just to see, how the modification looks like or will your change result in an updated package version somewhere in &quot;<a href="https://downloads.openwrt.org/chaos_calmer/15.05.1/&lt;ARCHITECTURE&gt;/generic/packages/base/">https://downloads.openwrt.org/chaos_cal â€¦ ages/base/</a>&quot; i.e. I don&#039;t have to create my own build environment<br />- If yes, when will that happen... I&#039;ve read something about a build-bot. But is this bot still running for Chaos Calmer?</p><p>4. @maurer, thank you for providing the files already. I appreciate that very much. However, in this case of &quot;security software&quot; I just want to use my own files or files from the official repository. Please don&#039;t get me wrong, it&#039;s my paranoia...</p><p>Kind Regards<br />oil_lamp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323511">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						12 May 2016, 13:32					</div>
				</div>
				<div class="post-content content">
					<p><strong>oil_lamp</strong>, Yes to both your questions.<br />Apart from the initial effort to set up the BuildRoot - the rest seems to be fairly easy.<br />I my case - the initial preparation was a very lengthy process - I&#039;m building on the EeePC 701 laptop, so it was almost 18 hours to get the BuildRoot working.</p><p>Thanks to your finding of the changeset #49295 it was almost trivial to update the OpenSSL.<br />And yes, I&#039;m building my own firmwares for my router.<br /><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323919">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						15 May 2016, 04:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>in the meantime, I created my own buildroot environment and compiled openssl (library and utils). Thank you booBot, tmo26 and maurer for the inspiration! :-)</p><p>@maurer, could you please explain, how you changed to makefile etc. to create openvpn-openssl_2.3.11-5_brcm47xx.ipk?</p><p>Did you just changed the version and the MD5 hash in the chaos calmer&#039;s makefile or did you do something else?</p><p>Thank you in advance<br />oil_lamp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324871">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">oil_lamp</div>
					<div class="post-datetime">
						20 May 2016, 01:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>in the meantime, I created my own openssl and openvpn packets.</p><p>My own openssl works fine, the openvpn version didn&#039;t work when I tried to connect with the smartphone app. Windows/Linux worked</p><p>Here&#039;s a short abstract what I did:</p><p>openssl (objective: upgrade to 1.0.2h-1):<br />just replaced the entries in the makefile according to tmo26&#039;s comment #7 and started the make process<br />Did that for the application and the library. Installed both packages.</p><p>openvpn (objective: upgrade to 2.3.10):<br />1. did all the changes in the makefile between chaos calmer 15.05.1 and Trunk except the change of the path variable &quot;IPROUTE=/usr/sbin/ip&quot; as I assumed that this is the result of another change in a different package which I did not implement.<br />2. deleted all files in the patches directory and replaced them by the files from trunk (I compared them, seemed reasonable to me)</p><p>In the end, the package was compiled without errors and I was able to install it.<br />All connections peer worked except my android app. It says something like &quot;epki issue&quot; and &quot;unknown alias&quot; during the connection setup process.</p><p>Anyway, the main objective was openssl and that&#039;s replaced now.</p><p>Kind Regards<br />oil_lamp</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>