<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> connect openwrt with arduino to get temp in refrigerator</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p202942">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:28					</div>
				</div>
				<div class="post-content content">
					<p>it&#039;s a early trying to conect the route with something real world,it should be use wr703,but in here,i dont wana to chooice a power suply,so i use mr11u in here,but the wr703 should work fine too.</p><p>the full process i put in my site,but it&#039;s mostly chinese<br /><a href="http://see.sl088.com/wiki/Openwrt%E6%B8%A9%E5%BA%A6%E8%8E%B7%E5%8F%96">http://see.sl088.com/wiki/Openwrt%E6%B8 … 7%E5%8F%96</a></p><p>have some test to conect the mr11u to the arduino,i use usb port,it&#039;s good fit:<br /><span class="postimg"><img src="http://see.sl088.com/w/images/f/f8/IMG_7396.JPG" alt="http://see.sl088.com/w/images/f/f8/IMG_7396.JPG" /></span></p><p>i chooice a temp sensor is 18b20,and with a nice cable:<br /><span class="postimg"><img src="http://see.sl088.com/w/images/d/db/18b20line.jpg" alt="http://see.sl088.com/w/images/d/db/18b20line.jpg" /></span></p><p>start connect<br /><span class="postimg"><img src="http://see.sl088.com/w/images/7/78/IMG_7408.JPG" alt="http://see.sl088.com/w/images/7/78/IMG_7408.JPG" /></span></p><p>put it in refrigerator<br /><span class="postimg"><img src="http://see.sl088.com/w/images/f/fd/IMG_7420.JPG" alt="http://see.sl088.com/w/images/f/fd/IMG_7420.JPG" /></span></p><p>and i think put the pcb inside it may not a good idea,so i move it out<br /><span class="postimg"><img src="http://see.sl088.com/w/images/d/dc/IMG_7411.JPG" alt="http://see.sl088.com/w/images/d/dc/IMG_7411.JPG" /></span></p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 May 2013, 18:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202943">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>now i got find a place to settle the route and arudino,so here is seems good<br /><span class="postimg"><img src="http://see.sl088.com/w/images/b/bb/IMG_7422.JPG" alt="http://see.sl088.com/w/images/b/bb/IMG_7422.JPG" /></span></p><p>in case the cable leave out,give a tie for the cable<br /><span class="postimg"><img src="http://see.sl088.com/w/images/f/fa/IMG_7428.JPG" alt="http://see.sl088.com/w/images/f/fa/IMG_7428.JPG" /></span></p><p>not it should like this<br /><span class="postimg"><img src="http://see.sl088.com/w/images/5/5f/IMG_7432.JPG" alt="http://see.sl088.com/w/images/5/5f/IMG_7432.JPG" /></span></p><p>after some hours ago,it become ice<br /><span class="postimg"><img src="http://see.sl088.com/w/images/f/f0/IMG_7483.JPG" alt="http://see.sl088.com/w/images/f/f0/IMG_7483.JPG" /></span></p><p>that&#039;s the first try,it seems work,so why not put a led inside it,i not use any protection to the pin of led,but it&#039;s low cost,so not worry this<br /><span class="postimg"><img src="http://see.sl088.com/w/images/7/72/IMG_7492.JPG" alt="http://see.sl088.com/w/images/7/72/IMG_7492.JPG" /></span></p><p>the final look is not bad<br /><span class="postimg"><img src="http://see.sl088.com/w/images/7/7f/IMG_7493.JPG" alt="http://see.sl088.com/w/images/7/7f/IMG_7493.JPG" /></span><br /><span class="postimg"><img src="http://see.sl088.com/w/images/c/c9/IMG_7495.JPG" alt="http://see.sl088.com/w/images/c/c9/IMG_7495.JPG" /></span></p><p>wow!ice and led<br /><span class="postimg"><img src="http://see.sl088.com/w/images/4/46/IMG_7497.JPG" alt="http://see.sl088.com/w/images/4/46/IMG_7497.JPG" /></span><br /><span class="postimg"><img src="http://see.sl088.com/w/images/a/ab/IMG_7504.JPG" alt="http://see.sl088.com/w/images/a/ab/IMG_7504.JPG" /></span></p><p>yes,after this,the pin of led is no luckly<br /><span class="postimg"><img src="http://see.sl088.com/w/images/1/17/IMG_7512.JPG" alt="http://see.sl088.com/w/images/1/17/IMG_7512.JPG" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202944">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:34					</div>
				</div>
				<div class="post-content content">
					<p>now i need write some code to the arduino,here is what i doing:</p><div class="codebox"><pre><code>#include &lt;OneWire.h&gt;
#include &lt;DallasTemperature.h&gt;
 
// Data wire is plugged into port 2 on the Arduino
#define ONE_WIRE_BUS 2
 
// Setup a oneWire instance to communicate with any OneWire devices (not just Maxim/Dallas temperature ICs)
OneWire oneWire(ONE_WIRE_BUS);
 
// Pass our oneWire reference to Dallas Temperature. 
DallasTemperature sensors(&amp;oneWire);
 
void setup(void)
{
  // start serial port
  Serial.begin(9600);
  Serial.println(&quot;Dallas Temperature IC Control Library Demo&quot;);
 
  // Start up the library
  sensors.begin();
}
 
void loop(void)
{ 
  // call sensors.requestTemperatures() to issue a global temperature 
  // request to all devices on the bus
  sensors.requestTemperatures(); // Send the command to get temperatures
 
  Serial.print(&quot;Temp Now: &quot;);
  Serial.println(sensors.getTempCByIndex(0));  
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202945">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>and sure,the main part,the openwrt,i use lua script to do the work,mostly is lua very tiny(only about 200k,and the luci had inside it)</p><div class="codebox"><pre><code>-- slboat_get_temp.lua
-- to get the temp
wserial=io.open(&quot;/dev/ttyUSB0&quot;,&quot;w&quot;)
wserial:write(&quot;Serial Port OK&quot;)
wserial:flush()
rserial=io.open(&quot;/dev/ttyUSB0&quot;,&quot;r&quot;)
while true do
chaine = nil
while chaine==nil do
        --to get and to lose the flush
        chaine=rserial:read();rserial:flush()
        if lasttemp ~= chaine then
            outstr=os.date(&quot;%x %X&quot;, os.time())..&quot;  &quot;.. string.gsub(chaine,&quot;Temp Now: &quot;,&quot;The Temp is:&quot;)
            print(outstr)
            -- the record file
            f = assert(io.open(&quot;temp &amp; ice&quot;, &quot;a&quot;))
        -- that&#039;s not kind good way,we can save a old string just for write file
            f:write(string.gsub(outstr,&quot;The Temp is:&quot;,&quot;&quot;)..&quot;\n&quot;);f:close()
            lasttemp = chaine
        else
            print (&quot;The temp has not change yet&quot;)
        end
 
end
end</code></pre></div>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 May 2013, 18:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202946">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:40					</div>
				</div>
				<div class="post-content content">
					<p>we can run the script just with lua<br /></p><div class="codebox"><pre><code>root@OpenWrt:~/fun4me# lua io232.lua 
^C
^C
root@OpenWrt:~/fun4me# killall lua
root@OpenWrt:~/fun4me# lua io232.lua 
05/13/12 19:47:09  The Temp is:31.19
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
05/13/12 19:47:18  The Temp is:31.12
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
05/13/12 19:47:22  The Temp is:31.19
05/13/12 19:47:23  The Temp is:31.12
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
The temp has not change yet
05/13/12 19:47:30  The Temp is:31.06
05/13/12 19:47:31  The Temp is:31.12
The temp has not change yet
05/13/12 19:47:32  The Temp is:31.06
05/13/12 19:47:33  The Temp is:31.12
05/13/12 19:47:34  The Temp is:31.06
05/13/12 19:47:35  The Temp is:31.12
05/13/12 19:47:36  The Temp is:31.06
05/13/12 19:47:36  The Temp is:31.12
05/13/12 19:47:37  The Temp is:31.06</code></pre></div><p>and sure we can use nohup to put it run in backgroud,because we dont wana open the ttl still<br /></p><div class="codebox"><pre><code>root@OpenWrt:~/fun4me# nohup lua io232.lua &amp;
root@OpenWrt:~/fun4me# nohup: ignoring input and appending output to `nohup.out&#039;
 
root@OpenWrt:~/fun4me# tail -f temp\ \&amp;\ ice 
05/13/12 19:47:37  31.06
05/13/12 19:47:47  31.00
05/13/12 19:47:48  31.06
05/13/12 19:47:49  31.00
05/13/12 19:47:50  31.06
05/13/12 19:47:50  31.00
05/13/12 19:54:23  30.37
05/13/12 19:54:27  30.44
05/13/12 19:54:27  30.37
05/13/12 19:54:30  30.44
05/13/12 19:54:31  30.37</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202947">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:45					</div>
				</div>
				<div class="post-content content">
					<p>and i wana to save the file to csv,so i change the code a little bit<br /></p><div class="codebox"><pre><code>-- slboat_get_temp.lua
wserial=io.open(&quot;/dev/ttyUSB0&quot;,&quot;w&quot;)
wserial:write(&quot;Serial Port OK&quot;)
wserial:flush()
rserial=io.open(&quot;/dev/ttyUSB0&quot;,&quot;r&quot;)
while true do
chaine = nil
while chaine==nil do
        --to get and to lose the flush
        chaine=rserial:read();rserial:flush()
        if lasttemp ~= chaine then
        -- for csv,we just need a &quot;,&quot;
            outstr=os.date(&quot;%x %X&quot;, os.time())..&quot;  ,  &quot;.. string.gsub(chaine,&quot;Temp Now: &quot;,&quot;The Temp is:&quot;)
            print(outstr)
            -- the record file,as csv type
            f = assert(io.open(&quot;logicetemp.csv&quot;, &quot;a&quot;))
        -- that&#039;s not kind good way,we can save a old string just for write file
            f:write(string.gsub(outstr,&quot;The Temp is:&quot;,&quot;&quot;)..&quot;\n&quot;);f:close()
            lasttemp = chaine
        else
            print (&quot;The temp has not change yet&quot;)
        end
 
end
end</code></pre></div><p>now run it<br /></p><div class="codebox"><pre><code>root@OpenWrt:~/fun4me# nohup lua io232.lua &amp;
root@OpenWrt:~/fun4me# nohup: ignoring input and appending output to `nohup.out&#039;
 
root@OpenWrt:~/fun4me# tail -f logicetemp.csv 
05/15/12 10:06:49  ,-5.38
05/15/12 10:06:52  ,-5.31
05/15/12 10:06:55  ,-5.25
05/15/12 10:07:05  ,  -5.06
05/15/12 10:07:07  ,  -5.00
05/15/12 10:07:10  ,  -4.94
05/15/12 10:07:12  ,  -4.88
05/15/12 10:07:16  ,  -4.81
05/15/12 10:07:18  ,  -4.75
05/15/12 10:07:21  ,  -4.69
05/15/12 10:07:24  ,  -4.63
05/15/12 10:07:27  ,  -4.56
05/15/12 10:07:30  ,  -4.50
05/15/12 10:07:33  ,  -4.44
05/15/12 10:07:35  ,  -4.38
05/15/12 10:07:05  ,  -5.06
05/15/12 10:07:07  ,  -5.00
05/15/12 10:07:10  ,  -4.94
05/15/12 10:07:12  ,  -4.88
05/15/12 10:07:16  ,  -4.81
05/15/12 10:07:18  ,  -4.75
05/15/12 10:07:21  ,  -4.69
05/15/12 10:07:24  ,  -4.63
05/15/12 10:07:27  ,  -4.56
05/15/12 10:07:30  ,  -4.50
05/15/12 10:07:39  ,  -4.31
05/15/12 10:07:42  ,  -4.25
05/15/12 10:07:44  ,  -4.19
05/15/12 10:07:47  ,  -4.13
05/15/12 10:07:50  ,  -4.06
05/15/12 10:07:53  ,  -4.00
05/15/12 10:07:56  ,  -3.94
05/15/12 10:07:57  ,  -4.00
05/15/12 10:07:57  ,  -3.94
05/15/12 10:07:59  ,  -3.88
05/15/12 10:08:02  ,  -3.81
05/15/12 10:08:06  ,  -3.75
05/15/12 10:08:09  ,  -3.69
05/15/12 10:08:12  ,  -3.63
05/15/12 10:08:14  ,  -3.56
05/15/12 10:08:17  ,  -3.50
05/15/12 10:08:20  ,  -3.44
05/15/12 10:08:23  ,  -3.38
05/15/12 10:08:25  ,  -3.31
05/15/12 10:08:28  ,  -3.25
05/15/12 10:08:31  ,  -3.19
05/15/12 10:08:34  ,  -3.13
05/15/12 10:08:37  ,  -3.06
05/15/12 10:08:40  ,  -3.00
05/15/12 10:08:44  ,  -2.94
05/15/12 10:08:46  ,  -2.88
05/15/12 10:08:49  ,  -2.81
05/15/12 10:08:52  ,  -2.75
05/15/12 10:08:56  ,  -2.69
05/15/12 10:08:59  ,  -2.63
05/15/12 10:09:02  ,  -2.56
05/15/12 10:09:06  ,  -2.50
05/15/12 10:09:08  ,  -2.44
05/15/12 10:09:13  ,  -2.38
05/15/12 10:09:17  ,  -2.31
05/15/12 10:09:19  ,  -2.25
05/15/12 10:09:23  ,  -2.19
05/15/12 10:09:26  ,  -2.13
05/15/12 10:09:30  ,  -2.06
05/15/12 10:09:33  ,  -2.00
05/15/12 10:09:37  ,  -1.94
05/15/12 10:09:41  ,  -1.88</code></pre></div><p>here we got a csv file</p><p>A benefit about the csv maybe is the excel can support it,so let&#039;s use it</p><p>here is what i final get:<br /><span class="postimg"><img src="http://see.sl088.com/w/images/7/7b/Fast_Cap0452.jpg" alt="http://see.sl088.com/w/images/7/7b/Fast_Cap0452.jpg" /></span><br /><span class="postimg"><img src="http://see.sl088.com/w/images/1/11/Fast_Cap0453.jpg" alt="http://see.sl088.com/w/images/1/11/Fast_Cap0453.jpg" /></span></p><p>the simple csv file i got is here:<br /><a href="http://see.sl088.com/wiki/%E6%96%87%E4%BB%B6:Logicetemp.zip">http://see.sl088.com/wiki/%E6%96%87%E4% … cetemp.zip</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202948">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>the further to-do:<br />to put the arduino mini inside the wr703-it&#039;s mostly small.<br />to use luci show the data,it&#039;s easy to get.</p><p>i think in here, the cool part is the route is kind low cost,and small,and with a box.it force to do one thing,maybe not strong like Raspberry,but i think a route just more sexy to doing this,and Raspberry pie is too like a pc to me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202961">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						27 May 2013, 19:35					</div>
				</div>
				<div class="post-content content">
					<p>Again, a lot of huge and unnecessary images in multiple posts... please, don&#039;t do this anymore. You can include 1-2 images and put URLs directing to more pictures - it will be easier to read your topics.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202962">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 May 2013, 19:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Again, a lot of huge and unnecessary images in multiple posts... please, don&#039;t do this anymore. You can include 1-2 images and put URLs directing to more pictures - it will be easier to read your topics.</p></blockquote></div><p>sorry,i dont really care that mush,in my site,i just random to put them togher,and my english is really bad too,mostly i just dont post anything here for safely.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202979">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						27 May 2013, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>As an alternative to this:<br />- Use a DS9490R USB 1-wire busmaster -&gt; much smaller than an anrduino<br />- use digitemp or owfs to get the sensor readings<br />- use rrdtool to create graphics</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202980">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						27 May 2013, 22:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tmo26 wrote:</cite><blockquote><p>- Use a DS9490R USB 1-wire busmaster -&gt; much smaller than an anrduino</p></blockquote></div><p>You can even just use only 2 GPIOs from router... I&#039;m using some sensors on I2C, on MR3040 (GPIO 1 and 13) <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203010">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						28 May 2013, 11:25					</div>
				</div>
				<div class="post-content content">
					<p>Or just 1 GPIO and use 1wire.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203022">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ashkanull</div>
					<div class="post-datetime">
						28 May 2013, 13:27					</div>
				</div>
				<div class="post-content content">
					<p>with an avr like atmega32&nbsp; the variety of applications is endless and it&#039;s not pricey or power consuming <br />I think the idea of bringing openwrt and arduino together is pretty neat . I used the uart ( the ar9331 uart can also be set as SPI ) to communicate between arduino and 9331 so the usb can be free for other purposes.<br />you can also make your own board based on these materials.<br />take a look at <a href="http://arduino.cc/en/uploads/Main/arduino-leonardo-reference-design_3b.zip">http://arduino.cc/en/uploads/Main/ardui … ign_3b.zip</a> <br />I&#039;ve already made an evaluation board and I&#039;m pretty happy with it</p>											<p class="post-edited">(Last edited by <strong>ashkanull</strong> on 28 May 2013, 13:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203034">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						28 May 2013, 15:33					</div>
				</div>
				<div class="post-content content">
					<p>i see there are lot good idea to do this,the use gpio with one-wire is cool,i hope you guys can share more like this hardware conect to the really world.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203056">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						28 May 2013, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>that might get you started: <a href="http://squidge.sourceforge.net/w1/">http://squidge.sourceforge.net/w1/</a><br />and search for &quot;w1_gpio_custom&quot;, that should lead you to the folks who already did these things.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338645">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						19 Sep 2016, 17:59					</div>
				</div>
				<div class="post-content content">
					<p>you can also measure temperature directly from the router without using Arduino, here is a tutorial I wrote:<br /><a href="http://kernelreloaded.com/reading-temperature-with-wr703n-and-ds18b20-on-openwrt/">http://kernelreloaded.com/reading-tempe … n-openwrt/</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>