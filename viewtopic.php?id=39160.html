<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> New device platform/chipset supported by OpenWRT, but not model itself</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p177121">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						6 Sep 2012, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Apologies if this is an obvious question, but I wish to err on the side of caution and ask before taking the plunge.</p><p>My question: Am I likely to get into serious trouble using ImageBuilder to assemble an image for a device not officially supported, but with a platform/chipset that *is* supported?</p><p>I have a device (of the made-by-a-small-Taiwanese-company variety) that&#039;s based upon the ramips rt3050f chipset. If I use the ImageBuilder binary distribution for that chipset (rt305x) from Attitude Adjustment (<a href="http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ramips/rt305x/">http://downloads.openwrt.org/attitude_a … ps/rt305x/</a>), and add in the packages that look likely to be required (I can get access to the device&#039;s console, and thus determine what devices I need to add support for), am I likely to see success, or am I likely to end up with a paperweight?</p><p>I suppose I want to be sure there isn&#039;t some factor that I haven&#039;t considered, which is going to land me in trouble if I proceed.</p><p>Many thanks,<br />Michael</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177124">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						6 Sep 2012, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>Show some pics, if it is an OEM board it will be much easier.<br />If case its not:<br />First get a copy of the original firmware, by either searching on internet or dumping it from your device.<br />Because if you load openwrt on it and it doesn&#039;t work, and also you can&#039;t go back to the factory firmware... that&#039;s when you get a nice and expensive paperweight.<br />If you can access the bootloader through the serial port, make sure you can transfer the firmware to it first. Search the commands about it.</p><p>Remember to post more info with hi-res pics and bootoloader/console logs, to be able to help you more.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177138">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						6 Sep 2012, 19:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the reply!</p><p>Righto, here&#039;re some images of the device:</p><p><a href="http://cl.ly/image/3j1y2v2u2J2w">http://cl.ly/image/3j1y2v2u2J2w</a><br /><a href="http://cl.ly/image/1e3v0d301a2w">http://cl.ly/image/1e3v0d301a2w</a><br /><a href="http://cl.ly/image/2I0k1z220I0X">http://cl.ly/image/2I0k1z220I0X</a></p><p>Various console output follows below.</p><br /><p>Slightly off-topic, but since you mention it: as far as getting a copy of the firmware goes, are you able to point me in the right direction? The manufacturer doesn&#039;t make this available, and the generic.backup howto seemed a little vague and doubtful. Is there a series of steps I can take to generate an image I can use to restore the entire system (ideally without needing to unsolder the flash ;-))? Presumably involving grabbing the contents of /dev/mtd* ?</p><br /><p>Thanks again,<br />Michael</p><br /><div class="codebox"><pre><code># dmesg
Linux version 2.6.21-g6dd2b64b-dirty (root@localhost.localdomain) (gcc version 3.4.2) #1 Fri Jul 6 18:02:38 CST 2012

 The CPU feqenuce set to 320 MHz
CPU revision is: 0001964c
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
On node 0 totalpages: 8192
  DMA zone: 64 pages used for memmap
  DMA zone: 0 pages reserved
  DMA zone: 8128 pages, LIFO batch:0
  Normal zone: 0 pages used for memmap
Built 1 zonelists.  Total pages: 8128
Kernel command line: console=ttyS1,115200n8 root=/dev/mtdblock4
Primary instruction cache 32kB, physically tagged, 4-way, linesize 32 bytes.
Primary data cache 16kB, 4-way, linesize 32 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
Cache parity protection disabled
cause = 30800060, status = 1100ff00
PID hash table entries: 128 (order: 7, 512 bytes)
calculating r4koff... 00138800(1280000)
CPU frequency 320.00 MHz
Using 160.000 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29612k/32768k available (2321k kernel code, 3156k reserved, 314k data, 116k init, 0k highmem)
Calibrating delay loop... 212.99 BogoMIPS (lpj=425984)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
Time: MIPS clocksource has been installed.
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
io scheduler noop registered (default)
Ralink gpio driver initialized
HDLC line discipline: version $Revision: 1.1.1.1 $, maxframe=4096
N_HDLC line discipline registered.
Serial: 8250/16550 driver $Revision: 1.3 $ 2 ports, IRQ sharing disabled
serial8250: ttyS0 at I/O 0xb0000500 (irq = 37) is a 16550A
serial8250: ttyS1 at I/O 0xb0000c00 (irq = 12) is a 16550A
loop: loaded (max 8 devices)
rdm_major = 254
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
PPP MPPE Compression module registered
NET: Registered protocol family 24
ralink flash device: 0x800000 at 0x1f000000
Ralink SoC physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
Creating 6 MTD partitions on &quot;Ralink SoC physically mapped flash&quot;:
0x00000000-0x00030000 : &quot;Bootloader&quot;
0x00030000-0x00040000 : &quot;Config&quot;
0x00040000-0x00050000 : &quot;Factory&quot;
0x00050000-0x00120000 : &quot;Kernel&quot;
0x00120000-0x007f0000 : &quot;RootFS&quot;
0x007f0000-0x00800000 : &quot;Data3G&quot;
block2mtd: version $Revision: 1.1.1.1 $
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
IPv4 over IPv4 tunneling driver
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team, Type=Restricted Cone
arp_tables: (C) 2002 David S. Miller
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 10
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
GDMA1_MAC_ADRH -- : 0x00000000
GDMA1_MAC_ADRL -- : 0x00000000
Ralink APSoC Ethernet Driver Initilization. v2.00  256 rx/tx descriptors allocated, mtu = 1500!
GDMA1_MAC_ADRH -- : 0x00000023
GDMA1_MAC_ADRL -- : 0x2805e044
PROC INIT OK!
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 116k freed
Algorithmics/MIPS FPU Emulator v1.5
devpts: called with bogus options
dwc_otg: version 2.72a 24-JUN-2008
DWC_otg: Core Release: 2.66a
DWC_otg: Periodic Transfer Interrupt Enhancement - disabled
DWC_otg: Multiprocessor Interrupt Enhancement - disabled
DWC_otg: Using DMA mode
DWC_otg: Device using Buffer DMA mode
dwc_otg lm0: DWC OTG Controller
dwc_otg lm0: new USB bus registered, assigned bus number 1
dwc_otg lm0: irq 18, io mem 0x00000000
DWC_otg: Init: Port Power? op_state=1
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected

phy_tx_ring = 0x01e5e000, tx_ring = 0xa1e5e000

phy_rx_ring = 0x00000000, rx_ring = 0x00000000
RT305x_ESW: Link Status Changed
CDMA_CSG_CFG = 81000007
GDMA1_FWD_CFG = 710000
rt2860v2_ap: module license &#039;unspecified&#039; taints kernel.


=== pAd = c0072000, size = 516072 ===

 RTMPAllocAdapterBlock, Status=0
RX DESC a1ecd000  size = 2048
 RTMPAllocTxRxRingMemory, Status=0
Key1Str is Invalid key length(0) or Type(0)
Key2Str is Invalid key length(0) or Type(0)
Key3Str is Invalid key length(0) or Type(0)
Key4Str is Invalid key length(0) or Type(0)
1. Phy Mode = 9
2. Phy Mode = 9
3. Phy Mode = 9
MCS Set = ff 00 00 00 00
Main bssid = 00:23:28:05:e0:46
== rt28xx_init, Status=0
0x1300 = 00064380
eth2.2: Setting MAC address to  00 23 28 05 e0 45.
device eth2 entered promiscuous mode
VLAN (eth2.2):  Setting underlying device (eth2) to promiscious mode.
eth2.1: add 33:33:00:00:00:01 mcast address to master interface
eth2.1: add 01:00:5e:00:00:01 mcast address to master interface
eth2.1: add 33:33:ff:05:e0:44 mcast address to master interface
eth2.2: add 33:33:00:00:00:01 mcast address to master interface
eth2.2: add 01:00:5e:00:00:01 mcast address to master interface
eth2.2: add 33:33:ff:05:e0:45 mcast address to master interface
device ra0 entered promiscuous mode
eth2.1: dev_set_promiscuity(master, 1)
device eth2.1 entered promiscuous mode
br0: port 2(eth2.1) entering learning state
br0: port 1(ra0) entering learning state
eth2: no IPv6 routers present
ra0: no IPv6 routers present
eth2.2: no IPv6 routers present
eth2.1: no IPv6 routers present
br0: no IPv6 routers present
br0: topology change detected, propagating
br0: port 2(eth2.1) entering forwarding state
br0: topology change detected, propagating
br0: port 1(ra0) entering forwarding state
Rcv Wcid(1) AddBAReq
Start Seq = 00000000



# uname -a
Linux 11N_3G_USB_Router 2.6.21-g6dd2b64b-dirty #1 Fri Jul 6 18:02:38 CST 2012 mips unknown



# cat /proc/bus/usb/devices 

T:  Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=  1 Spd=480 MxCh= 1
B:  Alloc=  0/800 us ( 0%), #Int=  0, #Iso=  0
D:  Ver= 2.00 Cls=09(hub  ) Sub=00 Prot=01 MxPS=64 #Cfgs=  1
P:  Vendor=0000 ProdID=0000 Rev= 2.06
S:  Manufacturer=Linux 2.6.21-g6dd2b64b-dirty dwc_otg_hcd
S:  Product=DWC OTG Controller
S:  SerialNumber=lm0
C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=  0mA
I:* If#= 0 Alt= 0 #EPs= 1 Cls=09(hub  ) Sub=00 Prot=00 Driver=hub
E:  Ad=81(I) Atr=03(Int.) MxPS=   4 Ivl=256ms



# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00030000 00010000 &quot;Bootloader&quot;
mtd1: 00010000 00010000 &quot;Config&quot;
mtd2: 00010000 00010000 &quot;Factory&quot;
mtd3: 000d0000 00010000 &quot;Kernel&quot;
mtd4: 006d0000 00010000 &quot;RootFS&quot;
mtd5: 00010000 00010000 &quot;Data3G&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>MichaelTyson</strong> on 8 Sep 2012, 15:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177141">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						6 Sep 2012, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>Looks to be identical to the ALFA R36, incidentally:</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=31264">https://forum.openwrt.org/viewtopic.php?id=31264</a></p><p>...although the folks on that thread keep talking about hooking up directly to the thing&#039;s serial port, whereas on mine, there&#039;s both an open terminal port, and a firmware upload facility via the web interface. Guess it&#039;s just a different software setup on it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177171">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						6 Sep 2012, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>Actually, you know, I think I may have answered my own question, here. After grabbing the dmesg output and googling for parts of it, and then discovering its similarity to the ALFA R36, I&#039;m pretty sure I can simply proceed, using the HW5503G profile. Time will tell, anyway.</p><p>I&#039;m still curious about how I can fully back up and restore the existing firmware, though - I don&#039;t feel like the backup howto has answered that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177181">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						7 Sep 2012, 00:36					</div>
				</div>
				<div class="post-content content">
					<p>You put just the dmesg. So we don&#039;t know anything about the bootloader.<br />To get more information, turn off the router, connect the serial port, and capture everything that is put on the console upon it is fully booted.</p><p>About the backup:</p><p>An easy way could be copying each partition to the ram, then symlink it to the www folder and try to get the file through HTTP.</p><p>Example for mtd0:<br /></p><div class="codebox"><pre><code>cat /dev/mtd0 &gt; /tmp/mtd0.bin
chmod 777 /tmp/mtd0.bin
ln -s /tmp/mtd0.bin /www/.

Now, on your browser, try to go to:
                   http://ROUTER_IP/mtd0.bin
and if you have luck it may download the file.
If it works, before copying the next partition to the ram, delete the previously copied,
or it may full the ram and cause a reboot:

rm /tmp/mtd0.bin

Now repeat with mtd1 etc</code></pre></div><p>please put the logs and such information in codebox, writing as this:<br />[c0de] (it&#039;s written &quot;code&quot;)<br />your log<br />blah<br />blah<br />[/c0de]</p><p>Another way could be if it was a TFTP client on the firmware.</p><p>But, since we don&#039;t know what are the commands on the router, you should check them. Maybe it doesn&#039;t even have the &quot;ln&quot; command.<br />To check if it is there, show here the result of doing the following commands:<br />ls /bin<br />ls /sbin<br />ls /usr/bin<br />ls /usr/sbin</p><p>So we can see what executables are built on the firmware, and work with them.<br />Regards</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 7 Sep 2012, 01:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177304">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						7 Sep 2012, 19:43					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for all your help on this <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Right, okay - however, I&#039;d end up with a bunch of images of each part of the flash; how do I then assemble that into something I can give to the firmware flasher/uploader? Or does that depend on the layout of the individual system?</p><p>Okay, sure:</p><div class="codebox"><pre><code># ls /bin
addgroup                    ipcalc                      ping
adduser                     iplink                      pppd
adjtimex                    iproute                     pppdump
ash                         iprule                      pppstats
ated                        iptables                    pptp
bc_nvram_clean              iptunnel                    ps
bc_nvram_get                iwconfig                    pwd
bc_nvram_set                iwevent                     qos_run
busybox                     iwgetid                     ralink_init
cat                         iwlist                      reg
chgrp                       iwpriv                      ripd
chmod                       iwspy                       rm
chown                       kill                        rmdir
cp                          lld2d                       rt2860apd
date                        ln                          run-parts
dd                          login                       sed
delgroup                    ls                          sh
deluser                     mii_mgr                     sleep
df                          miniupnpd                   switch
dmesg                       miniupnpd_config_create.sh  sync
dnsmasq                     mkdir                       tc
echo                        mknod                       touch
egrep                       more                        umount
fgrep                       mount                       uname
flash                       mtd_write                   upnp_xml.sh
goahead                     mv                          upnpd
gpio                        netstat                     vi
grep                        nice                        wpa_cli
hostname                    ntpclient                   wpa_passphrase
igmpproxy                   nvram_daemon                wpa_supplicant
igmpproxy.sh                nvram_get                   wscd
inadyn                      nvram_set                   zebra
ip                          openssl
ipaddr                      pidof
# ls /sbin
3gd                  global.sh            lan.sh               syslogd
adjtimex             greenap.sh           lcd_ctrl             udevadm
arp                  h21_modeswitch       logread              udevd
automount.sh         halt                 lsmod                udevsettle
chpasswd.sh          huaweiAktBbo         miniupnpd_init.sh    udhcpc
config-dns.sh        ifconfig             mkdosfs              udhcpc.sh
config-igmpproxy.sh  ifenslave            modprobe             usb_modeswitch
config-l2tp.sh       init                 nat.sh               usb_modeswitch.conf
config-pppoe.sh      insmod               ntp.sh               usb_wlan.sh
config-pptp.sh       internet.sh          poweroff             vconfig
config-udhcpd.sh     iss                  pppoe-relay          vpn-passthru.sh
config-vlan.sh       jw_modeswitch        pppoe.sh             wan.sh
config.sh            klogd                pptp.sh              wan_dual.sh
custom_config.sh     l2tp-control         radvd                wifi_unload.sh
ddns.sh              l2tp.sh              reboot               wpa_action.sh
depmod               l2tpd                rmmod                wpa_supplicant.sh
firewall.sh          lan-post-wan.sh      route                zcip
freeramdisk          lan-pre-wan.sh       sysctl
# ls /usr/bin
[         cal       expr      killall   renice    telnet    uptime
[[        crontab   free      logger    script    test      wc
arping    cryptpw   ftpget    mesg      strings   tftp      which
awk       cut       ftpput    nslookup  tail      top
basename  eject     ipcs      passwd    tee       udevinfo
# ls /usr/sbin
brctl        chroot       email        readprofile  udhcpd
chat         crond        msmtp        svlogd
chpasswd     dhcprelay    pppd         telnetd</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177305">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 Sep 2012, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>ls bin/, not ls /bin <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177320">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						7 Sep 2012, 20:41					</div>
				</div>
				<div class="post-content content">
					<p>Well, the admin user on this device has $HOME of &quot;/&quot;, so that command has the same effect <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177323">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 Sep 2012, 20:45					</div>
				</div>
				<div class="post-content content">
					<p>No it hasn&#039;t since the IB places its files in .../OpenWrt-ImageBuilder.../bin/ not in $HOME/bin/ .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177324">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						7 Sep 2012, 20:48					</div>
				</div>
				<div class="post-content content">
					<p>Oh, this isn&#039;t currently an OpenWrt system - it&#039;s the firmware from the manufacturer. I&#039;m just trying to figure out how to make a copy of the firmware that I can pop back on later if all goes awry (preferably using the firmware uploader - I like to keep my futzing around to a minimum where possible).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177325">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 Sep 2012, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>Oh sorry, right. I confused the thread with something else.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177351">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						8 Sep 2012, 02:33					</div>
				</div>
				<div class="post-content content">
					<p>Well, doing <strong>ls /bin</strong> will show contents of /(&quot;root&quot;, not /root/)/bin directory, so that&#039;s correct, it will list its contents, regardless of the directory in which the console is.<br />In openwrt works the same, check yourself. <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /><br /></p><div class="codebox"><pre><code>root@OpenWrt:/# echo ****CONTENTS OF /bin**** &amp;&amp; ls /bin &amp;&amp; echo ****CONTENTS OF /sbin**** &amp;&amp; ls /sbin &amp;&amp; echo ****CONTENTS OF /usr/bin**** &amp;&amp; ls /usr/bin &amp;&amp; echo ****CONTENTS OF /usr/sbin**** &amp;&amp; ls /usr/sbin
****CONTENTS OF /bin****
ash        chmod      dd         egrep      grep       kill       ls         mount      nice       ping6      rmdir      sync       ubus       zcat
busybox    chown      df         false      gunzip     ln         mkdir      mv         opkg       ps         sed        tar        umount
cat        cp         dmesg      fgrep      gzip       lock       mknod      netmsg     pidof      pwd        sh         touch      uname
chgrp      date       echo       fsync      ipcalc.sh  login.sh   mktemp     netstat    ping       rm         sleep      true       vi
****CONTENTS OF /sbin****
blkid              hotplug-call       ifup               lsmod              netifd             start-stop-daemon  sysctl             udhcpc
devstatus          hotplug2           init               luci-reload        pivot_root         swaplabel          syslogd            vconfig
fdisk              hwclock            insmod             mkswap             poweroff           swapoff            sysupgrade         watchdog
firstboot          ifconfig           klogd              mount_root         reboot             swapon             ubusd              wget2nand
fw                 ifdown             led.sh             mountd             rmmod              swconfig           uci                wifi
halt               ifstatus           logread            mtd                route              switch_root        udevtrigger
****CONTENTS OF /usr/bin****
[            bunzip2      cut          env          hexdump      jshn         luci-bwc     passwd       scp          tail         top          vim          yes
[[           bzcat        dbclient     expr         hostid       killall      md5sum       pgrep        seq          tee          tr           wc
arping       clear        dirname      find         htop         less         mkfifo       pkill        sort         telnet       traceroute   wget
awk          cmp          dropbearkey  free         id           logger       nc           printf       ssh          test         uniq         which
basename     crontab      du           head         iftop        lua          nslookup     reset        strings      time         uptime       xargs
****CONTENTS OF /usr/sbin****
brctl             dnsmasq           hostapd           iptables-save     iwlist            relayd            uhttpd
chroot            dropbear          iptables          iw                iwpriv            tc                wpa_supplicant
crond             fw_printenv       iptables-restore  iwconfig          ntpd              telnetd           wpad</code></pre></div><p>About the firmware:<br />We found some gold here! look at the binaries <strong> ftpput, tftp</strong><br />Let&#039;s try getting the partitions by TFTP.<br />Download this(TFTPD32 , is a TFTP server): <a href="http://tftpd32.jounin.net/download/tftpd32.400.zip">http://tftpd32.jounin.net/download/tftpd32.400.zip</a><br /><strong><span style="color: red">Disable any antivirus and firewalls, even the Windows firewall. I have got some headaches because it was blocking my transfers <img src="https://forum.openwrt.org/img/smilies/lol.png" width="15" height="15" alt="lol" /></span></strong><br />Do the <strong>cat /dev/mtd0 &gt;/tmp/mtd0.bin</strong> in the console<br />If your router is 192.168.1.1, manually set your computer LAN IP to 192.168.1.10 and connect to the router.<br />Run TFTPD32.<br />Now in the console do this <strong> tftp -p -l /tmp/mtd0.bin 192.168.1.10</strong><br />(it -P -L, lower case)<br />Check if TFTPD32 receives the file <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> It will save it on the same folder where the tftpd32.exe is.<br />If it sucess, then repeat with rest of mtd partitions. Remember to delete the /tmp/mtdx.bin before copying another.</p><p>And yes, the full backup (firmware + all data and settings stored in flash) is done by joining mtd1+mtd2+mtd3+mtd4+mtd5.<br />In windows, you could do this by doing <strong>copy /b mtd1.bin+mtd2.bin+mtd3.bin+mtd4.bin+mtd5.bin backup.bin</strong><br />Now you got your original firmware in just one file.<br />Leave mtd0.bin alone, rename to bootloader.bin.<br />Never write to it, the bootloader is the last thing you want to write on! Bad bootloader=Nice unrecoverable brick (unless by JTAG)</p><p>It should be easy to restore the firmware.</p><p>Follow this instructions <a href="https://forum.openwrt.org/viewtopic.php?pid=149174#p149174">https://forum.openwrt.org/viewtopic.php … 74#p149174</a> to access the bootloader.<br />(You can try to flash OpenWrt with that instructions, a user claimed that it&#039;s working )<br />But, to restore, follow this commands:<br />(First set computer LAN IP to 10.10.10.3, open TFTPD32 and copy the firmware to the same folder as the tftpd32.exe is located)</p><p><strong><span style="color: red">Tranferring firmware to the RAM:</span></strong><br /></p><div class="codebox"><pre><code>tftp 0x80600000 backup.bin

should output something like this:


netboot_common, argc= 3 
 NetTxPacket = 0x81FE5640 
 KSEG1ADDR(NetTxPacket) = 0xA1FE5640 
 NetLoop,call eth_halt ! 
 NetLoop,call eth_init ! 
Trying Eth0 (10/100-M)
 Waitting for RX_DMA_BUSY status Start... done
 Header Payload scatter function is Disable !! 
 ETH_STATE_ACTIVE!! 
Using Eth0 (10/100-M) device
TFTP from server 10.10.10.3; our IP address is 10.10.10.123    &lt;&lt;----IF IT PUTS OTHER SERVER IP, SET THAT IP IN YOUR COMPUTER LAN ADAPTER
Filename &#039;backup.bin&#039;
 TIMEOUT_COUNT=10,Load address: 0x80600000
Loading: Got ARP REPLY, set server/gtwy eth addr (xx:xx:xx:xx:xx:xx).
Got it
T #
 first block received  
################################################################
     ################ LOTS OF MORE LINES LIKE THIS  #################################################
     ############################
done
Bytes transferred = 8192000 (7d0000 hex)  &lt;--- THEORICALLY IT SHOULD PUT HIS NUMBERS
NetBootFileXferSize= 007d0000</code></pre></div><p><strong><span style="color: red">Erasing the whole flash, BUT NOT the bootloader</span></strong><br /></p><div class="codebox"><pre><code>erase 0xbf030000 0xbf7fffff       &lt;&lt;----CHECK 100 TIMES THAT YOU PUT THIS NUMBERS BEFORE YOU HIT ENTER!!!

Should put something like this:

 b_end =BF7FFFFF
Erase Flash from 0xbf030000 to 0xbf7fffff in Bank # 1 
 erase sector  = 2 
.
.
.
 erase sector  = 127
sect = 127,s_last = 127,erase poll = ??????
 done
Erased 126 sectors</code></pre></div><p><strong><span style="color: red">Copying the firmware from RAM to the flash</span></strong><br /></p><div class="codebox"><pre><code>cp.b 0x80600000 0xbf030000 7d0000    &lt;----AGAIN, RECHECK 100 TIMES THE NUMBERS YOU WRITE HERE!!!

And should output this:
Copy to Flash... 
 Copy 8192000 byte to Flash... 
 addr = 0xBFxxxxxx ,cnt=xxxxxxx 
 addr = 0xBFxxxxxx ,cnt=xxxxxxx
 .
 .
 .
 addr = 0xBFxxxxxx ,cnt=xxxxxxx  done</code></pre></div><p>And done!!. Reset the device by <strong>reset</strong> command and enjoy your original firmware.</p><br /><p>I love hacking things. If it works, tell me, tell me! <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p><p>Whoa! It took me an hour doing the post and correcting it 50001 times, rechecking the addresses and the flash sectors. I&#039;m gonna sleep now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 8 Sep 2012, 04:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177388">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 11:46					</div>
				</div>
				<div class="post-content content">
					<p>Wow. Wow. Wow. I really can&#039;t express how grateful I am for the pointers! An hour! That really is incredibly kind.</p><p>So, happy news, I&#039;ve managed to pull out the firmware and bootloader and transfer it via tftp, no problem. Next is the flashing, which I&#039;m hoping I&#039;ll be able to do by catching the bootloader over Ethernet, something <a href="http://wiki.openwrt.org/doc/howto/generic.flashing#via.bootloader.and.ethernet.port">this howto</a> seems to imply is possible. If I have to use serial, it&#039;s gonna be a massive pain &#039;cos I don&#039;t have the equipment, so my fingers&#039;re crossed that that&#039;ll do it.</p><p>The existing system *does* have an mtd writer on it (&#039;mtd_write&#039;, not &#039;mtd&#039;), so I could possibly do the flashing from the live system, but I&#039;ve been warned that there&#039;s a real risk of clobbering the bootloader that way, and given the paucity of documentation on the matter, I&#039;m inclined to steer way clear <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>So, time will tell!</p><p>Thanks again, this is a real help - certainly calms the fear a little ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177390">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 12:08					</div>
				</div>
				<div class="post-content content">
					<p>It just occurs to me that there&#039;s two possible interpretations of that howto...one, that you make a telnet connection to the bootloader over Ethernet, then tftp, and two, that the Ethernet connection is just there for transfer via tftp, and the actual console is only accessible via the serial port. Murphy&#039;s law (and ten minutes fruitlessly trying to contact the device over Ethernet) tells me it&#039;s the latter, not the former. Time to read up on mtd_write!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177398">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 13:08					</div>
				</div>
				<div class="post-content content">
					<p>Okay!</p><p>So, mtd_write says:</p><div class="codebox"><pre><code>Usage: mtd [&lt;options&gt; ...] &lt;command&gt; [&lt;arguments&gt; ...] &lt;device&gt;

The device is in the format of mtdX (eg: mtd4) or its label.
mtd recognizes these commands:
        unlock                  unlock the device
        erase                   erase all data on device
        write &lt;imagefile&gt;|-     write &lt;imagefile&gt; (use - for stdin) to device
Following options are available:
        -q                      quiet mode (once: no [w] on writing,
                                           twice: no status messages)
        -r                      reboot after successful command
        -e &lt;device&gt;             erase &lt;device&gt; before executing the command
        -v                      output writing info. (1 more -v would output HTML format.)
        -o &lt;num&gt;                file offset 
        -l &lt;num&gt;                length in file
        -w                      read after write action to check
Example: To write linux.trx to mtd4 labeled as linux and reboot afterwards
         mtd -r write linux.trx linux</code></pre></div><p>*Looks* sufficiently straightforward.</p><p>So, first, for the backup, presumably I need to take backups of each partition, separately, as mtd_write seems to want to write to individual partitions, not to arbitrary byte ranges of the actual device. Then I can apply those one-by-one, assuming I can get shell access to the device, of course.</p><p>Next, for the actual flashing:</p><p>I want to copy the kernel, and the fs (do you think order is important, while the system is actually running?)</p><p>So, the flash layout:</p><div class="codebox"><pre><code># cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00030000 00010000 &quot;Bootloader&quot;
mtd1: 00010000 00010000 &quot;Config&quot;
mtd2: 00010000 00010000 &quot;Factory&quot;
mtd3: 000d0000 00010000 &quot;Kernel&quot;
mtd4: 006d0000 00010000 &quot;RootFS&quot;
mtd5: 00010000 00010000 &quot;Data3G&quot;</code></pre></div><p>My built kernel image is 847,916 bytes; the partition is 0x000d0000 = 851,968 bytes, so, that&#039;ll fit without causing havoc - good.</p><p>The kernel goes to the MTD partition labelled &quot;Kernel&quot; (which maps to 0x00050000-0x00120000):</p><div class="codebox"><pre><code>mtd_write write openwrt-ramips-rt305x-uImage.bin Kernel</code></pre></div><p>Do you think I need to supply &quot;-e Kernel&quot; as well, to erase the flash first, given that my image isn&#039;t the full 0x000d0000 bytes? I assume that&#039;s probably part of the actual write process, so not required, but worth checking...</p><p>Given the example in the docs, I assume that mtd_write will simply use the length of the file you give it, instead of having to supply the -l parameter.</p><p>Next, the boot fs goes to &quot;RootFS&quot; (the &quot;RootFS&quot; partition is of length 0x006d0000: 7,143,424 bytes; my root image is 5,636,096 bytes)</p><div class="codebox"><pre><code>mtd_write write openwrt-ramips-rt305x-root.squashfs RootFS</code></pre></div><p>...Again with maybe needing to add &quot;-e RootFS&quot; first...</p><p>Then, reboot - and presumably, that&#039;s that, eh?</p>											<p class="post-edited">(Last edited by <strong>MichaelTyson</strong> on 8 Sep 2012, 14:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177400">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 13:32					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?pid=166041#p166041">This post</a> warns that mtd_write &quot;Will Brick your Router&quot; (&quot;If you use the mtd_write you risk bricking the bootloader, it may overwrite the bootloader.&quot;). Is this just because it&#039;s prone to user error? Surely if you give it the right parameters it&#039;ll just work, unless mtd_write is pathological <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Is there something I&#039;m missing?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177408">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						8 Sep 2012, 14:58					</div>
				</div>
				<div class="post-content content">
					<p>I have used the mtd_write few times without problem.<br />Unless there is some kind of programming error or bug, I don&#039;t see the problem.<br />I would try:<br /></p><div class="codebox"><pre><code>mtd_write unlock Kernel
mtd_write unlock RootFS
mtd_write unlock Data3G     &lt;-- I THINK THE OPENWRT ROOTFS_DATA (DYNAMIC DATA) WILL ERASE OVER THIS. SO WE CLEAN IT FIRST
mtd_write erase Data3G
mtd_write -e Kernel write openwrt-ramips-rt305x-uImage.bin Kernel
mtd_write -e RootFS write openwrt-ramips-rt305x-root.squashfs RootFS
reboot</code></pre></div><p>The mtd partitions should be locked for security reasons, that&#039;s why we do the <strong>unlock</strong> commands first. As we don&#039;t unlock mtd0, I should be impossible to write to it, unless you unlock it too.<br />Notice that I didn&#039;t use the <strong>-r</strong> option, we don&#039;t want to reboot it until we flash both the rootfs and the kernel.<br />I think that user who bricked the router,was due rebooting after flashing the kernel. The original RootFS was still there, and surely the openwrt kernel+original rootfs combination caused a big problem. I we flash both before rebooting everything shouild be fine.<br />So we flash both and reboot manually. It should work without problems...<br />Again, this is theory, it should work, but I&#039;m doing all of this just in my mind without any equipment to test on.</p><p>About the serial option, the equippment is no that hard. Just a usb to serial cable from ebay, they&#039;re under $2 and free shipping:<br /><a href="http://www.ebay.com/itm/1pcs-PL2303-USB-To-RS232-TTL-Converter-Adapter-Module-/251082091781?pt=LH_DefaultDomain_0&amp;hash=item3a75a8ad05#ht_2305wt_1312">http://www.ebay.com/itm/1pcs-PL2303-USB … 305wt_1312</a></p><p>You just need to connect 3 wires: tx, rx and gnd <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 8 Sep 2012, 15:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177409">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>Whoa, great catch - I don&#039;t know what I was thinking, adding the &#039;r&#039; option. That would&#039;ve been crappy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The serial option does sound doable, when you put it that way; although I still have to identify the terminals on the board and find a way to hold the connectors in place without owning a soldering iron. I love the shell-over-Ethernet approach ;-)</p><p>So, I think I&#039;m confident enough to take a crack at it - here goes!</p><p>Thanks again for all your help, I don&#039;t think I would&#039;ve quite had the confidence to proceed without it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177411">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						8 Sep 2012, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>Hey, how fast! I was still editing the post when you posted. Please recheck all the instructions! and good luck <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177412">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 15:08					</div>
				</div>
				<div class="post-content content">
					<p>Haha, I was champing at the bit, over here <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Lovely, okay, I&#039;ll add that step. Just about to telnet in now and get started. Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177413">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						8 Sep 2012, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>Again I corrected a few typo errors . I&#039;m used with typing &quot;mtd&quot; not &quot;mtd_write&quot;. I had written both in the commands <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177414">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 15:17					</div>
				</div>
				<div class="post-content content">
					<p>...Also, it&#039;s</p><div class="codebox"><pre><code>mtd_write -e Kernel write openwrt-ramips-rt305x-uImage.bin Kernel</code></pre></div><p>etc - the &quot;Kernel&quot; after &quot;e&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177416">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">MichaelTyson</div>
					<div class="post-datetime">
						8 Sep 2012, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>Aaaaaaand bricked. Won&#039;t come back up, not accessible via the LAN port on 192.168.1.1. No idea if the bootloader&#039;s okay; guess I&#039;ll be getting a serial connector after all =/</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177417">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						8 Sep 2012, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>wtf that is strange, sorry it happenned <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />.<br />I don&#039;t think the bootloader is damaged anyway...<br />Is any led light blinking? Try to enter in failsafe mode (if any led blinks, press any physical button and it will be on failsafe mode)<br />Have you tried forcing your computer ip to 192.168.1.x, without waiting for a DHCP address?</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 8 Sep 2012, 15:31)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>