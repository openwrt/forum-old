<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] Archer C7 (v2) issues with Trunk and 5GHz (ath10k) Radio</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p328604">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">WildByDesign</div>
					<div class="post-datetime">
						15 Jun 2016, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys/gals,</p><p>I&#039;ve been struggling with getting the 5GHz radio working initially for a few days and now after getting it working, the performance is almost non-existent.&nbsp; I have been following many great tutorials from the OpenWrt wiki and also many forum threads here on the same topic.</p><ul><li><p>Installing latest stable Chaos Calmer 15.05.1 on these latest Archer C7&#039;s brick the devices due to the flash chip change mentioned below</p></li><li><p>Installing <strong>arokh</strong>&#039;s community trunk builds install wonderfully including detecting the 5GHz radio and performance is absolutely great</p></li><li><p>Installing latest official trunk builds fail to detect the 5GHz chip (though the 2.4GHz detects appropriately)</p></li></ul><p><strong>Goal:</strong>&nbsp; What I would like is to run Wireless N (not AC) on my 5GHz band, which I was successfully doing without any issues on <strong>arokh</strong>&#039;s community trunk builds.</p><p><strong>Device:</strong>&nbsp; Archer C7 v2.0 (serial number 215C or higher) *</p><p>* From OpenWrt Wiki:&nbsp; <em>&quot;In late 2015 the V2 changed to flash chip gd25q128, affected serial numbers start with 215C or higher. The chip is supported in trunk as of r47588 and 15.05.1 as of r49220&quot;</em></p><p><strong>Branch:</strong>&nbsp; Trunk (LEDE Reboot r614)<br /><strong>Kernel:</strong>&nbsp; 4.4.13<br /><strong>Firmware: </strong> ath10k-firmware-qca988x_2014-11-13-b00eb8d30fbebb6a5047ccacefa8c37e072fca9c-1_mips_34kc.ipk<br /><strong>File name:</strong>&nbsp; firmware-5.bin</p><br /><p>dmesg | grep ath10k (yesterday):<br /><em>* 5GHz band not working</em><br /></p><div class="codebox"><pre><code>[    9.643690] ath10k_pci 0000:01:00.0: pci irq legacy oper_irq_mode 1 irq_mode 0 reset_mode 0
[    9.860904] ath10k_pci 0000:01:00.0: Direct firmware load for ath10k/pre-cal-pci-0000:01:00.0.bin failed with error -2
[    9.871793] ath10k_pci 0000:01:00.0: Falling back to user helper
[   10.066690] firmware ath10k!pre-cal-pci-0000:01:00.0.bin: firmware_loading_store: map pages failed
[   10.661092] ath10k_pci 0000:01:00.0: qca988x hw2.0 target 0x4100016c chip_id 0x043202ff sub 0000:0000
[   10.670491] ath10k_pci 0000:01:00.0: kconfig debug 0 debugfs 1 tracing 0 dfs 1 testmode 1
[   10.683534] ath10k_pci 0000:01:00.0: firmware ver 10.2.4.97 api 5 features no-p2p crc32 f91e34f2
[   10.692551] ath10k_pci 0000:01:00.0: Direct firmware load for ath10k/QCA988X/hw2.0/board-2.bin failed with error -2
[   10.703149] ath10k_pci 0000:01:00.0: Falling back to user helper
[   10.784613] firmware ath10k!QCA988X!hw2.0!board-2.bin: firmware_loading_store: map pages failed
[   10.795647] ath10k_pci 0000:01:00.0: board_file api 1 bmi_id N/A crc32 bebc7c08
[   11.928581] ath10k_pci 0000:01:00.0: htt-ver 2.1 wmi-op 5 htt-op 2 cal file max-sta 128 raw 0 hwcrypto 1
[   19.794145] ath10k_pci 0000:01:00.0: DFS region 0x0 not supported, will trigger radar for every pulse</code></pre></div><br /><p>dmesg | grep ath10k (today):<br /><em>* 5GHz band working, but very poorly</em><br /></p><div class="codebox"><pre><code>[    9.630992] ath10k_pci 0000:01:00.0: pci irq legacy oper_irq_mode 1 irq_mode 0 reset_mode 0
[    9.850453] ath10k_pci 0000:01:00.0: Direct firmware load for ath10k/pre-cal-pci-0000:01:00.0.bin failed with error -2
[    9.861348] ath10k_pci 0000:01:00.0: Falling back to user helper
[   10.051463] firmware ath10k!pre-cal-pci-0000:01:00.0.bin: firmware_loading_store: map pages failed
[   10.808993] ath10k_pci 0000:01:00.0: qca988x hw2.0 target 0x4100016c chip_id 0x043202ff sub 0000:0000
[   10.818398] ath10k_pci 0000:01:00.0: kconfig debug 0 debugfs 1 tracing 0 dfs 1 testmode 1
[   10.831451] ath10k_pci 0000:01:00.0: firmware ver 10.2.4.97 api 5 features no-p2p crc32 f91e34f2
[   10.840466] ath10k_pci 0000:01:00.0: Direct firmware load for ath10k/QCA988X/hw2.0/board-2.bin failed with error -2
[   10.851062] ath10k_pci 0000:01:00.0: Falling back to user helper
[   10.930569] firmware ath10k!QCA988X!hw2.0!board-2.bin: firmware_loading_store: map pages failed
[   10.941602] ath10k_pci 0000:01:00.0: board_file api 1 bmi_id N/A crc32 bebc7c08
[   12.073404] ath10k_pci 0000:01:00.0: htt-ver 2.1 wmi-op 5 htt-op 2 cal file max-sta 128 raw 0 hwcrypto 1</code></pre></div><br /><p>\etc\config\wireless:</p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    option type &#039;mac80211&#039;
    option hwmode &#039;11a&#039;
    option path &#039;pci0000:01/0000:01:00.0&#039;
    option htmode &#039;HT20&#039;
    option country &#039;CA&#039;
    option channel &#039;165&#039;
    option txpower &#039;19&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option network &#039;lan&#039;
    option mode &#039;ap&#039;
    option ssid &#039;OpenWrt-5GHz&#039;
    option encryption &#039;psk2&#039;
    option key &#039;*****&#039;

config wifi-device &#039;radio1&#039;
    option type &#039;mac80211&#039;
    option channel &#039;11&#039;
    option hwmode &#039;11g&#039;
    option path &#039;platform/qca955x_wmac&#039;
    option htmode &#039;HT20&#039;
    option country &#039;CA&#039;
    option txpower &#039;24&#039;

config wifi-iface
    option device &#039;radio1&#039;
    option network &#039;lan&#039;
    option mode &#039;ap&#039;
    option ssid &#039;OpenWrt-2.4GHz&#039;
    option encryption &#039;psk2&#039;
    option key &#039;*****&#039;</code></pre></div><p>Other Details:</p><div class="codebox"><pre><code>Signal / Noise
-61 / 0 dBm

RX Rate / TX Rate
6.0 Mbit/s, 20MHz
6.0 Mbit/s, 20MHz

Qualcomm Atheros QCA9880 802.11nac (radio0)
Channel: 165 (5.825 GHz) | Bitrate: 6 Mbit/s     SCAN  ADD
75%    SSID: OpenWrt-5GHz | Mode: Master
BSSID: EC:08:6B:47:6E:F0 | Encryption: WPA2 PSK (CCMP)</code></pre></div><br /><p>Having followed a lot of great tips here in this forum from other users experiencing issues with Archer C7 and the 5GHz radio, the following is what I have tried thus far:</p><div class="codebox"><pre><code>opkg update
opkg install luci ath10k-firmware-qca988x kmod-ath kmod-ath10k
reboot</code></pre></div><div class="codebox"><pre><code>rm /etc/config/wireless
wifi detect &gt; /etc/config/wireless
reboot</code></pre></div><br /><p>Also, this was a clean firmware install with squashfs-factory bin without keeping settings to ensure the best results.&nbsp; However, as we can see with the details above, the results are quite bad.&nbsp; I tried my best due diligence on troubleshooting this myself for approximately 48-72 hours now and researched a lot of great information within OpenWrt forum and wiki.&nbsp; But I am stuck at the moment.&nbsp; So hopefully I have provided some appropriate details above for anyone who may be able to assist me with troubleshooting this issue.&nbsp; I really appreciate your time, thank you.&nbsp; If you need more details, please let me know and I am happy to provide whatever is necessary.</p><p>Cheers,<br />Dave</p>											<p class="post-edited">(Last edited by <strong>WildByDesign</strong> on 16 Jun 2016, 06:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328624">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						15 Jun 2016, 19:59					</div>
				</div>
				<div class="post-content content">
					<p>AFAIK, both kmod-ath and kmod-ath10k are included in the trunk DD/LEDE images for Archer C7v2, but you&#039;re missing the firmware. Build your own image with the image builder with: PACKAGES=&quot;ath10k-firmware-qca988x&quot; and it should work fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328636">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">WildByDesign</div>
					<div class="post-datetime">
						15 Jun 2016, 21:21					</div>
				</div>
				<div class="post-content content">
					<p>Thank you both for your responses.</p><p>Alright, so I switched over cleanly from lede trunk over to OpenWrt current trunk.&nbsp; Discarded settings and started fresh.&nbsp; Installation was literally a breeze, much smoother experience.&nbsp; Installed and configured the necessary packages and firmware.&nbsp; While almost every aspect thus far with OpenWrt trunk has been smooth and flawless, the same issue remains with the 5GHz radio.</p><br /><p><strong>dmesg | grep ath10k</strong>:<br /></p><div class="codebox"><pre><code>[    9.948086] ath10k_pci 0000:01:00.0: pci irq legacy interrupts 0 irq_mode 0 reset_mode 0
[   10.835780] ath10k_pci 0000:01:00.0: qca988x hw2.0 target 0x4100016c chip_id 0x043202ff sub 0000:0000
[   10.845139] ath10k_pci 0000:01:00.0: kconfig debug 0 debugfs 1 tracing 0 dfs 1 testmode 1
[   10.858239] ath10k_pci 0000:01:00.0: firmware ver 10.2.4.97 api 5 features no-p2p crc32 f91e34f2
[   10.910463] ath10k_pci 0000:01:00.0: Direct firmware load for ath10k/QCA988X/hw2.0/board-2.bin failed with error -2
[   10.921073] ath10k_pci 0000:01:00.0: Falling back to user helper
[   11.134094] firmware ath10k!QCA988X!hw2.0!board-2.bin: firmware_loading_store: map pages failed
[   11.145090] ath10k_pci 0000:01:00.0: board_file api 1 bmi_id N/A crc32 bebc7c08
[   12.269612] ath10k_pci 0000:01:00.0: htt-ver 2.1 wmi-op 5 htt-op 2 cal file max-sta 128 raw 0 hwcrypto 1
[   23.262350] ath10k_pci 0000:01:00.0: no channel configured; ignoring frame(s)!
[   23.325954] ath10k_pci 0000:01:00.0: no channel configured; ignoring frame(s)!</code></pre></div><br /><p><strong>etc/config/wireless</strong>:<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    option type &#039;mac80211&#039;
    option channel &#039;11&#039;
    option hwmode &#039;11g&#039;
    option path &#039;platform/qca955x_wmac&#039;
    option htmode &#039;HT20&#039;
    option txpower &#039;24&#039;
    option country &#039;CA&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option network &#039;lan&#039;
    option mode &#039;ap&#039;
    option ssid &#039;OpenWrt-2.4GHz&#039;
    option encryption &#039;psk2&#039;
    option key &#039;*****&#039;

config wifi-device &#039;radio1&#039;
    option type &#039;mac80211&#039;
    option hwmode &#039;11a&#039;
    option path &#039;pci0000:01/0000:01:00.0&#039;
    option channel &#039;165&#039;
    option htmode &#039;HT20&#039;
    option country &#039;CA&#039;
    option txpower &#039;24&#039;

config wifi-iface
    option device &#039;radio1&#039;
    option network &#039;lan&#039;
    option mode &#039;ap&#039;
    option ssid &#039;OpenWrt-5GHz&#039;
    option encryption &#039;psk2&#039;
    option key &#039;*****&#039;</code></pre></div><br /><p><strong>Other Details</strong>:<br /></p><div class="codebox"><pre><code>Qualcomm Atheros QCA9880 802.11nac (radio1)
Channel: 165 (5.825 GHz) | Bitrate: 6 Mbit/s     SCAN  ADD
75%    SSID: OpenWrt-5GHz | Mode: Master
BSSID: EC:08:6B:47:6E:F0 | Encryption: WPA2 PSK (CCMP)</code></pre></div><div class="codebox"><pre><code>Signal / Noise
-57 / 0 dBm

RX Rate / TX Rate
24.0 Mbit/s, 20MHz
6.0 Mbit/s, 20MHz</code></pre></div><br /><p>Would somebody be willing to help me troubleshoot this Archer C7 / ath10k issue further?</p><p>Also, does anybody know why <strong>arokh</strong>&#039;s community trunk builds handle this ath10k firmware issue with the C7 perfectly (performance-wise), while both the lede trunk and OpenWrt trunk seem to have significant performance issues with C7 and ath10k?</p><br /><p>Thank you for your time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328653">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						16 Jun 2016, 00:18					</div>
				</div>
				<div class="post-content content">
					<p>This will fix your 5ghz:<br /><a href="https://www.gargoyle-router.com/phpbb/viewtopic.php?f=14&amp;t=8765">https://www.gargoyle-router.com/phpbb/v â€¦ amp;t=8765</a></p><p>I don&#039;t use openwrt trunk or lede.<br />Gargoyle is built on top of Openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328680">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						16 Jun 2016, 06:03					</div>
				</div>
				<div class="post-content content">
					<p>The following is what works for me:<br /></p><div class="codebox"><pre><code>    option htmode &#039;VHT80&#039;
    option channel &#039;161&#039;</code></pre></div><p>dmesg is the same with exception of:<br /></p><div class="codebox"><pre><code>[   23.262350] ath10k_pci 0000:01:00.0: no channel configured; ignoring frame(s)!
[   23.325954] ath10k_pci 0000:01:00.0: no channel configured; ignoring frame(s)!</code></pre></div>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 16 Jun 2016, 06:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329013">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">PJK</div>
					<div class="post-datetime">
						19 Jun 2016, 12:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>WildByDesign wrote:</cite><blockquote><p>Alright, so I switched over cleanly from lede trunk over to OpenWrt current trunk.&nbsp; Discarded settings and started fresh.&nbsp; Installation was literally a breeze, much smoother experience.&nbsp; Installed and configured the necessary packages and firmware.&nbsp; While almost every aspect thus far with OpenWrt trunk has been smooth and flawless, the same issue remains with the 5GHz radio.</p></blockquote></div><p>After firmware and kernel modules are installed 5GHz channel width must be 80MHz and channel can&#039;t be auto.<br /></p><div class="quotebox"><blockquote><p>Also, does anybody know why <strong>arokh</strong>&#039;s community trunk builds handle this ath10k firmware issue with the C7 perfectly (performance-wise), while both the lede trunk and OpenWrt trunk seem to have significant performance issues with C7 and ath10k?</p></blockquote></div><p>I have not seen any big performance issues with official trunk builds, iperf3 shows 300-500Mbps rates with MacBook Pro.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345064">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">whatshisname</div>
					<div class="post-datetime">
						28 Nov 2016, 02:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>This will fix your 5ghz:<br />(Link to the Gargoyle image removed because of restrictions imposed by the BB software.)</p><p>I don&#039;t use openwrt trunk or lede.<br />Gargoyle is built on top of Openwrt.</p></blockquote></div><p>I have never tried installing Open-WRT or DD-WRT before.&nbsp; So this is new territory for me.</p><p>Been following through the maze of posts on the Archer ac1750.&nbsp; I have a later build with serial number 215c+ where I see some people have bricked the router trying to install Open-WRT.</p><p>To be painfully clear, are you saying if I use the firmware you recommend, that I will be able to successfully install Open-WRT and have the 5ghz radio work fine?</p><p>Currently, my router says it&#039;s using the factory firmware version:&nbsp; 3.14.3 Build 151014 Rel.49676n</p><p>Thanks.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>