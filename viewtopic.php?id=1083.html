<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Blocking Hosts</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p5116">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">m51dps</div>
					<div class="post-datetime">
						8 Mar 2005, 06:17					</div>
				</div>
				<div class="post-content content">
					<p>I have found a <a href="http://pgl.yoyo.org/adservers/">few sites</a> that discuss setting up your computer to block ads by putting the ad server host names in your hosts file, and pointing them to 127.0.0.1 (loopback address obviously). Is there a simple way to set up my OpenWRT router to block or redirect hosts? It would be much easier to control everything on the router than keep track of each individual computer.</p><p>There is no /etc/hosts, but I know there is something ridiculously simple that I am missing....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5117">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						8 Mar 2005, 07:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I have found a <a href="http://pgl.yoyo.org/adservers/">few sites</a> that discuss setting up your computer to block ads by putting the ad server host names in your hosts file, and pointing them to 127.0.0.1 (loopback address obviously). Is there a simple way to set up my OpenWRT router to block or redirect hosts? It would be much easier to control everything on the router than keep track of each individual computer.</p><p>There is no /etc/hosts, but I know there is something ridiculously simple that I am missing....</p></blockquote></div><p>Well, I plan to do a peerguardian package this week. That would help in this, too (as it has automatic updates to block certain ranges, anti-p2p, ads, spyware, edu, gov, etc).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5119">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						8 Mar 2005, 09:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I have found a <a href="http://pgl.yoyo.org/adservers/">few sites</a> that discuss setting up your computer to block ads by putting the ad server host names in your hosts file, and pointing them to 127.0.0.1 (loopback address obviously). Is there a simple way to set up my OpenWRT router to block or redirect hosts? It would be much easier to control everything on the router than keep track of each individual computer.</p><p>There is no /etc/hosts, but I know there is something ridiculously simple that I am missing....</p></blockquote></div><p>Create a /etc/hosts, restart dnsmasq.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16052">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						25 Nov 2005, 15:37					</div>
				</div>
				<div class="post-content content">
					<p>has somebody make a package for peerguardian 2?</p><p>or a way to block ip taken from blocklist.org?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16862">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						8 Dec 2005, 22:13					</div>
				</div>
				<div class="post-content content">
					<p>Has anyone made a package for peerguardian yet? I would really like this package...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16871">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						9 Dec 2005, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>no one replies to me...</p><p>i think i&#039;ll make this package by myself.. but i need time to learn how</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16885">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Kasei</div>
					<div class="post-datetime">
						9 Dec 2005, 10:38					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>i think theres an easy way: <a href="http://www.bluetack.co.uk/converter/index.php">http://www.bluetack.co.uk/converter/index.php</a><br />With this you can create a script with the desired adresses(adware,spyware, antip2p...). It could look like this:</p><p>#!/bin/bash</p><p># Create special MLDONKEY chain<br />iptables -t filter -N MLDONKEY<br />iptables -t filter -F MLDONKEY</p><p># Create the logdrop chain to log &amp; drop a packet<br />iptables -t filter -N MLDONKEY_LOGDROP<br />iptables -t filter -F MLDONKEY_LOGDROP<br />iptables -t filter -A MLDONKEY_LOGDROP -j LOG --log-prefix &quot;MLDONKEY&quot;<br />iptables -t filter -A MLDONKEY_LOGDROP -j DROP</p><p># Jump to the special MLD chain at the end of the INPUT chain (commented out)<br />#iptables -t nat -A INPUT -j MLDONKEY</p><p># List of ip ranges to ban<br />iptables -t filter -I INPUT 1 -s 4.18.162.102 -j MLDONKEY_LOGDROP<br />iptables -A OUTPUT -o eth0 -d 4.18.162.102 -j REJECTiptables -t filter -I INPUT 1 -s 4.36.44.3 -j MLDONKEY_LOGDROP<br />iptables -A OUTPUT -o eth0 -d 4.36.44.3 -j REJECTiptables -t filter -I INPUT 1 -s 4.38.98.140 -j MLDONKEY_LOGDROP<br />iptables -A OUTPUT -o eth0 -d 4.38.98.140 -j REJECTiptables -t filter -I INPUT 1 -s 4.65.105.109 -j MLDONKEY_LOGDROP<br />iptables -A OUTPUT -o eth0 -d 4.65.105.109 -j REJECTiptables -t filter -I INPUT 1 -s 12.3.249.0/24 -j MLDONKEY_LOGDROP<br />iptables -A OUTPUT -o eth0 -d 12.3.249.0/24 -j REJECTiptables -t filter -I INPUT 1 -s 12.14.172.204 -j MLDONKEY_LOGDROP<br />.... and so on</p><p>I think the iptables way is better because some sites are loading the ads from IP-adresses + iptables should be faster.<br />It would be great if someone makes a package with autoupdate functionality and stuff like that. I havent tried the way i mentioned above so i cant tell if its any good from experience but it looks like it would do the job.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16888">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						9 Dec 2005, 11:51					</div>
				</div>
				<div class="post-content content">
					<p>One could just make a script that downloads the new list and updates the iptables and the it could be a cronjob. I can write the script. </p><p>How does peerguardian work? If one would put alot of entries in iptables there would be much load on the router I guess... If all traffic needs to be checked against the iptables script... If it is just as good to just dowlaod the list and convert it to a iptables script I will create the script.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16889">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						9 Dec 2005, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>Hmm where do I download the source list with all the ipadresses to block?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16890">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Kasei</div>
					<div class="post-datetime">
						9 Dec 2005, 12:07					</div>
				</div>
				<div class="post-content content">
					<p>Hello Kaksi,</p><p>you can find the blacklists here -&gt; <a href="http://www.bluetack.co.uk/modules.php?name=Downloads&amp;d_op=viewdownload&amp;cid=2">http://www.bluetack.co.uk/modules.php?n … &amp;cid=2</a><br />It would be great if one could choose the list(s) like only adtrackers+spy-/malware.<br />Its formatted like hostname:ip(adress/range)<br />If you do create a script id be happy to try it and give feedback.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16893">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						9 Dec 2005, 12:14					</div>
				</div>
				<div class="post-content content">
					<p>I guess this is the one that is interresting: <a href="http://dialspace.dial.pipex.com/town/pipexdsl/s/ashu56/bluetack/level1.txt">http://dialspace.dial.pipex.com/town/pi … level1.txt</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16899">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						9 Dec 2005, 12:48					</div>
				</div>
				<div class="post-content content">
					<p>but i think that there are so many ip to block that iptables cannot handle them...</p><p>there would be hundred of rules in iptables and openwrt is a small router not a linuxbox</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16900">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Kasei</div>
					<div class="post-datetime">
						9 Dec 2005, 12:54					</div>
				</div>
				<div class="post-content content">
					<p>If it cant handle the tables it wont be able to handle the hosts anyway -&gt; we´re talking about thousands not hundreds of entrys.</p>											<p class="post-edited">(Last edited by <strong>Kasei</strong> on 9 Dec 2005, 12:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17041">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						11 Dec 2005, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>i don&#039;t know how many hosts peerguardian blocks, but i think they are hundreds</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17044">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						11 Dec 2005, 17:08					</div>
				</div>
				<div class="post-content content">
					<p>The best choice would be to set up a proxy server (preferably Squid on a separate Linux box) and force all of your web traffic through this proxy. There are several ways to block/filter content and addresses. I like squidguard and dansguardian. I also use adzapper and wrote a howto on it long long long ago:</p><p><a href="http://voidmain.is-a-geek.net/redhat/zapping_ads_with_squid_and_adzapper.html">http://voidmain.is-a-geek.net/redhat/za … apper.html</a></p><p>You can block all port 80 traffic at your firewall except for the proxy server. You can also set up a transparent proxy so that any port 80/443/etc traffic is automatically forwarded through the proxy by setting a simple iptables rule in your router. Just another idea in case you didn&#039;t think of it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17067">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						11 Dec 2005, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>i&#039;ve just installed peerguardian2 on my windowspc, i downloaded the blocking list(only the p2p list) there:</p><p>peerguardian.sourceforge.net/lists/p2p.php</p><p>it has 91715 line made so:<br /></p><div class="codebox"><pre><code>General Electric Company:3.0.0.0-3.255.255.255
s0-0.ciscoseattle.bbnplanet.net:4.0.25.146-4.0.25.148
p1-0.cisco.bbnplanet.net:4.0.26.14-4.0.29.24
Cisco Systems, Inc:4.2.144.64-4.2.144.95
Drug Enforcement Adm:4.2.144.224-4.2.144.231
US Dept of Treasury - TIGTA:4.2.144.248-4.2.144.255
City of League City:4.2.145.224-4.2.145.239
Verizon/Intel-San Jose:4.2.153.0-4.2.153.7
Cisco Systems, Inc:4.2.153.32-4.2.153.63
Werner Media:4.2.160.64-4.2.160.79
Pike County Auditor:4.2.161.0-4.2.161.7
Delaware MRDD:4.2.161.64-4.2.161.71
Brown County Commissioners/Georgetown:4.2.162.128-4.2.162.135
Portsmouth Municipal Court:4.2.162.144-4.2.162.151
City of Circleville:4.2.162.160-4.2.162.191
Cisco Systems, Inc:4.2.163.96-4.2.163.127

etc. etc.</code></pre></div><p>i think it&#039;s impossible iptables (on openwrt) can handle a so big list of ip to drop...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17069">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						11 Dec 2005, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>Not only that but it doesn&#039;t make any sense to use iptables to block such a large list. A proxy does it with ease however.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17070">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						11 Dec 2005, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>if i put that list in host.deny?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17071">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						11 Dec 2005, 22:21					</div>
				</div>
				<div class="post-content content">
					<p>proxy. I actually block ALL outbound traffic at the firewall with iptables (except for a whitelist of hosts). That takes just one rule. If someone needs to get to the Internet it is done through the proxy. The proxy can block such a large list with ease along with doing ad blocking and content filtering. You run into many problems trying to do this with iptables. I wrote a program to automatically add an iptables rule to block any host trying to hit me that is infected with Code Red or Nimda. When the list gets up to 10,000 it starts becoming a big performance hit. This is on a full fledged PC with 3 NICs rather than the limited resources of the WRT54G such devices. Then try manually manipulating the rules tables with such a large list.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17264">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						15 Dec 2005, 15:26					</div>
				</div>
				<div class="post-content content">
					<p>but i need to block spy server for p2p software, i don&#039;t want to block http</p><p>i have p2p port enabled on my router but i want to block scanning my pcs from ips in <a href="http://peerguardian.sourceforge.net/lists/p2p.php">http://peerguardian.sourceforge.net/lists/p2p.php</a></p>											<p class="post-edited">(Last edited by <strong>Giammin</strong> on 15 Dec 2005, 15:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17542">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						20 Dec 2005, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>I found that a peerguardian package has been commited to: <a href="https://dev.openwrt.org/browser/trunk/openwrt/package/peerguardian/">https://dev.openwrt.org/browser/trunk/o … rguardian/</a></p><p>Is the a binary package for installation? Does it work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17546">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">olli</div>
					<div class="post-datetime">
						20 Dec 2005, 15:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kaksi wrote:</cite><blockquote><p>I found that a peerguardian package has been commited to: <a href="https://dev.openwrt.org/browser/trunk/openwrt/package/peerguardian/">https://dev.openwrt.org/browser/trunk/o … rguardian/</a></p><p>Is the a binary package for installation? Does it work?</p></blockquote></div><p>You can download a ipkg package from <a href="http://openwrt.inf.fh-brs.de/~olli/testing/mipsel/packages/peerguardian_1.5beta-1_mipsel.ipk">peerguardian_1.5beta-1_mipsel.ipk</a> (749K).</p><p>Please report if it&#039;s working for you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17547">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">Giammin</div>
					<div class="post-datetime">
						20 Dec 2005, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>i have this problem:</p><div class="codebox"><pre><code>root@OpenWrt:~# ipkg install http://openwrt.inf.fh-brs.de/~olli/testing/mipsel/packages/peerguardian_1.5beta-1_mipsel.ipk
Downloading http://openwrt.inf.fh-brs.de/~olli/testing/mipsel/packages/peerguardian_1.5beta-1_mipsel.ipk
Installing peerguardian (1.5beta-1) to root...
Installing libpthread (0.9.27-1) to root...
Downloading http://downloads.openwrt.org/whiterussian/packages/libpthread_0.9.27-1_mipsel.ipk
Configuring libpthread
Configuring peerguardian
Successfully terminated.
root@OpenWrt:~# peerguardnf -h
peerguardnf: can&#039;t load library &#039;libstdc++.so.6&#039;
root@OpenWrt:~# peerguardnf
peerguardnf: can&#039;t load library &#039;libstdc++.so.6&#039;</code></pre></div><p>is this package working as original peerguardian for linux?<br />where have i to put config files?</p><p>thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17577">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						21 Dec 2005, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>While compiling peerguardian for linux, I did not manage to make it link with the uClibc++, so please try to install the libstdc++ package.</p><p>I&#039;ll correct the dependency</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17681">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">kaksi</div>
					<div class="post-datetime">
						22 Dec 2005, 19:39					</div>
				</div>
				<div class="post-content content">
					<p>I guess it does not work.</p><p>First I had to chmod +x on the init script. Then when I tried to start it I got:</p><div class="quotebox"><blockquote><p>orno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno colorno co</p></blockquote></div><p>all over the screen.</p><p>Pressing CTRL+C got me back to the console and I got: Problem with init file</p><br /><p>Ideas? Do I have to configure it somehow?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>