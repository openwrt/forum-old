<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ar9331&#039;s usb stability issue - [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Mar 2017 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p199287">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						23 Apr 2013, 08:34					</div>
				</div>
				<div class="post-content content">
					<p>Make sure in the logs that it is a high-speed hub, as USB 2.0 doesn&#039;t give a clue of what actual speed is used.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199291">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">david-m</div>
					<div class="post-datetime">
						23 Apr 2013, 09:03					</div>
				</div>
				<div class="post-content content">
					<p>The kernel reports everything I connect as &quot;...new high-speed USB device number...&quot;,&nbsp; so I think all the hubs and devices are 2.0.&nbsp; I am getting just over 100Mbits pulling data off a flash key with/without hub,&nbsp; so that pretty much cancels any 1.1 possibilities right ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201293">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">LinuxHata</div>
					<div class="post-datetime">
						9 May 2013, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello. I found this tread via google, my tasks aren&#039;t exactly as yours, but I have high speed scope, logic analyzer, spectrum analyzer, so I can start looking at the USB signal, to find out when it gets in troubles. The main problem is, that I&#039;m running the stock firmware and want to keep it&#039;s functionality, as 3G connection sharing wifi hotspot, so if yours OpenWRT provides that, I will flash and check. The main interest and keyword why I&#039;ve found this tread is usability of USB hub. Is it possible to hook an usb hub and two devices in it? I&#039;d like to have 3G modem and usb hdd connected, so I can use my hdd as NAS. The power won&#039;t be an issue - I can mod power supply to required levels.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206481">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">jay_87</div>
					<div class="post-datetime">
						5 Jul 2013, 11:05					</div>
				</div>
				<div class="post-content content">
					<p>USB hub can solve this problem. Is there anybody can solve this problem in the&nbsp; linux kernel and usb driver?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207632">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">xkremator</div>
					<div class="post-datetime">
						20 Jul 2013, 17:26					</div>
				</div>
				<div class="post-content content">
					<p>FYI, USB power output voltage of WR703N is very susceptible to AR9331 Wi-Fi operation.</p><p>Below are oscilloscope&#039;s snapshot images of USB voltage showing example of typical router&#039;s usage:<br />- powered by original AC adapter ;<br />- (only) passive budget USB 2.0 hub is connected to the router ;</p><br /><br /><p><strong>Wi-fi is ON, no traffic, beacons only</strong>:</p><p><span class="postimg"><img src="http://imageshack.us/a/img96/9994/owt6.jpg" alt="http://imageshack.us/a/img96/9994/owt6.jpg" /></span></p><br /><br /><br /><br /><p><strong>Wi-fi is ON, lot of traffic</strong>:</p><p><span class="postimg"><img src="http://imageshack.us/a/img844/4373/w3rb.jpg" alt="http://imageshack.us/a/img844/4373/w3rb.jpg" /></span></p><br /><br /><br /><br /><p><strong>Wi-fi is OFF</strong>:</p><p><span class="postimg"><img src="http://imageshack.us/a/img534/5628/53dc.jpg" alt="http://imageshack.us/a/img534/5628/53dc.jpg" /></span></p><br /><p>A lot of USB devices require +4.75V ... +5.25V voltage range for their operation.<br />Some other USB devices declare that 5V +- 10% is sufficient ( 4.5V ... 5.5V).</p><p><strong>Spikes of 0.3V in magnitude shown above are too high for reliable operation!</strong>.<br />When USB power becomes lower than necessary OpenWRT system may suffer from numerous &quot;USB disconnect&quot;s.</p><p>Powered USB Hub with sufficient electrical capacity will help:<br />- to keep medium voltage applied to USB devices close to 5V ;<br />- to dump spikes and variations of voltage caused by dynamic variations of electrical load;</p>											<p class="post-edited">(Last edited by <strong>xkremator</strong> on 20 Jul 2013, 17:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207641">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						20 Jul 2013, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>Will using an adapter with higher current help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207675">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">xkremator</div>
					<div class="post-datetime">
						21 Jul 2013, 14:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Will using an adapter with higher current help?</p></blockquote></div><p>May, or may not. Quality of adapters does vary.</p><p>As an example, I&#039;ve measured the voltage of WR703N connected to 12V-&gt;5V car adapter rated for 2A - spikes are the same.</p><p>Soldering a capacitance of few hundreds of uF to 5V power lines typically does help.</p><br /><p>Another issue we should worry about - the voltage for USB socket of WR703N is taken out from internal LDO,<br />which is likely rated not more than 500mA. This is because WR703N is originally specified to be connected with<br />not more than a USB 3G modem.<br />Some of you may already noticed that older models of 3G modems drain a lot of curent and also susceptible<br />to frequent disconnects when attached to WR703N.</p><p>So if we want to attach several USB devices to the router, we should use self-powered USB hub,<br />and it is preferable that internal electrical design of the hub can withstand to all of the noise generated by<br />attached devices over the 5V power lines.</p>											<p class="post-edited">(Last edited by <strong>xkremator</strong> on 21 Jul 2013, 14:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207691">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						21 Jul 2013, 18:44					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, USB power and corresponding decoupling on the TL-WR703N is pretty weak: adding a few hundreds ¬µF capacitor across the USB power may help:<br /><span class="postimg"><img src="http://oomz.net/p/web/IMG_5862.JPG" alt="Big Capacitor for USB!!!" /></span></p><p>See this thread: <a href="https://forum.openwrt.org/viewtopic.php?pid=155706#p155706">https://forum.openwrt.org/viewtopic.php ‚Ä¶ 06#p155706</a></p><p>But unfortunately, this is not the only issue:(</p><p>Even with a large capacitor like above, there is still a&nbsp; USB long-term stability issue with the AR9331 (occurring from as fast as a few minutes up to one hour)&nbsp; which also applies to some other AR9331-based devices (so this is not a TL-WR703N problem per se), that only occurs when WiFi is turned on: the USB just hangs (NOT a disconnect!), and this happens only with full speed devices connected directly to the router, like an Arduino board.</p><p>It doesn&#039;t happen using a high-speed device or when the full-speed device is attached through a high-speed hub, even a passive one, so this is not a weak power supply problem.</p><p>It is not due to a high USB traffic: the Arduino board only spits a counter every second using a CDC-ACM pseudo TTY.</p><p>The USB bus does not hang either when you only use isochronous traffic, like for audio or video streaming; there may be some glitches, but they may well get unnoticed.</p><p>Apparently, this problem may be due to WiFi RF spurious emissions causing problems to the USB clock PLL within the chip itself.</p><p>This is the reason why I changed all my projects to use boards based on the RT5350 SoC rather than on the AR9331 whenever I need a reliable USB operation.</p><p>However, the AR9331 is still a better option when USB is not used, with only 1/3 (0.5 W vs. 1.5 W) of the power requirement running WiFi @ 18 dBm.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207703">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						21 Jul 2013, 20:12					</div>
				</div>
				<div class="post-content content">
					<p>hmm, so what you are saying, Squonk, is that no amount of hacking will fix the issue as it is all happening within the chip?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207706">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						21 Jul 2013, 20:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>hmm, so what you are saying, Squonk, is that no amount of hacking will fix the issue as it is all happening within the chip?</p></blockquote></div><p>In my opinion (I may be wrong!), the only possibility left is if there are some magic registers in the wireless peripheral/baseband to lower/shift the WiFi RF spurious emissions and preventing it from bugging the USB, or some other registers in the USB host peripheral to lower the USB clock PLL sensitivity to RF spurious...</p><p>Maybe in QCA&#039;s openhal project on Github, see my post #146?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208029">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						25 Jul 2013, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>i make a test for the wr703,seems just 78 second is over.so it may the power supply problem...<br /><a href="http://see.sl088.com/id/4a9">http://see.sl088.com/id/4a9</a></p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 25 Jul 2013, 13:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208032">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						25 Jul 2013, 13:26					</div>
				</div>
				<div class="post-content content">
					<p>and i try direct connect the R113(give supply from usb),still no luck,only about 1minuter</p><p>it seems with out the ldo(3.3v-5v),it dead fast,so the ldo maybe is try to fix the problem?but still not so good.</p><p>in the org firmware,the 3g dongle is work okay more than hours and hours.</p><p>be use a hub(the chip is FE2.1),it work very long time<br /><span class="postimg"><img src="http://farm6.staticflickr.com/5524/9272280579_abb0548a5f_c.jpg" alt="http://farm6.staticflickr.com/5524/9272280579_abb0548a5f_c.jpg" /></span></p><div class="codebox"><pre><code>survive for time second: 973
survive for time second: 974
survive for time second: 975
survive for time second: 976
survive for time second: 977
survive for time second: 978
survive for time second: 979
survive for time second: 980
survive for time second: 981
 
&gt; survive for time second: 982</code></pre></div><p>more than 8000 second<br /></p><div class="codebox"><pre><code>survive for time second: 7977
survive for time second: 7978
survive for time second: 7979
survive for time second: 7980
survive for time second: 7981
survive for time second: 7982
survive for time second: 7983
survive for time second: 7984
survive for time second: 7985
survive for time second: 7986
survive for time second: 7987
survive for time second: 7988
survive for time second: 7989
survive for time second: 7990
survive for time second: 7991
survive for time second: 7992
survive for time second: 7993
survive for time second: 7994
survive for time second: 7995
survive for time second: 7996
survive for time second: 7997
survive for time second: 7998
survive for time second: 7999
survive for time second: 8000
survive for time second: 8001
survive for time second: 8002
survive for time second: 8003
survive for time second: 8004
survive for time second: 8005
survive for time second: 8006
survive for time second: 8007
survive for time second: 8008
survive for time second: 8009
survive for time second: 8010
survive for time second: 8011</code></pre></div>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 25 Jul 2013, 16:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208073">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						25 Jul 2013, 19:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>slboat wrote:</cite><blockquote><p>in the org firmware,the 3g dongle is work okay more than hours and hours.</p></blockquote></div><p>Yes, but is the 3G dongle full-speed or high-speed in the logs?</p><p>The problem only happens when doing non-isochronous full-speed transfers, everything is fine if doing isochronous or high-speed transfers.</p><p>There may also be a patch in the original firmware just like the ones in QCA&#039;s openhal project on Github that may correct the problem, I don&#039;t know.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208162">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						26 Jul 2013, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>i use a hub and now can put them on the wall <br /><span class="postimg"><img src="http://farm3.staticflickr.com/2840/9366886885_f1e0f9f4e1_c.jpg" alt="http://farm3.staticflickr.com/2840/9366886885_f1e0f9f4e1_c.jpg" /></span><br /><span class="postimg"><img src="http://farm3.staticflickr.com/2842/9369430790_084ee9e18c_c.jpg" alt="http://farm3.staticflickr.com/2842/9369430790_084ee9e18c_c.jpg" /></span></p><p>guess that&#039;s just the way usb and wr703.</p><p>i have a thought that may be problem is only for the CDC/ACM driver,not the usb1.1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208240">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 Jul 2013, 06:14					</div>
				</div>
				<div class="post-content content">
					<p>i found a wired thing,the wr703 v1.6 is use a cpu called[ar9331-al3A],and the v1.1 is use[ar9331-al1A],and some other change is now have a f1 element.</p><p>now i test the v1.6 see how is the usb problem going.</p><p>here is some diffrent betwen two board<br /><span class="postimg"><img src="http://farm3.staticflickr.com/2814/9375322774_105af4c151_h.jpg" alt="http://farm3.staticflickr.com/2814/9375322774_105af4c151_h.jpg" /></span><br /><span class="postimg"><img src="http://farm3.staticflickr.com/2814/9375322774_105af4c151_h.jpg" alt="http://farm3.staticflickr.com/2814/9375322774_105af4c151_h.jpg" /></span></p><p>the v1.1 test survive 1088 second,now is test the V1.6 version,for now is more than 600 second.</p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 Jul 2013, 07:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208245">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 Jul 2013, 07:57					</div>
				</div>
				<div class="post-content content">
					<p>the first test on new pcb V1.6 survive more than 3000 second,and stop because the wifi,not show the usb disconnect)<br /></p><div class="codebox"><pre><code>survive for time second: 2917
survive for time second: 2918
survive for time second: 2919
survive for time second: 2920
survive for time second: 2921
survive for time second: 2922
survive for time second: 2923
survive for time second: 2924
survive for time second: 2925
[ 4832.500000] ath: phy0: Failed to stop TX DMA, queues=0x001!
[ 4833.310000] wlan0: authenticate with 24:3c:64:14:11:1e
[ 4833.350000] wlan0: send auth to 24:3c:64:14:11:1e (try 1/3)
[ 4833.350000] wlan0: authenticated
[ 4833.360000] wlan0: associate with 24:3c:64:14:11:1e (try 1/3)
[ 4833.550000] wlan0: RX AssocResp from 24:3c:64:14:11:1e (capab=0x431 status=0 aid=3)
[ 4833.560000] wlan0: associated</code></pre></div><p>i think the F1 is for the usb,base on spounk&#039;s sch.<br /><span class="postimg"><img src="http://see.sl088.com/w/images/c/c7/JustCapIt7771.jpg" alt="http://see.sl088.com/w/images/c/c7/JustCapIt7771.jpg" /></span></p><p>the F1 look close<br /><span class="postimg"><img src="http://see.sl088.com/w/images/4/4e/JustCapIt7781.jpg" alt="http://see.sl088.com/w/images/4/4e/JustCapIt7781.jpg" /></span></p><p>now i going to test again,and this time use lan to conect for test(last is use ttl)</p><p><span class="postimg"><img src="http://farm4.staticflickr.com/3830/9375846360_9696c9ea28_c.jpg" alt="http://farm4.staticflickr.com/3830/9375846360_9696c9ea28_c.jpg" /></span></p><p>and i found the change is not V1.6,is the sn change,after 136198,it&#039;s come with the change<br /><span class="postimg"><img src="http://farm8.staticflickr.com/7282/9373094175_1e321f417e_c.jpg" alt="http://farm8.staticflickr.com/7282/9373094175_1e321f417e_c.jpg" /></span><br /><span class="postimg"><img src="http://farm8.staticflickr.com/7366/9375889316_df88864972_c.jpg" alt="http://farm8.staticflickr.com/7366/9375889316_df88864972_c.jpg" /></span><br /><span class="postimg"><img src="http://farm8.staticflickr.com/7452/9373103551_7bf16c8e45_c.jpg" alt="http://farm8.staticflickr.com/7452/9373103551_7bf16c8e45_c.jpg" /></span></p><p>stably more than one hours<br /></p><div class="codebox"><pre><code>survive for time second: 4021
survive for time second: 4022
survive for time second: 4023
survive for time second: 4024
survive for time second: 4025
survive for time second: 4026
survive for time second: 4027
survive for time second: 4028
survive for time second: 4029
survive for time second: 4030
survive for time second: 4031
survive for time second: 4032
survive for time second: 4033
survive for time second: 4034
survive for time second: 4035
survive for time second: 4036
survive for time second: 4037
survive for time second: 4038
survive for time second: 4039</code></pre></div><p>i now going to get 2 arduino uno board,start 3 route(with pcb change) same time test</p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 Jul 2013, 09:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208265">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 Jul 2013, 12:44					</div>
				</div>
				<div class="post-content content">
					<p>in the v1.1version wr703n:<br />and i found wifi client mode can work more than 2500 second,as wifi server mode,mostly cant survive for 1minute.<br /></p><div class="codebox"><pre><code>root@OpenWrt_SLboat_Mod_V1:/etc/config# wifi on
[12790.230000] wlan0: deauthenticating from 94:0c:6d:d4:b1:be by local choice (reason=3)
Configuration file: /var/run/hostapd-phy0.conf
[12791.430000] device wlan0 entered promiscuous mode
Using interface wlan0 with hwaddr 14:cf:92:87:07:a8 and ssid &quot;OpenWrt SLboat Mod 1&quot;
[12791.570000] br-lan: port 2(wlan0) entered forwarding state
[12791.570000] br-lan: port 2(wlan0) entered forwarding state
[12793.570000] br-lan: port 2(wlan0) entered forwarding state
root@OpenWrt_SLboat_Mod_V1:/etc/config# microcom -D/dev/ttyACM0
√ö
**********Help***********
  x - exit microcom
  b - send break
  l - log on             
  s - start script       
  t - set terminal
  q - quit help
*************************
Command: √∫√Äh‚ÄìzB≈°√π
******Set terminal ******
  p - set speed
  m - no CR/NL mapping   
  n - no flow control
  h - hardware flow control
  s - software flow control
  q - quit help
*************************
******Set speed *********
 a - 1200
 b - 2400
 c - 4800
 d - 9600
 e - 19200
 f - 38400
 g - 57600
 h - 115200
 i - 230400
 j - 460800
 q - quit help
*************************
Command: Help done!
survive for time second: 7
survive for time second: 8
survive for time second: 9
survive for time second: 10
survive for time second: 11
# &lt;- dead here</code></pre></div><p>try again<br /></p><div class="codebox"><pre><code>[12973.790000] usb 1-1: USB disconnect, device number 13
root@OpenWrt_SLboat_Mod_V1:/etc/config# [12974.460000] usb 1-1: new full-speed USB device number 14 using ehci-platform
[12974.620000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device

root@OpenWrt_SLboat_Mod_V1:/etc/config# 
root@OpenWrt_SLboat_Mod_V1:/etc/config# microcom -D/dev/ttyACM0
√∫√ÅH√ö¬Æ-
√É¬∞h√§
**********Help***********
  x - exit microcom
  b - send break
  l - log on             
  s - start script       
  t - set terminal
  q - quit help
*************************
Command: 
******Set terminal ******
  p - set speed
  m - no CR/NL mapping   
  n - no flow control
  h - hardware flow control
  s - software flow control
  q - quit help
*************************
Command: √∫U√öU√¢
******Set speed *********
 a - 1200
 b - 2400
 c - 4800
 d - 9600
 e - 19200
 f - 38400
 g - 57600
 h - 115200
 i - 230400
 j - 460800
 q - quit help
*************************
Command: √öU√öD√øHelp done!
survive for time second: 2
survive for time second: 3
survive for time second: 4
survive for time second: 5
survive for time second: 6
survive for time second: 7
survive for time second: 8
survive for time second: 9
survive for time second: 10
survive for time second: 11
survive for time second: 12
survive for time second: 13
survive for time second: 14
survive for time second: 15
survive for time second: 16
survive for time second: 17
survive for time second: 18
survive for time second: 19
survive for time second: 20
survive for time second: 21
survive for time second: 22
survive for time second: 23
survive for time second: 24
survive for time second: 25
survive for time second: 26
survive for time second: 27
survive for time second: 28
survive for time second: 29
survive for time second: 30
survive for time second: 31
survive for time second: 32
survive for time second: 33
survive for time second: 34
survive for time second: 35
survive for time second: 36
survive for time second: 37
survive for time second: 38
survive for time second: 39
survive for time second: 40
survive for time second: 41
# &lt;- dead here</code></pre></div><p><strong>in the v1.6 pcb change version</strong>,even start as wifi server,it can work just fine<br /></p><div class="codebox"><pre><code>root@OpenWrt_SLboat_Mod_V1:/etc/config# microcom -D/dev/ttyACM0
√±√ò
**********Help***********
  x - exit microcom
  b - send break
  l - log on             
  s - start script       
  t - set terminal
  q - quit help
*************************
Command: 
******Set terminal ******
  p - set speed
  m - no CR/NL mapping   
  n - no flow control
  h - hardware flow control
  s - software flow control
  q - quit help
*************************
Command: ¬ª√à(&amp;√°¬¨@¬°¬Å√à
******Set speed *********
 a - 1200
 b - 2400
 c - 4800
 d - 9600
 e - 19200
 f - 38400
 g - 57600
 h - 115200
 i - 230400
 j - 460800
 q - quit help
*************************
Command: Help done!
survive for time second: 0
survive for time second: 1
survive for time second: 2
survive for time second: 3
survive for time second: 4
survive for time second: 5
survive for time second: 6
survive for time second: 7
survive for time second: 8
survive for time second: 9
survive for time second: 10
survive for time second: 11
survive for time second: 12
survive for time second: 13
survive for time second: 14
survive for time second: 15
survive for time second: 16
survive for time second: 17
survive for time second: 18
survive for time second: 19
survive for time second: 20
survive for time second: 21
survive for time second: 22
survive for time second: 23
survive for time second: 24
survive for time second: 25
survive for time second: 26
survive for time second: 27
survive for time second: 28
survive for time second: 29
survive for time second: 30
survive for time second: 31
survive for time second: 32
survive for time second: 33
survive for time second: 34
survive for time second: 35
survive for time second: 36
survive for time second: 37
survive for time second: 38
survive for time second: 39
survive for time second: 40
survive for time second: 41
survive for time second: 42
survive for time second: 43
survive for time second: 44
survive for time second: 45
survive for time second: 46
survive for time second: 47
survive for time second: 48
survive for time second: 49
survive for time second: 50
survive for time second: 51
survive for time second: 52
survive for time second: 53
survive for time second: 54
....
survive for time second: 154
survive for time second: 155
survive for time second: 156
survive for time second: 157
survive for time second: 158
survive for time second: 159
survive for time second: 160
survive for time second: 161
survive for time second: 162
....
survive for time second: 1390
survive for time second: 1391
survive for time second: 1392
survive for time second: 1393
survive for time second: 1394
survive for time second: 1395
survive for time second: 1396
survive for time second: 1397
survive for time second: 1398
survive for time second: 1399
survive for time second: 1400
# still working...</code></pre></div><p>so,i think the problem is cause by the wifi kind stuff,and maybe related the chip,and the v1.6pcb change,the tp-link is start take care this,dont why,that&#039;s pretty wired,if can have more information about the AR9331-AL3A and AR9331-AL1A&#039;s diffrent,that&#039;s maybe can help.</p><p>another thought is the usb2.0 device maybe have better electrical performance design,so it&#039;s not easy be influence.</p><p>and in the same time,the [v1.6] has survive more than 600 second,the[v1.1] test with arduino mega,still less than 1 minute.<br /></p><div class="codebox"><pre><code>*************************
Command: Help done!
survive for time second: 2
survive for time second: 3
survive for time second: 4
survive for time second: 5
survive for time second: 6
survive for time second: 7
survive for time second: 8
survive for time second: 9
survive for time second: 10
survive for time second: 11
survive for time second: 12
survive for time second: 13
survive for time second: 14
survive for time second: 15
survive for time second: 16
survive for time second: 17 # v1.1 dead here</code></pre></div><p>next i wana try is test other [v1.6 pcb change]wr703n,seem if same,and test some others[v1.1]see how is&nbsp; going,and i wana to remove one [v1.6]&#039;s F1,see how is going.</p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 Jul 2013, 13:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208286">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						27 Jul 2013, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for all your tests, Sen!</p><p>F1 looks like a common mode choke: this is used as en EMI protection to remove common mode (i.e. between the 2 wires) spurious emissions.</p><p>I don&#039;t know how this can be related to our problem, but who knows?</p><p>The AR9331-AL3A vs. AR9331-AL1A may be what makes things work: Atheros may have corrected a hardware bug within the chip with this new version.</p><p>What I suggest is to remove the F1 choke on one 1.6 PCB and replace it with a solder bridge or 0R shunt resistors, and see what happens: if this still works ok, then this may well be the new chip revision that makes thing work...</p><p>Otherwise, the PCB rev. is still 1.1, so the change is only a BOM change.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208288">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						27 Jul 2013, 17:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Thank you for all your tests, Sen!</p><p>F1 looks like a common mode choke: this is used as en EMI protection to remove common mode (i.e. between the 2 wires) spurious emissions.</p><p>I don&#039;t know how this can be related to our problem, but who knows?</p><p>The AR9331-AL3A vs. AR9331-AL1A may be what makes things work: Atheros may have corrected a hardware bug within the chip with this new version.</p><p>What I suggest is to remove the F1 choke on one 1.6 PCB and replace it with a solder bridge or 0R shunt resistors, and see what happens: if this still works ok, then this may well be the new chip revision that makes thing work...</p><p>Otherwise, the PCB rev. is still 1.1, so the change is only a BOM change.</p></blockquote></div><p>i still test on 3 v1.1 route,seems one just be fine(more than 3000 second),so in the v1.1,there just some chance will happen to this,and if you like,i wana send you one new pcb change wr703,so you may can have some test on you self.</p><p>im test on those route for now:<br /><span class="postimg"><img src="http://farm4.staticflickr.com/3812/9377258140_c95d2a830a_b.jpg" alt="http://farm4.staticflickr.com/3812/9377258140_c95d2a830a_b.jpg" /></span></p><p>this one cant survire more than 60second<br /><span class="postimg"><img src="http://farm6.staticflickr.com/5495/9374487037_a77e11d78f_b.jpg" alt="http://farm6.staticflickr.com/5495/9374487037_a77e11d78f_b.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 27 Jul 2013, 17:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208335">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						28 Jul 2013, 06:23					</div>
				</div>
				<div class="post-content content">
					<p>v1.1 4 routes test results:<br /></p><div class="codebox"><pre><code>M038 WR703N V1.1(PCB V1.1)
[USB-ACM:Arduino UNO]ÊµãËØïÁîüÂ≠òÊó∂Èó¥Ë∂ÖËøá100ÁßíÊú™Ê≠ªÔºåÁÑ∂Âêé‰∏≠Êñ≠ÁúãËµ∑Êù•ÂæàÁ®≥Âõ∫ - [Short Time Pass &gt; 100s]
[USB-ACM:Arduino UNO]ÊµãËØïË∂ÖËøá237ÁßíÊú™Ê≠ªÔºåÂìáÂñî - [Short Time Pass &gt; 237s]
[USB-ACM:Arduino UNO]ÊµãËØïË∂ÖËøá108ÁßíÊú™Ê≠ªÔºåÊé•ÁùÄË∂ÖËøá25205ÁßíÔºåÊúÄÁªàÊ≠ª‰∫°‰∫é57083ÁßíÔºà15Â∞èÊó∂Ôºâ - [Long Long Time Pass &gt; 15hrs][Still &lt; 57083s]
M044 WR703N V1.1(PCB V1.1)
[USB-FTDI:Arduino Mega]ÊµãËØïÁîüÂ≠òÊó∂Èó¥‰∏çÂà∞14ÁßíÔºåÂæàÂø´ÁöÑÊ≠ªÊéâ - [Short Time Faild = 14s]
[USB-FTDI:Arduino Mega]ÊµãËØï33ÁßíÔºå‰æùÁÑ∂Ê≠ªÊéâ - [Short Time Faild = 33s]
[USB-FTDI:Arduino Mega]ÊµãËØïÊú™26ÁßíÊ≠ª‰∫°Êó∂Èó¥ - [Short Time Faild = 26s]
M048 WR703N V1.1(PCB V1.1)
[USB-ACM:Arduino UNO]Ë∂ÖËøá760Áßí - [Short Time Pass &gt;760s]
[USB-FTDI:Arduino Mega]ÊµãËØï3626ÁßíÊ≠ª‰∫° - [Long Time Faild = 3626s]
[USB-FTDI:Arduino Mega]ÊµãËØï345ÁßíÊ≠ª‰∫° - [Long Time Faild = 345s]
[USB-FTDI:Arduino Mega]ÊµãËØï2967ÁßíÊ≠ª‰∫° - [Long Time Faild = 2967s]
M040 WR703N V1.1(PCB V1.1)
[USB-FTDI:Arduino Mega]ÊµãËØï1262ÁßíÊ≠ª‰∫° - [Long Time Faild = 1262s]
[USB-FTDI:Arduino Mega]ÊµãËØï1363ÁßíÊ≠ª‰∫° - [Long Time Faild = 1363s]
[USB-FTDI:Arduino Mega]ÊµãËØï1466ÁßíÊ≠ª‰∫° - [Long Time Faild = 1466s]</code></pre></div><p>here is v1.6(pcb change)&#039;s test<br /></p><div class="codebox"><pre><code>ÊµãËØïV1.6ÔºàPCBÊîπÂèòÂêéÁöÑÔºâËÆæÂ§á
M046 WR703N V1.6(PCB ADD F1) S/N:137073
[USB-FTDI:Arduino Mega]Ë∂ÖËøá1066ÁßíÔºåÊÑèÂ§ñÊéâÁîµ [Short Time Pass &gt; 1066s]
[USB-FTDI:Arduino Mega]Ë∂ÖËøá28691Áßí [Short Time Pass &gt; 28691s]
M036 WR703N V1.6(PCB ADD F1) S/N:137073
[USB-FTDI:Arduino Mega]Ë∂ÖËøá300Áßí [Short Time Pass &gt; 300s]
[USB-FTDI:Arduino Mega]839ÁßíÊ≠ª [Long Time Faild = 839s]
[USB-FTDI:Arduino Mega]1458ÁßíÊ≠ª [Long Time Faild = 1458s]
[USB-FTDI:Arduino Mega]1021ÁßíÊ≠ª [Long Time Faild = 1021s]
[USB-FTDI:Arduino Mega]798ÁßíÊ≠ª [Long Time Faild = 798s]
M045 WR703N V1.6(PCB ADD F1) S/N:136198
[USB-FTDI:Arduino Mega]76ÁßíÊ≠ªÔºåÂèØËÉΩÊúâ‰æõÁîµÈóÆÈ¢ò [Short Time Faild = 76s]
[USB-FTDI:Arduino Mega]77ÁßíÊ≠ªÔºåÂ∫îËØ•‰∏çÊòØ‰æõÁîµÈóÆÈ¢ò [Short Time Faild = 77s]
[USB-FTDI:Arduino Mega]73ÁßíÊ≠ª [Short Time Faild = 73s]
[USB-FTDI:Arduino Mega]86ÁßíÊ≠ª [Short Time Faild = 86s]
[USB-FTDI:Arduino Mega]18ÁßíÊ≠ª [Short Time Faild = 18s]
[USB-FTDI:Arduino Mega]5ÁßíÊ≠ª [Short Time Faild = 5s]
[USB-FTDI:Arduino Mega]138ÁßíÊ≠ªÔºå‰∏Ä‰∏™Â•áÊÄ™ÁöÑ‰∫ãÊÉÖÊòØÔºåRXÁúãËµ∑Êù•‰πü‰∏çÁÇπ‰∫Æ‰∫ÜÔºåÈöæÈÅìArduino‰πüÊúâÊÑèÂ§ñÔºü [Short Time Faild = 138s]
M047 WR703N V1.6(PCB ADD F1) S/N:137073
[USB-FTDI:Arduino Mega]Ë∂ÖËøá2175Áßí [Short Time Pass &gt; 2175s]
[USB-FTDI:Arduino Mega]1671ÁßíÊ≠ª‰∫° [Short Time Pass &gt; 1671s]</code></pre></div><p>so it not always luck,it still have the problem.</p>											<p class="post-edited">(Last edited by <strong>slboat</strong> on 28 Jul 2013, 14:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210038">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">donhamilton</div>
					<div class="post-datetime">
						17 Aug 2013, 21:56					</div>
				</div>
				<div class="post-content content">
					<p>1. I am a newbe.</p><p>2. Found this discussion via google. I would like to use the MR3020 as a bridge between USB serial and Wifi.</p><p>&nbsp; &nbsp;Which version of WRT should I Flash to get that functionality ?<br />&nbsp; &nbsp;Will that latest version of WRT be able to connect to my office Wifi and a PL2303 USB-serial converter out of the box ?</p><p>&nbsp; &nbsp;Are there any web sites that help explain the steps necessary to accomplish these tasks ?</p><p>&nbsp; &nbsp;I do understand that I need a USB 2.0 HUB.</p><p>Thank You</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210088">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						18 Aug 2013, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>donhamilton,</p><p>Virtually any version of openWrt will do, but probably the best and most stable version for you would be Attitude Adjustment 12.9 -- <a href="http://downloads.openwrt.org/attitude_adjustment/">http://downloads.openwrt.org/attitude_adjustment/</a></p><p>There are a number of ways to use openWrt and the WR703N (with &quot;high speed&quot; hub as reported in dmesg--not just a hub labeled or sold as &quot;USB 2&quot;) to get data from a serial device to a web-enabled device. </p><p>My favorite method is to set up the 703n as a wireless client with a script (in /etc/rc.local) to use netcat (nc) to submit the data to my &quot;collector&quot; device, which accumulates and process data from different openWrt-connected serial devices.</p><p>Here is a sample /etc/config/wireless file<br /></p><div class="codebox"><pre><code> config wifi-device  radio0
         option type     mac80211
         option channel  11
         option macaddr  14:e6:e4:e1:f4:3a
         option hwmode   11ng
         option htmode   HT20
         list ht_capab   SHORT-GI-20
         list ht_capab   SHORT-GI-40
         list ht_capab   RX-STBC1
         list ht_capab   DSSS_CCK-40
         # REMOVE THIS LINE TO ENABLE WIFI:
 #       option disabled 1

config wifi-iface
         option device   radio0
         option network  wireless
         option mode     sta
         option ssid     someSSID
         option encryption psk
         option key      someKey</code></pre></div><p>Don&#039;t just copy this--your macaddr will be unique, and you&#039;ll need the appropriate channel for your network (and of course your own ssid and key).</p><p>Here is a copy of my /etc/rc.local which runs a script which I put in&nbsp; /etc/config/log.sh (in that directory so it would be preserved over sysupgrades):<br /></p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.
/etc/config/log.sh &amp;
echo &quot;rebooted  $(date +%y%m%d%H%M%S)&quot; &gt;&gt; /home/user0/boot.txt
exit 0</code></pre></div><p>Here is /etc/config/log.sh<br /></p><div class="codebox"><pre><code>#!/bin/sh
stty -F /dev/ttyUSB0 2400 clocal cread cs8 -cstopb -parenb -crtscts
cat /dev/ttyUSB0 2&gt;/dev/null | while read v1 v2 v3 v4; do
  echo &quot;$v1 $v2 $v3 $v4 $(date +%y%m%d%H%M%S)&quot; &gt;&gt; /home/user0/Rx01.txt
  echo &quot;$v1 $v2 $v3 $v4 $(date +%y%m%d%H%M%S)&quot; | nc 192.168.1.70 8086 &amp;
  sleep 1s ; kill `pidof nc`
done</code></pre></div><p>This logs the serial input locally, and sends it with &quot;nc&quot; to a netcat listener on 192.168.1.70, port 8086.</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 19 Aug 2013, 17:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210123">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">donhamilton</div>
					<div class="post-datetime">
						19 Aug 2013, 06:30					</div>
				</div>
				<div class="post-content content">
					<p>@lizby<br />Ohboy !</p><p>I will repeat, I am a newbe.</p><p>&quot;Virtually any version of openWrt will do,&quot; the link you sent has 26 sub-directories.<br />None say &quot;WR703N&quot;, so which directory has the binary for the WR703N&nbsp; ?<br />Or can I use any one of them ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210162">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						19 Aug 2013, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>Don--sorry.</p><p>First flash:&nbsp; <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin">http://downloads.openwrt.org/attitude_a ‚Ä¶ actory.bin</a></p><p>Subsequent flashes if needed: <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin">http://downloads.openwrt.org/attitude_a ‚Ä¶ pgrade.bin</a></p><p>You want to use squashfs images (which, among other things, provide &quot;failsafe&quot; recovery with telnet)--&quot;factory&quot; first because you are replacing the factory firmware (what comes on the device); then if later flashes are needed (you shouldn&#039;t need them because Attitude Adjustment is stable), you use the &quot;sysupgrade&quot; version.</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 19 Aug 2013, 17:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210344">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">peteruithoven</div>
					<div class="post-datetime">
						21 Aug 2013, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi folks,<br />Another noob here. <br />Do I understand it correctly that you guys are trying to stabilize the voltage to the usb part of the chip by adding extra wires? And that the current trails haven&#039;t yet solved the issue?</p><p>@slboat, what usb hub are you using in post #164? </p><p>I&#039;m going to try to switch off the WiFi when good usb connection is critical, but I hope you guys can find a better solution.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>