<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> IPv6 on Chaos Calmer...</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 28 Mar 2018 and 8 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=63367&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p314804">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						14 Mar 2016, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m running an x86 router with OpenWRT ((git-16.018.33482-3201903) / OpenWrt Chaos Calmer 15.05) and I&#039;m having issues with IPv6.</p><p>The router can see and talk to IPv6 sites on the internet just fine:<br /></p><div class="codebox"><pre><code>root@Router:~# traceroute6 www.google.com
traceroute to www.google.com (2607:f8b0:400f:803::2004) from 2001:470:1f16:174::2, 30 hops max, 24 byte packets
 1  anaerin-1.tunnel.tserv1.ywg1.ipv6.he.net (2001:470:1f16:174::1)  84.5 ms  84.347 ms  83.572 ms
 2  ge2-20.core1.ywg1.he.net (2001:470:0:2b8::1)  91.215 ms  84.23 ms  90.422 ms
 3  10ge1-6.core1.msp1.he.net (2001:470:0:2dd::1)  111.456 ms  100.77 ms  100.237 ms
 4  100ge7-1.core1.chi1.he.net (2001:470:0:18e::1)  99.979 ms  99.966 ms  100.152 ms
 5  eqixchi-v6.google.com (2001:504:0:4:0:1:5169:1)  100.005 ms  99.175 ms  100.148 ms
 6  2001:4860::1:0:aa79 (2001:4860::1:0:aa79)  100.894 ms  101.004 ms  100.133 ms
 7  2001:4860::8:0:9150 (2001:4860::8:0:9150)  119.603 ms  119.419 ms  120.486 ms
 8  2001:4860::8:0:b0e2 (2001:4860::8:0:b0e2)  118.673 ms  118.611 ms  118.686 ms
 9  2001:4860::8:0:79e5 (2001:4860::8:0:79e5)  119.624 ms  118.629 ms  118.599 ms
10  2001:4860::1:0:8831 (2001:4860::1:0:8831)  118.753 ms  119.319 ms  118.579 ms
11  2001:4860:0:1::1221 (2001:4860:0:1::1221)  119.669 ms  119.517 ms  118.664 ms
12  den03s10-in-x04.1e100.net (2607:f8b0:400f:803::2004)  119.542 ms  119.466 ms  118.685 ms
root@Router:~#</code></pre></div><p>But my clients aren&#039;t getting issued IPv6 addresses:<br /></p><div class="codebox"><pre><code>Robert@ANAERIN-PC C:\Users\Robert
&gt; ipconfig /all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : Anaerin-PC
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : lan

Ethernet adapter Ethernet:

   Connection-specific DNS Suffix  . : lan
   Description . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   Physical Address. . . . . . . . . : 74-D0-2B-96-1A-8B
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::747b:52e9:a206:ca3b%13(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.0.10(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained. . . . . . . . . . : March 8, 2016 4:05:49 PM
   Lease Expires . . . . . . . . . . : March 14, 2016 10:53:48 PM
   Default Gateway . . . . . . . . . : 192.168.0.1
   DHCP Server . . . . . . . . . . . : 192.168.0.1
   DHCPv6 IAID . . . . . . . . . . . : 57987115
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-1A-F9-7C-41-74-D0-2B-96-1A-8B
   DNS Servers . . . . . . . . . . . : 192.168.0.1
   NetBIOS over Tcpip. . . . . . . . : Disabled</code></pre></div><p>ifstatus wan6 gives me:<br /></p><div class="codebox"><pre><code>root@Router:~# ifstatus wan6
{
        &quot;up&quot;: true,
        &quot;pending&quot;: false,
        &quot;available&quot;: true,
        &quot;autostart&quot;: true,
        &quot;dynamic&quot;: false,
        &quot;uptime&quot;: 446,
        &quot;l3_device&quot;: &quot;6in4-wan6&quot;,
        &quot;proto&quot;: &quot;6in4&quot;,
        &quot;updated&quot;: [
                &quot;addresses&quot;,
                &quot;routes&quot;,
                &quot;prefixes&quot;
        ],
        &quot;metric&quot;: 0,
        &quot;delegation&quot;: true,
        &quot;ipv4-address&quot;: [

        ],
        &quot;ipv6-address&quot;: [
                {
                        &quot;address&quot;: &quot;2001:470:1f16:174::2&quot;,
                        &quot;mask&quot;: 64
                }
        ],
        &quot;ipv6-prefix&quot;: [
                {
                        &quot;address&quot;: &quot;2001:470:3074::&quot;,
                        &quot;mask&quot;: 48,
                        &quot;class&quot;: &quot;wan6&quot;,
                        &quot;assigned&quot;: {
                                &quot;lan&quot;: {
                                        &quot;address&quot;: &quot;2001:470:3074::&quot;,
                                        &quot;mask&quot;: 60
                                }
                        }
                }
        ],
        &quot;ipv6-prefix-assignment&quot;: [

        ],
        &quot;route&quot;: [
                {
                        &quot;target&quot;: &quot;::&quot;,
                        &quot;mask&quot;: 0,
                        &quot;nexthop&quot;: &quot;::&quot;,
                        &quot;source&quot;: &quot;2001:470:3074::\/48&quot;
                },
                {
                        &quot;target&quot;: &quot;::&quot;,
                        &quot;mask&quot;: 0,
                        &quot;nexthop&quot;: &quot;::&quot;,
                        &quot;source&quot;: &quot;2001:470:1f16:174::2\/64&quot;
                }
        ],
        &quot;dns-server&quot;: [

        ],
        &quot;dns-search&quot;: [

        ],
        &quot;inactive&quot;: {
                &quot;ipv4-address&quot;: [

                ],
                &quot;ipv6-address&quot;: [

                ],
                &quot;route&quot;: [

                ],
                &quot;dns-server&quot;: [

                ],
                &quot;dns-search&quot;: [

                ]
        },
        &quot;data&quot;: {

        }
}</code></pre></div><p>And /etc/config/network reads:<br /></p><div class="codebox"><pre><code>root@Router:~# cat /etc/config/network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.0.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;
        option delegate &#039;0&#039;

config interface &#039;wan6&#039;
        option _orig_ifname &#039;eth1&#039;
        option _orig_bridge &#039;false&#039;
        option proto &#039;6in4&#039;
        option peeraddr &#039;184.105.255.26&#039;
        option ip6addr &#039;2001:470:1f16:174::2/64&#039;
        option ip6prefix &#039;2001:470:3074::/48&#039;
        option tunnelid &#039;325727&#039;
        option username &#039;&lt;REMOVED&gt;&#039;
        option updatekey &#039;&lt;REMOVED&gt;&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd56:0da3:9c31::/48&#039;

root@Router:~#</code></pre></div><p>And /etc/config/dhcp reads:<br /></p><div class="codebox"><pre><code>root@Router:~# cat /etc/config/dhcp

config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        option filterwin2k &#039;1&#039;
        option nonegcache &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option ra &#039;relay&#039;
        option dhcpv6 &#039;relay&#039;
        option ndp &#039;relay&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan6&#039;
        option ra &#039;relay&#039;
        option dhcpv6 &#039;relay&#039;
        option ndp &#039;relay&#039;
        option master &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config host
        option name &#039;Anaerin-PC&#039;
        option mac &#039;74:d0:2b:96:1a:8b&#039;
        option ip &#039;192.168.0.10&#039;</code></pre></div><p>So everything should be fine, right? What am I missing?</p>											<p class="post-edited">(Last edited by <strong>Anaerin</strong> on 14 Mar 2016, 22:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314807">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						14 Mar 2016, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>Why do you have &quot;relay&quot; mode on dhcp settings?<br />I think that it should be &quot;server&quot;, as you are not receiving anything dynamically. (You have set the prefix in network settings.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314809">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						14 Mar 2016, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>I was going off the &quot;Default configuration for Chaos Calmer&quot; on the ipv6 wiki page. Now I have:<br /></p><div class="codebox"><pre><code>root@Router:~# cat /etc/config/dhcp

config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        option filterwin2k &#039;1&#039;
        option nonegcache &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option ra &#039;server&#039;
        option dhcpv6 &#039;server&#039;
        option ra_management &#039;1&#039;
        option ra_default &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan6&#039;
        option ra &#039;relay&#039;
        option dhcpv6 &#039;relay&#039;
        option ndp &#039;relay&#039;
        option master &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config host
        option name &#039;Anaerin-PC&#039;
        option mac &#039;74:d0:2b:96:1a:8b&#039;
        option ip &#039;192.168.0.10&#039;</code></pre></div><p>But I&#039;m still not getting an IPv6 address:<br /></p><div class="codebox"><pre><code>C:\WINDOWS\system32&gt;ipconfig /all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : Anaerin-PC
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : lan

Ethernet adapter Ethernet:

   Connection-specific DNS Suffix  . : lan
   Description . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   Physical Address. . . . . . . . . : 74-D0-2B-96-1A-8B
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::747b:52e9:a206:ca3b%13(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.0.10(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained. . . . . . . . . . : March 8, 2016 4:05:49 PM
   Lease Expires . . . . . . . . . . : March 15, 2016 2:32:14 AM
   Default Gateway . . . . . . . . . : 192.168.0.1
   DHCP Server . . . . . . . . . . . : 192.168.0.1
   DHCPv6 IAID . . . . . . . . . . . : 57987115
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-1A-F9-7C-41-74-D0-2B-96-1A-8B
   DNS Servers . . . . . . . . . . . : 192.168.0.1
   NetBIOS over Tcpip. . . . . . . . : Disabled</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314818">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						14 Mar 2016, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>I have a configuration quite similar to yours but a few details:</p><ul><li><p>In /etc/network/config, instead of &quot;option ip6addr &#039;2001:470:1f16:174::2/64&#039;&quot; I have &quot;option ip6addr &#039;2001:470:1f16:174::2&#039;&quot;.</p></li><li><p>In &quot;/etc/network/dhcp&quot;, I do not have the following lines for the &quot;lan&quot; interface:<br />&nbsp; &nbsp; &nbsp; &nbsp; option ra_management &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ra_default &#039;1&#039;</p></li><li><p>I do not have a &quot;wan6&quot; section in &quot;/etc/network/dhcp&quot;.</p></li></ul>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314824">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						15 Mar 2016, 00:13					</div>
				</div>
				<div class="post-content content">
					<p>Having made the above changes, I&#039;m still not getting anything.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314874">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						15 Mar 2016, 09:06					</div>
				</div>
				<div class="post-content content">
					<p>Do you have other clients to test?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314899">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						15 Mar 2016, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve had for years similar config that uses he.net as tunnel broker. On many devices and many ISPs and it always worked fine.</p><p>Just a few moments :</p><p>You dont need dhcp6 service if you dont need prefix delegation inside your local network. Disable it. This is all what needed :</p><div class="codebox"><pre><code>config dhcp &#039;lan&#039;
 option interface &#039;lan&#039;
 option ra &#039;server&#039;
 option ra_maxinterval &#039;30&#039;

config dhcp &#039;wan&#039;
 option interface &#039;wan&#039;
 option ignore &#039;1&#039;</code></pre></div><p>Ensure odhcpd process is started and running. Restart it for sure : /etc/init.d/odhcpd restart. Ensure its in autostart : /etc/init.d/odhcpd enable<br />Run &quot;ifstatus lan&quot; to see if you have anything in&nbsp; &quot;ipv6-prefix-assignment&quot;. This is what odhcpd uses to broadcast RAs.<br />Run wireshark on PC with filter &quot;icmpv6&quot;. Look for RAs from the router. Look inside RAs , check if it contain valid prefix and route, router lifetime is not zero, route and prefix lifetime are also not zero.</p><p>Dont know what &quot;option maindhcp &#039;0&#039;&quot; means but its not required and may have negative effect.</p><p>If you see valid RAs in wireshark but PC does not assign ipv6 address then problem is on the PC side. Assuming PC run windows, run &quot;netsh int ipv6 show int&quot; and find interface id, then run &quot;&quot;netsh int ipv6 show int &lt;interface_id&gt;&quot;.&nbsp; Check if router discovery is enabled. If nothing helps - delete network adapter and let the system redetect it. This will wipe settings to default.</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 15 Mar 2016, 12:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314906">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						15 Mar 2016, 12:02					</div>
				</div>
				<div class="post-content content">
					<p>Like bolvan said, the trouble may be with odhcpd. I think that it does not always restart after a network config change, so it may use a stale config unless you restart it or reboot the router.<br /></p><div class="quotebox"><cite>bolvan wrote:</cite><blockquote><p>This is all what needed :<br /></p><div class="codebox"><pre><code>config dhcp &#039;lan&#039;
...
 option ignore &#039;1&#039;</code></pre></div><p>Ensure odhcpd process is started and running. Restart it for sure : /etc/init.d/odhcpd restart. Ensure its in autostart : /etc/init.d/odhcpd enable</p></blockquote></div><p>I agree with bolvan&#039;s advice otherwise, but disabling also ipv4 dhcp on LAN looks strange... Most users depend on the router to provide ipv4 dhcp service. (unless you are trying to provide an ipv6-only LAN environment.)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 15 Mar 2016, 12:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314914">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						15 Mar 2016, 12:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>but disabling also ipv4 dhcp on LAN looks strange... Most users depend on the router to provide ipv4 dhcp service.</p></blockquote></div><p>Yes, you&#039;re right. I copypasted from my system with non-standard configuration. Of course in most cases dhcp must be enabled for lan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315005">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						15 Mar 2016, 21:06					</div>
				</div>
				<div class="post-content content">
					<p>Okay, with those changes (thank-you very much, Bolvan) the PC is getting an ipv6 address:<br /></p><div class="codebox"><pre><code>Ethernet adapter Ethernet:

   Connection-specific DNS Suffix  . : lan
   Description . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   Physical Address. . . . . . . . . : 74-D0-2B-96-1A-8B
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2001:470:1f16:174:747b:52e9:a206:ca3b(Preferred)
   IPv6 Address. . . . . . . . . . . : 2001:470:3074:0:747b:52e9:a206:ca3b(Preferred)
   IPv6 Address. . . . . . . . . . . : fd56:da3:9c31:0:747b:52e9:a206:ca3b(Preferred)
   Temporary IPv6 Address. . . . . . : 2001:470:1f16:174:45c6:a6b6:6662:dd32(Preferred)
   Temporary IPv6 Address. . . . . . : 2001:470:3074:0:45c6:a6b6:6662:dd32(Preferred)
   Temporary IPv6 Address. . . . . . : fd56:da3:9c31:0:45c6:a6b6:6662:dd32(Preferred)
   Link-local IPv6 Address . . . . . : fe80::747b:52e9:a206:ca3b%13(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.0.10(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained. . . . . . . . . . : March 8, 2016 4:05:49 PM
   Lease Expires . . . . . . . . . . : March 15, 2016 8:18:35 PM
   Default Gateway . . . . . . . . . : fe80::c6e9:84ff:fe05:4110%13
                                       192.168.0.1
   DHCP Server . . . . . . . . . . . : 192.168.0.1
   DHCPv6 IAID . . . . . . . . . . . : 57987115
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-1A-F9-7C-41-74-D0-2B-96-1A-8B
   DNS Servers . . . . . . . . . . . : 192.168.0.1
   NetBIOS over Tcpip. . . . . . . . : Disabled</code></pre></div><p>For the record, so anyone else with this issue can fix it as I did, my config files look like this:<br /></p><div class="codebox"><pre><code>root@Router:~# cat /etc/config/dhcp

config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        option filterwin2k &#039;1&#039;
        option nonegcache &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option ra &#039;server&#039;
        option ra_maxinterval &#039;30&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config host
        option name &#039;Anaerin-PC&#039;
        option mac &#039;74:d0:2b:96:1a:8b&#039;
        option ip &#039;192.168.0.10&#039;

root@Router:~# cat /etc/config/network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.0.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;
        option delegate &#039;0&#039;

config interface &#039;wan6&#039;
        option _orig_ifname &#039;eth1&#039;
        option _orig_bridge &#039;false&#039;
        option proto &#039;6in4&#039;
        option peeraddr &#039;184.105.255.26&#039;
        option ip6addr &#039;2001:470:1f16:174::2&#039;
        option ip6prefix &#039;2001:470:3074::/48&#039;
        option tunnelid &#039;325727&#039;
        option username &#039;&lt;REMOVED&gt;&#039;
        option updatekey &#039;&lt;REMOVED&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd56:0da3:9c31::/48&#039;

root@Router:~# ifstatus lan
{
        &quot;up&quot;: true,
        &quot;pending&quot;: false,
        &quot;available&quot;: true,
        &quot;autostart&quot;: true,
        &quot;dynamic&quot;: false,
        &quot;uptime&quot;: 134117,
        &quot;l3_device&quot;: &quot;br-lan&quot;,
        &quot;proto&quot;: &quot;static&quot;,
        &quot;device&quot;: &quot;br-lan&quot;,
        &quot;updated&quot;: [
                &quot;addresses&quot;
        ],
        &quot;metric&quot;: 0,
        &quot;delegation&quot;: true,
        &quot;ipv4-address&quot;: [
                {
                        &quot;address&quot;: &quot;192.168.0.1&quot;,
                        &quot;mask&quot;: 24
                }
        ],
        &quot;ipv6-address&quot;: [

        ],
        &quot;ipv6-prefix&quot;: [

        ],
        &quot;ipv6-prefix-assignment&quot;: [
                {
                        &quot;address&quot;: &quot;2001:470:3074::&quot;,
                        &quot;mask&quot;: 60
                },
                {
                        &quot;address&quot;: &quot;fd56:da3:9c31::&quot;,
                        &quot;mask&quot;: 60
                }
        ],
        &quot;route&quot;: [

        ],
        &quot;dns-server&quot;: [

        ],
        &quot;dns-search&quot;: [

        ],
        &quot;inactive&quot;: {
                &quot;ipv4-address&quot;: [

                ],
                &quot;ipv6-address&quot;: [

                ],
                &quot;route&quot;: [

                ],
                &quot;dns-server&quot;: [

                ],
                &quot;dns-search&quot;: [

                ]
        },
        &quot;data&quot;: {

        }
}</code></pre></div><p>Unfortunately, however, packets are still not being routed properly.<br />The router can see the IPv6 net just fine:<br /></p><div class="codebox"><pre><code>root@Router:~# ping6 www.google.com
PING www.google.com(den03s10-in-x04.1e100.net) 56 data bytes
64 bytes from den03s10-in-x04.1e100.net: icmp_seq=1 ttl=52 time=119 ms
64 bytes from den03s10-in-x04.1e100.net: icmp_seq=2 ttl=52 time=119 ms

--- www.google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 119.429/119.440/119.451/0.011 ms
root@Router:~# traceroute6 www.google.com
traceroute to www.google.com (2607:f8b0:400f:803::2004) from 2001:470:1f16:174::2, 30 hops max, 24 byte packets
 1  anaerin-1.tunnel.tserv1.ywg1.ipv6.he.net (2001:470:1f16:174::1)  84.236 ms  84.188 ms  84.317 ms
 2  ge2-20.core1.ywg1.he.net (2001:470:0:2b8::1)  94.671 ms  85.877 ms  84.449 ms
 3  10ge1-6.core1.msp1.he.net (2001:470:0:2dd::1)  93.965 ms  92.055 ms  100.091 ms
 4  100ge7-1.core1.chi1.he.net (2001:470:0:18e::1)  106.129 ms  99.882 ms  101.028 ms
 5  eqixchi-v6.google.com (2001:504:0:4:0:1:5169:1)  99.165 ms  99.083 ms  99.207 ms
 6  2001:4860::1:0:84b4 (2001:4860::1:0:84b4)  101.851 ms  98.908 ms  103.847 ms
 7  2001:4860::8:0:9150 (2001:4860::8:0:9150)  120.949 ms  119.534 ms  121.633 ms
 8  2001:4860::8:0:b0e2 (2001:4860::8:0:b0e2)  119.882 ms  119.028 ms  119.507 ms
 9  2001:4860::8:0:79e5 (2001:4860::8:0:79e5)  119.233 ms  118.469 ms  119.605 ms
10  2001:4860::1:0:8831 (2001:4860::1:0:8831)  118.652 ms  120.388 ms  119.504 ms
11  2001:4860:0:1::1221 (2001:4860:0:1::1221)  119.565 ms  119.539 ms  118.705 ms
12  den03s10-in-x04.1e100.net (2607:f8b0:400f:803::2004)  119.52 ms  119.506 ms  119.526 ms</code></pre></div><p>The PC, however, is a different story:<br /></p><div class="codebox"><pre><code>C:\WINDOWS\system32&gt;tracert -6 www.google.com

Tracing route to www.google.com [2607:f8b0:400f:803::2004]
over a maximum of 30 hops:

  1  Destination net unreachable.

Trace complete.</code></pre></div><p>.<br />According to wireshark, the reason reported by ICMP is &quot;Source Address failed ingress/egress policy&quot;, which sounds like routing or firewall is blocking packets.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315008">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						15 Mar 2016, 21:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>The following seems like an obvious suggestion so you may have already tried it.&nbsp; Your traffic does seem to be firewalled:</p><p><a href="https://psg.com/lists/shim6/msg01959.html">https://psg.com/lists/shim6/msg01959.html</a></p><p>I&#039;m <span class="bbu">not</span> a Windows built-in firewall expert and it causes me problems from time to time when helping clients.&nbsp; This looks like it may be helpful:</p><p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366142(v=vs.85).aspx">https://msdn.microsoft.com/en-us/librar â€¦ s.85).aspx</a></p><p>Maybe it&#039;s possible to disable the firewall just for testing, then do a search to figure out how to allow outbound IPv6 traffic of various protocols.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315010">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						15 Mar 2016, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>You might be missing some firewall related things:<br />1) You have not added the tunnel interface (wan6 in your case, henet in my example) to the wan zone in firewall.<br />2) Firewall rules are missing the default icmpv6 rules. They could be missing if you have an ancient network config.<br />3) You have not enabled 6in4 traffic = proto41 to pass through the ipv4 firewall to be processed at the ipv6 firewall.</p><p>I am normally using full native ipv6, but I disabled it for testing and activated my he.net tunnel for testing.<br />My Windows PC gets a quite normally usable he.net 6in4 tunnel with these settings in the router.<br />After setting all config files, I rebooted the router, which forces Windows to clear its network stack (at least with wired connection), so that it refreshes the network and fetched new addresses via dhcp &amp; ra.<br />(my example is from Openwrt trunk, but CC15.05 should have quite identical config)</p><p>Note: my example uses &quot;henet&quot; as the name for the tunnel interface, not wan6.</p><p>/etc/config/network<br />- define router&#039;s tunnel address, routed prefix, and local endpoint<br />- add/check ip6assign option to lan<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ipaddr &#039;192.168.1.1&#039;
...
        option ip6assign &#039;60&#039;

config interface &#039;henet&#039;
        option proto &#039;6in4&#039;
        option mtu &#039;1424&#039;
        option peeraddr &#039;216.66.80.90&#039;
        option ip6addr &#039;2001:3333:27:4444::2/64&#039;
        option ip6prefix &#039;2001:3333:28:4444::/64&#039;
        option tunnelid &#039;1xxxxx&#039;
        option username &#039;xxxxxxxxxxx&#039;
        option password &#039;yyyyyyyyyyy&#039;</code></pre></div><p>/etc/config/dhcp<br />- set lan dhcpv6/ra mode to &#039;server&#039;<br />- exclude henet interface from ipv4 dhcp allocation<br />- check that the default odhcpd parameters are there</p><div class="codebox"><pre><code>config &#039;dhcp&#039; &#039;lan&#039;
        option &#039;interface&#039; &#039;lan&#039;
...
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;

config &#039;dhcp&#039;
        option &#039;ignore&#039; &#039;1&#039;
        option &#039;interface&#039; &#039;henet&#039;
        option &#039;dynamicdhcp&#039; &#039;0&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</code></pre></div><p>/etc/config/firewall<br />- add henet interface to wan zone, and<br />- add a IPv4 rule to accept protocol 41 (= 6in4 encapsulation) from the local Henet tunnel endpoint (my ISP&#039;s endpoint below)<br />- check that the default icmpv6 rules are present </p><div class="codebox"><pre><code>config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        list &#039;network&#039; &#039;wan&#039;
        list &#039;network&#039; &#039;henet&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;masq&#039; &#039;1&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;


config rule
        option target &#039;ACCEPT&#039;
        option name &#039;HEnet IPv6&#039;
        option src &#039;wan&#039;
        option src_ip &#039;216.66.80.90&#039;
        option proto &#039;41&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-ICMPv6-Input&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        list &#039;icmp_type&#039; &#039;echo-request&#039;
        list &#039;icmp_type&#039; &#039;echo-reply&#039;
        list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
        list &#039;icmp_type&#039; &#039;packet-too-big&#039;
        list &#039;icmp_type&#039; &#039;time-exceeded&#039;
        list &#039;icmp_type&#039; &#039;bad-header&#039;
        list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
        list &#039;icmp_type&#039; &#039;router-solicitation&#039;
        list &#039;icmp_type&#039; &#039;neighbour-solicitation&#039;
        list &#039;icmp_type&#039; &#039;router-advertisement&#039;
        list &#039;icmp_type&#039; &#039;neighbour-advertisement&#039;
        option &#039;limit&#039; &#039;1000/sec&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-ICMPv6-Forward&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;dest&#039; &#039;*&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        list &#039;icmp_type&#039; &#039;echo-request&#039;
        list &#039;icmp_type&#039; &#039;echo-reply&#039;
        list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
        list &#039;icmp_type&#039; &#039;packet-too-big&#039;
        list &#039;icmp_type&#039; &#039;time-exceeded&#039;
        list &#039;icmp_type&#039; &#039;bad-header&#039;
        list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
        option &#039;limit&#039; &#039;1000/sec&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 15 Mar 2016, 22:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315018">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						15 Mar 2016, 23:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>You might be missing some firewall related things:<br />1) You have not added the tunnel interface (wan6 in your case, henet in my example) to the wan zone in firewall.</p></blockquote></div><p>Nope, it&#039;s in there.<br /></p><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>2) Firewall rules are missing the default icmpv6 rules. They could be missing if you have an ancient network config.</p></blockquote></div><p>Nope, they&#039;re in there too.<br /></p><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>3) You have not enabled 6in4 traffic = proto41 to pass through the ipv4 firewall to be processed at the ipv6 firewall.</p></blockquote></div><p>That is quite possible - I don&#039;t see those listed in the firewall config. But as it stands the router can already talk to the IPv6 internet on the IPv6 interface, so that means the 6in4 traffic is getting where it needs to. If I was using 6in4 on a client inside the firewall, I would understand this needing to be tunneled.</p><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>- check that the default odhcpd parameters are there</p></blockquote></div><p>These were missing, but odhcpd is now handing out addresses correctly, so I&#039;m leaving them untouched.</p><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>/etc/config/firewall<br />- add a IPv4 rule to accept protocol 41 (= 6in4 encapsulation) from the local Henet tunnel endpoint (my ISP&#039;s endpoint below)<br /></p><div class="codebox"><pre><code>config rule
        option target &#039;ACCEPT&#039;
        option name &#039;HEnet IPv6&#039;
        option src &#039;wan&#039;
        option src_ip &#039;216.66.80.90&#039;
        option proto &#039;41&#039;</code></pre></div></blockquote></div><p>This part is missing, but as mentioned, I don&#039;t think this is necessary. For reference, my firewall config looks like this:<br /></p><div class="codebox"><pre><code>root@Router:~# cat /etc/config/firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;

config zone
        option name &#039;lan&#039;
        list network &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;wan&#039;
        list network &#039;wan&#039;
        list network &#039;wan6&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;wan&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-IGMP&#039;
        option src &#039;wan&#039;
        option proto &#039;igmp&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fe80::/10&#039;
        option src_port &#039;547&#039;
        option dest_ip &#039;fe80::/10&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-MLD&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option src_ip &#039;fe80::/10&#039;
        list icmp_type &#039;130/0&#039;
        list icmp_type &#039;131/0&#039;
        list icmp_type &#039;132/0&#039;
        list icmp_type &#039;143/0&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;esp&#039;
        option target &#039;ACCEPT&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option dest_port &#039;500&#039;
        option proto &#039;udp&#039;
        option target &#039;ACCEPT&#039;

config include &#039;miniupnpd&#039;
        option type &#039;script&#039;
        option path &#039;/usr/share/miniupnpd/firewall.include&#039;
        option family &#039;any&#039;
        option reload &#039;1&#039;</code></pre></div><p>I&#039;m not sure what the rule for udp:500 is (it was in there by default so I&#039;ve not touched it).<br />The icmp6 packet I&#039;m getting back from the router reads:<br /></p><div class="codebox"><pre><code>Frame 2: 174 bytes on wire (1392 bits), 174 bytes captured (1392 bits) on interface 0
Ethernet II, Src: Tp-LinkT_05:41:10 (c4:e9:84:05:41:10), Dst: AsustekC_96:1a:8b (74:d0:2b:96:1a:8b)
Internet Protocol Version 6, Src: 2001:470:1f16:174::2, Dst: 2001:470:1f16:174:45c6:a6b6:6662:dd32
Internet Control Message Protocol v6
    Type: Destination Unreachable (1)
    Code: 5 (Source address failed ingress/egress policy)
    Checksum: 0xaa76 [correct]
    Reserved: 00000000
    Internet Protocol Version 6, Src: 2001:470:1f16:174:45c6:a6b6:6662:dd32, Dst: 2607:f8b0:400f:803::2004
        0110 .... = Version: 6
        .... 0000 0000 .... .... .... .... .... = Traffic class: 0x00 (DSCP: CS0, ECN: Not-ECT)
        .... .... .... 0000 0000 0000 0000 0000 = Flowlabel: 0x00000000
        Payload length: 72
        Next header: ICMPv6 (58)
        Hop limit: 1
        Source: 2001:470:1f16:174:45c6:a6b6:6662:dd32
        Destination: 2607:f8b0:400f:803::2004
        [Source GeoIP: Unknown]
        [Destination GeoIP: Unknown]
    Internet Control Message Protocol v6
        Type: Echo (ping) request (128)
        Code: 0
        Checksum: 0x8391 [in ICMP error packet]
        Identifier: 0x0001
        Sequence: 15
        Data (64 bytes)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315026">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 00:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Anaerin wrote:</cite><blockquote><div class="codebox"><pre><code>Ethernet II, Src: Tp-LinkT_05:41:10 (c4:e9:84:05:41:10), Dst: AsustekC_96:1a:8b (74:d0:2b:96:1a:8b)
Internet Protocol Version 6, Src: 2001:470:1f16:174::2, Dst: 2001:470:1f16:174:45c6:a6b6:6662:dd32</code></pre></div></blockquote></div><p>I&#039;m not sure I understand these addresses.&nbsp; You&#039;re running OpenWRT on an x86 router, right?&nbsp; Is this a TP-Link-branded router?&nbsp; That&#039;s the source in this ICMPv6 error.&nbsp; Then I guess the destination is an Asus workstation or laptop?&nbsp; If so, I believe this means it&#039;s the OpenWRT router&#039;s firewall that is blocking the IPv6 traffic.</p><p>I see you have addresses assigned to your Windows client from both assigned subnets:</p><p>Temporary IPv6 Address. . . . . . : 2001:470:1f16:174:45c6:a6b6:6662:dd32(Preferred)<br />Temporary IPv6 Address. . . . . . : 2001:470:3074:0:45c6:a6b6:6662:dd32(Preferred)</p><p>I&#039;m not sure this is *wrong* but my on-site he.net IPv6 links are configured differently.&nbsp; I use the assigned /64 subnet for the LAN side of the gateway router (connected to the ISP) but don&#039;t use my assigned /48 on that link at all.&nbsp; I assign subnets from the /48 to the downstream side of internal non-gateway routers.&nbsp; This probably doesn&#039;t matter but I thought I&#039;d mention it.</p><p>Clemmitt</p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 16 Mar 2016, 00:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315029">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						16 Mar 2016, 00:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cmsigler wrote:</cite><blockquote><div class="quotebox"><cite>Anaerin wrote:</cite><blockquote><div class="codebox"><pre><code>Ethernet II, Src: Tp-LinkT_05:41:10 (c4:e9:84:05:41:10), Dst: AsustekC_96:1a:8b (74:d0:2b:96:1a:8b)
Internet Protocol Version 6, Src: 2001:470:1f16:174::2, Dst: 2001:470:1f16:174:45c6:a6b6:6662:dd32</code></pre></div></blockquote></div><p>I&#039;m not sure I understand these addresses.&nbsp; You&#039;re running OpenWRT on an x86 router, right?&nbsp; Is this a TP-Link-branded router?</p></blockquote></div><p>It&#039;s a TP-Link branded GBe ethernet card in a former desktop PC (The on-board NIC of that PC is the WAN link). </p><div class="quotebox"><cite>cmsigler wrote:</cite><blockquote><p>That&#039;s the source in this ICMPv6 error.&nbsp; Then I guess the destination is an Asus workstation or laptop?&nbsp; If so, I believe this means it&#039;s the OpenWRT router&#039;s firewall that is blocking the IPv6 traffic.</p></blockquote></div><p>Right, the client is an on-board NIC on an ASUS motherboard. So this means the packets are getting to the router and being bounced, rather than bouncing internally.<br /></p><div class="quotebox"><cite>cmsigler wrote:</cite><blockquote><p>I see you have addresses assigned to your Windows client from both assigned subnets:</p><p>Temporary IPv6 Address. . . . . . : 2001:470:1f16:174:45c6:a6b6:6662:dd32(Preferred)<br />Temporary IPv6 Address. . . . . . : 2001:470:3074:0:45c6:a6b6:6662:dd32(Preferred)</p><p>I&#039;m not sure this is *wrong* but my on-site he.net IPv6 links are configured differently.&nbsp; I use the assigned /64 subnet for the LAN side of the gateway router (to ISP) but don&#039;t use my assigned /48 on that link at all.&nbsp; I assign subnets from the /48 to the downstream side of internal non-gateway routers.&nbsp; This probably doesn&#039;t matter but I thought I&#039;d mention it.</p></blockquote></div><p>I am using (or trying to use) the /48 I&#039;ve got allocated for clients, ideally with the /64 used for publicly internet-facing services (for example, a web server or similar). Ideally, I would like only addresses from the /48 used for LAN clients.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315033">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 01:39					</div>
				</div>
				<div class="post-content content">
					<p>I myself don&#039;t see any obvious problems but I&#039;m still fairly new to the UCI firewall.&nbsp; I&#039;m more acquainted with good old ip6tables.&nbsp; Have you done &#039;ip6tables -nvL --line-numbers&#039; to see the raw rules (although complex)?&nbsp; Maybe look at packet counters to see which rules are blocking things?&nbsp; Also -- which you already know -- you could insert &#039;-j LOG&#039; ip6tables rules once you understand the chains/rule numbers to debug.&nbsp; Wish I saw something obvious.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315035">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						16 Mar 2016, 01:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cmsigler wrote:</cite><blockquote><p>Have you done &#039;ip6tables -nvL --line-numbers&#039; to see the raw rules (although complex)?&nbsp; Maybe look at packet counters to see which rules are blocking things?</p></blockquote></div><p>I have no idea how to read this, but here&#039;s the output of the command you specified:<br /></p><div class="codebox"><pre><code>root@Router:~# ip6tables -nvL --line-numbers
Chain INPUT (policy ACCEPT 7 packets, 1214 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1    23090 3138K delegate_input  all      *      *       ::/0                 ::/0

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 delegate_forward  all      *      *       ::/0                 ::/0

Chain OUTPUT (policy ACCEPT 8 packets, 1290 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1     234K  140M delegate_output  all      *      *       ::/0                 ::/0

Chain MINIUPNPD (2 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain delegate_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 forwarding_rule  all      *      *       ::/0                 ::/0                 /* user chain for forwarding */
2        0     0 ACCEPT     all      *      *       ::/0                 ::/0                 ctstate RELATED,ESTABLISHED
3        0     0 zone_lan_forward  all      br-lan *       ::/0                 ::/0
4        0     0 zone_wan_forward  all      eth1   *       ::/0                 ::/0
5        0     0 zone_wan_forward  all      6in4-wan6 *       ::/0                 ::/0
6        0     0 reject     all      *      *       ::/0                 ::/0

Chain delegate_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        3   456 ACCEPT     all      lo     *       ::/0                 ::/0
2    23087 3137K input_rule  all      *      *       ::/0                 ::/0                 /* user chain for input */
3    20719 2749K ACCEPT     all      *      *       ::/0                 ::/0                 ctstate RELATED,ESTABLISHED
4      509 39536 syn_flood  tcp      *      *       ::/0                 ::/0                 tcp flags:0x17/0x02
5     1684  333K zone_lan_input  all      br-lan *       ::/0                 ::/0
6        7  1560 zone_wan_input  all      eth1   *       ::/0                 ::/0
7      670 52487 zone_wan_input  all      6in4-wan6 *       ::/0                 ::/0

Chain delegate_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        3   456 ACCEPT     all      *      lo      ::/0                 ::/0
2     234K  140M output_rule  all      *      *       ::/0                 ::/0                 /* user chain for output */
3    22007   38M ACCEPT     all      *      *       ::/0                 ::/0                 ctstate RELATED,ESTABLISHED
4     212K  102M zone_lan_output  all      *      br-lan  ::/0                 ::/0
5        8  1636 zone_wan_output  all      *      eth1    ::/0                 ::/0
6      411 34120 zone_wan_output  all      *      6in4-wan6  ::/0                 ::/0

Chain forwarding_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain forwarding_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain forwarding_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain reject (5 references)
num   pkts bytes target     prot opt in     out     source               destination
1      509 39536 REJECT     tcp      *      *       ::/0                 ::/0                 reject-with tcp-reset
2      167 14407 REJECT     all      *      *       ::/0                 ::/0                 reject-with icmp6-port-unreachable

Chain syn_flood (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1      509 39536 RETURN     tcp      *      *       ::/0                 ::/0                 tcp flags:0x17/0x02 limit: avg 25/sec burst 50
2        0     0 DROP       all      *      *       ::/0                 ::/0

Chain zone_lan_dest_ACCEPT (4 references)
num   pkts bytes target     prot opt in     out     source               destination
1     212K  102M ACCEPT     all      *      br-lan  ::/0                 ::/0

Chain zone_lan_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 forwarding_lan_rule  all      *      *       ::/0                 ::/0                 /* user chain for forwarding */
2        0     0 zone_wan_dest_ACCEPT  all      *      *       ::/0                 ::/0                 /* forwarding lan -&gt; wan */
3        0     0 zone_lan_dest_ACCEPT  all      *      *       ::/0                 ::/0

Chain zone_lan_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     1684  333K input_lan_rule  all      *      *       ::/0                 ::/0                 /* user chain for input */
2     1684  333K zone_lan_src_ACCEPT  all      *      *       ::/0                 ::/0

Chain zone_lan_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     212K  102M output_lan_rule  all      *      *       ::/0                 ::/0                 /* user chain for output */
2     212K  102M zone_lan_dest_ACCEPT  all      *      *       ::/0                 ::/0

Chain zone_lan_src_ACCEPT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     1684  333K ACCEPT     all      br-lan *       ::/0                 ::/0

Chain zone_wan_dest_ACCEPT (2 references)
num   pkts bytes target     prot opt in     out     source               destination
1        8  1636 ACCEPT     all      *      eth1    ::/0                 ::/0
2      411 34120 ACCEPT     all      *      6in4-wan6  ::/0                 ::/0

Chain zone_wan_dest_REJECT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 reject     all      *      eth1    ::/0                 ::/0
2        0     0 reject     all      *      6in4-wan6  ::/0                 ::/0

Chain zone_wan_forward (2 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 MINIUPNPD  all      *      *       ::/0                 ::/0
2        0     0 MINIUPNPD  all      *      *       ::/0                 ::/0
3        0     0 forwarding_wan_rule  all      *      *       ::/0                 ::/0                 /* user chain for forwarding */
4        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 128 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
5        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 129 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
6        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 1 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
7        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 2 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
8        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 3 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
9        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 4 code 0 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
10       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 4 code 1 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Forward */
11       0     0 zone_lan_dest_ACCEPT  esp      *      *       ::/0                 ::/0                 /* @rule[7] */
12       0     0 zone_lan_dest_ACCEPT  udp      *      *       ::/0                 ::/0                 udp dpt:500 /* @rule[8] */
13       0     0 zone_wan_dest_REJECT  all      *      *       ::/0                 ::/0

Chain zone_wan_input (2 references)
num   pkts bytes target     prot opt in     out     source               destination
1      677 54047 input_wan_rule  all      *      *       ::/0                 ::/0                 /* user chain for input */
2        0     0 ACCEPT     udp      *      *       fe80::/10            fe80::/10            udp spt:547 dpt:546 /* Allow-DHCPv6 */
3        0     0 ACCEPT     icmpv6    *      *       fe80::/10            ::/0                 ipv6-icmptype 130 code 0 /* Allow-MLD */
4        0     0 ACCEPT     icmpv6    *      *       fe80::/10            ::/0                 ipv6-icmptype 131 code 0 /* Allow-MLD */
5        0     0 ACCEPT     icmpv6    *      *       fe80::/10            ::/0                 ipv6-icmptype 132 code 0 /* Allow-MLD */
6        0     0 ACCEPT     icmpv6    *      *       fe80::/10            ::/0                 ipv6-icmptype 143 code 0 /* Allow-MLD */
7        1   104 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 128 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
8        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 129 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
9        0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 1 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
10       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 2 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
11       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 3 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
12       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 4 code 0 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
13       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 4 code 1 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
14       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 133 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
15       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 135 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
16       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 134 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
17       0     0 ACCEPT     icmpv6    *      *       ::/0                 ::/0                 ipv6-icmptype 136 limit: avg 1000/sec burst 5 /* Allow-ICMPv6-Input */
18     676 53943 zone_wan_src_REJECT  all      *      *       ::/0                 ::/0

Chain zone_wan_output (2 references)
num   pkts bytes target     prot opt in     out     source               destination
1      419 35756 output_wan_rule  all      *      *       ::/0                 ::/0                 /* user chain for output */
2      419 35756 zone_wan_dest_ACCEPT  all      *      *       ::/0                 ::/0

Chain zone_wan_src_REJECT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        7  1560 reject     all      eth1   *       ::/0                 ::/0
2      669 52383 reject     all      6in4-wan6 *       ::/0                 ::/0</code></pre></div><p>Does that help any? I&#039;ve not touched this at all, so this is all chaos calmer OOTB settings.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315038">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 02:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br /></p><div class="quotebox"><cite>Anaerin wrote:</cite><blockquote><p>Does that help any?</p></blockquote></div><p>OpenWRT has a well designed firewall system.&nbsp; Therefore, it&#039;s impossible for me to grok <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>If you&#039;re willing to go further, try this.</p><p>1.) Make sure the firewall is &quot;quiet&quot; for IPv6 traffic (not used by others so unrelated traffic won&#039;t get mixed in).<br />2.) Run this command and save the output to a temporary text file.<br />3.) Do some IPv6 pings or HTTP connects to IPv6-only websites (ipv6.google.com) which the firewall blocks.<br />4.) Run the command again and save the output to a second text file.<br />5.) Use a diff tool or text editor windows to compare the outputs.<br />6.) Look for changes in the counter columns (pkts and bytes).<br />7.) This will show you which &quot;REJECT&quot; or &quot;DROP&quot; rule(s) is blocking your traffic.</p><p>It might be confusing because so many of these rules jump (chain) from one chain to another and then back.&nbsp; It hurts my brain <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />&nbsp; Again, my supposition is that there&#039;s a stray IPv6 firewall rule blocking stuff that shouldn&#039;t be there.&nbsp; HTH.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315040">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						16 Mar 2016, 02:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi There,</p><p>There&#039;s a couple of things which may be right, but look wrong. </p><p>1) You use of addressing. End station networks (where you windows machine is) should always be a /64. Trying to make it otherwise will cause you nothing but problems. With an HE tunnel, you should have a network diagram something like this:</p><p>WAN--------------------&gt; router ----------------&gt;LAN<br />2001:db8:1:1::2/64&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2001:db8:1:2::2/64</p><p>When using static provisioning from HE, you have to decide which /64 of the /48 they gave you to use for your LAN.</p><p>2) Thanks for the ip6tables&nbsp; output. It takes a bit to wrap your head around ip6tables. What concerns me is that Zero packets are being forwarded at all:<br /></p><div class="codebox"><pre><code>Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 delegate_forward  all      *      *       ::/0                 ::/0</code></pre></div><p>When I look at my Buffalo router you can see it is forwarding lots of packets<br /></p><div class="codebox"><pre><code>Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1     891K  654M delegate_forward  all      *      *       ::/0                 ::/0    </code></pre></div><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p>Perhaps you provided this already, but can you show your routing table on the router? using &#039;ip -6 route&#039;</p><p>The lack of forwarding could be the /48 issue, or it could be a routing table issue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315041">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 02:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cvmiller wrote:</cite><blockquote><p>1) You use of addressing. End station networks (where you windows machine is) should always be a /64.</p><p>2) What concerns me is that Zero packets are being forwarded at all:</p><p>Perhaps you provided this already, but can you show your routing table on the router? using &#039;ip -6 route&#039;</p><p>The lack of forwarding could be the /48 issue, or it could be a routing table issue.</p></blockquote></div><p>Ditto! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />&nbsp; TIA.</p><p>Clemmitt</p><p>P.S.: Yeah, I&#039;m starting to convince myself the problem is this:</p><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;wan6&#039;
        ...
        option ip6prefix &#039;2001:470:3074::/48&#039;</code></pre></div><p>which is OK but you&#039;re missing this:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        ...
        option ip6hint 0</code></pre></div><p>so the LAN link subnet isn&#039;t a /64 but is instead both a /64 <span class="bbu">and</span> a /48.&nbsp; The firewall probably isn&#039;t configured to pass traffic with such an address scheme.&nbsp; HTH.</p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 16 Mar 2016, 03:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315044">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Anaerin</div>
					<div class="post-datetime">
						16 Mar 2016, 03:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cvmiller wrote:</cite><blockquote><p>Perhaps you provided this already, but can you show your routing table on the router? using &#039;ip -6 route&#039;</p><p>The lack of forwarding could be the /48 issue, or it could be a routing table issue.</p></blockquote></div><p>So far, that&#039;s something that hasn&#039;t been asked for. So here you go:<br /></p><div class="codebox"><pre><code>root@Router:~# ip -6 route
default from 2001:470:1f16:174::2 dev 6in4-wan6  proto static  metric 1024
default from 2001:470:3074::/48 dev 6in4-wan6  proto static  metric 1024
2001:470:1f16:174::2 dev 6in4-wan6  proto kernel  metric 256
2001:470:1f16:174::/64 dev br-lan  proto kernel  metric 256
2001:470:3074::1 dev br-lan  proto static  metric 1024
2001:470:3074::/64 dev br-lan  proto static  metric 1024
unreachable 2001:470:3074::/48 dev lo  proto static  metric 2147483647  error -101
fd56:da3:9c31::1 dev br-lan  proto static  metric 1024
fd56:da3:9c31::/64 dev br-lan  proto static  metric 1024
unreachable fd56:da3:9c31::/48 dev lo  proto static  metric 2147483647  error -101
fe80::/64 dev ifb0  proto kernel  metric 256
fe80::/64 dev br-lan  proto kernel  metric 256
fe80::/64 dev eth1  proto kernel  metric 256
fe80::/64 dev 6in4-wan6  proto kernel  metric 256</code></pre></div><p>And as suggested, I&#039;ve added ip6hint 0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315045">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 03:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Anaerin wrote:</cite><blockquote><div class="codebox"><pre><code>root@Router:~# ip -6 route
default from 2001:470:1f16:174::2 dev 6in4-wan6  proto static  metric 1024
default from 2001:470:3074::/48 dev 6in4-wan6  proto static  metric 1024</code></pre></div></blockquote></div><p>These default routes have nowhere to go -- there is no &#039;via fe80::aabb:ccff:fedd:eeff&#039;.&nbsp; So the routing is messed up?&nbsp; Thanks to cvmiller for asking for this info.</p><p>P.S.: Unless this is how the tunnel is supposed to work.&nbsp; Let me check my he.net site tunnel...</p><p>No, &#039;via what:ever::1&#039; doesn&#039;t appear to be needed for a he.net tunnel.&nbsp; Sorry for the noise.</p><p>Have you rebooted the router after applying the last changes you made?&nbsp; Any help?&nbsp; Honestly, I&#039;m much better at hand configuration.&nbsp; UCI is a professional quality system, but confusing if you&#039;re used to the do-it-yourself, Linux-from-Scratch method.</p><p>Clemmitt</p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 16 Mar 2016, 03:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315049">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						16 Mar 2016, 04:41					</div>
				</div>
				<div class="post-content content">
					<p>I also see the same subnet being used on the WAN &amp; LAN sides, so the router will not route.<br /></p><div class="codebox"><pre><code>2001:470:1f16:174::2 dev 6in4-wan6  proto kernel  metric 256
2001:470:1f16:174::/64 dev br-lan  proto kernel  metric 256</code></pre></div><p>A router _must_ have different subnets for it to route. It looks to me that you have 2001:470:1f16:174:: assigned to both 6in4-wan6 AND br-lan. This would explain why no packets are hitting the FORWARD filter in ip6tables.</p><p>I only have a /64 from HE, but looking at similar lines in my routing table:<br /></p><div class="codebox"><pre><code>2001:470:1c:583::/64 dev 6in4-henet  proto static  metric 5000 
2001:470:1d:583::/64 dev br-lan  proto static  metric 1024 </code></pre></div><p>As you can see one is 1c and the other is 1d, therefore they are different prefixes.</p><p>Hope this helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315055">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 05:39					</div>
				</div>
				<div class="post-content content">
					<p>cvmiller is of course right.&nbsp; Thank you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&nbsp; On the tunnelbroker.net website, what are your tunnel values for:</p><p>Server IPv6 Address:<br />Client IPv6 Address:</p><p>Routed /64:<br />Routed /48:</p><p>You might want to change them a bit to protect the innocent IPv6 subnets <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Sorry this is dragging on so.&nbsp; For me, it&#039;s really hard to identify these problems when you&#039;re not sitting in front of the systems in question.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315063">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						16 Mar 2016, 06:26					</div>
				</div>
				<div class="post-content content">
					<p>Clemmitt, </p><p>My head is getting big here with all your complements ;-)</p><p>I agree, it can be difficult to troubleshoot remotely. I think from an ease of support, this is why ISPs have gone with DHCPv6-PD (which OpenWRT supports quite well).</p><p>Craig...</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=63367&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>