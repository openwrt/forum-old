<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Optimizing router for 100Mb connection</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p137221">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ashrack</div>
					<div class="post-datetime">
						15 Jun 2011, 13:27					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>My router has 1 LAN and 2 WLAN clients connected all with heavy P2P traffic going on. I know that with the current router there is no way to fully utilize the connection simply because of lack of CPU power.</p><p>What I would like to do is apply some optimization, I&#039;ve read about conntrack and likes but haven&#039;t had luck of finding much more info on the subject.</p><p>Also would it be possible to set different priority to clients. So LAN has bigger priority than WLAN #1 which has bigger priority than WLAN #2, <br />LAN &gt; WLAN #1 &gt; WLAN #2</p><div class="codebox"><pre><code>net.ipv4.ip_conntrack_max = 16384
net.ipv4.netfilter.ip_conntrack_generic_timeout = 600
net.ipv4.netfilter.ip_conntrack_icmp_timeout = 30
net.ipv4.netfilter.ip_conntrack_udp_timeout_stream = 180
net.ipv4.netfilter.ip_conntrack_udp_timeout = 60
net.ipv4.netfilter.ip_conntrack_tcp_timeout_close = 10
net.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait = 120
net.ipv4.netfilter.ip_conntrack_tcp_timeout_last_ack = 30
net.ipv4.netfilter.ip_conntrack_tcp_timeout_close_wait = 60
net.ipv4.netfilter.ip_conntrack_tcp_timeout_fin_wait = 120
net.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 3600
net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv = 60
net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_sent = 120
net.ipv4.netfilter.ip_conntrack_buckets = 5953
net.ipv4.netfilter.ip_conntrack_max = 16384</code></pre></div><p>ps. Also heard that if one disables NAT and goes to BRIDGE mode that would speed things up since the CPU is much less hogged. <br />How would one do this?</p>											<p class="post-edited">(Last edited by <strong>ashrack</strong> on 15 Jun 2011, 13:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140213">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Alex24</div>
					<div class="post-datetime">
						29 Jul 2011, 05:07					</div>
				</div>
				<div class="post-content content">
					<p>Bump. I would like to know this too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140328">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tului</div>
					<div class="post-datetime">
						31 Jul 2011, 11:52					</div>
				</div>
				<div class="post-content content">
					<p>If you&#039;ve got a 100Mbps WAN connection I&#039;d save up and get an E4200 or one of the other high end routers currently out. A WNDR3700 might handle it too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140345">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						31 Jul 2011, 14:53					</div>
				</div>
				<div class="post-content content">
					<p>ashrack, your posting is merely a hint. It does not contain information.</p><p>1. You can disable conntrack<br />2. there are a couple of buffers involved,&nbsp; which could be optimised, if they are not already at optimum...!<br />3. you can apply packet scheduling to one of the buffers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140347">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						31 Jul 2011, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>Google links to dd-wrt-wiki:&nbsp; a couple of explanations: <a href="http://www.dd-wrt.com/wiki/index.php/Router_Slowdown">http://www.dd-wrt.com/wiki/index.php/Router_Slowdown</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140617">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Alex24</div>
					<div class="post-datetime">
						4 Aug 2011, 20:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>scruffy wrote:</cite><blockquote><p>ashrack, your posting is merely a hint. It does not contain information.</p><p>1. You can disable conntrack</p></blockquote></div><p>How to disable it? The is no documentaton for this...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140676">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">pbix</div>
					<div class="post-datetime">
						5 Aug 2011, 19:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ashrack wrote:</cite><blockquote><p>What I would like to do is apply some optimization, I&#039;ve read about conntrack and likes but haven&#039;t had luck of finding much more info on the subject.</p><p>Also would it be possible to set different priority to clients. So LAN has bigger priority than WLAN #1 which has bigger priority than WLAN #2, <br />LAN &gt; WLAN #1 &gt; WLAN #2</p><p>ps. Also heard that if one disables NAT and goes to BRIDGE mode that would speed things up since the CPU is much less hogged. <br />How would one do this?</p></blockquote></div><p>I am worried that you have some basic misconceptions.&nbsp; You cannot disable conntrack when using NAT because NAT depends on conntrack.&nbsp; Also you cannot &quot;set different priority to clients&quot; if you disable conntrack since QoS classes generally depend on it. </p><p>Using bridge mode would provide some nominal increase in performance but at the expense of your router function.&nbsp; How will you route your traffic without a router (NAT, DNS, DHCP etc).&nbsp; Is there a different router at your disposal that you could utilize?</p><p>Are you sure you can actually get 100Mbps service?&nbsp; You may find that the next link up the chain also has issues with such speeds.&nbsp; Also what evidence do you have that your router is responsible for your current limited throughput?&nbsp; Could an upstream device be the source of your limitation?&nbsp; Just because you have a 100Mbps Ethernet connection does not mean you can get 100Mbps service.</p><p>With OpenWRT in router mode you can assign different priorities to your clients using QoS.&nbsp; The downside is that this will also require more CPU time since you are asking the router to do more work so while your will get control of the situation your top end throughput will go down if you are already CPU bound.</p><p>The developers here have already done their best to &quot;optimize&quot; OpenWRT so it is unlikely that you could make any meaningful gains in performance yourself.&nbsp; The only realistic thing for your to do it get a router that can handle your load.&nbsp; Once you have done that I recommend <a href="http://www.gargoyle-router.com">www.gargoyle-router.com</a> to you.&nbsp; Gargoyle is built on top of OpenWRT but includes a user interface that the average use can manage as well as additional features not found in OpenWRT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140683">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						5 Aug 2011, 20:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pbix wrote:</cite><blockquote><p>Gargoyle is built on top of OpenWRT but includes a user interface that the average use can manage as well as additional features not found in OpenWRT.</p></blockquote></div><p>If its based &quot;on top of OpenWrt&quot;, how can I install it &quot;on top of OpenWrt&quot; right now?</p><p><a href="http://www.gargoyle-router.com/wiki/doku.php?id=install_guide#installing_gargoyle_as_a_set_of_packages">http://www.gargoyle-router.com/wiki/dok … f_packages</a> is for Kamikaze only. Kamikaze is no longer supported. Backfire 10.03 is current. Would it work on attitudeadjustment?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140705">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pbix</div>
					<div class="post-datetime">
						6 Aug 2011, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>The is a post in the Gargoyle forum about this</p><p><a href="http://www.gargoyle-router.com/phpbb/viewtopic.php?f=5&amp;t=1202">http://www.gargoyle-router.com/phpbb/vi … amp;t=1202</a></p><p>However, I have never done this myself since you can also just upload the Gargoyle .bin file through the Luci interface so I cannot vouch for it. </p><p>Gargoyle will not be faster than OpenWRT so what is your plan for your speed issue?&nbsp; Did you find out if you really have a 100mbps interface?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>