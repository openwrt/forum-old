<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Trying to re-install sqm-scripts</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p304655">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 21:41					</div>
				</div>
				<div class="post-content content">
					<p>For some reason sqm-scripts is DISABLED in the system -&gt; startup screen.&nbsp; I click on the DISABLED button, it appears to be enabled, then I refresh the screen, it is disabled again.</p><p>I tried to uninstal the package sqm-scripts (from LUCI) and I am getting this error message:</p><br /><br /><div class="codebox"><pre><code>Removing package sqm-scripts from root...
You can force removal of packages with failed prerm scripts with the option: 
    --force-remove
No packages removed.

/bin/sh: can&#039;t open &#039;/etc/rc.common
&#039;
/bin/sh: can&#039;t open &#039;/etc/rc.common
&#039;
Collected errors:
 * pkg_run_script: package &quot;sqm-scripts&quot; prerm script returned status 2.
 * opkg_remove_pkg: not removing package &quot;sqm-scripts&quot;, prerm script failed</code></pre></div><p>What is the CLI command to remove it, so I can reinstall it?</p><p>BTW, this is a failed command I had given before:<br /></p><div class="codebox"><pre><code>/etc/init.d/sqm start
&#039;bin/sh: can&#039;t open &#039;/etc/rc.common</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304659">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 21:59					</div>
				</div>
				<div class="post-content content">
					<p>File /etc/rc.common exists.&nbsp; The file permissions are 755.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304663">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Dec 2015, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>My best guess is your current sqm scripts install got corrupted. I would recommend to follow the instructions in README.md on <a href="https://github.com/tohojo/sqm-scripts">https://github.com/tohojo/sqm-scripts</a> to manually install the most recent sqm-scripts version (which should work on your system). That is probably faster than trying to figure out why /etc/initd.s/sqm has issues with /etc/rc.common ....</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304664">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>ok, I am installing on top of the existing installation, since I cannot remove the old SQM, correct?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304665">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>I issue this after I connect and login to the router (Openwrt) enviroment, right?</p><div class="codebox"><pre><code># git clone https://github.com/tohojo/sqm-scripts
-ash: git: not found</code></pre></div><p>Is GIT some command/package that I also need to install?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304670">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>ok, I figured it out.&nbsp; I first installed GIT and GIT-HTTP packages.&nbsp; However my free disk space is less than 450 KB now. </p><div class="codebox"><pre><code>root@OpenWrt:~# git clone https://github.com/tohojo/sqm-scripts
Cloning into &#039;sqm-scripts&#039;...
warning: templates not found /usr/share/git-core/templates
remote: Counting objects: 641, done.
remote: Total 641 (delta 0), reused 0 (delta 0), pack-reused 641
Receiving objects: 100% (641/641), 125.77 KiB | 102.00 KiB/s, done.
Resolving deltas: 100% (411/411), done.
Checking connectivity... done.</code></pre></div><p>EDIT: Have you seen the warning?<br />warning: templates not found /usr/share/git-core/templates</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 22 Dec 2015, 22:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304671">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Dec 2015, 22:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I issue this after I connect and login to the router (Openwrt) enviroment, right?</p><div class="codebox"><pre><code># git clone https://github.com/tohojo/sqm-scripts
-ash: git: not found</code></pre></div><p>Is GIT some command/package that I also need to install?</p></blockquote></div><p>Oh sure, and I guess you need to do all of this on one of your ubuntu machines, not the router itself.</p><p>I assume something like:</p><p>sudo apt-get install git</p><p>should work to install git under ubuntu (though I am amazed to hear that it is not installed by default...)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304672">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 22:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Oh sure, and I guess you need to do all of this on one of your ubuntu machines, not the router itself.</p></blockquote></div><br /><p>Ooops!&nbsp; I already messed up and installed GIT on the router.&nbsp; ANd I also issued the GIT command on the router:<br />git clone <a href="https://github.com/tohojo/sqm-scripts">https://github.com/tohojo/sqm-scripts</a></p><p>Should I try to revert all these?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304674">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Dec 2015, 22:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Oh sure, and I guess you need to do all of this on one of your ubuntu machines, not the router itself.</p></blockquote></div><br /><p>Ooops!&nbsp; I already messed up and installed GIT on the router.&nbsp; ANd I also issued the GIT command on the router:<br />git clone <a href="https://github.com/tohojo/sqm-scripts">https://github.com/tohojo/sqm-scripts</a></p><p>Should I try to revert all these?</p></blockquote></div><p>Well, all they will do is eat up space on your router, so unless you have plenty of free space I would delete the folder the clone operation created (on my machine the folder is 3.2 MB so worth removing). That said, I am sure it is possible to do all of this on your router, I just believe it is not worth the hassle and potential risk to fill up the filesystem completely...<br />I guess having git installed will not hurt... but it should be possible to uninstall it with &quot;opkg remove ...&quot;</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304676">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I managed to do steps 0,1,2 on my ubuntu 14.04 pc.&nbsp; Now step #3, don&#039;t laugh.&nbsp; I issued this command EXACTLY as it states:<br /># make install PLATFORM=openwrt DESTDIR=./$your_distribution_directory_here.&nbsp; Here is the result:</p><div class="codebox"><pre><code>$ make install PLATFORM=openwrt DESTDIR=./$your_distribution_directory_here
install -m 0755 -d .//etc/sqm .//usr/lib/sqm
install -m 0644 platform/openwrt/sqm.conf .//etc/sqm/sqm.conf
install -m 0644  src/functions.sh src/defaults.sh \
        src/*.qos src/*.help .//usr/lib/sqm
install -m 0744  src/start-sqm src/stop-sqm src/update-available-qdiscs \
        .//usr/lib/sqm
install -m 0755 -d .//etc/hotplug.d/iface .//etc/config \
        .//etc/init.d
install -m 0755 platform/openwrt/sqm-hotplug .//etc/hotplug.d/iface/11-sqm
install -m 0755 platform/openwrt/sqm-init .//etc/init.d/sqm
install -m 0644 platform/openwrt/sqm-uci .//etc/config/sqm
install -m 0744 src/run-openwrt.sh .//usr/lib/sqm/run.sh</code></pre></div><br /><p>Should I have replaced&nbsp; your_distribution_directory_here with another name?&nbsp; Because the following command gave me nothing:<br /></p><div class="codebox"><pre><code>~/sqm-scripts$ cd ./$your_distribution_directory_here
~/sqm-scripts$</code></pre></div><p>EDIT: I removed GIT and the contents of /root/sqm-scripts from the router.&nbsp; However I cannot remove the actual /root/sqm-scripts directory.&nbsp; I am doing it with FTP Filezilla.</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 22 Dec 2015, 23:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304677">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Dec 2015, 23:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hi</p><p>I managed to do steps 0,1,2 on my ubuntu 14.04 pc.&nbsp; Now step #3, don&#039;t laugh.&nbsp; I issued this command EXACTLY as it states:<br /># make install PLATFORM=openwrt DESTDIR=./$your_distribution_directory_here.&nbsp; Here is the result:</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Ah, sorry, The $-sign is used in shell scripts to signify that you are using an existing variable, in that meta-instruction this was just meant to be a placeholder for whatever directory name you want so try something like:</p><p>make install PLATFORM=openwrt DESTDIR=./121222_sqm</p><p>Note no $<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="codebox"><pre><code>$ make install PLATFORM=openwrt DESTDIR=./$your_distribution_directory_here
install -m 0755 -d .//etc/sqm .//usr/lib/sqm
install -m 0644 platform/openwrt/sqm.conf .//etc/sqm/sqm.conf
install -m 0644  src/functions.sh src/defaults.sh \
        src/*.qos src/*.help .//usr/lib/sqm
install -m 0744  src/start-sqm src/stop-sqm src/update-available-qdiscs \
        .//usr/lib/sqm
install -m 0755 -d .//etc/hotplug.d/iface .//etc/config \
        .//etc/init.d
install -m 0755 platform/openwrt/sqm-hotplug .//etc/hotplug.d/iface/11-sqm
install -m 0755 platform/openwrt/sqm-init .//etc/init.d/sqm
install -m 0644 platform/openwrt/sqm-uci .//etc/config/sqm
install -m 0744 src/run-openwrt.sh .//usr/lib/sqm/run.sh</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So this created a number of sub directories in sqm-scripts like usr and etc and distributed files into these. The quickest way to remedy this would be to delete this sqm-scripts directory completely, git clone it again and then follow the instructions but replace $your_distribution_directory_here with a real name like 121222_openwrt or whatever else you like...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><p>Should I have replaced&nbsp; your_distribution_directory_here with another name?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Yes, sorry the instructions are a bit concise...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Because the following command gave me nothing:<br /></p><div class="codebox"><pre><code>~/sqm-scripts$ cd ./$your_distribution_directory_here
~/sqm-scripts$</code></pre></div><p>EDIT: I removed GIT and the contents of /root/sqm-scripts from the router.&nbsp; However I cannot remove the actual /root/sqm-scripts directory.&nbsp; I am doing it with FTP Filezilla.</p></blockquote></div><p>If the directory is empty it should not matter much, but if you log into the router with ssh you should be able to the following:<br />cd /root<br />rm -r ./sqm-scripts</p><p>that hopefully should do the trick.</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304678">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 23:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Everything worked like you said.</p><p>Now step #6 is the following, right?<br />scp -r ./*&nbsp; root@192.168.1.1:/</p><p>ok, I finished installing SQM.&nbsp; I soft booted the router.&nbsp; I see SQM ENABLED in the System -&gt; Startup screen.&nbsp; However I do not see a menu option SQM under the Network menu.&nbsp; Seems like SQM is not active.</p><p>What else do I need to do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304679">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Dec 2015, 23:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hi</p><p>Everything worked like you said.</p><p>Now step #6 is the following, right?<br />scp -r ./*&nbsp; root@192.168.1.1:/</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If 192.168.1.1 is your router&#039;s IP that should copy the new sqm scripts and related files over the old ones hopefully fixing the brokenness.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>ok, I finished installing SQM.&nbsp; I soft booted the router.&nbsp; I see SQM ENABLED in the System -&gt; Startup screen.&nbsp; However I do not see a menu option SQM under the Network menu.&nbsp; Seems like SQM is not active.</p><p>What else do I need to do?</p></blockquote></div><p>The GUI requires you to install luci-app-sqm in addition to sqm-scripts. But what is the output of:<br />cat /etc/config/sqm<br />tc -d qdisc<br /># the next two might not actually work if sqm is not configured/enabled...<br />SQM_VERBOSITY=8 /etc/init.d/sqm stop <br />SQM_VERBOSITY=8 /etc/init.d/sqm start</p><p>I believe we now need to first establish basic functionality before moving further</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304680">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						22 Dec 2015, 23:48					</div>
				</div>
				<div class="post-content content">
					<p># cat /etc/config/sqm</p><p>config queue &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option download &#039;85000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option upload &#039;10000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ingress_ecn &#039;ECN&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option egress_ecn &#039;ECN&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc_really_really_advanced &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option itarget &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option etarget &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option linklayer &#039;none&#039;</p><br /><br /><br /><br /><p># tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><br /><br /><br /><p>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm stop <br />root@OpenWrt:~# </p><br /><p>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm start<br />root@OpenWrt:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304683">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Dec 2015, 00:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p># cat /etc/config/sqm</p><p>config queue &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option download &#039;85000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option upload &#039;10000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc &#039;fq_codel&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option script &#039;simple.qos&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc_advanced &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ingress_ecn &#039;ECN&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option egress_ecn &#039;ECN&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option qdisc_really_really_advanced &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option itarget &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option etarget &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option linklayer &#039;none&#039;</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, so the the default configuration file is there (which will not work for your set-up at all)<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><p># tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; As expected nothing set up<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><br /><p>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm stop <br />root@OpenWrt:~# </p><br /><p>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm start<br />root@OpenWrt:~#</p></blockquote></div><p>And since the config is off (do you even have eth1?) nothing happens, but that is unfortunately no indication that all is well. So could you try to install luci-app-sqm (log into the GUI, go to System -&gt; Software, hit the &quot;Update lists&quot; button, go to available packages, select &quot;L&quot;, scroll down until you see &quot;luci-app-sqm&quot; hit &quot;install&quot; ). Then we have a decent chance get you going...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304684">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						23 Dec 2015, 00:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I went through LUCI and made rthe same configuration like I had before :</p><p><span class="postimg"><img src="http://s3.postimg.org/kn9ebuic3/sqm.png" alt="http://s3.postimg.org/kn9ebuic3/sqm.png" /></span></p><p>So here are the tests you told me.&nbsp; They seem to work now:</p><br /><div class="codebox"><pre><code>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm stop
SQM: Stopping SQM on eth0.3
SQM: ifb associated with interface eth0.3: 
SQM: Currently no ifb is associated with eth0.3, this is normal during starting of the sqm system.
SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.3 shaper deleted
SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.3 interface deleted
SQM: Stopping SQM on pppoe-wan
SQM: ifb associated with interface pppoe-wan: 
SQM: Currently no ifb is associated with pppoe-wan, this is normal during starting of the sqm system.
SQM: /usr/lib/sqm/stop-sqm: ifb4pppoe-wan shaper deleted
SQM: /usr/lib/sqm/stop-sqm: ifb4pppoe-wan interface deleted





root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm start
SQM: Starting SQM script: simple.qos on pppoe-wan, in: 7450 Kbps, out: 720 Kbps
SQM: QDISC htb is useable.
SQM: QDISC fq_codel is useable.
SQM: Starting simple.qos
SQM: ifb associated with interface pppoe-wan: 
SQM: Currently no ifb is associated with pppoe-wan, this is normal during starting of the sqm system.
SQM: Squashing differentiated services code points (DSCP) from ingress.
SQM: IFACE: pppoe-wan MTU: 1492
SQM: CUR_HTB_QUANTUM: 1492, BANDWIDTH: 720
SQM: STAB: stab mtu 2047 tsize 512 mpu 0 overhead 44 linklayer atm
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: egress shaping activated
SQM: QDISC ingress is useable.
SQM: IFACE: pppoe-wan MTU: 1492
SQM: CUR_HTB_QUANTUM: 1492, BANDWIDTH: 7450
SQM: Do not perform DSCP based filtering on ingress. (1-tier classification)
SQM: STAB: stab mtu 2047 tsize 512 mpu 0 overhead 44 linklayer atm
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: ingress shaping activated
SQM: simple.qos was started on pppoe-wan successfully
SQM: Starting SQM script: simple.qos on eth0.3, in: 9300 Kbps, out: 825 Kbps
SQM: QDISC htb is useable.
SQM: QDISC fq_codel is useable.
SQM: Starting simple.qos
SQM: ifb associated with interface eth0.3: 
SQM: Currently no ifb is associated with eth0.3, this is normal during starting of the sqm system.
SQM: Squashing differentiated services code points (DSCP) from ingress.
SQM: IFACE: eth0.3 MTU: 1500
SQM: CUR_HTB_QUANTUM: 1500, BANDWIDTH: 825
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: egress shaping activated
SQM: QDISC ingress is useable.
SQM: IFACE: eth0.3 MTU: 1500
SQM: CUR_HTB_QUANTUM: 1500, BANDWIDTH: 9300
SQM: Do not perform DSCP based filtering on ingress. (1-tier classification)
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: ingress shaping activated
SQM: simple.qos was started on eth0.3 successfully </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304685">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						23 Dec 2015, 00:05					</div>
				</div>
				<div class="post-content content">
					<p>And here are the rest of the commands:</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/sqm

config queue &#039;eth1&#039;
    option qdisc &#039;fq_codel&#039;
    option script &#039;simple.qos&#039;
    option qdisc_advanced &#039;0&#039;
    option enabled &#039;1&#039;
    option interface &#039;pppoe-wan&#039;
    option download &#039;7450&#039;
    option upload &#039;720&#039;
    option linklayer &#039;atm&#039;
    option overhead &#039;44&#039;

config queue
    option qdisc &#039;fq_codel&#039;
    option script &#039;simple.qos&#039;
    option linklayer &#039;none&#039;
    option enabled &#039;1&#039;
    option interface &#039;eth0.3&#039;
    option download &#039;9300&#039;
    option upload &#039;825&#039;
    option qdisc_advanced &#039;0&#039;




root@OpenWrt:~#  tc -d qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2
qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn 
qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn 
qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn 
qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- 
qdisc mq 0: dev wlan0 root 
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc htb 1: dev pppoe-wan root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 3
 linklayer atm overhead 44 mtu 2047 tsize 512 
qdisc fq_codel 110: dev pppoe-wan parent 1:11 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn 
qdisc fq_codel 120: dev pppoe-wan parent 1:12 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn 
qdisc fq_codel 130: dev pppoe-wan parent 1:13 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn 
qdisc ingress ffff: dev pppoe-wan parent ffff:fff1 ---------------- 
qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32
 linklayer atm overhead 44 mtu 2047 tsize 512 
qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn 
qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32
qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304687">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Dec 2015, 00:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><p>so yay progress, you are back again at the position you were when we started this <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hi</p><p>I went through LUCI and made rthe same configuration like I had before :</p><p><span class="postimg"><img src="http://s3.postimg.org/kn9ebuic3/sqm.png" alt="http://s3.postimg.org/kn9ebuic3/sqm.png" /></span></p><p>So here are the tests you told me.&nbsp; They seem to work now:</p><br /><div class="codebox"><pre><code>root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm stop
SQM: Stopping SQM on eth0.3
SQM: ifb associated with interface eth0.3: 
SQM: Currently no ifb is associated with eth0.3, this is normal during starting of the sqm system.
SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.3 shaper deleted
SQM: /usr/lib/sqm/stop-sqm: ifb4eth0.3 interface deleted
SQM: Stopping SQM on pppoe-wan
SQM: ifb associated with interface pppoe-wan: 
SQM: Currently no ifb is associated with pppoe-wan, this is normal during starting of the sqm system.
SQM: /usr/lib/sqm/stop-sqm: ifb4pppoe-wan shaper deleted
SQM: /usr/lib/sqm/stop-sqm: ifb4pppoe-wan interface deleted





root@OpenWrt:~# SQM_VERBOSITY=8 /etc/init.d/sqm start
SQM: Starting SQM script: simple.qos on pppoe-wan, in: 7450 Kbps, out: 720 Kbps
SQM: QDISC htb is useable.
SQM: QDISC fq_codel is useable.
SQM: Starting simple.qos
SQM: ifb associated with interface pppoe-wan: 
SQM: Currently no ifb is associated with pppoe-wan, this is normal during starting of the sqm system.
SQM: Squashing differentiated services code points (DSCP) from ingress.
SQM: IFACE: pppoe-wan MTU: 1492
SQM: CUR_HTB_QUANTUM: 1492, BANDWIDTH: 720
SQM: STAB: stab mtu 2047 tsize 512 mpu 0 overhead 44 linklayer atm
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: egress shaping activated
SQM: QDISC ingress is useable.
SQM: IFACE: pppoe-wan MTU: 1492
SQM: CUR_HTB_QUANTUM: 1492, BANDWIDTH: 7450
SQM: Do not perform DSCP based filtering on ingress. (1-tier classification)
SQM: STAB: stab mtu 2047 tsize 512 mpu 0 overhead 44 linklayer atm
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: ingress shaping activated
SQM: simple.qos was started on pppoe-wan successfully
SQM: Starting SQM script: simple.qos on eth0.3, in: 9300 Kbps, out: 825 Kbps
SQM: QDISC htb is useable.
SQM: QDISC fq_codel is useable.
SQM: Starting simple.qos
SQM: ifb associated with interface eth0.3: 
SQM: Currently no ifb is associated with eth0.3, this is normal during starting of the sqm system.
SQM: Squashing differentiated services code points (DSCP) from ingress.
SQM: IFACE: eth0.3 MTU: 1500
SQM: CUR_HTB_QUANTUM: 1500, BANDWIDTH: 825
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: egress shaping activated
SQM: QDISC ingress is useable.
SQM: IFACE: eth0.3 MTU: 1500
SQM: CUR_HTB_QUANTUM: 1500, BANDWIDTH: 9300
SQM: Do not perform DSCP based filtering on ingress. (1-tier classification)
SQM: get_limit:  CURLIMIT: 1001
SQM: get_target defaulting to auto.
SQM: get_ECN: ECN CURECN: ecn IECN: ECN EECN: ECN
SQM: ingress shaping activated
SQM: simple.qos was started on eth0.3 successfully </code></pre></div></blockquote></div><br /><p>Good now:</p><p>1) tc -d qdisc</p><p>2) reboot # wait until all is back</p><p>3) tc -d qdisc # I want to see that the automatic start on eth0.3 works</p><p>4) disconnect pppoe-wan at the modem to simulate an unscheduled outage of that link and hope that eth0.3 takes over</p><p>5) tc -d qdisc</p><p>6) speedtest (dslreports)</p><p>7) plug the modem in again and open luci again</p><p>8) change eth0.3 bandwidth to Download 700 and Upload 7000</p><p>9) unplug the modem again</p><p>10) speedtest (dslreports)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304688">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						23 Dec 2015, 00:12					</div>
				</div>
				<div class="post-content content">
					<p>while I do these, here is a test from yesterday.&nbsp; It is working fine now:</p><div class="codebox"><pre><code>root@OpenWrt:~# /etc/init.d/sqm start
SQM: Stopping SQM on pppoe-wan
SQM: Starting SQM script: simple.qos on pppoe-wan, in: 7450 Kbps, out: 720 Kbps
SQM: simple.qos was started on pppoe-wan successfully
SQM: Stopping SQM on eth0.3
SQM: Starting SQM script: simple.qos on eth0.3, in: 9300 Kbps, out: 825 Kbps
SQM: simple.qos was started on eth0.3 successfully</code></pre></div>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 23 Dec 2015, 00:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304692">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						23 Dec 2015, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>It is WORKING! (I think)</p><br /><p>1)</p><p>root@OpenWrt:~#&nbsp; tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev pppoe-wan root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 3<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev pppoe-wan parent 1:11 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 120: dev pppoe-wan parent 1:12 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 130: dev pppoe-wan parent 1:13 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc ingress ffff: dev pppoe-wan parent ffff:fff1 ---------------- <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><p>2) reboot # wait until all is back</p><br /><p>3) <br />root@OpenWrt:~# tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev pppoe-wan root refcnt 2 r2q 10 default 12 direct_packets_stat 8 ver 3.17 direct_qlen 3<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev pppoe-wan parent 1:11 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 120: dev pppoe-wan parent 1:12 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 130: dev pppoe-wan parent 1:13 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc ingress ffff: dev pppoe-wan parent ffff:fff1 ---------------- <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><br /><p>4) disconnect pppoe-wan at the modem to simulate an unscheduled outage of that link and hope that eth0.3 takes over</p><br /><p>5)<br />root@OpenWrt:~#&nbsp; tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><p>6)<br /><span class="postimg"><img src="http://www.dslreports.com/speedtest/2312412.png" alt="http://www.dslreports.com/speedtest/2312412.png" /></span></p><br /><p>7) plug the modem in again and open luci again</p><br /><p>8) change eth0.3 bandwidth to Download 700 and Upload 7000</p><br /><p>9) unplug the modem again</p><p>10)<br /><span class="postimg"><img src="http://www.dslreports.com/speedtest/2312469.png" alt="http://www.dslreports.com/speedtest/2312469.png" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304694">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Dec 2015, 00:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>It is WORKING! (I think)</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Excellent!<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>1)</p><p>root@OpenWrt:~#&nbsp; tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev pppoe-wan root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 3<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev pppoe-wan parent 1:11 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 120: dev pppoe-wan parent 1:12 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 130: dev pppoe-wan parent 1:13 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc ingress ffff: dev pppoe-wan parent ffff:fff1 ---------------- <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><p>2) reboot # wait until all is back</p><br /><p>3) <br />root@OpenWrt:~# tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev pppoe-wan root refcnt 2 r2q 10 default 12 direct_packets_stat 8 ver 3.17 direct_qlen 3<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev pppoe-wan parent 1:11 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 120: dev pppoe-wan parent 1:12 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc fq_codel 130: dev pppoe-wan parent 1:13 limit 1001p flows 1024 quantum 300 target 19.4ms interval 114.4ms ecn <br />qdisc ingress ffff: dev pppoe-wan parent ffff:fff1 ---------------- <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512 <br />qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Great, automatic starting of eth0.3 seems to work again.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>4) disconnect pppoe-wan at the modem to simulate an unscheduled outage of that link and hope that eth0.3 takes over</p><br /><p>5)<br />root@OpenWrt:~#&nbsp; tc -d qdisc<br />qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev eth0.3 root refcnt 2 r2q 10 default 12 direct_packets_stat 0 ver 3.17 direct_qlen 2<br />qdisc fq_codel 110: dev eth0.3 parent 1:11 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 120: dev eth0.3 parent 1:12 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc fq_codel 130: dev eth0.3 parent 1:13 limit 1001p flows 1024 quantum 300 target 17.0ms interval 112.0ms ecn <br />qdisc ingress ffff: dev eth0.3 parent ffff:fff1 ---------------- <br />qdisc mq 0: dev wlan0 root <br />qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4pppoe-wan root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br /> linklayer atm overhead 44 mtu 2047 tsize 512</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This is sort of an ugly left-over, but that is how hotplug works currently, it should be purely cosmetic, so please ignore...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>qdisc fq_codel 110: dev ifb4pppoe-wan parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn <br />qdisc htb 1: dev ifb4eth0.3 root refcnt 2 r2q 10 default 10 direct_packets_stat 0 ver 3.17 direct_qlen 32<br />qdisc fq_codel 110: dev ifb4eth0.3 parent 1:10 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn </p><br /><p>6)<br /><span class="postimg"><img src="http://www.dslreports.com/speedtest/2312412.png" alt="http://www.dslreports.com/speedtest/2312412.png" /></span></p><br /><p>7) plug the modem in again and open luci again</p><br /><p>8) change eth0.3 bandwidth to Download 700 and Upload 7000</p><br /><p>9) unplug the modem again</p><p>10)<br /><span class="postimg"><img src="http://www.dslreports.com/speedtest/2312469.png" alt="http://www.dslreports.com/speedtest/2312469.png" /></span></p></blockquote></div><p>Great, the speed-tests basically show that the &quot;polarity&quot; of upload and download in the GUI are correct, so Upload really is the upload over the eth0.3-wan interface. So now follow the &quot;instructions&quot; in <a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a> to figure out what bandwidth to shape to on eth0.3. Please holler if there are issues with sqm-scripts.</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304699">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						23 Dec 2015, 01:21					</div>
				</div>
				<div class="post-content content">
					<p>Thank you very much for your help</p><p>You are a very patient and tolerant person.&nbsp; I am very lucky to get support from the developer of SQM.</p><p>I am curious, how come the upload on the second test is above the line&#039;s capacity (which is 1 mbps)?</p><p><span class="postimg"><img src="http://s3.postimg.org/kn9ebuic3/sqm.png" alt="http://s3.postimg.org/kn9ebuic3/sqm.png" /></span></p><p>The above values are 95% of the AVERAGE values I had measured several days ago (without SQM).&nbsp; Trouble is there were some large variations, like 6mbps - 8.5 mbps download for ppppoe-wan.&nbsp; Should I be extremely strict and take 95% of the minimum ever values?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304747">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Dec 2015, 12:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Thank you very much for your help</p><p>You are a very patient and tolerant person.&nbsp; I am very lucky to get support from the developer of SQM.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Thanks for the flattery, but for correctness sake, I am not the developer of SQM, I do help out there a bit though.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I am curious, how come the upload on the second test is above the line&#039;s capacity (which is 1 mbps)?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This is a cable/DOCSIS link if I recall correctly, the lines capacity is taken from the status pages of the modem or from your contract? I ask because some cable providers are known to a) over provide their lines a bit (often to account for overheads so people see the advertised bandwidth in speedtests) and b) occasionally use techniques like speedboost (temporarily giving customers more bandwidth) which helps the feeling of snappiness. If a test does not run long enough it might show all the boost from speedboat, but might not show the fall back to contracted bandwidth. Not sure your cable company does that though.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p><span class="postimg"><img src="http://s3.postimg.org/kn9ebuic3/sqm.png" alt="http://s3.postimg.org/kn9ebuic3/sqm.png" /></span></p><p>The above values are 95% of the AVERAGE values I had measured several days ago (without SQM).&nbsp; Trouble is there were some large variations, like 6mbps - 8.5 mbps download for ppppoe-wan.&nbsp; Should I be extremely strict and take 95% of the minimum ever values?</p></blockquote></div><p>Witch cable on ingress people typically shape down to 85-90% of contracted speed (ingress shaping works better if there is larger speed difference between true bottleneck and shaper bandwidth). On egress 95% often seems to work fine. I would look at the bufferbloat measurements and scale the shaping so that the latency under load increase stays in a range you are comfortable with. The same holds true for your DSL link look at both the resulting bandwidth and the latency under load increase to figure out a decent shaping rate. Please note that the goal can only be to shape for the last-mile link bottleneck , but depending on your ISPs routing and peering the full path to the speedtest site might have the true bottleneck at say your ISPs transit sites. You will not be able to fix this issue satisfactory by shaping at your end... (you might be able to adjust your shaper for a congested DSLAM uplink, but that I believe is about as far as one can take it, but I digress).</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304932">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						24 Dec 2015, 19:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello moeller0</p><p>By true bottleneck you mean the reading from speedtests?<br />By latency under load you mean the latency reading in <a href="http://www.dslreports.com/speedtest">http://www.dslreports.com/speedtest</a> ?&nbsp; Should I have a clean line (like described in the speed test) or load the line with some downloading?<br />&nbsp; <br />My wan2 (eth0.3) is connected to a Motorola SBV5121E cable modem.&nbsp; I have not gone to the modem&#039;s status page.&nbsp; The contracted speed is 10 mbps/1 mbps download/upload.&nbsp; When I go to speedtest.net I typically get 9,75/0,98 mbps download/upload.&nbsp; The figures I entered in the SQM form are 95% of the values I got from the <a href="http://www.dslreports.com/speedtest.">http://www.dslreports.com/speedtest.</a></p><p>My question was more about the ADSL line connected to the wan interface (pppoe-wan).&nbsp; The modem status typically reports actual speed of 11,0/1,0 mbps download/upload, while speedtest.net typically measures 10,0/0,98 mbps download/upload.&nbsp; According to <a href="http://www.dslreports.com/speedtest">http://www.dslreports.com/speedtest</a> I had 6,0-8,5 mbps download.&nbsp; The readings in the 8 mbps range are much more typical while the 6 mbps is rare. So should I take the 95% of 6 mbps or be more generous, as I entered 7450 mbps?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304942">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						24 Dec 2015, 21:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hello moeller0</p><p>By true bottleneck you mean the reading from speed tests?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; In each network path there is going to be one link/position/node/segment (what ever you want to call those) that is lower than all the others; this link is going to limit the traffic in a way that the maximum bandwidth achievable on this path equals that links bandwidth. In a sense this link is the smallest diameter pipe (if you think about networking as an extension of plumbing for a moment) just as the bottleneck is the limiting diameter when you pour. Typically for home networks the access link or last-mile link is effectively acting as this bottleneck. The whole premise of latency reduction by sqm-scripts rest upon this fact. Networking experts managed to come up with an active queue management (AQM)&nbsp; system that keeps induced latency low while minimally affecting bandwidth, unfortunately this AQM has not spread to all network devices, as it should have; so in sqm-script we do the next best thing, since we can keep the induced latency of the router running sqm-scripts pretty well controlled (while most upstream devices, most likely including your cable/DOCSIS- and the DSL-modem induce multi 100s of milliseconds (up to seconds) on latency under saturation load) we use traffic shaping to move the bottleneck away from your link into the router by setting up a shaper that makes sure the router never sends/receives more from the modem than that can handle without filling its buffers. In other words we create an artificial bottleneck at a network load where we have latency under control. And since on each path only the bottleneck introduces (unwanted) queueing delay, we basically control all of the unwanted delay, just by traffic shaping at your router, pretty nifty actually <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />&nbsp; &nbsp; &nbsp; &nbsp;So ideal the bottleneck I am talking about is your DOCSIS- or DSL-link, but there are situations where the bottleneck is located somewhere upstream of your up-link and in that situation sqm-scripts will not be able to help to salvage latency under load...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>By latency under load you mean the latency reading in <a href="http://www.dslreports.com/speedtest">http://www.dslreports.com/speedtest</a> ?&nbsp; Should I have a clean line (like described in the speed test) or load the line with some downloading?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Latency under load basically is the difference between the &quot;idle&quot; and the worst of &quot;downloading&quot; and &quot;uploading&quot; categories in the bufferbloat section of the sweetest detailed results page.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>My wan2 (eth0.3) is connected to a Motorola SBV5121E cable modem.&nbsp; I have not gone to the modem&#039;s status page.&nbsp; The contracted speed is 10 mbps/1 mbps download/upload.&nbsp; When I go to speedtest.net I typically get 9,75/0,98 mbps download/upload.&nbsp; The figures I entered in the SQM form are 95% of the values I got from the <a href="http://www.dslreports.com/speedtest.">http://www.dslreports.com/speedtest.</a></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, if the latency under load stays to you licking you are set.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>My question was more about the ADSL line connected to the wan interface (pppoe-wan).&nbsp; The modem status typically reports actual speed of 11,0/1,0 mbps download/upload, while speedtest.net typically measures 10,0/0,98 mbps download/upload.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So I call BS on speedtest.net then (or our premise that your link uses ATM encapsulation), ATM&#039;s 48/53 coding already reduces achievable rate by 100-100*48/53 = 9.4%, so the 0,98Mbps out of 1,0Mbps syncopate is pretty much impossible... (and we have not yet looked into the other sources of overhead like depending on the encapsulation used by your ISP ethernet header, IP-header and TCP header, that all eat into the achievable payload-bandwidth, that is measured by your typical speedtest).<br />&nbsp; &nbsp; &nbsp; &nbsp; Since you use PPPoE on your link and set the overhead to 44 (out of caution, I guess, or did you measure it?) I believe that the following link should give you a run-down on the different overheads: <a href="http://meinkontes.de/maxbandwidth/">http://meinkontes.de/maxbandwidth/</a><br />With 10000 Kbps as sync speed the maximum effective download payload rate is calculated as 8561.321 Kbps<br />With 1000 Kbps as sync speed the maximum effective upload payload rate is calculated as 856.132 Kbps</p><br /><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p> According to <a href="http://www.dslreports.com/speedtest">http://www.dslreports.com/speedtest</a> I had 6,0-8,5 mbps download.&nbsp; The readings in the 8 mbps range are much more typical while the 6 mbps is rare. So should I take the 95% of 6 mbps or be more generous, as I entered 7450 mbps?</p></blockquote></div><p>Since you use the link layer adjustments already I would simply go and put in 95% of your syncrates and the test the latency under load behavior. On a good ADSL-link you should be able (if you account for the correct overhead) to set the upload to 95% (heck with a bit of luck even 99 or even 100% will work well), for the download you are better of with setting it to 90% or 85%. Note that I am talking about sync rates here not speedtest results. About the 6 versus 8 question, if the latency under load towards other hosts stays acceptable (to you) you do not need to shape more restrictive; if however latency under load becomes uncomfortable you might want to shape stricter; what I want to say, this is a policy decision you have to make, there is no right or wrong...</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>