<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> After adding Guest Wifi: &quot;Wireless is disabled or not associated&quot;</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p361721">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						9 Jul 2017, 20:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>today I followed the openwrt wiki &quot;Configure a guest WLAN using the Luci web-Interface&quot; entry. (<a href="https://wiki.openwrt.org/doc/recipes/guest-wlan-webinterface">https://wiki.openwrt.org/doc/recipes/gu … binterface</a>).</p><p>After I restarted the router, I see the following info on Luci&#039;s &quot;Overview&quot; page:</p><p>&quot;Wireless is disabled or not associated&quot;</p><p>This message is shown below both of my &quot;Generic 802.11bg Wireless Controller (radio0)&quot; wifi Networks (the non-guest one still worked before adding the guest Network).</p><p>My wifi Network &quot;Generic 802.11an Wireless Controller (radio1)&quot; still works as expected.</p><p>There&#039;s noch state change when I disable the guest Network. As found here in the Forum, Setting a Band Channel from &quot;Auto&quot; to a Manual one should help, this is not possible. The &quot;Operating frequency&quot; Dropdowns are all empty.</p><p>Do you have any idea or Need any additional Information from my config files? It would be very Kind if you could help me, so my friends can use my wifi, too. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Thanks and Kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361722">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rj-45</div>
					<div class="post-datetime">
						9 Jul 2017, 20:44					</div>
				</div>
				<div class="post-content content">
					<p>screenshots of the config page or the files under /etc/config/* are helpful</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361723">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						9 Jul 2017, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your fast response!</p><p>Here are my settings:</p><p><strong>network</strong><br /></p><div class="quotebox"><blockquote><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fd49:8e60:7962::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.0.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0 1 2 3 5&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;4 6&#039;</p><p>config interface &#039;vpn0&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option auto &#039;1&#039;</p><p>config interface &#039;vpn&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option ipaddr &#039;10.1.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;guest&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;radio0.network2&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.0.155&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p></blockquote></div><p><strong>firewall (guest is configured at the end)</strong><br /></p><div class="quotebox"><blockquote><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option src &#039;*&#039;<br />&nbsp; &nbsp; option dest_port &#039;1194&#039;<br />&nbsp; &nbsp; option name &#039;Allow Inbound VPN0&#039;</p><p>config include<br />&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;wan wan6&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;vpn0&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;68&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-Ping&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-IGMP&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;igmp&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fc00::/6&#039;<br />&nbsp; &nbsp; option dest_ip &#039;fc00::/6&#039;<br />&nbsp; &nbsp; option dest_port &#039;546&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-MLD&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; list icmp_type &#039;130/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;131/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;132/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;143/0&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-advertisement&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-advertisement&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;esp&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option dest_port &#039;500&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;vpn&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;vpn&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;guest&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;guest&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;53&#039;<br />&nbsp; &nbsp; option name &#039;Guest DNS&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;67-68&#039;<br />&nbsp; &nbsp; option name &#039;Guest DHCP&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p></blockquote></div><p><strong>wireless</strong><br /></p><div class="quotebox"><blockquote><p>config wifi-device &#039;radio0&#039;<br />&nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:01.0/0000:01:00.0&#039;<br />&nbsp; &nbsp; option txpower &#039;27&#039;<br />&nbsp; &nbsp; option country &#039;US&#039;<br />&nbsp; &nbsp; option noscan &#039;1&#039;<br />&nbsp; &nbsp; option hwmode &#039;11a&#039;<br />&nbsp; &nbsp; option channel &#039;auto&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;psk2&#039;<br />&nbsp; &nbsp; option key &#039;3$$617D7f174b8eeb555b75$A38848b0&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN&#039;</p><p>config wifi-device &#039;radio1&#039;<br />&nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; option hwmode &#039;11a&#039;<br />&nbsp; &nbsp; option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;<br />&nbsp; &nbsp; option channel &#039;auto&#039;<br />&nbsp; &nbsp; option country &#039;US&#039;<br />&nbsp; &nbsp; option htmode &#039;HT40&#039;<br />&nbsp; &nbsp; option txpower &#039;23&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio1&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;psk2&#039;<br />&nbsp; &nbsp; option key &#039;3$$617D7f174b8eeb555b75$A38848b0&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN_N&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;none&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN_GAST&#039;<br />&nbsp; &nbsp; option network &#039;guest&#039;</p></blockquote></div><p>encryption is none for guest network, because I initially wanted to test without being in need to enter a password on several devices.</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 11 Jul 2017, 10:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361738">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						10 Jul 2017, 09:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>This message is shown below both of my &quot;Generic 802.11bg Wireless Controller (radio0)&quot; wifi Networks (the non-guest one still worked before adding the guest Network).</p><p>My wifi Network &quot;Generic 802.11an Wireless Controller (radio1)&quot; still works as expected.</p></blockquote></div><p>Do I understand correctly that you have one 2.4 GHz radio (radio0) and one 5 GHz radio (radio1)?</p><p>From your config:<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    option type &#039;mac80211&#039;
    option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:01.0/0000:01:00.0&#039;
    option txpower &#039;27&#039;
    option country &#039;US&#039;
    option noscan &#039;1&#039;
    option hwmode &#039;11a&#039;  # &lt;- Either this is wrong...
    option channel &#039;auto&#039;

... omitted for brevity ...

config wifi-device &#039;radio1&#039;
    option type &#039;mac80211&#039;
    option hwmode &#039;11a&#039;   # &lt;- ... or this is wrong. 
    option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;
    option channel &#039;auto&#039;
    option country &#039;US&#039;
    option htmode &#039;HT40&#039;
    option txpower &#039;23&#039;</code></pre></div><p>I believe you need to change one of these radios to work on &#039;11g&#039; hwmode. If both radios are 2.4 GHz, then both of them are wrong. But since you say one of the wireless radios is working correctly, then I believe you have one 2.4 GHz radio and one 5 Ghz radio. The 5 Ghz one is working, and the other one is not.</p><p>The &#039;hwmode&#039; option selects the radio band (2.4 GHz or 5 GHz), not the 802.11 standard. Most likely your 2.4 GHz radio will refuse to work if it is requested to operate on the 5 GHz band. See <a href="http://w1.fi/cgit/hostap/tree/hostapd/hostapd.conf">http://w1.fi/cgit/hostap/tree/hostapd/hostapd.conf</a> and search for &#039;operation mode&#039; to find the explanation what this option does.</p><p>You should be able to verify if this is the root cause by observing the kernel ring-buffer (dmesg) after restarting your router. Most likely you will see an error related to setting up the wireless device. Change the option, and the problem should go away.</p><p>You should also look at the &#039;htmode&#039; option you supply to the second radio device. If this radio is the 5 GHz one, then you can get more throughput by using one of the &#039;VHT&#039; options listed in <a href="https://wiki.openwrt.org/doc/uci/wireless#mac80211_device_options">https://wiki.openwrt.org/doc/uci/wirele … ce_options</a> if your device supports them.</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 10 Jul 2017, 09:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361750">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						10 Jul 2017, 19:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>I believe you need to change one of these radios to work on &#039;11g&#039; hwmode. If both radios are 2.4 GHz, then both of them are wrong.</p></blockquote></div><p>You are right, one is 2.4 GHz, the other one 5 GHz. very strange, this seems to be a bug in Luci, because until I configured my guest wifi, both SSIDs (MY_WLAN and MY_WLAN_N) worked properly. I know this for sure, because the 5 GHz is the one I (daily) use with my laptop, but this one is not found by my iPhone. For my iPhone I (daily) use the 2.4 GHz connection.</p><p>As recommended by you, I change the hwmode value for radio0 connection to 11g, rebootet my router and now my MY_WLAN works again.</p><p>My guest wifi with SSID MY_WLAN_GUEST is the one I&#039;m right now connected with. It took quite long, until the connection was established. When I now want to connect to the internet, it doesn&#039;t work. A point quite strange looking to me: I configured the guest wifi to use dhcp. My wifi has static ip 192.168.0.155. My dhcp range goes from 156 to 175. But when I check the ip given to my iPhone either the iPhone itself and the router &quot;Overview&quot; page show my 192.168.0.17 as ip for my iPhone.</p><p>Could you perhaps help me once more, what is wrong? Are there still any firewall rules that block the connection from the guest wifi to the internet? That shall be the only thing guest wifi user are allowed to do. They shall not be able to connect to any local network device. If one guest wlan client can connect to another is something I don&#039;t care. I tried to check my firewall rules and as far as I understood that looks ok - but I don&#039;t have that much experiences.</p><div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>You should also look at the &#039;htmode&#039; option you supply to the second radio device. If this radio is the 5 GHz one, then you can get more throughput by using one of the &#039;VHT&#039; options listed in <a href="https://wiki.openwrt.org/doc/uci/wireless#mac80211_device_options">https://wiki.openwrt.org/doc/uci/wirele … ce_options</a> if your device supports them.</p></blockquote></div><p>Thanks for that hint. This is something I&#039;ll try immediately. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> <br />EDIT: Perhaps you can give me a hint. I tried VHT20, 40 and 80. With 80 I couldn&#039;t see my wifi in the windows &quot;connect to wifi&quot; view. With VHT20 and VHT40 I made a speedtest on the internet (not sure if that makes any sense), but my speed was ~20 MBit (VHT20) and 24 MBit, (VHT40) but with HT40 it was 34 MBit. Is there a way I can easily test my wifi speed or do you know the recommended setting for Linksys EA4500 router?</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 10 Jul 2017, 19:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361784">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						11 Jul 2017, 09:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>My guest wifi with SSID MY_WLAN_GUEST is the one I&#039;m right now connected with. It took quite long, until the connection was established. When I now want to connect to the internet, it doesn&#039;t work. A point quite strange looking to me: I configured the guest wifi to use dhcp. My wifi has static ip 192.168.0.155. My dhcp range goes from 156 to 175. But when I check the ip given to my iPhone either the iPhone itself and the router &quot;Overview&quot; page show my 192.168.0.17 as ip for my iPhone.</p><p>Could you perhaps help me once more, what is wrong? Are there still any firewall rules that block the connection from the guest wifi to the internet? That shall be the only thing guest wifi user are allowed to do. They shall not be able to connect to any local network device. If one guest wlan client can connect to another is something I don&#039;t care. I tried to check my firewall rules and as far as I understood that looks ok - but I don&#039;t have that much experiences.</p></blockquote></div><p>Looking at your firewall config, I see the following:<br /></p><div class="codebox"><pre><code>config zone
    option name &#039;guest&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;guest&#039;
    option input &#039;REJECT&#039;
    option forward &#039;REJECT&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;guest&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option dest_port &#039;53&#039;
    option name &#039;Guest DNS&#039;
    option src &#039;guest&#039;
    option enabled &#039;0&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;67-68&#039;
    option name &#039;Guest DHCP&#039;
    option src &#039;guest&#039;
    option enabled &#039;0&#039;</code></pre></div><p>This configuration allows packets generated by the router to travel out to the &quot;guest&quot; network (OUTPUT). Traffic from the &quot;guest&quot; network to the router (INPUT) is rejected. Traffic forwarded from &quot;guest&quot; network to another network (FORWARD) is rejected.</p><p>You have then added an explicit forwarding rule, which allows packets to travel from &quot;guest&quot; to &quot;wan&quot; network. All fine and well here.</p><p>Then you have two firewall rules which open up ports 53 TCP &amp; UDP and ports 67-68 UDP in the &quot;guest&quot; network. However, for both of these firewall rules, the &quot;enabled&quot; option is set to &quot;0&quot;, which inherently disables the rules.</p><p>Conclusion: clients in your &quot;guest&quot; network cannot use DHCP or DNS services hosted by your router, since the INPUT direction is blocked, and the additional firewall rules are not enabled. Try setting the &quot;enabled&quot; option to &quot;1&quot;, and see what happens then.</p><div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>EDIT: Perhaps you can give me a hint. I tried VHT20, 40 and 80. With 80 I couldn&#039;t see my wifi in the windows &quot;connect to wifi&quot; view. With VHT20 and VHT40 I made a speedtest on the internet (not sure if that makes any sense), but my speed was ~20 MBit (VHT20) and 24 MBit, (VHT40) but with HT40 it was 34 MBit. Is there a way I can easily test my wifi speed or do you know the recommended setting for Linksys EA4500 router?</p></blockquote></div><p>Unfortunately I have not configured any 5 GHz radios so far, so I cannot help you with this one <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 11 Jul 2017, 09:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361786">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						11 Jul 2017, 10:49					</div>
				</div>
				<div class="post-content content">
					<p>Hello Antek,</p><p>thanks for your response.</p><div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>You have then added an explicit forwarding rule, which allows packets to travel from &quot;guest&quot; to &quot;wan&quot; network. All fine and well here.</p><p>Then you have two firewall rules which open up ports 53 TCP &amp; UDP and ports 67-68 UDP in the &quot;guest&quot; network. However, for both of these firewall rules, the &quot;enabled&quot; option is set to &quot;0&quot;, which inherently disables the rules.</p><p>Conclusion: clients in your &quot;guest&quot; network cannot use DHCP or DNS services hosted by your router, since the INPUT direction is blocked, and the additional firewall rules are not enabled. Try setting the &quot;enabled&quot; option to &quot;1&quot;, and see what happens then.</p></blockquote></div><p>I&#039;m sorry for the &quot;confusion&quot;. I made a mistake and added my config files, after I tried to make my MY_WLAN work again. One step trying to make it work again was disabling &quot;everything&quot; I set up / activated for my guest wifi. Therefore I also disabled both rules for port 53 and 67-68.</p><p>When I added your mentioned &quot;hwmode&quot; fix, I also enabled again both rules. I just checked my firewall config. For both rules there was no line &quot;option enabled &#039;1&#039;&quot; anymore (also no &quot;option enabled &#039;1&#039;&quot; which I added manually), but Luci showed both being enabled. I now restarted my router via vpn and will let you know, if it works.</p><p>EDIT: I edited my initial config file post, so that people perhaps read here later won&#039;t be confused.</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 11 Jul 2017, 10:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361789">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						11 Jul 2017, 12:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>I now restarted my router via vpn and will let you know, if it works</p></blockquote></div><p>If it doesn&#039;t work, then post the full and up-to-date content of the following files:</p><p>/etc/config/network<br />/etc/config/wireless<br />/etc/config/firewall<br />/etc/config/dhcp</p><p>Screen the files, and remove possible passwords or usernames if you have those.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361815">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						11 Jul 2017, 21:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,</p><p>this didn&#039;t work, what a pitty. I found one additional thing in my dhcp config file: the ip ranges overlapped for guest and vpn. The one started with 156 to 175, the other one with 170 to 200. This is fixed now. The last one now starts with 176 to 200.</p><p>My ip setting connecting to the guest lan is 192.168.0.17, but the ip range for the dhcp is 156 to 175. As gateway I see 192.168.0.155, the static ip of my guest wlan interface. Is this correct, too? I cannot ping it.</p><p>Here&#039;s my config:</p><p><strong>dhcp</strong><br /></p><div class="quotebox"><blockquote><p>config dnsmasq<br />&nbsp; &nbsp; option domainneeded &#039;1&#039;<br />&nbsp; &nbsp; option boguspriv &#039;1&#039;<br />&nbsp; &nbsp; option localise_queries &#039;1&#039;<br />&nbsp; &nbsp; option rebind_protection &#039;1&#039;<br />&nbsp; &nbsp; option rebind_localhost &#039;1&#039;<br />&nbsp; &nbsp; option local &#039;/lan/&#039;<br />&nbsp; &nbsp; option domain &#039;lan&#039;<br />&nbsp; &nbsp; option expandhosts &#039;1&#039;<br />&nbsp; &nbsp; option authoritative &#039;1&#039;<br />&nbsp; &nbsp; option readethers &#039;1&#039;<br />&nbsp; &nbsp; option leasefile &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; option resolvfile &#039;/tmp/resolv.conf.auto&#039;<br />&nbsp; &nbsp; option localservice &#039;1&#039;<br />&nbsp; &nbsp; list server &#039;/surname.lan/192.168.0.1&#039;<br />&nbsp; &nbsp; list server &#039;/pi.lan/192.168.0.2&#039;<br />&nbsp; &nbsp; list server &#039;/hp-print.lan/192.168.0.3&#039;<br />&nbsp; &nbsp; list server &#039;/home.lan/192.168.0.5&#039;<br />&nbsp; &nbsp; option nonwildcard &#039;0&#039;</p><p>config dhcp &#039;lan&#039;<br />&nbsp; &nbsp; option interface &#039;lan&#039;<br />&nbsp; &nbsp; option leasetime &#039;12h&#039;<br />&nbsp; &nbsp; option start &#039;10&#039;<br />&nbsp; &nbsp; option limit &#039;50&#039;</p><p>config dhcp &#039;wan&#039;<br />&nbsp; &nbsp; option interface &#039;wan&#039;<br />&nbsp; &nbsp; option ignore &#039;1&#039;</p><p>config odhcpd &#039;odhcpd&#039;<br />&nbsp; &nbsp; option maindhcp &#039;0&#039;<br />&nbsp; &nbsp; option leasefile &#039;/tmp/hosts/odhcpd&#039;<br />&nbsp; &nbsp; option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</p><p>config dhcp &#039;guest&#039;<br />&nbsp; &nbsp; option interface &#039;guest&#039;<br />&nbsp; &nbsp; option limit &#039;175&#039;<br />&nbsp; &nbsp; option leasetime &#039;4h&#039;<br />&nbsp; &nbsp; option start &#039;156&#039;</p><p>config dhcp &#039;vpn0&#039;<br />&nbsp; &nbsp; option leasetime &#039;12h&#039;<br />&nbsp; &nbsp; option interface &#039;vpn0&#039;<br />&nbsp; &nbsp; option start &#039;176&#039;<br />&nbsp; &nbsp; option limit &#039;200&#039;</p><p>config domain<br />&nbsp; &nbsp; option name &#039;hp-print.lan&#039;<br />&nbsp; &nbsp; option ip &#039;192.168.0.3&#039;</p><p>config domain<br />&nbsp; &nbsp; option name &#039;pi.lan&#039;<br />&nbsp; &nbsp; option ip &#039;192.168.0.2&#039;</p><p>config domain<br />&nbsp; &nbsp; option name &#039;home.lan&#039;<br />&nbsp; &nbsp; option ip &#039;192.168.0.5&#039;</p><p>config domain<br />&nbsp; &nbsp; option name &#039;surname.lan&#039;<br />&nbsp; &nbsp; option ip &#039;192.168.0.1&#039;</p></blockquote></div><p><strong>firewall</strong><br /></p><div class="quotebox"><blockquote><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option src &#039;*&#039;<br />&nbsp; &nbsp; option dest_port &#039;1194&#039;<br />&nbsp; &nbsp; option name &#039;Allow Inbound VPN0&#039;</p><p>config include<br />&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;wan wan6&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;vpn0&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;68&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-Ping&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-IGMP&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;igmp&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fc00::/6&#039;<br />&nbsp; &nbsp; option dest_ip &#039;fc00::/6&#039;<br />&nbsp; &nbsp; option dest_port &#039;546&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-MLD&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; list icmp_type &#039;130/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;131/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;132/0&#039;<br />&nbsp; &nbsp; list icmp_type &#039;143/0&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-advertisement&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-advertisement&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;esp&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option dest_port &#039;500&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;vpn&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;vpn&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;guest&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;guest&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;53&#039;<br />&nbsp; &nbsp; option name &#039;Guest DNS&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;67-68&#039;<br />&nbsp; &nbsp; option name &#039;Guest DHCP&#039;<br />&nbsp; &nbsp; option src &#039;guest&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p></blockquote></div><p><strong>network</strong><br /></p><div class="quotebox"><blockquote><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fd49:8e60:7962::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.0.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0 1 2 3 5&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;4 6&#039;</p><p>config interface &#039;vpn0&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option auto &#039;1&#039;</p><p>config interface &#039;vpn&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option ipaddr &#039;10.1.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;guest&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;radio0.network2&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.0.155&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p></blockquote></div><p><strong>wireless</strong><br /></p><div class="quotebox"><blockquote><p>config wifi-device &#039;radio0&#039;<br />&nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:01.0/0000:01:00.0&#039;<br />&nbsp; &nbsp; option txpower &#039;27&#039;<br />&nbsp; &nbsp; option country &#039;US&#039;<br />&nbsp; &nbsp; option noscan &#039;1&#039;<br />&nbsp; &nbsp; option hwmode &#039;11g&#039;<br />&nbsp; &nbsp; option channel &#039;auto&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;psk2&#039;<br />&nbsp; &nbsp; option key &#039;3$$617D7f174b8eeb555b75$A38848b0&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN&#039;</p><p>config wifi-device &#039;radio1&#039;<br />&nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; option hwmode &#039;11a&#039;<br />&nbsp; &nbsp; option path &#039;mbus/mbus:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;<br />&nbsp; &nbsp; option channel &#039;auto&#039;<br />&nbsp; &nbsp; option country &#039;US&#039;<br />&nbsp; &nbsp; option htmode &#039;HT40 &#039;<br />&nbsp; &nbsp; option txpower &#039;23&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio1&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;psk2&#039;<br />&nbsp; &nbsp; option key &#039;3$$617D7f174b8eeb555b75$A38848b0&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN_N&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option encryption &#039;none&#039;<br />&nbsp; &nbsp; option ssid &#039;MY_WLAN_GAST&#039;<br />&nbsp; &nbsp; option network &#039;guest&#039;</p></blockquote></div><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361843">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						12 Jul 2017, 09:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>I found one additional thing in my dhcp config file: the ip ranges overlapped for guest and vpn. The one started with 156 to 175, the other one with 170 to 200. This is fixed now. The last one now starts with 176 to 200.</p><p>My ip setting connecting to the guest lan is 192.168.0.17, but the ip range for the dhcp is 156 to 175. As gateway I see 192.168.0.155, the static ip of my guest wlan interface. Is this correct, too? I cannot ping it.</p></blockquote></div><p>Looking at your configuration files, you seem to have a serious conflict related to overlapping address ranges.</p><p>Your LAN network is defined as 192.168.0.0 / 24. These settings come from the static IP address and the netmask setting. This configuration states that addresses from 192.168.0.1 to 192.168.0.255 belong to the LAN network.</p><p>Similarly, your Guest network is <strong>also</strong> defined as 192.168.0.0 / 24. Again, this setting comes from the static IP address and the netmask. This configuration claims that addresses from 192.168.0.1 to 192.68.0.255 belong to the Guest network.</p><p>I&#039;m sure you can see the problem emerging now. From the routing perspective, your router does not know which addresses belong to which networks because the address ranges of the networks are overlapping. The routing table of your device is completely messed up; the kernel does not know which physical interface it should use for sending and receiving traffic related to a specific network.</p><p>The easy fix is to change the static IP address of the router in the Guest network to &quot;192.168.10.1&quot; while keeping the netmask as is, and then adjust the DHCP settings of the Guest network to start from &quot;10&quot; and limit to &quot;50&quot; or &quot;25&quot; or however many addresses you want to deal out through DHCP. This will set the LAN network to 192.168.0.0 / 24 and the Guest network to 192.168.10.0 / 24. The networks are no longer in conflict, and everything should work as expected.</p><p>If you want to do things the harder way and split the single-octet network (192.168.0.X) in half, then you&#039;ll need to calculate netmasks and know exactly how you configure the &quot;start&quot; and &quot;limit&quot; variables so each network has enough addresses to operate correctly. The minimum number of addresses required by a network is usually 3: the network address, one address for a single host and one address for a multicast endpoint.</p><p>If you want to go the harder way, then begin by reading <a href="http://www.enterprisenetworkingplanet.com/netsp/article.php/3566521/Networking-101-Understanding-Subnets-and-CIDR.htm">http://www.enterprisenetworkingplanet.c … d-CIDR.htm</a> and then use the CIDR calculator at <a href="http://www.subnet-calculator.com/cidr.php">http://www.subnet-calculator.com/cidr.php</a> to determine the correct static IP address and netmask values.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361850">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						12 Jul 2017, 12:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>Looking at your configuration files, you seem to have a serious conflict related to overlapping address ranges.</p><p>Your LAN network is defined as 192.168.0.0 / 24. These settings come from the static IP address and the netmask setting. This configuration states that addresses from 192.168.0.1 to 192.168.0.255 belong to the LAN network.</p><p>Similarly, your Guest network is <strong>also</strong> defined as 192.168.0.0 / 24. Again, this setting comes from the static IP address and the netmask. This configuration claims that addresses from 192.168.0.1 to 192.68.0.255 belong to the Guest network.</p><p>I&#039;m sure you can see the problem emerging now.</p></blockquote></div><p>Thanks for your detailed description. I now see the problem / conflicts. For me I defined a &quot;lan&quot; that has a static ip 192.168.0.1 and if anyone connects to &quot;lan&quot;, the user gets an ip within the range of 192.168.0.10 and 192.168.0.50, depending which is the first one available.<br />The same for &quot;guest&quot;. The interface has the static 192.168.0.155 and the user connecting gets an ip in the range of 192.168.0.156 and 192.168.0.175. So there were - in my eyes - no conflicts.<br />That in the configuration in the &quot;background&quot; the whole 192.168.0.x network was already reserved for the &quot;lan&quot; network&quot;, I didn&#039;t know.</p><div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>From the routing perspective, your router does not know which addresses belong to which networks because the address ranges of the networks are overlapping. The routing table of your device is completely messed up; the kernel does not know which physical interface it should use for sending and receiving traffic related to a specific network.</p></blockquote></div><p>That sounds logical, now and is probably also the reason why I got an ip not within my defined &quot;guest&quot; network limits.</p><div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>The easy fix is to change the static IP address of the router in the Guest network to &quot;192.168.10.1&quot; while keeping the netmask as is, and then adjust the DHCP settings of the Guest network to start from &quot;10&quot; and limit to &quot;50&quot; or &quot;25&quot; or however many addresses you want to deal out through DHCP. This will set the LAN network to 192.168.0.0 / 24 and the Guest network to 192.168.10.0 / 24. The networks are no longer in conflict, and everything should work as expected.</p></blockquote></div><p>That&#039;s what I did (via vpn) now. I cannot test it, yet, because, but will do so when I&#039;m at home.</p><div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>If you want to do things the harder way and split the single-octet network (192.168.0.X) in half, then you&#039;ll need to calculate netmasks and know exactly how you configure the &quot;start&quot; and &quot;limit&quot; variables so each network has enough addresses to operate correctly. The minimum number of addresses required by a network is usually 3: the network address, one address for a single host and one address for a multicast endpoint.</p><p>If you want to go the harder way, then begin by reading <a href="http://www.enterprisenetworkingplanet.com/netsp/article.php/3566521/Networking-101-Understanding-Subnets-and-CIDR.htm">http://www.enterprisenetworkingplanet.c … d-CIDR.htm</a> and then use the CIDR calculator at <a href="http://www.subnet-calculator.com/cidr.php">http://www.subnet-calculator.com/cidr.php</a> to determine the correct static IP address and netmask values.</p></blockquote></div><p>I think it makes no sense for me to do it the harder way, because it&#039;s only a home network. Nevertheless I will start reading - if I come to a point where I don&#039;t understand anything anymore or I get too border, I can skip reading. But I&#039;m interested, even if, as I said, I don&#039;t think it makes sense for me to set up a &quot;business network&quot;.</p><p>Thanks a lot once again and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361852">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						12 Jul 2017, 13:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>I think it makes no sense for me to do it the harder way, because it&#039;s only a home network. Nevertheless I will start reading - if I come to a point where I don&#039;t understand anything anymore or I get too border, I can skip reading. But I&#039;m interested, even if, as I said, I don&#039;t think it makes sense for me to set up a &quot;business network&quot;.</p></blockquote></div><p>There is one caveat to this that you might not&#039;ve considered: the address pool size of a network is related to potential network load.</p><p>With that said, consider that your Guest network now has up to 255 addresses available. One is reserved for your router, and one is a broadcast address. A few from the remaining 253 addresses fall inside the DHCP address pool, and are managed by it.</p><p>The remaining addresses which are not reserved and fall outside the DHCP address pool are free for the taking; while you might&#039;ve assigned only, say 25 or 20 addresses into the DHCP pool, then this does not limit the number of clients that your network can actually support. Since the wireless interface that is associated with your Guest network has no encryption or authentication requirements, anyone who is within range can hop on-board. If the DHCP pool is exhausted, then using DHCP on the client will not work, but that does not prevent the client from assigning a static address and then using your network.</p><p>Limiting the maximum size of the address pool by using a more restrictive netmask will effectively limit the maximum number of clients supported by your network, and thus reduce potential network load. A client can still assign itself a static address, but if the maximum limit has already been reached (i.e. all non-reserved addresses are assigned to a DHCP pool, and all of them are leased out at the moment), then traffic collisions are imminent and the &quot;rogue&quot; client could not communicate with the network.</p>											<p class="post-edited">(Last edited by <strong>Antek</strong> on 12 Jul 2017, 13:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361888">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						13 Jul 2017, 00:02					</div>
				</div>
				<div class="post-content content">
					<p>Thanks. I got it - I guess <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Now, my guest network is working, too and I&#039;ll give it a authentication method.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>