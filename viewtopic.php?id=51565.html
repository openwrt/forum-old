<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> self compiled qemu - Waiting for root device /dev/sda2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p239961">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						11 Jul 2014, 13:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I try to compile me a new qemu image on the todays bleeding edge branch (barrier braker). I&#039;ve been running openwrt on qemu as my central router at home for months now. It&#039;s a lot of fun because it&#039;s so blazingly fast even compared e.g. to a WNDR3700v2.</p><p>Though I&#039;m stuck because when I boot it it won&#039;t get further than this<br /> Waiting for root device /dev/sda2...</p><p>I already tried some different kernel modules like scsi-core or ata but none worked so far.</p><p>My libvirt configuration:<br /><a href="http://pastebin.com/TznTTxnA">http://pastebin.com/TznTTxnA</a></p><p>My compile config:<br /><a href="http://pastebin.com/9cqi3GVf">http://pastebin.com/9cqi3GVf</a></p><p><span class="postimg"><img src="http://www.gosix.net/resources/qemu_waiting_for_root.png" alt="PunBB bbcode test" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240056">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						12 Jul 2014, 13:14					</div>
				</div>
				<div class="post-content content">
					<p>I have this attitude adjustment qemu image running with the exact same libvirt configuration (but of course with network interfaces). Working like a charm.<br />OpenWrt Attitude Adjustment 12.09.1 / LuCI 0.11 Branch (0.11+svn9951)</p><p>Doesn&#039;t anybody have&nbsp; barrier breaker running via qemu?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240062">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						12 Jul 2014, 15:00					</div>
				</div>
				<div class="post-content content">
					<p>I have x86 and x86-64 target images running succesful on trunk with Qemu on Arch Linux (qemu 2.0)</p><p>I usually start with command line.</p><p>The wiki pages for Qemu were recently redesigned and updated.<br />have a read at : <a href="http://wiki.openwrt.org/doc/howto/qemu">http://wiki.openwrt.org/doc/howto/qemu</a></p><p>notice the x86-64 &quot;machine&quot; issue with Qemu there<br />the commandline there is working on my end - test it on your side</p><p>Instead of providing the config it is better to supply just the output of <br /></p><div class="codebox"><pre><code>./scripts/diffconfig.sh</code></pre></div><p>That long config file is not really helpful for quickly seeing what stuff you selected that is different from default.</p><p>Somebody needs to add import/export XML profile libvirt stuff to wiki(for quick + dirty command line normally is fine and not overkill like xml)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240081">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						12 Jul 2014, 20:47					</div>
				</div>
				<div class="post-content content">
					<p>I seem to be using qemu 1.0 at ubuntu 12.04.</p><p>You are right I&#039;m sorry. Here&#039;s the diff:<br /></p><div class="quotebox"><blockquote><p>CONFIG_TARGET_x86_64=y<br />CONFIG_TARGET_x86_64_Default=y<br />CONFIG_TARGET_BOARD=&quot;x86_64&quot;<br />CONFIG_OPENSSL_WITH_EC=y<br />CONFIG_PACKAGE_bridge=y<br />CONFIG_PACKAGE_glib2=y<br />CONFIG_PACKAGE_kmod-crypto-core=y<br />CONFIG_PACKAGE_kmod-crypto-hash=y<br />CONFIG_PACKAGE_kmod-fs-ext4=y<br />CONFIG_PACKAGE_kmod-lib-crc16=y<br />CONFIG_PACKAGE_libattr=y<br />CONFIG_PACKAGE_libdbi=y<br />CONFIG_PACKAGE_libeventlog=y<br />CONFIG_PACKAGE_libffi=y<br />CONFIG_PACKAGE_libopenssl=y<br />CONFIG_PACKAGE_libpcre=y<br />CONFIG_PACKAGE_libpthread=y<br />CONFIG_PACKAGE_librt=y<br />CONFIG_PACKAGE_libwrap=y<br />CONFIG_PACKAGE_syslog-ng3=y<br />CONFIG_PACKAGE_zlib=y<br />CONFIG_TARGET_KERNEL_PARTSIZE=8<br />CONFIG_TARGET_ROOTFS_PARTSIZE=250</p></blockquote></div><p>Regarding the x86_64 issue: I&#039;m not using vdi images. Should I be using it? I will try now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240086">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						12 Jul 2014, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>I tried .vdi image with the command given at the wiki qemu page of openwrt you linked, but my qemu version doesn&#039;t support pc-q35-2.0 so I didn&#039;t use the &quot;-M&quot; switch. I also did not give any network interfaces.</p><p>Anyhow I run into the exact same problem:<br />Waiting for root device /dev/sda2...</p><p>I also tried the vdi image with virtualbox (mac) 4.3.8 and this it working fine.</p><p>Update:<br />I updated to Ubuntu 14.04 with Qemu 2.0.0. The problem persists.<br />Update 2:<br />I forgot to run the qemu command line with emulation type pc-q35-2.0. It&#039;s working now.</p><p>Could we conclude that qemu 1.0.0 won&#039;t work with Barrier Breaker trunk since it does not support pc-q35-2.0?</p>											<p class="post-edited">(Last edited by <strong>juni</strong> on 13 Jul 2014, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240290">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						15 Jul 2014, 10:10					</div>
				</div>
				<div class="post-content content">
					<p>Well, it works with qemu 2 to the point where it hangs at hardware / disk detection - it boots grub, so it works to a certain degree (no coredump / Oops)</p><p>afaik there was a ticket asking for IDE drivers that are used in older Qemu machines to be activated but that ticket was denied + closed</p><p>check sth like<br /></p><div class="codebox"><pre><code>CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_Default=y
CONFIG_TARGET_BOARD=&quot;x86_64&quot;
CONFIG_DEVEL=y
CONFIG_BUILD_LOG=y
CONFIG_PACKAGE_kmod-ata-ahci=y
CONFIG_PACKAGE_kmod-ata-core=y
CONFIG_PACKAGE_kmod-ata-marvell-sata=y
CONFIG_PACKAGE_kmod-ata-nvidia-sata=y
CONFIG_PACKAGE_kmod-ata-piix=y
CONFIG_PACKAGE_kmod-ata-sil=y
CONFIG_PACKAGE_kmod-crypto-core=y
CONFIG_PACKAGE_kmod-crypto-hash=y
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-ide-core=y
CONFIG_PACKAGE_kmod-ide-generic=y
CONFIG_PACKAGE_kmod-ide-generic-old=y
CONFIG_PACKAGE_kmod-lib-crc16=y
CONFIG_PACKAGE_kmod-scsi-core=y
CONFIG_PACKAGE_kmod-scsi-generic=y
# CONFIG_TARGET_IMAGES_GZIP is not set
CONFIG_TARGET_INITRAMFS_COMPRESSION_NONE=y
CONFIG_TARGET_KERNEL_PARTSIZE=48
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_ROOTFS_INCLUDE_KERNEL=y
CONFIG_TARGET_ROOTFS_INITRAMFS=y
CONFIG_TARGET_ROOTFS_PARTSIZE=512
# CONFIG_TARGET_ROOTFS_TARGZ is not set
CONFIG_VDI_IMAGES=y
CONFIG_VMDK_IMAGES=y</code></pre></div><p>at my end this boots again with the old<br /></p><div class="codebox"><pre><code>qemu-system-x86_64 -hda openwrt-x86_64-combined-ext4.vdi</code></pre></div><p>commandline</p><p>edit: notice according to <a href="http://wiki.qemu.org/Features/Q35">http://wiki.qemu.org/Features/Q35</a> the new machine has better features like easier pcie passthrough</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 15 Jul 2014, 10:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240588">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						17 Jul 2014, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>Using pc-1.0, qemu 2.0 and your kernel compile config, I&#039;m again stuck at waiting for /dev/sda2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249229">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						5 Oct 2014, 11:22					</div>
				</div>
				<div class="post-content content">
					<p>No matter what I do, I am not able to run openwrt barrier breaker via qemu.<br />Could someone please lead me into the right direction.</p><p>I&#039;m using ubuntu 14.04 with<br />qemu 2.0<br />libvirt 1.2.8</p><p>I would like to have an xml configuration file as in /etc/libvirt/qemu so that it&#039;s easy to handle the virtual machine.<br />The wiki page (<a href="http://wiki.openwrt.org/doc/howto/qemu">http://wiki.openwrt.org/doc/howto/qemu</a>) does not really help.<br />It&#039;s using a vdi image which I do not intend to. Plus there is no xml configuration given.</p><p>Here I read that libvirt can handle q35 only with version 1.3+ (<a href="http://fedoraproject.org/wiki/Features/Virt_PCI_Express_Q35">http://fedoraproject.org/wiki/Features/ â€¦ xpress_Q35</a>).<br />Is it really necessary for me to use q35 in order to be able to use openwrt kvm guest?</p>											<p class="post-edited">(Last edited by <strong>juni</strong> on 5 Oct 2014, 11:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259668">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">juni</div>
					<div class="post-datetime">
						3 Jan 2015, 13:05					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s the status here? I really would like to run openwrt CC trunk in qemu with libvirt.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>