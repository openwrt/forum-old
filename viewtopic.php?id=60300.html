<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> limiting downloads speed with wshaper</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p295988">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						14 Oct 2015, 13:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi my neighbour has let me share its connection but I don&#039;t want to use all his bandwidth so I want to limit mine to 2 mb download and 512 upload<br />i have installed wshaper and edit uplink and downlink speeds but result is still the same</p><p>My setup on a wr740nd router with barrier braker&nbsp; I connected to his network then I created my own wifi called casa for my house</p><p>I am confused as which interface should wshaper use I tried wwan lan w0 but still the same 10mb downloads 1mb upload</p><p>This is config for wshaper now</p><p>BARRIER BREAKER (14.07, r42625)<br /> -----------------------------------------------------<br />&nbsp; * 1/2 oz Galliano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Pour all ingredients into<br />&nbsp; * 4 oz cold Coffee&nbsp; &nbsp; &nbsp; &nbsp; an irish coffee mug filled<br />&nbsp; * 1 1/2 oz Dark Rum&nbsp; &nbsp; &nbsp; &nbsp;with crushed ice. Stir.<br />&nbsp; * 2 tsp. Creme de Cacao<br /> -----------------------------------------------------<br />root@OpenWrt:~# uci show wshaper<br />wshaper.settings=wshaper<br />wshaper.settings.upink=512<br />wshaper.settings.downlink=128<br />wshaper.settings.network=w0<br />root@OpenWrt:~#</p><br /><br /><p>I enclose screenshots of my setup</p><p><span class="postimg"><img src="http://i.imgur.com/Vi1CIPl.png" alt="http://i.imgur.com/Vi1CIPl.png" /></span></p><p><span class="postimg"><img src="http://i.imgur.com/In0n6i0.png" alt="http://i.imgur.com/In0n6i0.png" /></span></p>											<p class="post-edited">(Last edited by <strong>robi62</strong> on 14 Oct 2015, 13:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296016">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						14 Oct 2015, 17:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi robie62,</p><div class="quotebox"><cite>robi62 wrote:</cite><blockquote><p>Hi my neighbour has let me share its connection but I don&#039;t want to use all his bandwidth so I want to limit mine to 2 mb download and 512 upload<br />i have installed wshaper and edit uplink and downlink speeds but result is still the same</p><p>My setup on a wr740nd router with barrier braker&nbsp; I connected to his network then I created my own wifi called casa for my house</p><p>I am confused as which interface should wshaper use I tried wwan lan w0 but still the same 10mb downloads 1mb upload</p><p>This is config for wshaper now</p><p>BARRIER BREAKER (14.07, r42625)<br /> -----------------------------------------------------<br />&nbsp; * 1/2 oz Galliano&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Pour all ingredients into<br />&nbsp; * 4 oz cold Coffee&nbsp; &nbsp; &nbsp; &nbsp; an irish coffee mug filled<br />&nbsp; * 1 1/2 oz Dark Rum&nbsp; &nbsp; &nbsp; &nbsp;with crushed ice. Stir.<br />&nbsp; * 2 tsp. Creme de Cacao<br /> -----------------------------------------------------<br />root@OpenWrt:~# uci show wshaper<br />wshaper.settings=wshaper<br />wshaper.settings.upink=512<br />wshaper.settings.downlink=128<br />wshaper.settings.network=w0<br />root@OpenWrt:~#</p><br /><br /><p>I enclose screenshots of my setup</p><p><span class="postimg"><img src="http://i.imgur.com/Vi1CIPl.png" alt="http://i.imgur.com/Vi1CIPl.png" /></span></p><p><span class="postimg"><img src="http://i.imgur.com/In0n6i0.png" alt="http://i.imgur.com/In0n6i0.png" /></span></p></blockquote></div><br /><p>Unfortunately, I will not be able to help you with wonder shaper, but I would recommend you install and use the sqm-scripts and luci-app-sqm packages instead. They should work better than shaper (shaper, for example does not work at all for IPv6). Also in case of problems I might be able to help out a bit...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296101">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						15 Oct 2015, 11:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Hi robie62,</p><br /><p>Unfortunately, I will not be able to help you with wonder shaper, but I would recommend you install and use the sqm-scripts and luci-app-sqm packages instead. They should work better than shaper (shaper, for example does not work at all for IPv6). Also in case of problems I might be able to help out a bit...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p></blockquote></div><p>Hi could not find the app in barrier breaker but i installed the scripts </p><p>this is config file what should i do<br />root@OpenWrt:~# uci show sqm<br />sqm.eth1=queue<br />sqm.eth1.enabled=0<br />sqm.eth1.interface=eth1<br />sqm.eth1.download=85000<br />sqm.eth1.upload=10000<br />sqm.eth1.qdisc=fq_codel<br />sqm.eth1.script=simple.qos<br />sqm.eth1.qdisc_advanced=0<br />sqm.eth1.ingress_ecn=ECN<br />sqm.eth1.egress_ecn=NOECN<br />sqm.eth1.qdisc_really_really_advanced=0<br />sqm.eth1.itarget=auto<br />sqm.eth1.etarget=auto<br />sqm.eth1.linklayer=none</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296103">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						15 Oct 2015, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>In general, you should update to Chaos Calmer 15.05.<br />SQM packages are found natively there, and also otherwise it is much more modern.</p><p>The plain scripts may not help you much, as you need also a ton of kernel modules, which the normal installation would install for you.</p><br /><p>EDIT: hmmm. your router has only 4 MB flash. Might be tight with CC15.05.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 15 Oct 2015, 11:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296104">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						15 Oct 2015, 11:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi robi62,</p><p>I agree with hnyman, switching to CC would be much nicer, though I share his concern about the flash size. His idea about the required modules also is not completely off the mark manual installation is not going to be simple. I am not 100% certain, but I believe that sqm-scripts also entered the BB repositories, but that certainly is not the most recent version, so if at all possible CC15.05 would be a much better base.</p><p>Also I note that you don not really specify on which interface you connect to your neighbor. If you use a wired connection via the WAN port there is a good chance to get out working, if you connect via WLAN it will get trickier...</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296109">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						15 Oct 2015, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>hi i mamaged to get app and installed gui in luci and enabled qos i have set download speed to 2000 and 4000 but it starts downloading about 1mb then goes to 0.40 any ideas why????</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296110">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						15 Oct 2015, 11:49					</div>
				</div>
				<div class="post-content content">
					<p>Actually there is the 1.0.3 sqm-scripts (of September 2015) for the 14.07 branch, so it is recent.<br /><a href="https://github.com/openwrt/packages/blob/for-14.07/net/sqm-scripts/Makefile">https://github.com/openwrt/packages/blo … s/Makefile</a></p><p>But no binary package is available for download, so it needs to be built by the user. (I did that for my previous BB firmware version, so it works ok.)</p><br /><p>EDIT: <br />To your last message of having got it installed:<br />What are your settings?<br />and what is your network config?</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 15 Oct 2015, 11:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296112">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						15 Oct 2015, 12:10					</div>
				</div>
				<div class="post-content content">
					<p>i have seem to have managed it set downloads speed to 20000 and that get me about just over two meg download</p><p>I set upload to 5000 but uploads still 1 meg so I need to lower that</p><p>queue discipline i left default and link layer adaptation I left default</p><p>Download Speed: 2.35 Mbps<br />Upload Speed: 1.13 Mbps<br />these are test speed results</p>											<p class="post-edited">(Last edited by <strong>robi62</strong> on 15 Oct 2015, 12:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296116">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						15 Oct 2015, 12:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robi62 wrote:</cite><blockquote><p>hi i mamaged to get app and installed gui in luci and enabled qos i have set download speed to 2000 and 4000 but it starts downloading about 1mb then goes to 0.40 any ideas why????</p></blockquote></div><p>Could you please ost the output of the following commands (assuming you run sqm-scripts):</p><p>cat /etc/config/sqm</p><p>tc -d qdisc</p><p>/etc/init.d/sqm stop</p><p>/etc/init.d/sqm start</p><p>tc -d qdisc</p><p>ifconfig</p><p>dmesg</p><br /><p>Also do you connect to your neighbor via WLAN/WIFI or via a cable?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296117">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						15 Oct 2015, 13:15					</div>
				</div>
				<div class="post-content content">
					<p>hi moeller0</p><p>i have managed to get it working</p><p>I wanted to know how do I delete wshaper config file and qos config file?????</p><p>I have removed programs but config files still exists<br />will they interfere with sqm ????<br />Regards</p>											<p class="post-edited">(Last edited by <strong>robi62</strong> on 15 Oct 2015, 13:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296353">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						17 Oct 2015, 05:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi robi62,</p><br /><div class="quotebox"><cite>robi62 wrote:</cite><blockquote><p>hi moeller0</p><p>i have managed to get it working</p><p>I wanted to know how do I delete wshaper config file and qos config file?????</p><p>I have removed programs but config files still exists<br />will they interfere with sqm ????<br />Regards</p></blockquote></div><p>Great that you got it working (not exactly sure which version of what). I have never used wonder-shaper myself, but looking at <a href="https://github.com/openwrt/packages/blob/master/net/wshaper/Makefile">https://github.com/openwrt/packages/blo … r/Makefile</a> I believe the following files should be removed:<br />/etc/init.d/wshaper<br />/etc/hotplug.d/iface/10-wshaper<br />/etc/config/wshaper</p><p>Now, I am not sure which of those will be removed by &quot;opkg remove wshaper&quot; but I believe you can go and manually delete any leftovers...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296583">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">robi62</div>
					<div class="post-datetime">
						19 Oct 2015, 14:02					</div>
				</div>
				<div class="post-content content">
					<p>Ok I have tried to in install Chaos Calmer 15.05 but then there was not enough space to install anything </p><p>so I reflashed barrier braker and now its working as it should after testing different interfaces in sqm</p><p>I set downloads to 2000 and uploads to 500 so I am only using 2mb out of 10 which its enough for me</p><p>Thank you guys for help I appreciate it</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>