<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> howto tl-mr3020 webcam-server with upload over wifi</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p193667">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">antonio66</div>
					<div class="post-datetime">
						3 Mar 2013, 11:32					</div>
				</div>
				<div class="post-content content">
					<p>Dear,<br />I&#039;ve a TL-MR3020 working with logitech c210 webcam. I used mjpg-streamer and the actual openwrt firmware for this device.</p><p>Now I trying to setup the TL-MR3020 as standalone &quot;webcam&quot;-server with only wifi-connection (client) to my network; and it must be able to send the stream and/or pictures over ftp to my homepage.</p><p>I search this forum, but there are too many hits and it&#039;s confusing (for me) to find the right way for my intention <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Who has or knows the quick-and-dirty solution or thread for my plan?</p><p>Thx<br />antonio</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193680">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						3 Mar 2013, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>Not exactly what you are looking for, but here&#039;s a link with some detail on over-the-web streaming with mjpg-streamer:</p><p><a href="http://www.picaxeforum.co.uk/showthread.php?13705-Rivercam-with-PICAXE-pan-tilt-control&amp;highlight=rivercam">http://www.picaxeforum.co.uk/showthread … t=rivercam</a></p><p>I&#039;ve done something closer to what you appear to be asking about with &quot;motion&quot;--saving images and emailing a day&#039;s worth at a time--any time period could be used, or ftp.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193692">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">antonio66</div>
					<div class="post-datetime">
						3 Mar 2013, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>yes, I found this page, too. But I need something very simple and small without overcharching my network.</p><p>well I found a solution; the mjpg-streamer wiki-howto is not updated, but I found a few more parameters on the installed version.</p><p>output_file.so have options like single-export-file,&nbsp; delaytime and command. Then I found and install wput and to start ftp-upload of pictures over wifi to my homepage. It works.</p><p>I know, that&#039;s nothing special, but all the pages describes streaming-cam, but no simple picture upload...</p><p>thx anyway</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203343">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">wifi487uci</div>
					<div class="post-datetime">
						31 May 2013, 15:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi Antonio66,</p><p>I have just bought TL-MR3020, I have Microsoft lifecam cinema. I installed OPENWRT but I could&#039;t run the camera. I need only stream over on my local network. Can you guide me? I&#039;m newby in linux and OpenWrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203345">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						31 May 2013, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>Did you see this?<br /><a href="https://forum.openwrt.org/viewtopic.php?id=42552">https://forum.openwrt.org/viewtopic.php?id=42552</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203353">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wifi487uci</div>
					<div class="post-datetime">
						31 May 2013, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>Yes , It was my reference. but it didn&#039;t work. I tried many time.&nbsp; May be I made a mistake somewhere.</p>											<p class="post-edited">(Last edited by <strong>wifi487uci</strong> on 31 May 2013, 17:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203355">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						31 May 2013, 17:21					</div>
				</div>
				<div class="post-content content">
					<p>More information please. Once the cam is plugged in, what is the output of:<br /></p><div class="codebox"><pre><code> lsusb
dmesg</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203356">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">wifi487uci</div>
					<div class="post-datetime">
						31 May 2013, 17:29					</div>
				</div>
				<div class="post-content content">
					<p>Some questions:<br />I didn&#039;t install openwrt-brcm47xx-squashfs.trx (Because, I will not use wireless. I&#039;m making a submarin robot, and comminication will be with a cable). May I install?<br />There is a swich on the rooter (3G,WISP,AP) for mode. I set it on 3G position. Is it right?<br />I connect the camera 3G&nbsp; USB jack.</p><p>I see the camera with (Isusb). So I passed the first stage.<br />But,&nbsp; &quot;opkg install kmod-usb-video&quot; command not worked.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203358">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wifi487uci</div>
					<div class="post-datetime">
						31 May 2013, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>Thanks alot,</p><br /><p>lsusb<br />Bus 001 Device 002: ID 045e:075d Microsoft Corp. LifeCam Cinema<br />Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</p><br /><p>root@OpenWrt:~# dmesg<br />[&nbsp; &nbsp; 0.000000] Linux version 3.3.8 (blogic@Debian-60-squeeze-64-minimal) (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #1 Sun Nov 18 04:31:55 UTC 2012<br />[&nbsp; &nbsp; 0.000000] MyLoader: sysp=444ba8b5, boardp=5fbcaeef, parts=ebc66edc<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019374 (MIPS 24Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Atheros AR9330 rev 1<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 02000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone PFN ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00002000<br />[&nbsp; &nbsp; 0.000000] Movable zone start PFN for each node<br />[&nbsp; &nbsp; 0.000000] Early memory PFN ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;0: 0x00000000 -&gt; 0x00002000<br />[&nbsp; &nbsp; 0.000000] On node 0 totalpages: 8192<br />[&nbsp; &nbsp; 0.000000] free_area_init_node: node 0, pgdat 802ef060, node_mem_map 81000000<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 64 pages used for memmap<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 0 pages reserved<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal zone: 8128 pages, LIFO batch:0<br />[&nbsp; &nbsp; 0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768<br />[&nbsp; &nbsp; 0.000000] pcpu-alloc: [0] 0<br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />[&nbsp; &nbsp; 0.000000] Kernel command line:&nbsp; board=TL-MR3020 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 128 (order: -3, 512 bytes)<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />[&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />[&nbsp; &nbsp; 0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />[&nbsp; &nbsp; 0.000000] Writing ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Readback ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Memory: 29008k/32768k available (2209k kernel code, 3760k reserved, 412k data, 212k init, 0k highmem)<br />[&nbsp; &nbsp; 0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:51<br />[&nbsp; &nbsp; 0.000000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)<br />[&nbsp; &nbsp; 0.080000] pid_max: default: 32768 minimum: 301<br />[&nbsp; &nbsp; 0.080000] Mount-cache hash table entries: 512<br />[&nbsp; &nbsp; 0.090000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.090000] gpiochip_add: registered GPIOs 0 to 29 on device: ath79<br />[&nbsp; &nbsp; 0.100000] MIPS: machine is TP-LINK TL-MR3020<br />[&nbsp; &nbsp; 0.350000] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.360000] Switching to clocksource MIPS<br />[&nbsp; &nbsp; 0.360000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.370000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.370000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.370000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.380000] TCP: Hash tables configured (established 1024 bind 1024)<br />[&nbsp; &nbsp; 0.390000] TCP reno registered<br />[&nbsp; &nbsp; 0.390000] UDP hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.400000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.400000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 0.410000] PCI: CLS 0 bytes, default 32<br />[&nbsp; &nbsp; 0.430000] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 0.430000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.440000] msgmni has been set to 56<br />[&nbsp; &nbsp; 0.440000] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254)<br />[&nbsp; &nbsp; 0.450000] io scheduler noop registered<br />[&nbsp; &nbsp; 0.450000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.460000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled<br />[&nbsp; &nbsp; 0.470000] ar933x-uart: ttyATH0 at MMIO 0x18020000 (irq = 11) is a AR933X UART<br />[&nbsp; &nbsp; 0.480000] console [ttyATH0] enabled, bootconsole disabled<br />[&nbsp; &nbsp; 0.490000] m25p80 spi0.0: found s25sl032a, expected m25p80<br />[&nbsp; &nbsp; 0.500000] m25p80 spi0.0: s25sl032a (4096 Kbytes)<br />[&nbsp; &nbsp; 0.500000] 5 tp-link partitions found on MTD device spi0.0<br />[&nbsp; &nbsp; 0.510000] Creating 5 MTD partitions on &quot;spi0.0&quot;:<br />[&nbsp; &nbsp; 0.510000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;<br />[&nbsp; &nbsp; 0.520000] 0x000000020000-0x000000109894 : &quot;kernel&quot;<br />[&nbsp; &nbsp; 0.520000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />[&nbsp; &nbsp; 0.540000] 0x000000109894-0x0000003f0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 0.540000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />[&nbsp; &nbsp; 0.550000] mtd: partition &quot;rootfs&quot; set to be root filesystem<br />[&nbsp; &nbsp; 0.560000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2E0000, len=110000<br />[&nbsp; &nbsp; 0.570000] 0x0000002e0000-0x0000003f0000 : &quot;rootfs_data&quot;<br />[&nbsp; &nbsp; 0.570000] 0x0000003f0000-0x000000400000 : &quot;art&quot;<br />[&nbsp; &nbsp; 0.580000] 0x000000020000-0x0000003f0000 : &quot;firmware&quot;<br />[&nbsp; &nbsp; 0.600000] ag71xx_mdio: probed<br />[&nbsp; &nbsp; 0.610000] eth0: Atheros AG71xx at 0xb9000000, irq 4<br />[&nbsp; &nbsp; 1.160000] ag71xx ag71xx.0: eth0: connected to PHY at ag71xx-mdio.1:00 [uid=004dd041, driver=Generic PHY]<br />[&nbsp; &nbsp; 1.170000] TCP cubic registered<br />[&nbsp; &nbsp; 1.170000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.180000] Bridge firewalling registered<br />[&nbsp; &nbsp; 1.180000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 1.190000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />[&nbsp; &nbsp; 1.200000] Freeing unused kernel memory: 212k freed<br />[&nbsp; &nbsp; 3.080000] Registered led device: tp-link:green:3g<br />[&nbsp; &nbsp; 3.090000] Registered led device: tp-link:green:wlan<br />[&nbsp; &nbsp; 3.090000] Registered led device: tp-link:green:lan<br />[&nbsp; &nbsp; 3.090000] Registered led device: tp-link:green:wps<br />[&nbsp; &nbsp; 5.160000] eth0: link up (100Mbps/Full duplex)<br />[&nbsp; &nbsp; 6.400000] JFFS2 notice: (442) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (1 unchecked, 0 orphan) and 15 of xref (0 dead, 5 orphan) found.<br />[&nbsp; &nbsp; 6.520000] eth0: link down<br />[&nbsp; &nbsp; 8.310000] Compat-drivers backport release: compat-drivers-2012-09-04-2-gddac993<br />[&nbsp; &nbsp; 8.310000] Backport based on wireless-testing.git master-2012-09-07<br />[&nbsp; &nbsp; 8.320000] compat.git: wireless-testing.git<br />[&nbsp; &nbsp; 8.350000] cfg80211: Calling CRDA to update world regulatory domain<br />[&nbsp; &nbsp; 8.360000] cfg80211: World regulatory domain updated:<br />[&nbsp; &nbsp; 8.360000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp; 8.370000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 8.380000] cfg80211:&nbsp; &nbsp;(2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 8.390000] cfg80211:&nbsp; &nbsp;(2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 8.390000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 8.400000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 8.750000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 8.750000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 8.760000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 9.320000] ath: EEPROM regdomain: 0x0<br />[&nbsp; &nbsp; 9.320000] ath: EEPROM indicates default country code should be used<br />[&nbsp; &nbsp; 9.320000] ath: doing EEPROM country-&gt;regdmn map search<br />[&nbsp; &nbsp; 9.320000] ath: country maps to regdmn code: 0x3a<br />[&nbsp; &nbsp; 9.320000] ath: Country alpha2 being used: US<br />[&nbsp; &nbsp; 9.320000] ath: Regpair used: 0x3a<br />[&nbsp; &nbsp; 9.320000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;<br />[&nbsp; &nbsp; 9.320000] Registered led device: ath9k-phy0<br />[&nbsp; &nbsp; 9.320000] ieee80211 phy0: Atheros AR9330 Rev:1 mem=0xb8100000, irq=2<br />[&nbsp; &nbsp; 9.330000] cfg80211: Calling CRDA for country: US<br />[&nbsp; &nbsp; 9.330000] cfg80211: Regulatory domain changed to country: US<br />[&nbsp; &nbsp; 9.340000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp; 9.350000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)<br />[&nbsp; &nbsp; 9.360000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)<br />[&nbsp; &nbsp; 9.360000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 9.370000] cfg80211:&nbsp; &nbsp;(5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 9.380000] cfg80211:&nbsp; &nbsp;(5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp; 9.390000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)<br />[&nbsp; &nbsp; 9.450000] PPP generic driver version 2.4.2<br />[&nbsp; &nbsp; 9.710000] ip_tables: (C) 2000-2006 Netfilter Core Team<br />[&nbsp; &nbsp; 9.930000] NET: Registered protocol family 24<br />[&nbsp; &nbsp; 9.950000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 9.960000] ehci-platform ehci-platform: Generic Platform EHCI Controller<br />[&nbsp; &nbsp; 9.960000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp;10.000000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp;10.020000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp;10.020000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp;10.020000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp;10.050000] nf_conntrack version 0.5.0 (456 buckets, 1824 max)<br />[&nbsp; &nbsp;10.300000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp;10.330000] uhci_hcd: USB Universal Host Controller Interface driver<br />[&nbsp; &nbsp;10.430000] i2c /dev entries driver<br />[&nbsp; &nbsp;10.520000] Linux video capture interface: v2.00<br />[&nbsp; &nbsp;10.660000] usbcore: registered new interface driver uvcvideo<br />[&nbsp; &nbsp;10.670000] USB Video Class driver (1.1.1)<br />[&nbsp; &nbsp;14.250000] eth0: link up (100Mbps/Full duplex)<br />[&nbsp; &nbsp;90.780000] usb 1-1: new high-speed USB device number 2 using ehci-platform<br />[&nbsp; &nbsp;90.950000] uvcvideo: Found UVC 1.00 device MicrosoftÂ® LifeCam Cinema(TM) (045e:075d)<br />[&nbsp; &nbsp;90.960000] input: MicrosoftÂ® LifeCam Cinema(TM) as /devices/platform/ehci-platform/usb1/1-1/1-1:1.0/input/input0<br />root@OpenWrt:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203359">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						31 May 2013, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>Strange, it seem recognised OK. I was working on a webcam on my wr703n a little while back, and everything was cool.<br />I can&#039;t remember what I did though. (Recognising the camera was the big hurdle).<br />I *think* I found the solution here:<br /><a href="http://h-wrt.com/en/doc">http://h-wrt.com/en/doc</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203362">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">wifi487uci</div>
					<div class="post-datetime">
						31 May 2013, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>Wooow, Many thanks</p><p>I entered the following commands (from the that link which you gived) and it worked.</p><p>root@OpenWrt:/# ls /dev/v*<br />root@OpenWrt:/# mjpg_streamer -i &quot;input_uvc.so -d /dev/video0 -y&quot; -o &quot;output_http.so&quot;</p><p>I see the stream on the browser.<br /><a href="http://192.168.2.123:8080/?action=stream">http://192.168.2.123:8080/?action=stream</a></p><p>(192.168.2.123 is my router IP address)</p>											<p class="post-edited">(Last edited by <strong>wifi487uci</strong> on 31 May 2013, 19:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206586">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">adrianp03</div>
					<div class="post-datetime">
						6 Jul 2013, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>I have a question here, I&#039;m close to update my stock firmware with OpenWrt in order to plug my usb webcam.<br />The idea here, mjpg_streamer can start encoding when there is one or more http client connected and stop encoding when there is no more client ? Something like VOD (video on demand). Because I do not want it to stream continuously.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206594">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						7 Jul 2013, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>&gt; I do not want it to stream continuously.</p><p>Not sure what your point is.&nbsp; If no one is watching, does it matter if it is still streaming?</p><p>You could make a cgi page with a button a user would click to start streaming, but I&#039;m not sure how you would stop it when they go away.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206598">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">adrianp03</div>
					<div class="post-datetime">
						7 Jul 2013, 00:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>&gt; I do not want it to stream continuously.</p><p>Not sure what your point is.&nbsp; If no one is watching, does it matter if it is still streaming?</p><p>You could make a cgi page with a button a user would click to start streaming, but I&#039;m not sure how you would stop it when they go away.</p></blockquote></div><p>Well, first is annoying like the led to be on all the time. And why to load a router which is hardware/resources limited to make a task when no client is requesting it ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211084">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hurjup</div>
					<div class="post-datetime">
						29 Aug 2013, 00:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>adrianp03 wrote:</cite><blockquote><div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>&gt; I do not want it to stream continuously.</p><p>Not sure what your point is.&nbsp; If no one is watching, does it matter if it is still streaming?</p><p>You could make a cgi page with a button a user would click to start streaming, but I&#039;m not sure how you would stop it when they go away.</p></blockquote></div><p>Well, first is annoying like the led to be on all the time. And why to load a router which is hardware/resources limited to make a task when no client is requesting it ? :)</p></blockquote></div><p>I also judge wasting of resources on a very limited hardware a bad thing. So I&#039;ve begun to tinker.<br />Please note that after one and a half wasted decades, just started networking &quot;seriously&quot; (having recently my first openwrt router, the perfect medium to do so). It implies that <span class="bbu">the below code works, but does that in a rather painful way.</span> See comments at the bottom of my reply.</p><p>So the intention how it should work: After digging the internet for a while how to open ports, I learned that netcat can do the trick. So the basic idea was that port 8080 will always be open - mostly by netcat, otherwise by mjpg-streamer. If a client arrives, netcat will notice it and tries to do something; hopefully redirecting it to the meanwhile started streamer. If no client connects to 8080, the streamer will be stopped and netcat starts listening on 8080 again.<br />Here is the code, followed by some questions:</p><div class="codebox"><pre><code>#!/bin/sh

trap &quot;echo &#039;Exiting...&#039; ; /etc/init.d/mjpg-streamer stop ; sleep 1 ; exit 0&quot; SIGINT SIGTERM

client_candidate=0
hc_retval=

http_client_present() {
    netstat -nat 2&gt;/dev/null | grep 8080 | grep -c ESTABLISHED
}

do_we_have_candidate() {
     if [ &quot;$client_candidate&quot; -eq 1 ] ; then
         client_candidate=0
         hc_retval=1
         return
     fi
     hc_retval=0
     return
}

mjpg_streamer_is_running() {
    ps | grep mjpg_streamer | grep -cv grep
}

while : ; do
    do_we_have_candidate 
    
    # All clients gone, so...
    if [ &quot;$(http_client_present)&quot; -eq 0 ] &amp;&amp; [ &quot;$hc_retval&quot; -eq 0 ] ; then
        # ... cut streaming if on, and...
        if [ &quot;$(mjpg_streamer_is_running)&quot; -eq 1 ] ; then
            /etc/init.d/mjpg-streamer stop
             sleep 1
        fi
        # ... wait for another client (candidate).
         netcat -l -p 8080 &lt; dummy.html # no here strings in &#039;sh&#039; afaik
        client_candidate=1

    # We have at least one client.
    else
        # So start streaming, and...
        if [ &quot;$(mjpg_streamer_is_running)&quot; -eq 0 ] ; then
            /etc/init.d/mjpg-streamer start
             sleep 1
        fi
        # ... hope the client reconnects in 15 sec
        # so http_client_present becomes true until the next check.
        sleep 15
    fi
done</code></pre></div><p>And the comments and questions:<br />- Is there a better approach for this video on demand thing?<br />- Without redirecting something (here: dummy.html) into netcat, it doesn&#039;t really work. The client candidates simply glance off. Is there some other, better parameterizing of netcat?<br />- This is how now it works with firefox: the client candidate tries to connect to netcat and goes to some &quot;Connection: Keep-Alive&quot; state. After refreshing manually, firefox receives the garbage content of dummy.html . At last, the third try will succeed in case it is within 15 seconds. Yes, it is painful. But it works at least.<br />On an android smartphone the mjpg client software should be killed by task manager (because of the garbage), and after restarting (within 15 seconds) it connects. Yes, it is painful too.<br />Can someone tell me whether it can be made better using netcat? (Different content of dummy.html, different parameterizing, etc.) I have no domain knowledge in this area.</p><p>Oh and some keywords at the end, probably the scribes will find this post more easily.<br />&quot;video on demand&quot; &quot;VOD&quot; &quot;mjpg-streamer&quot; &quot;open port&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211252">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">hurjup</div>
					<div class="post-datetime">
						30 Aug 2013, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve mastered the script, now it works flawlessly: the new client candidates get the stream right away, without the must to push refresh. Also, the stop of streaming and cleanup at exit looks fine too.<br />Some solutions may not be perfectly elegant, so feel free to improve.</p><div class="codebox"><pre><code>#!/bin/sh

trap &#039;echo &quot;Exiting...&quot; ; /etc/init.d/mjpg-streamer stop ; sleep 1 ; kill $(jobs -p) ; exit 0&#039; SIGINT SIGTERM EXIT

CLIENT_CHECK_INTERVAL=15
client_candidate=0
have_candidate=

http_client_present() {
    netstat -nat 2&gt;/dev/null | grep 8080 | grep -c ESTABLISHED
}

do_we_have_candidate() {
    if [ &quot;$client_candidate&quot; -eq 1 ] ; then
        client_candidate=0
        have_candidate=1
        return
    fi
    have_candidate=0
    return
}

mjpg_streamer_is_running() {
    ps | grep mjpg_streamer | grep -cv grep
}

conditional_start_mjpg() {
if [ &quot;$(mjpg_streamer_is_running)&quot; -eq 0 ] ; then
    /etc/init.d/mjpg-streamer start
    sleep 1
fi
}

conditional_stop_mjpg() {
if [ &quot;$(mjpg_streamer_is_running)&quot; -eq 1 ] ; then
    /etc/init.d/mjpg-streamer stop
    sleep 1
fi
}

netcat_stopper() {
    local NETCAT_PID
    
    sleep 1
    NETCAT_PID=$(ps | grep netcat | grep -v grep | cut -c 1-5 | tr -d &#039; &#039; | tail -1)
    while : ; do
        if [ &quot;$(http_client_present)&quot; -eq 1 ] ; then
            conditional_start_mjpg
            kill $NETCAT_PID
            break
        fi
        sleep 3
    done
}

while : ; do
    do_we_have_candidate

    if [ &quot;$(http_client_present)&quot; -eq 0 ] &amp;&amp; [ &quot;$have_candidate&quot; -eq 0 ] ; then
        conditional_stop_mjpg
        netcat_stopper &amp;
        netcat -l -p 8080
        client_candidate=1
    else
        conditional_start_mjpg
        sleep $CLIENT_CHECK_INTERVAL
    fi
done</code></pre></div>											<p class="post-edited">(Last edited by <strong>hurjup</strong> on 31 Aug 2013, 12:38)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>