<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netflow exporter for OpenWrt?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p336521">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						30 Aug 2016, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>In the (distant) past, I used fprobe with Cerowrt to act as a netflow exporter. (A note on terminology: a &quot;netflow exporter&quot; runs in a router and sends summary stats to a &quot;netflow collector&quot;, such as ntop, for display.)</p><p>fprobe 1.1 was available in Barrier Breaker, but seems to have fallen out of the CC builds. Last known source bundle was at <a href="https://sourceforge.net/projects/fprobe/">https://sourceforge.net/projects/fprobe/</a></p><p>Does anyone know whether fprobe still works? Can/will it be added to CC builds? Are there alternatives? Many thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337203">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						5 Sep 2016, 09:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><p>In the (distant) past, I used fprobe with Cerowrt to act as a netflow exporter. (A note on terminology: a &quot;netflow exporter&quot; runs in a router and sends summary stats to a &quot;netflow collector&quot;, such as ntop, for display.)</p><p>fprobe 1.1 was available in Barrier Breaker, but seems to have fallen out of the CC builds. Last known source bundle was at <a href="https://sourceforge.net/projects/fprobe/">https://sourceforge.net/projects/fprobe/</a></p><p>Does anyone know whether fprobe still works? Can/will it be added to CC builds? Are there alternatives? Many thanks.</p></blockquote></div><p>What about pmacct?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343720">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						14 Nov 2016, 21:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>milankocvara wrote:</cite><blockquote><div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><p>In the (distant) past, I used fprobe with Cerowrt to act as a netflow exporter. (A note on terminology: a &quot;netflow exporter&quot; runs in a router and sends summary stats to a &quot;netflow collector&quot;, such as ntop, for display.)</p><p>fprobe 1.1 was available in Barrier Breaker, but seems to have fallen out of the CC builds. Last known source bundle was at <a href="https://sourceforge.net/projects/fprobe/">https://sourceforge.net/projects/fprobe/</a></p><p>Does anyone know whether fprobe still works? Can/will it be added to CC builds? Are there alternatives? Many thanks.</p></blockquote></div><p>What about pmacct?</p></blockquote></div><p>Sorry to revive an old thread - do you use pmacct? Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343753">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						15 Nov 2016, 08:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><div class="quotebox"><cite>milankocvara wrote:</cite><blockquote><div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><p>In the (distant) past, I used fprobe with Cerowrt to act as a netflow exporter. (A note on terminology: a &quot;netflow exporter&quot; runs in a router and sends summary stats to a &quot;netflow collector&quot;, such as ntop, for display.)</p><p>fprobe 1.1 was available in Barrier Breaker, but seems to have fallen out of the CC builds. Last known source bundle was at <a href="https://sourceforge.net/projects/fprobe/">https://sourceforge.net/projects/fprobe/</a></p><p>Does anyone know whether fprobe still works? Can/will it be added to CC builds? Are there alternatives? Many thanks.</p></blockquote></div><p>What about pmacct?</p></blockquote></div><p>Sorry to revive an old thread - do you use pmacct? Thanks.</p></blockquote></div><p>Yes, I&#039;m using pmacct on different distro (slackware). <br />I have tried it on my OpenWRT based distro too. It take a little bit more CPU on AA AR71x... (Not tested on BB or CC yet.) but it is working. </p><p>Or take a look into old packages for fprobe.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343765">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						15 Nov 2016, 10:45					</div>
				</div>
				<div class="post-content content">
					<p>I use softflowd. There&#039;s a package in the packages feeds. Just works and does netflow v9</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343828">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						16 Nov 2016, 07:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>I use softflowd. There&#039;s a package in the packages feeds. Just works and does netflow v9</p></blockquote></div><p>I tried installing it (v0.9.9 on CC 15.05.1) from LuCI, but don&#039;t see any data sent to the collector. Here&#039;s /etc/config/softflowd:</p><div class="codebox"><pre><code>config softflowd
    option enabled        &#039;1&#039;
    option interface      &#039;br-lan&#039;
    option pcap_file      &#039;&#039;
    option timeout        &#039;&#039;
    option max_flows      &#039;8192&#039;
    option host_port      &#039;192.168.254.5:2055&#039;
    option pid_file       &#039;/var/run/softflowd.pid&#039;
    option control_socket &#039;/var/run/softflowd.ctl&#039;
    option export_version &#039;5&#039;
    option hoplimit       &#039;&#039;
    option tracking_level &#039;full&#039;
    option track_ipv6     &#039;0&#039;
    option sampling_rate  &#039;100&#039;</code></pre></div><p>Then I invoke with &#039;/etc/init.d/softflowd restart&#039;</p><p>ps shows this command is running:</p><div class="codebox"><pre><code>/usr/sbin/softflowd -i br-lan -m 8192 -n 192.168.254.5:2055 -p /var/run/softflowd.pid -c /var/run/softflowd.ctl -v 5 -T full -s 100 -p /var/run/softflowd.pid</code></pre></div><p>I have also tried with eth0 (my WAN port, not br-lan) with the same (non-)results.</p><p>Any thoughts about why I don&#039;t see any Netflow traffic on port 2055 of 192.168.254.5? Thanks.</p>											<p class="post-edited">(Last edited by <strong>richbhanover</strong> on 16 Nov 2016, 07:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343844">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						16 Nov 2016, 10:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>I use softflowd. There&#039;s a package in the packages feeds. Just works and does netflow v9</p></blockquote></div><p>I tried installing it (v0.9.9 on CC 15.05.1) from LuCI, but don&#039;t see any data sent to the collector. Here&#039;s /etc/config/softflowd:</p><p>.....</p><p>Any thoughts about why I don&#039;t see any Netflow traffic on port 2055 of 192.168.254.5? Thanks.</p></blockquote></div><p>I seem to recall I also had problems with the default init script and config and so I wrote my own very simple hard-coded init script. Suggest you try invoking it manually and see if it works in manual mode. My command line is</p><div class="codebox"><pre><code>/usr/sbin/softflowd -i br-lan -6 -v 9 -n 192.168.254.5:2055 -p /var/run/softflowd.pid</code></pre></div><p>You definitely don&#039;t want it running on the WAN port, otherwise you&#039;re not going to be able to resolve the internal IPs - all you&#039;ll get is the appearance of every connection originating from your WAN IP. I&#039;m running CERT NetSA Silk as the backend, which supports netflow v9 and ipv6.</p><p>I&#039;m also on CC 15.05.1 and softflowd 0.9.9</p><p>My scripts</p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common

START=99


IFACE=br-lan
PORT=2055
SERVER=192.168.254.5
PIDFILE=/var/run/softflowd.pid
CTLFILE=/var/run/softflowd.ctl
SOFTFLOWD=/usr/sbin/softflowd
SOFTFLOWCTL=/usr/sbin/softflowctl

EXTRA_COMMANDS=&quot;status&quot;
EXTRA_HELP=&quot;        status Show the status of the qat device&quot;

reload()
{
    stop
    start
}

restart()
{
    reload
}

start()
{
    ${SOFTFLOWCTL} shutdown 2&gt; /dev/null
    ${SOFTFLOWD} -i ${IFACE} -6 -v 9 -n ${SERVER}:${PORT} -p ${PIDFILE}
}


status()
{
    [ -S ${CTLFILE} ] &amp;&amp; ${SOFTFLOWCTL} statistics
}

stop()
{
    [ -S ${CTLFILE} ] &amp;&amp; {

        ${SOFTFLOWCTL} shutdown
        rm -f ${PIDFILE} 2&gt; /dev/null
        rm -f ${CTLFILE} 2&gt; /dev/null

    }
}</code></pre></div><br /><p>What backend are you using?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p359758">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						5 Jun 2017, 00:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>What backend are you using?</p></blockquote></div><p>[Sorry to have taken so long to answer this question, but I&#039;ve been doing a lot of research (see <a href="http://richb-hanover.com/netflow-collectors-for-home-networks/">http://richb-hanover.com/netflow-collec â€¦ -networks/</a> ]</p><p>I&#039;ve been horsing around with Webview Netflow Reporter for the moment. I have it built as a Docker container, so it&#039;s easy to deploy on one of my always-on computers at home. You can get the Dockerfile at: <a href="https://github.com/richb-hanover/wvnetflow-dockerized">https://github.com/richb-hanover/wvnetflow-dockerized</a></p><p>I&#039;m successfully using softflowd in LEDE as my exporter. I have a question, though, about your config:</p><p>Why did you set the sampling_rate to 100 in your softflowd config? If I&#039;m understanding the program, that would only look at every 100th packet (creating statistical samples of the flow information). This would make sense if the the router were handling hundreds of thousands of packets a second, but at home, recording info for each packet isn&#039;t a burden. (I set it to &quot;0&quot; in my config...)</p><p>Please let me know what your backend Netflow Collector is. Thanks!</p><p>[EDIT: I see that the &#039;100&#039; was in my original config file. I&#039;m not sure where that came from - it&#039;s certainly not required...]</p>											<p class="post-edited">(Last edited by <strong>richbhanover</strong> on 5 Jun 2017, 00:22)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>