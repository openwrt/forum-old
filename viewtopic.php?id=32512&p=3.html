<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link MR3420v1 16M flash /64M Memory hardware mod with uboot bin</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 4 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=32512&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=32512&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=32512&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=32512&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p158948">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">Lennong</div>
					<div class="post-datetime">
						28 Feb 2012, 00:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>I received a moded 703n (8M/64M).&nbsp; This guy simply used original 4M uboot and it works fine with my 8M rootfs.&nbsp; What is the difference between 4M and 8M uboot?</p><p>Edit (02/15/2012):<br />I figured this out.&nbsp; A 4M uboot cannot write anything longer than 4M.&nbsp; However, the Openwrt can detect flash memory size on its own.&nbsp; Thus, to flash a rootfs larger than 4M, one need to first install a 4M rootfs and then use ssh or luci to install a new rootfs, which can be larger than 4M.&nbsp; A two step process but not too bad.</p></blockquote></div><p>Aha, that is some useful information! Could you please explain how you went by to extend the rootfs &quot;live&quot; without uboot modification?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158956">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						28 Feb 2012, 03:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Lennong wrote:</cite><blockquote><div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>......</p></blockquote></div><p>Aha, that is some useful information! Could you please explain how you went by to extend the rootfs &quot;live&quot; without uboot modification?</p></blockquote></div><p>That&#039;s simple.&nbsp; I just updated firmware with xxxxfactory.bin image (8M) in the system management page (4M).</p>											<p class="post-edited">(Last edited by <strong>twinclouds</strong> on 28 Feb 2012, 03:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158959">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">Lennong</div>
					<div class="post-datetime">
						28 Feb 2012, 04:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><div class="quotebox"><cite>Lennong wrote:</cite><blockquote><div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>......</p></blockquote></div><p>Aha, that is some useful information! Could you please explain how you went by to extend the rootfs &quot;live&quot; without uboot modification?</p></blockquote></div><p>That&#039;s simple.&nbsp; I just updated firmware with xxxxfactory.bin image (8M) in the system management page (4M).</p></blockquote></div><p>Interesting, I didn&#039;t think that was a feasible route regarding . Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158962">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						28 Feb 2012, 06:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Lennong wrote:</cite><blockquote><div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><div class="quotebox"><cite>Lennong wrote:</cite><blockquote><p>Aha, that is some useful information! Could you please explain how you went by to extend the rootfs &quot;live&quot; without uboot modification?</p></blockquote></div><p>That&#039;s simple.&nbsp; I just updated firmware with xxxxfactory.bin image (8M) in the system management page (4M).</p></blockquote></div><p>Interesting, I didn&#039;t think that was a feasible route regarding . Thanks!</p></blockquote></div><p>I also thought the upgrade page in the web interface only work for sysupgrade.bin.&nbsp; Actually, it also works for the factory.bin file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158965">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">Lennong</div>
					<div class="post-datetime">
						28 Feb 2012, 07:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><div class="quotebox"><cite>Lennong wrote:</cite><blockquote><div class="quotebox"><cite>twinclouds wrote:</cite><blockquote><p>That&#039;s simple.&nbsp; I just updated firmware with xxxxfactory.bin image (8M) in the system management page (4M).</p></blockquote></div><p>Interesting, I didn&#039;t think that was a feasible route regarding . Thanks!</p></blockquote></div><p>I also thought the upgrade page in the web interface only work for sysupgrade.bin.&nbsp; Actually, it also works for the factory.bin file.</p></blockquote></div><p>Yes, that did I know. However, to pass a 8MB image through the web iface running on a image that is configured to be 4MB, that I did not think was possible due to fault checks and whatnot. Well, it suits me fine with more wiggelroom in terms of upgrade methods.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158970">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						28 Feb 2012, 07:43					</div>
				</div>
				<div class="post-content content">
					<p>I think once you installed an Openwrt image, it automatically recognize how much RAM and ROM are available and can make full use of them.&nbsp; At that stage, uboot becomes irrelevant.<br />You can simply use the 4M openwrt to install additional packages using &quot;opkg install ...&quot;&nbsp; It is only necessary to build an 8M image when you want to put more packages in during compiling and the image size is larger than 4M.&nbsp; I found including packages during compilation can free up more ROM for future package installation.&nbsp; It is because the packages installed using opkg take jffs format, which has no compression, while the image compiled in squashfs format has compression built in, as I was told.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159016">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						28 Feb 2012, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>And if you just use a standard horror story from the section on <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware">Back to original firmware</a>? Simply add the compiled 128k <strong>u-boot</strong> file to the beginning of the compiled firmware (in hex editor). Then simply rename the image file so that included the word _<strong>boot</strong>.bin</p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 28 Feb 2012, 16:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159027">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						28 Feb 2012, 18:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>And if you just use a standard horror story from the section on <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#back.to.original.firmware">Back to original firmware</a>? Simply add the compiled 128k <strong>u-boot</strong> file to the beginning of the compiled firmware (in hex editor). Then simply rename the image file so that included the word _<strong>boot</strong>.bin</p></blockquote></div><p>Interesting.&nbsp; If I do that, after reflashing, where the new image will starts?&nbsp; Will it overwrite the original uboot file?&nbsp; Also, how you flash the _boot.bin file?&nbsp; using the upgrade web page or mtd?&nbsp; Can you also use the serial interface?&nbsp; If you can, what will be the the cp.b command looks like (original: cp.b 0x81000000 0x9f020000 0x3c0000) and where should the bootm starts (origianl: bootm 9f020000)?</p>											<p class="post-edited">(Last edited by <strong>twinclouds</strong> on 28 Feb 2012, 18:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159039">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						28 Feb 2012, 21:15					</div>
				</div>
				<div class="post-content content">
					<p>1. Wait, forget the serial interface, I wrote it specifically to simplify the firmware. serial interface or JTAG is needed in extreme cases, if the uboot will be unbootable.</p><p>2. According to my experience the name of the &quot;boot&quot; in the firmware file is made to ensure that the developer can fix the uboot - it&#039;s logical.</p><p>3. No mtd does not support writing to the boot area if it does not allow the kernel by default. I meant the other way to flash the router firmware version of the old factory image, and then make 128k+OpenwrtFirmware (in hex editor) and now the flash from the web-interface (factory firmware) to the &quot;boot&quot; firmware prefixed as their own.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159063">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						29 Feb 2012, 07:44					</div>
				</div>
				<div class="post-content content">
					<p>I edited the factory.bin file use a hex editor by inserted the 128k uboot file at its beginning.&nbsp; As a result, the image ended at 0x007DFFFF instead of 0x007BFFFF as the original factory.bin file.&nbsp; I saved it as a xxxx_boot.bin file.&nbsp; When I flash it using the luci system flash firmware function, I got: &quot;The uploaded image file does not contain a supported format. Make sure that you choose the generic image format for your platform.&quot;&nbsp; What I did wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159071">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						29 Feb 2012, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>Maybe IdaPro can help you to do some hexing work, and make uboot meet with your needs as i can see from ida some string that we can modified below:</p><div class="codebox"><pre><code>seg000:1A680 0000001D C       AP83 (ar9100) U-boot 0.0.11\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
seg000:1A6A0 0000000D C       id read %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
seg000:1A6B0 00000023 C       The hell do you want flinfo for??\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
seg000:1A6D4 00000010 C       write addr: %x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1A6E4 00000025 C       \nFirst %#x last %#x sector size %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
seg000:1A70C 00000008 C       \b\b\b\b%4d                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1A714 00000023 C       flash size 8MB, sector count = %d\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
seg000:1A738 0000000F C       \nResetting...\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1A748 0000000E C       Tx Timed out\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
seg000:1A758 00000011 C       dup %d speed %d\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
seg000:1A76C 00000015 C       Cant allocate fifos\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
seg000:1A784 0000001B C       ag7100_enet_initialize...\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1A7A0 0000000F C       malloc failed\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
seg000:1A7C0 00000020 C       %s: unknown ethernet device %s\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1A7E0 00000030 C       No valid address in Flash. Using fixed address\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1A810 00000020 C       Fetching MAC Address from 0x%p\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1A830 00000015 C       : cfg1 %#x cfg2 %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
seg000:1A848 00000023 C       %s: %02x:%02x:%02x:%02x:%02x:%02x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
seg000:1A874 0000000E C       trying %#x...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
seg000:1A884 00000021 C       didnt work written %#x read %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
seg000:1A8A8 0000001C C       floor %d ceil %d size-1 %d\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
seg000:1A8C4 00000014 C       worked; ceiling %d\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
seg000:1A8D8 00000012 C       worked; floor %d\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
seg000:1A8F4 00000014 C       Setting Tap to %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
seg000:1A908 00000023 C       something&#039;s wrong. rd %#x pat %#x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
seg000:1A938 00000009 C       bootargs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
seg000:1A944 00000027 C       ## Loading Ramdisk Image at %08lx ...\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
seg000:1A96C 00000012 C       Bad Magic Number\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
seg000:1A980 00000015 C       Bad Header Checksum\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
seg000:1A998 0000001B C          Verifying Checksum ...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
seg000:1A9B4 0000000E C       Bad Data CRC\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
seg000:1A9C4 0000001D C       No Linux MIPS Ramdisk Image\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
seg000:1A9E4 00000009 C       mem=%luM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
seg000:1A9F4 00000008 C       memsize                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
seg000:1AA04 0000000D C       initrd_start                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
seg000:1AA1C 0000000C C       initrd_size                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1AA28 0000000C C       flash_start                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1AA34 0000000B C       flash_size                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
seg000:1AA40 00000017 C       \nStarting kernel ...\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
seg000:1AA58 00000013 C       chip ID is 0x%08x\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
seg000:1AA6C 00000011 C       initChip failed\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
seg000:1AA90 0000000A unicode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
seg000:1AAE0 00000091 C       bootargs=console=ttyS0,115200 root=31:02 rootfstype=jffs2 init=/sbin/init mtdparts=ar9100-nor0:128k(u-boot),1024k(kernel),4096k(rootfs),64k(art)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
seg000:1AB71 00000019 C       bootcmd=bootm 0xbf020000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
seg000:1AB8A 0000000C C       bootdelay=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1AB96 00000010 C       baudrate=115200                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
seg000:1ABA6 0000001A C       ethaddr=00:1D:0F:11:22:33                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
seg000:1ABC0 00000013 C       ipaddr=192.168.0.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
seg000:1ABD3 00000015 C       serverip=192.168.0.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
seg000:1AE70 00000020 C       \b\b\b\b\b\b\b\b\b(((((\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
seg000:1FE00 00000008 C       79717458</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159083">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						29 Feb 2012, 11:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p><strong>and now the flash from the web-interface (factory firmware)</strong></p></blockquote></div><p>did you miss that part?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159134">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						29 Feb 2012, 18:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p><strong>and now the flash from the web-interface (factory firmware)</strong></p></blockquote></div><p>did you miss that part?</p></blockquote></div><p>I did this part as I said: &quot;I flash it using the luci system flash firmware function&quot;.&nbsp; It was exactly when the error message occurred. When flashing, I was already running openwrt but not original firmware from TP-Link but I don&#039;t think it should make any difference, or it would?</p>											<p class="post-edited">(Last edited by <strong>twinclouds</strong> on 29 Feb 2012, 18:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159136">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						29 Feb 2012, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>&quot;I meant the other way to flash the router firmware version of the old factory image, and then make 128k+OpenwrtFirmware (in hex editor) and now the flash from the web-interface (factory firmware) to the &quot;boot&quot; firmware prefixed as their own&quot;</p><p>i&#039;m not 100% sure but from the whole sentence seems to me he is suggesting to flash FROM THE FACTORY firmware, elsewhere it makes no sense to add the word BOOT. the fact is that factory firmware knows that with the boot word it has to write also the boot part of the flash...</p><p>once again, i&#039;m not sure, just trying to understand <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159160">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						29 Feb 2012, 23:59					</div>
				</div>
				<div class="post-content content">
					<p>I forgot about the header. When we cut off (0x20200) the top of the firmware image with the word &quot;boot&quot;. As i see this structure, there should be:<br /></p><div class="codebox"><pre><code>header (0x200) + uboot (0x20000) + kernel (0x0x3B0000)</code></pre></div><p>If we find on the official site at least one firmware with the word &quot;boot&quot;- only then we can understand (<a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/drivers/mtd/tplinkpart.c">this</a>) exactly what is contained in the header, and can even use it. The header is needed for web-interface of the original firmware.<br />Here I would like to remind you if you successfully get the header and add a uboot + kernel - you need to flash the image in the original firmware (not OpenWRT).</p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 6 Mar 2012, 13:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p162064">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">cthun</div>
					<div class="post-datetime">
						25 Mar 2012, 11:15					</div>
				</div>
				<div class="post-content content">
					<p>Now I am trying to build root to 16MB flash but seems I cannot find the mentioned partition info in</p><p>target/linux/ar71xx/files/arch/mips/ar71xx/mach-tl-mr3x20.c file.</p><p>16M:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &quot;u-boot&quot;, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x020000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.mask_flags&nbsp; &nbsp; &nbsp;= MTD_WRITEABLE, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, { <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &quot;kernel&quot;, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x020000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x140000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, { <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &quot;rootfs&quot;, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x160000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0xe90000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, { <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &quot;art&quot;, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0xff0000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x010000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.mask_flags&nbsp; &nbsp; &nbsp;= MTD_WRITEABLE, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, { <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &quot;firmware&quot;, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.offset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x020000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0xfd0000, <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} <br />};</p><p>In addition the folder <br />target/linux/ar71xx/files/arch/mips/ar71xx</p><p>Is not present and has ath91 instead. </p><p>I am using the document in openwrt build root steps to get the source and building it.<br />Building the source is ok and it could work on the MR3420 with 16MB MX25L12854 but only see 4MB. Any suggestion to build a 16MB image for my MR3420?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p162067">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						25 Mar 2012, 12:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cthun wrote:</cite><blockquote><p>Now I am trying to build root to 16MB flash but seems I cannot find the mentioned partition info in</p><p>target/linux/ar71xx/files/arch/mips/ar71xx/mach-tl-mr3x20.c file.</p><p>16M:<br />...<br />In addition the folder <br />target/linux/ar71xx/files/arch/mips/ar71xx</p><p>Is not present and has ath91 instead.</p></blockquote></div><p>That topic was covered on the first page of this thread: <a href="https://forum.openwrt.org/viewtopic.php?id=32512&amp;p=1">https://forum.openwrt.org/viewtopic.php  12&amp;p=1</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p162125">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">cthun</div>
					<div class="post-datetime">
						26 Mar 2012, 06:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MBS wrote:</cite><blockquote><div class="quotebox"><cite>cthun wrote:</cite><blockquote><p>Now I am trying to build root to 16MB flash but seems I cannot find the mentioned partition info in</p><p>target/linux/ar71xx/files/arch/mips/ar71xx/mach-tl-mr3x20.c file.</p><p>16M:<br />...<br />In addition the folder <br />target/linux/ar71xx/files/arch/mips/ar71xx</p><p>Is not present and has ath91 instead.</p></blockquote></div><p>That topic was covered on the first page of this thread: <a href="https://forum.openwrt.org/viewtopic.php?id=32512&amp;p=1">https://forum.openwrt.org/viewtopic.php  12&amp;p=1</a></p></blockquote></div><p>Thanks, I read through all the post and I manage to get it to work and it compiles a 15.6MB image. </p><p>However I can&#039;t flash the image using u-boot. It crashes while loading half way from tftp.&nbsp; Most probably I am still using the 32MB DDR. Since most of the image contains 0xff, I just truncate the 15.6MB image to 4MB. It boots and works well.</p>											<p class="post-edited">(Last edited by <strong>cthun</strong> on 26 Mar 2012, 06:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164523">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">twinclouds</div>
					<div class="post-datetime">
						14 Apr 2012, 23:08					</div>
				</div>
				<div class="post-content content">
					<p>Has anybody figured out how to build the u-boot for the 9331 based routers, e.g., 740n v4, 703n?&nbsp; The instructions cannot be directory used.<br />I also noticed that there is a version of 743n that come with a usb port for 3G dongle.&nbsp; It is only on sale in China and pretty cheap.&nbsp; Does anyone know about it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171324">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">sethiel</div>
					<div class="post-datetime">
						2 Jul 2012, 11:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Part Four: Make up a flash programmer file:<br />1. Use Winhex to create a empty 16M template, use replace to replace all 00 to FF.<br />2. Open the u-boot.bin previously you created, copy all (Ctrl+A) and Write(Ctrl+b) the 128k bytes from begining to the template.<br />3. Open the openwrt firmware openwrt-ar71xx-generic-tl-mr3420-v1-squashfs-factory.bin write all data(about 15.75M) as step 2 from 0x000000020000 to the file.<br />4. Open the art file, write the 64k file to the lastest 64k from 0x000000ff0000 to your template.<br />5. save all to a new file such as New.bin for future usage.</p><br /><p>Part five: Solder the chip<br />1. Flash the whole file to your flash chip by flash programmer ( you shall have this hardware to as help from others)<br />2. Solder the flash and memory chip, 64M RAM can be detected after changing the chip, no need to modify the uboot code to support 64M RAM<br />3. Solder the TTL pin for TTL debugging.</p></blockquote></div><p>Does anyone have such files and can share them, could put them somewhere to download?<br />I mean bin file to solder the chip and openwrt 16M ?</p><p>Im asking cause I have stoped just on the beggining:<br /></p><div class="codebox"><pre><code>/bin/sh: mips-linux-uclibc-gcc: not found
make[2]: *** No rule to make target `.depend&#039;.  Stop.
make[2]: Leaving directory `/virtual/home/bartosz/mr3420_3220v1/ap99/boot/u-boot/post/cpu&#039;
make[1]: *** [depend] Error 2
make[1]: Leaving directory `/virtual/home/bartosz/mr3420_3220v1/ap99/boot/u-boot&#039;
make: *** [uboot] Error 2</code></pre></div>											<p class="post-edited">(Last edited by <strong>sethiel</strong> on 2 Jul 2012, 12:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171333">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">Lennong</div>
					<div class="post-datetime">
						2 Jul 2012, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sethiel wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Part Four: Make up a flash programmer file:<br />1. Use Winhex to create a empty 16M template, use replace to replace all 00 to FF.<br />2. Open the u-boot.bin previously you created, copy all (Ctrl+A) and Write(Ctrl+b) the 128k bytes from begining to the template.<br />3. Open the openwrt firmware openwrt-ar71xx-generic-tl-mr3420-v1-squashfs-factory.bin write all data(about 15.75M) as step 2 from 0x000000020000 to the file.<br />4. Open the art file, write the 64k file to the lastest 64k from 0x000000ff0000 to your template.<br />5. save all to a new file such as New.bin for future usage.</p><br /><p>Part five: Solder the chip<br />1. Flash the whole file to your flash chip by flash programmer ( you shall have this hardware to as help from others)<br />2. Solder the flash and memory chip, 64M RAM can be detected after changing the chip, no need to modify the uboot code to support 64M RAM<br />3. Solder the TTL pin for TTL debugging.</p></blockquote></div><p>Does anyone have such files and can share them, could put them somewhere to download?<br />I mean bin file to solder the chip and openwrt 16M ?</p><p>Im asking cause I have stoped just on the beggining:<br /></p><div class="codebox"><pre><code>/bin/sh: mips-linux-uclibc-gcc: not found
make[2]: *** No rule to make target `.depend&#039;.  Stop.
make[2]: Leaving directory `/virtual/home/bartosz/mr3420_3220v1/ap99/boot/u-boot/post/cpu&#039;
make[1]: *** [depend] Error 2
make[1]: Leaving directory `/virtual/home/bartosz/mr3420_3220v1/ap99/boot/u-boot&#039;
make: *** [uboot] Error 2</code></pre></div></blockquote></div><p>Sure, I have a compiled image here that I used for my mod. If you send me pm with your MAC and pin number I will change that for you and then send it over.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176708">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						2 Sep 2012, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>Finally I was able to compile the u-boot from TP-Link sources, for ap121 (ar9331 based devices).<br />The hardest was to find out how to fix the missing mips-linux-gcc error, as I have almost no idea about Linux.<br />I found the solution here (russian) <br /><a href="http://openrouter.info/forum/viewtopic.php?f=22&amp;t=1553&amp;start=20">http://openrouter.info/forum/viewtopic.  p;start=20</a></p><p>You need the full 150Router.tar.bz2 file, not just the u-boot, as there are lots of dependencies.<br />Uncompress it to some folder. Enter into that folder.<br />Uncompress the file &quot;gcc-4.3.3.tar.bz2&quot; inside branch_hornet_linux/toolchain/ by doing &quot;tar -xf gcc-4.3.3.tar.bz2 ./&quot;<br />Create a folder called &quot;bin&quot; inside &quot;branch_hornet_linux&quot;<br />Create a file inside folder branch_hornet_linux called Makefile.<br />Edit it and paste the following:</p><div class="codebox"><pre><code>export BUILD_TOPDIR=$(PWD)
MAKECMD=make ARCH=mips CROSS_COMPILE=mips-linux-
export PATH:=$(BUILD_TOPDIR)/toolchain/gcc-4.3.3/build_mips/staging_dir/usr/bin/:$(PATH)
export FLASH_SIZE=4
export COMPRESSED_UBOOT=1
export CONFIG_HORNET_1_1_WAR=1

all:
    cd $(BUILD_TOPDIR)/ap121/boot/u-boot/ &amp;&amp; $(MAKECMD) ap121_config
    cd $(BUILD_TOPDIR)/ap121/boot/u-boot/ &amp;&amp; $(MAKECMD)
    cp $(BUILD_TOPDIR)/ap121/boot/u-boot/tuboot.bin $(BUILD_TOPDIR)/bin

clean:
    cd $(BUILD_TOPDIR)/ap121/boot/u-boot/ &amp;&amp; $(MAKECMD) clean
    rm -f $(BUILD_TOPDIR)/bin/*

clean_all:
    cd $(BUILD_TOPDIR)/ap121/boot/u-boot/ &amp;&amp; $(MAKECMD) distclean
    rm -f $(BUILD_TOPDIR)/bin/*</code></pre></div><p>remember to change &quot;export FLASH_SIZE=x&quot; to the MB of your flash. You still need to modify the ap121. if higher than 8MB.<br />do &quot;chmod 664 Makefile&quot;</p><p>Now, just open the terminal and go to the branch_hornet_linux folder.<br />Do:<br />make clean<br />make</p><p>It will compile in just a minute or so, and at the end it will put something like this:<br /></p><div class="codebox"><pre><code>Image Name:   u-boot image
Created:      Sun Sep  2 21:58:12 2012
Image Type:   MIPS Linux Firmware (lzma compressed)
Data Size:    32200 Bytes = 31.45 kB = 0.03 MB
Load Address: 0x80010000
Entry Point:  0x80010000
make[1]: Leaving directory `/home/ubuntu/150Router/branch_hornet_linux/ap121/boot/u-boot&#039;
cp /home/ubuntu/150Router/branch_hornet_linux/ap121/boot/u-boot/tuboot.bin /home/ubuntu/150Router/branch_hornet_linux/bin</code></pre></div><p>And done!! Your u-boot should be in branch_hornet_linux/bin. The rest of the part is the same as told in this topic.</p><br /><p>If you get &quot;separator error&quot; when doing make, is due the spaces in the lines like this:<br /></p><div class="codebox"><pre><code>    cd $(BUILD_TOPDIR)/ap121/boot/u-boot/ &amp;&amp; $(MAKECMD) ap121_config
&lt;--&gt;
This is a tabulation, not 4 spaces!! When pasting ensure that they are correct, if not delete them and puts tabs instead.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179118">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">favas0</div>
					<div class="post-datetime">
						23 Sep 2012, 16:46					</div>
				</div>
				<div class="post-content content">
					<p>Where to buy these chips in india or a seller who ships to india ?</p><p>S25FL128PIF <br />MX25L12805 <br />Hynix HY5DU121622DTP-D43</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179251">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						24 Sep 2012, 21:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>favas0 wrote:</cite><blockquote><p>Where to buy these chips in india or a seller who ships to india ?</p><p>S25FL128PIF <br />MX25L12805 <br />Hynix HY5DU121622DTP-D43</p></blockquote></div><p><a href="http://www.ebay.com/itm/Flash-IC-MX25L6445EM2I-Ram-IC-HY5DU121622-For-Wr703-/180962722821?pt=LH_DefaultDomain_0&amp;hash=item2a22380405">http://www.ebay.com/itm/Flash-IC-MX25L6  2a22380405</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181188">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">sosw</div>
					<div class="post-datetime">
						22 Oct 2012, 14:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>Where can i get modded firmware to MR3220 or MR3420? I have done ram mod but flash<br />size is still same so I must do </p><p><a href="https://forum.openwrt.org/viewtopic.php?id=32512">https://forum.openwrt.org/viewtopic.php?id=32512</a></p><p>trick?</p><p>best regards</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 5</div><nav><ul><li><a href="viewtopic.php%3Fid=32512&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=32512&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=32512&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=32512&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>