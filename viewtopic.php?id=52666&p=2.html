<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ZyXEL NBG-419N v2 support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 27 Nov 2017 and 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=52666&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=52666&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p248552">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						30 Sep 2014, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>Last test for final(?) BB build released of Sep 29:<br />openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.bin - BB final patched image <br />bb-final-ramips-add-zyxel-nbg-419n2.patch - patch for BB final</p><p>This image is minimal support of nbg-419n2 (no additinal kernel modules, no wps action script).<br />BTW you can download Image Builder, apply patch and rebuild firmware as you wish.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249119">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						4 Oct 2014, 14:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>and sorry for my late reply. I&#039;ve been sick.</p><p>However, I downloaded the image already a few days ago, but it didn&#039;t work???</p><p>During that time, the system complained that some of the packages can&#039;t be downloaded???</p><p>Ok, just now I saw the announcement of BB 14.07 release.</p><p>So, I installed the image again, and voilà, all of the packages can be dowloaded and installed with opkg!!!</p><p><strong>However, you need to change the <span class="bbu">&#039;1-1&#039; to &#039;1-2&#039;</span> in &#039;/etc/config/system&#039; !!!</strong></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/system

config system
        option hostname &#039;OpenWrt&#039;
        option timezone &#039;UTC&#039;

config timeserver &#039;ntp&#039;
        list server &#039;0.openwrt.pool.ntp.org&#039;
        list server &#039;1.openwrt.pool.ntp.org&#039;
        list server &#039;2.openwrt.pool.ntp.org&#039;
        list server &#039;3.openwrt.pool.ntp.org&#039;
        option enable_server &#039;0&#039;

config led &#039;led_wifi_led&#039;
        option name &#039;wifi&#039;
        option sysfs &#039;rt2800pci-phy0::radio&#039;
        option trigger &#039;netdev&#039;
        option dev &#039;wlan0&#039;
        option mode &#039;link tx rx&#039;

config led &#039;led_usb&#039;
        option name &#039;USB&#039;
        option sysfs &#039;nbg-419n:green:usb&#039;
        option trigger &#039;usbdev&#039;
        option dev &#039;1-2&#039;                # This must be &#039;1-2&#039; instead of &#039;1-1&#039; !!!
        option interval &#039;50&#039;</code></pre></div><p><strong>Now, among the other features, the USB led is working as it&#039;s supposed to work.</strong></p><p>And thanks for the tip; I&#039;ll try that Image Builder.</p><p>However, it would be nice to have an official image for the device, for other people as well.</p><p>Thank you so much.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249143">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						4 Oct 2014, 18:09					</div>
				</div>
				<div class="post-content content">
					<p>Openwrt team rebuild release at Oct 2. I think that for fixing packages paths.<br />USB: &quot;1-1&quot; is correct value for high-speed usb 2.0 devices. Your stick is full-speed usb 1,1 device:<br /></p><div class="codebox"><pre><code>[  391.720000] usb 1-2: new full-speed USB device number 2 using ohci-platform
[  391.960000] usb 1-2: no of_node; not parsing pinctrl DT</code></pre></div><p>Wrong detection or it is really old usb 1.1 device? So I prefer that &quot;1-1&quot; will be default value as more common case.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249164">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						4 Oct 2014, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>and thank you so much for your quick response.</p><p>And yes, the USB stick what I&#039;ve been using is indeed an old usb 1.1 device.</p><p>I like to use that usb stick for various testing, as it never contains anything important.</p><p>Also, I just tried the Image Builder.</p><p>I can produce an image, flash it to device, but now some of the led&#039;s won&#039;t work, i.e the power led, and the usb led. (Not sure about the WPS led atm)<br /></p><div class="codebox"><pre><code>wget http://downloads.openwrt.org/barrier_breaker/14.07/ramips/rt305x/OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64.tar.bz2

tar jxvf OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64.tar.bz2 

cd OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64

cp /home/jama/Downloads/OpenWRT/NBG-419N2.dts target/linux/ramips/dts/.

make image

make clean</code></pre></div><p>Now, I modified the &#039;target/linux/ramips/image/Makefile&#039; -file to take the new profile into account, by adding the following two lines in correct places:<br /></p><div class="codebox"><pre><code>Image/Build/Profile/NBG-419N2=$(call BuildFirmware/Default8M/$(1),$(1),nbg-419n2,NBG-419N2)
$(call Image/Build/Profile/NBG-419N2,$(1))</code></pre></div><p>Then, creating the image, and including all the packages that were in your final build: (after checking those with &#039;opkg list-installed&#039;)<br /></p><div class="codebox"><pre><code>make image PROFILE=NBG-419N2 PACKAGES=&quot;base-files busybox dnsmasq dropbear firewall fstools hostapd-common ip6tables iptables iw jshn jsonfilter kernel kmod-cfg80211 kmod-crypto-aes kmod-crypto-arc4 kmod-crypto-core kmod-eeprom-93cx6 kmod-fs-vfat kmod-gpio-button-hotplug kmod-i2c-core kmod-input-core kmod-ip6tables kmod-ipt-conntrack kmod-ipt-core kmod-ipt-nat kmod-ipt-nathelper kmod-ipv6 kmod-leds-gpio kmod-ledtrig-usbdev kmod-lib-crc-ccitt kmod-lib-crc-itu-t kmod-mac80211 kmod-mmc kmod-nls-base kmod-nls-cp437 kmod-nls-iso8859-1 kmod-ppp kmod-pppoe kmod-pppox kmod-rt2800-lib kmod-rt2800-mmio kmod-rt2800-soc kmod-rt2x00-lib kmod-rt2x00-mmio kmod-scsi-core kmod-scsi-generic kmod-sdhci kmod-slhc kmod-usb-core kmod-usb-ohci kmod-usb-storage kmod-usb-storage-extras kmod-video-core kmod-video-uvc kmod-video-videobuf2 libblobmsg-json libc libgcc libip4tc libip6tc libiwinfo libiwinfo-lua libjson-c libjson-script liblua libncurses libnl-tiny libubox libubus libubus-lua libuci libuci-lua libxtables lua luci luci-app-firewall luci-base luci-lib-nixio luci-mod-admin-full luci-proto-ppp luci-theme-bootstrap mtd netifd odhcp6c odhcpd opkg ppp ppp-mod-pppoe procd swconfig terminfo ubox ubus ubusd uci uhttpd uhttpd-mod-ubus wpad-mini&quot;</code></pre></div><p>But the above mentioned leds won&#039;t work? (Yes, I checked/modified i.e. the /etc/config/system...)</p><p>Now, I must be missing something here, as I don&#039;t understand the build system and the architecure that well...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249199">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						5 Oct 2014, 04:38					</div>
				</div>
				<div class="post-content content">
					<p>In my final patch some additional files are touched. I think you don&#039;t use patch command? Just change directory where you install ImageBuilder and call<br /></p><div class="codebox"><pre><code>patch &lt;bb-filnal-ramips-add-zyxel-nbg-419n2.patch</code></pre></div><p>Or look at patch file and make changes by hand in:<br />- target/linux/ramips/base-files/lib/ramips.h - board identification<br />- target/linux/ramips/base-files/lib/upgrade/platform.sh - to make sysupgrade happy<br />- target/linux/ramips/base-files/etc/diag.sh - to set status led<br />- target/linux/ramips/base-files/etc/uci-defaults/01_leds - to set other leds<br />You have made only last two changes from patch concerning makefile and dts-file <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.<br />BTW no need to include all packages from final image. You may create your own package set. And save it in target/linux/ramips/...../rt305x/profiles/nbg419n2.mk (forget exactly path) for future use.</p><p>Goog luck!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249547">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						7 Oct 2014, 15:37					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m sorry, but it does not work. The leds, including the power led, are not working when the image is created with the ImageBuilder.</p><p>WAN and LAN leds do work.</p><p>I did everything from scratch:</p><div class="codebox"><pre><code>wget http://downloads.openwrt.org/barrier_breaker/14.07/ramips/rt305x/OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64.tar.bz2
tar jxvf OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64.tar.bz2 
cd OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64</code></pre></div><p>Then, the patch -file is supposed to patch a few, already existing files:</p><div class="codebox"><pre><code>cat ../bb-final-ramips-add-zyxel-nbg-419n2.patch | grep ^Index
Index: target/linux/ramips/base-files/lib/ramips.sh
Index: target/linux/ramips/base-files/lib/upgrade/platform.sh
Index: target/linux/ramips/base-files/etc/diag.sh
Index: target/linux/ramips/base-files/etc/uci-defaults/01_leds
Index: target/linux/ramips/image/Makefile
Index: target/linux/ramips/dts/NBG-419N2.dts</code></pre></div><p>So, just to ensure the functionality, we back-up the files.<br /></p><div class="codebox"><pre><code>mkdir backup_files
cat ../bb-final-ramips-add-zyxel-nbg-419n2.patch | grep ^Index | cut -d &#039; &#039; -f2 | xargs -i cp {} backup_files/.
cp: cannot stat ‘target/linux/ramips/dts/NBG-419N2.dts’: No such file or directory</code></pre></div><p>Before patching the files, we need to create the .dts -file, since a file which does not exist can&#039;t be patched; i.e. the patch won&#039;t creat a new file. (At least not on Fedora 20).</p><div class="codebox"><pre><code>touch target/linux/ramips/dts/NBG-419N2.dts</code></pre></div><p>Then we patch:</p><div class="codebox"><pre><code>patch &lt; ../bb-final-ramips-add-zyxel-nbg-419n2.patch 
can&#039;t find file to patch at input line 5
Perhaps you should have used the -p or --strip option?
The text leading up to this was:
--------------------------
|Index: target/linux/ramips/base-files/lib/ramips.sh
|===================================================================
|--- target/linux/ramips/base-files/lib/ramips.sh    (revision 42702)
|+++ target/linux/ramips/base-files/lib/ramips.sh    (working copy)
--------------------------
File to patch: target/linux/ramips/base-files/lib/ramips.sh
patching file target/linux/ramips/base-files/lib/ramips.sh
can&#039;t find file to patch at input line 19
Perhaps you should have used the -p or --strip option?
The text leading up to this was:
--------------------------
|Index: target/linux/ramips/base-files/lib/upgrade/platform.sh
|===================================================================
|--- target/linux/ramips/base-files/lib/upgrade/platform.sh    (revision 42702)
|+++ target/linux/ramips/base-files/lib/upgrade/platform.sh    (working copy)
--------------------------
File to patch: target/linux/ramips/base-files/lib/upgrade/platform.sh
patching file target/linux/ramips/base-files/lib/upgrade/platform.sh
can&#039;t find file to patch at input line 31
Perhaps you should have used the -p or --strip option?
The text leading up to this was:
--------------------------
|Index: target/linux/ramips/base-files/etc/diag.sh
|===================================================================
|--- target/linux/ramips/base-files/etc/diag.sh    (revision 42702)
|+++ target/linux/ramips/base-files/etc/diag.sh    (working copy)
--------------------------
File to patch: target/linux/ramips/base-files/etc/diag.sh
patching file target/linux/ramips/base-files/etc/diag.sh
can&#039;t find file to patch at input line 45
Perhaps you should have used the -p or --strip option?
The text leading up to this was:
--------------------------
|Index: target/linux/ramips/base-files/etc/uci-defaults/01_leds
|===================================================================
|--- target/linux/ramips/base-files/etc/uci-defaults/01_leds    (revision 42702)
|+++ target/linux/ramips/base-files/etc/uci-defaults/01_leds    (working copy)
--------------------------
File to patch: target/linux/ramips/base-files/etc/uci-defaults/01_leds
patching file target/linux/ramips/base-files/etc/uci-defaults/01_leds
patching file Makefile
Hunk #1 FAILED at 448.
Hunk #2 FAILED at 605.
2 out of 2 hunks FAILED -- saving rejects to file Makefile.rej
patching file NBG-419N2.dts</code></pre></div><p>It says that the Makefile can&#039;t be patched, and claims that the .dts -file is patched. (Which in fact didn&#039;t happen ??)</p><p>Now we compare the patched files, against the backed-up files:<br /></p><div class="codebox"><pre><code>mkdir new_files
cat ../bb-final-ramips-add-zyxel-nbg-419n2.patch | grep ^Index | cut -d &#039; &#039; -f2 | xargs -i cp {} new_files/.
for i in `ls backup_files` ; do echo &quot; == $i ==&quot; ; diff backup_files/$i new_files/$i ; done
 == 01_leds ==
134a135,138
&gt;     nbg-419n2)
&gt;         set_usb_led &quot;nbg-419n2:green:usb&quot;
&gt;         set_wifi_led &quot;rt2800pci-phy0::radio&quot;
&gt;         ;;
 == diag.sh ==
90a91,93
&gt;     nbg-419n2)
&gt;         status_led=&quot;nbg-419n2:green:power&quot;
&gt;         ;;
 == Makefile ==
 == NBG-419N2.dts ==
 == platform.sh ==
63a64
&gt;     nbg-419n2 | \
 == ramips.sh ==
171a172,174
&gt;     *&quot;NBG-419N v2&quot;)
&gt;         name=&quot;nbg-419n2&quot;
&gt;         ;;</code></pre></div><p>We can see that some of the files were patched, and some were intact.</p><p>We must fix the remaining files by hand.</p><div class="codebox"><pre><code>cp /home/jama/Downloads/OpenWRT/NBG-419N2.dts target/linux/ramips/dts/.
vi target/linux/ramips/image/Makefile</code></pre></div><p>And perform the comparison of the Makefile again. (The .dts -file excluded due to size)</p><div class="codebox"><pre><code>diff target/linux/ramips/image/Makefile backup_files/Makefile 
451d450
&lt; Image/Build/Profile/NBG-419N2=$(call BuildFirmware/Default8M/$(1),$(1),nbg-419n2,NBG-419N2)
609d607
&lt;     $(call Image/Build/Profile/NBG-419N2,$(1))

diff target/linux/ramips/image/Makefile new_files/Makefile 
451d450
&lt; Image/Build/Profile/NBG-419N2=$(call BuildFirmware/Default8M/$(1),$(1),nbg-419n2,NBG-419N2)
609d607
&lt;     $(call Image/Build/Profile/NBG-419N2,$(1))</code></pre></div><p>As we can be confident that everything is as it&#039;s supposed to be, we can create the images.</p><div class="codebox"><pre><code>make image</code></pre></div><p>And verify the results.</p><div class="codebox"><pre><code>ls -al bin/ramips/*419*
-rw-rw-r--. 1 jama jama 2883588 Oct  7 14:47 bin/ramips/openwrt-ramips-rt305x-nbg-419n2-squashfs-sysupgrade.bin
-rw-r--r--. 1 jama jama 2883588 Oct  7 14:47 bin/ramips/openwrt-ramips-rt305x-nbg-419n-squashfs-sysupgrade.bin</code></pre></div><p>But the leds won&#039;t work. The image can be flashed, it boots, etc., but the leds won&#039;t work ??</p><p>During the boot, a message appears.</p><div class="codebox"><pre><code>[    5.130000] leds-gpio gpio-leds.4: pins are not configured from the driver</code></pre></div><p>????</p><p>Ok, I also tried to include everything to the single image again.</p><div class="codebox"><pre><code>make image PACKAGES=&quot;base-files busybox dnsmasq dropbear firewall fstools hostapd-common ip6tables iptables iw jshn jsonfilter kernel kmod-cfg80211 kmod-crypto-aes kmod-crypto-arc4 kmod-crypto-core kmod-eeprom-93cx6 kmod-fs-vfat kmod-gpio-button-hotplug kmod-i2c-core kmod-input-core kmod-ip6tables kmod-ipt-conntrack kmod-ipt-core kmod-ipt-nat kmod-ipt-nathelper kmod-ipv6 kmod-leds-gpio kmod-ledtrig-usbdev kmod-lib-crc-ccitt kmod-lib-crc-itu-t kmod-mac80211 kmod-mmc kmod-nls-base kmod-nls-cp437 kmod-nls-iso8859-1 kmod-ppp kmod-pppoe kmod-pppox kmod-rt2800-lib kmod-rt2800-mmio kmod-rt2800-soc kmod-rt2x00-lib kmod-rt2x00-mmio kmod-scsi-core kmod-scsi-generic kmod-sdhci kmod-slhc kmod-usb-core kmod-usb-ohci kmod-usb-storage kmod-usb-storage-extras kmod-video-core kmod-video-uvc kmod-video-videobuf2 libblobmsg-json libc libgcc libip4tc libip6tc libiwinfo libiwinfo-lua libjson-c libjson-script liblua libncurses libnl-tiny libubox libubus libubus-lua libuci libuci-lua libxtables lua luci luci-app-firewall luci-base luci-lib-nixio luci-mod-admin-full luci-proto-ppp luci-theme-bootstrap mtd netifd odhcp6c odhcpd opkg ppp ppp-mod-pppoe procd swconfig terminfo ubox ubus ubusd uci uhttpd uhttpd-mod-ubus wpad-mini&quot;</code></pre></div><p>And check the image size again.</p><div class="codebox"><pre><code>ls -al bin/ramips/*419*
-rw-rw-r--. 1 jama jama 3670020 Oct  7 15:22 bin/ramips/openwrt-ramips-rt305x-nbg-419n2-squashfs-sysupgrade.bin
-rw-r--r--. 1 jama jama 3670020 Oct  7 15:22 bin/ramips/openwrt-ramips-rt305x-nbg-419n-squashfs-sysupgrade.bin</code></pre></div><p>Which shows that the image is much larger, and should now contain everything needed for leds to work.</p><p>But, still, the leds won&#039;t work ???</p><p>?????</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249559">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						7 Oct 2014, 16:44					</div>
				</div>
				<div class="post-content content">
					<p>1. Use -p option of patch command<br /></p><div class="codebox"><pre><code>patch -p0 &lt; ../bb-final-ramips-add-zyxel-nbg-419n2.patch</code></pre></div><p>2. Reset settings after firmware update with reset button or commands <br /></p><div class="codebox"><pre><code>firstboot; reboot</code></pre></div><p>Leds configuration is saved in /etc/config/system only during first boot. Next upgrades preserve this system file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249617">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						7 Oct 2014, 21:54					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m sorry, but it does not work at all. No matter what I do.</p><p>If I i.e. flash &#039;openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.bin&#039; first, (using TFTP) then upgrade it with my own image via LuCI, then, yes, it will retain the configuration files, including &#039;/etc/config/system&#039;, but the leds won&#039;t work after all.</p><p>Issuing &#039;firstboot&#039;, and rebooting does not help. It looks that it resets &#039;/etc/config/system&#039; to some default one:</p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/system 
config system
        option hostname OpenWrt
        option timezone UTC

config timeserver ntp
        list server     0.openwrt.pool.ntp.org
        list server     1.openwrt.pool.ntp.org
        list server     2.openwrt.pool.ntp.org
        list server     3.openwrt.pool.ntp.org
        option enabled 1
        option enable_server 0</code></pre></div><p>The same happens if I flash my own image directly, (using TFTP) without upgrading.</p><p>Could this be a kernel issue?</p><p>So,<br />- with&nbsp; &#039;openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.bin&#039; everything works<br />- upgrade&nbsp; &#039;openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.bin&#039; to my own image retains config files, but leds won&#039;t work<br />- issuing &#039;firstboot ; reboot&#039; after upgrade makes no difference. Leds won&#039;t work<br />- flashing my own image directly (using TFTP) does not help, even I&#039;d issue &#039;firstboot ; reboot&#039;</p><p>?????</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249739">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						8 Oct 2014, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>Did you apply patch? To check see rootfs image tree (root filesystem before packing):<br />build_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/root-ramips/ </p><p>For test BB release of Oct 2:<br />openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.v2.bin - only change kernel config (dts-file) and apply patch to userspace scripts</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250153">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						11 Oct 2014, 20:33					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Yes, I applied the patch. There&#039;re only a few steps to produce the image:</p><div class="codebox"><pre><code>$ tar jxvf OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64.tar.bz2 

$ cd OpenWrt-ImageBuilder-ramips_rt305x-for-linux-x86_64/

$ patch -p0 &lt; /home/jama/Downloads/OpenWRT/bb-final-ramips-add-zyxel-nbg-419n2.patch 
patching file target/linux/ramips/base-files/lib/ramips.sh
patching file target/linux/ramips/base-files/lib/upgrade/platform.sh
patching file target/linux/ramips/base-files/etc/diag.sh
patching file target/linux/ramips/base-files/etc/uci-defaults/01_leds
patching file target/linux/ramips/image/Makefile
patching file target/linux/ramips/dts/NBG-419N2.dts

$ make image

$ ls bin/ramips/*419*
bin/ramips/openwrt-ramips-rt305x-nbg-419n2-squashfs-sysupgrade.bin
bin/ramips/openwrt-ramips-rt305x-nbg-419n-squashfs-sysupgrade.bin</code></pre></div><p>Then, copy the image (as root) to another location in order to make it available for TFTP download:</p><div class="codebox"><pre><code># cp bin/ramips/openwrt-ramips-rt305x-nbg-419n2-squashfs-sysupgrade.bin /var/lib/tftpboot/myimage.bin</code></pre></div><p>Then, &lt;... flash the image with tftp ...&gt;</p><p>After the boot is fully completed, (a message &#039;: procd: - init complete - seen on console) issue</p><div class="codebox"><pre><code>root@OpenWrt:/# firstboot ; reboot</code></pre></div><p>But, the power led won&#039;t work ??</p><p>However, if I now reboot, and flash the &#039;openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.v2.bin&#039; -image, then the following appears on console, during the &#039;openwrt-ramips-rt305x-nbg-419n2-bb-final-squashfs-sysupgrade.v2.bin&#039; boot:</p><div class="codebox"><pre><code>[   24.130000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0001001c: 0x2651 instead
[   24.160000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00010020: 0xf4e4 instead
[   24.190000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00010024: 0xf73d instead
[   24.200000] jffs2: Further such events for this erase block will not be printed
[   24.330000] jffs2: Old JFFS2 bitmask found at 0x00017ee4
[   24.340000] jffs2: You cannot use older JFFS2 filesystems with newer kernels
[   24.440000] jffs2: Old JFFS2 bitmask found at 0x0001e00c
[   24.450000] jffs2: You cannot use older JFFS2 filesystems with newer kernels
[   24.480000] jffs2: Old JFFS2 bitmask found at 0x0001f074
[   24.490000] jffs2: You cannot use older JFFS2 filesystems with newer kernels
[   24.520000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020000: 0x1784 instead
[   24.580000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020004: 0x7099 instead
[   24.610000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020008: 0xd748 instead
[   24.640000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0002000c: 0xf175 instead
[   24.670000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020010: 0x77ab instead
[   24.700000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020014: 0x3b65 instead
[   24.730000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020018: 0x035b instead
[   24.760000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0002001c: 0xdab0 instead
[   24.790000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020020: 0xd761 instead
[   24.820000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00020024: 0xe19c instead
[   24.830000] jffs2: Further such events for this erase block will not be printed
[   25.110000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030000: 0xa1c3 instead
[   25.150000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030004: 0x16b9 instead
[   25.180000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030008: 0xb194 instead
[   25.210000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0003000c: 0xdfd9 instead
[   25.240000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030010: 0x815c instead
[   25.270000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030014: 0x309b instead
[   25.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030018: 0x6007 instead
[   25.330000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0003001c: 0x3154 instead
[   25.360000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030020: 0x2fa1 instead
[   25.390000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00030024: 0x5d65 instead
[   25.400000] jffs2: Further such events for this erase block will not be printed
[   25.670000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040000: 0xf9a9 instead
[   25.690000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040004: 0x22c3 instead
[   25.720000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040008: 0xb730 instead
[   25.750000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0004000c: 0x43bf instead
[   25.780000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040010: 0xb35a instead
[   25.810000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040014: 0x9bdf instead
[   25.840000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040018: 0x6280 instead
[   25.870000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0004001c: 0xc4e2 instead
[   25.900000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040020: 0xb473 instead
[   25.930000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00040024: 0xe4f9 instead
[   25.940000] jffs2: Further such events for this erase block will not be printed
[   26.040000] jffs2: Empty flash at 0x000437cc ends at 0x00044000
[   26.560000] jffs2: notice: (887) jffs2_build_xattr_subsystem: complete building xattr subsystem, 2 of xdatum (0 unchecked, 1 orphan) and 22 of xref (0 dead, 13 orphan) found.
[   27.280000] device eth0.1 entered promiscuous mode
[   27.290000] device eth0 entered promiscuous mode
[   27.320000] br-lan: port 1(eth0.1) entered forwarding state
[   27.330000] br-lan: port 1(eth0.1) entered forwarding state
[   29.330000] br-lan: port 1(eth0.1) entered forwarding state
procd: - init complete -</code></pre></div><p>But the kernel version is supposed to be the same ??</p><p>However, now the power led works.</p><p>If I now issue:</p><div class="codebox"><pre><code>root@OpenWrt:/# firstboot ; reboot</code></pre></div><p>Everything works still.</p><p>If I now flash my own image, and boot, the power led won&#039;t work anymore.</p><p>The power led goes off once &#039;procd: - preinit -&#039; appears on console.</p><br /><p>Issuing &#039;firstboot ; reboot&#039; after the boot is completed (procd: - init complete - seen on console) does nothing.</p><p>The power led stays on during the boot, but goes off immediately after procd: - preinit -&#039; appears on console.</p><br /><p>?????</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251146">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						19 Oct 2014, 07:27					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve no idea what is wrong.<br />Check two point:<br />1. Power led work if you echo 1 &gt; /sys/class/leds/nbg-419n2:green:power/brightness<br />2. See output of cat /proc/cpuinfo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251196">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						19 Oct 2014, 18:08					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><div class="quotebox"><blockquote><p>2. See output of cat /proc/cpuinfo</p></blockquote></div><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/cpuinfo
system type             : Ralink RT3352 id:1 rev:6
machine                 : ZyXEL NBG-419N v2
processor               : 0
cpu model               : MIPS 24KEc V4.12
BogoMIPS                : 255.59
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 32
extra interrupt vector  : yes
hardware watchpoint     : yes, count: 4, address/irw mask: [0x0ffc, 0x0ffc, 0x0ffb, 0x0ffb]
isa                     : mips1 mips2 mips32r1 mips32r2
ASEs implemented        : mips16 dsp
shadow register sets    : 1
kscratch registers      : 0
core                    : 0
VCED exceptions         : not available
VCEI exceptions         : not available</code></pre></div><p>However, I can <strong>confirm</strong> that I was able to produce a completely working build, by cross-compiling the image myself, instead of using the ImageBuilder:</p><div class="codebox"><pre><code>$ svn co svn://svn.openwrt.org/openwrt/branches/barrier_breaker@42056 BB-r42056

$ cd BB-r42056/

$ patch -p0 &lt; /home/jama/Downloads/OpenWRT/bb-final-ramips-add-zyxel-nbg-419n2.patch
patching file target/linux/ramips/base-files/lib/ramips.sh
patching file target/linux/ramips/base-files/lib/upgrade/platform.sh
patching file target/linux/ramips/base-files/etc/diag.sh
patching file target/linux/ramips/base-files/etc/uci-defaults/01_leds
patching file target/linux/ramips/image/Makefile
Hunk #2 succeeded at 601 (offset -5 lines).
patching file target/linux/ramips/dts/NBG-419N2.dts

$ ./scripts/feeds update -a

$ ./scripts/feeds install -a

$ make menuconfig</code></pre></div><p>To configure the image, I selected the following to be included, in addition to existing ones, in the image (by pressing &#039;y&#039;):</p><div class="codebox"><pre><code>Target System (Ralink RT288x/RT3xxx)  ---&gt; 
Subtarget (RT3x5x/RT5350 based boards)  ---&gt; 

[Global build settings]
- Enable rfkill support
[Kernel modules]
+[Block Devices]
 - kmod-scsi-core
 - kmod-scsi-generic
+[Filesystems]
 - kmod-fs-vfat 
+[LED Modules]
 - kmod-ledtrig-default-on
 - kmod-ledtrig-gpio
+[Native Language Support]
 - kmod-nls-cp437
 - kmod-nls-iso8859-1
 - kmod-nls-iso8859-15
 - kmod-nls-utf8
+[Other modules]
 - kmod-mmc
 - kmod-rfkill
 - kmod-sdhci
+[USB Support]
 - kmod-usb-ohci
 - kmod-usb-storage
 - kmod-usb-storage-extras
 - kmod-usb-uhci
 - kmod-usb2</code></pre></div><p>After the configuration, I simply ran:</p><div class="codebox"><pre><code>$ make -j 9</code></pre></div><p>And flashed the image.</p><p>Now, <strong>everything works.</strong> And, I mean <strong>everything:</strong><br />- power led<br />- lan led(s)<br />- wan led<br />- wifi led<br />- rfkill<br />- wps led<br />- usb led (after modification, though)</p><p>However, <strong>the usb led does not work unless <span class="bbu">&#039;1-1&#039; is changed to &#039;1-2&#039;</span> in /etc/config/system !!!</strong></p><p>I don&#039;t know should the &#039;kmod-usb2&#039; be included or not, and does it affect to usb led in any way, but now the led won&#039;t lit at all if a 1.1 stick is inserted. (Not a problem; nobody uses these anymore <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p><p>Do you know how to make a permanent change to /etc/config/system so &#039;1-2&#039; would always be included by default ???</p><p>So, there <strong>must</strong> be something wrong with the ImageBuilder ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251772">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						23 Oct 2014, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>In file target/linux/ramips/base-files/etc/uci-defaults/01_leds change &quot;1-1&quot; to &quot;1-2&quot; and your leds will be ok for usb 1.1 devices by default.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252004">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						25 Oct 2014, 14:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I can <strong>confirm</strong> that once the change is made, the USB led works, and this is the <strong>only</strong> way to have the USB led work.</p><p>Now, I don&#039;t know what does this &#039;1-1&#039; or &#039;1-2&#039; setting do, but based on my test results, it seems that the setting is related to the number of the USB port(s), and has nothing to with USB 1.1 or 2.0.</p><p>If you take a look of the v2 board, <a href="https://wikidevi.com/wiki/File:ZyXEL_NBG-419N_v2_board_top.jpg">https://wikidevi.com/wiki/File:ZyXEL_NB … rd_top.jpg</a>, you can see two lanes coming from the CPU, of which the other one ends to an USB -connector, while the other one has nothing connected.</p><p>So, I <strong>assume</strong> that the board was supposed to have two USB ports, but is only having one.</p><p>Also, by opening the cover (or taking a very careful look of the picture) and reading the printouts on the board, you can see markings (silk screen prints) &#039;USB1&#039; and &#039;USB2&#039;. </p><p>Of which the USB2 has the connector, while the USB1 is empty.</p><p><strong>Test results</strong><br /></p><div class="codebox"><pre><code>change 1-1 to 1-2

include usb2 kernel module

with usb 2.0 stick the led is on
with usb 1.1 stick the led is off

exclude usb2 kernel module

with usb 2.0 stick the led is on
with usb 1.1 stick the led is on</code></pre></div><p>So, based on the test above, it&#039;s up to the <strong>USB kernel module</strong> whether or not the USB led is on with different USB stick.</p><div class="codebox"><pre><code>keep 1-1 setting

include usb2 kernel module

with usb 2.0 stick the led is off
with usb 1.1 stick the led is off

exclude usb2 kernel module

with usb 2.0 stick the led is off
with usb 1.1 stick the led is off</code></pre></div><p>Also, it&#039;s worth to mention that:</p><p>- USB 1.1 and USB 2.0 sticks both work regardless of &#039;1-1&#039; or &#039;1-2&#039; setting, but the USB led is lit only when set to &#039;1-2&#039;<br />- USB 1.1 stick works even if the usb2 -kernel module is included, but the USB led won&#039;t lit at all<br />- USB 1.1 and USB 2.0 sticks both work even if the usb2 kernel module is excluded</p><br /><p><strong>:: FINAL TEST RESULTS OF NBG-419 v2 ::</strong></p><p>The ImageBuilder does not work. Do not use ImageBuilder at all to create an image for NBG-419N v2.</p><p>Instead of using the ImageBuilder, check-out the code, patch it with Serge&#039;s patch-file, modify the leds -file, configure, and cross-compile the image by yourself.</p><p><strong>!! NOTE !!</strong> At least I was not able to produce a working image with ImageBuilder, even I patched the files.</p><br /><p><strong>... CONCLUSION ...</strong></p><p>OpenWRT BB release works on NBG-419 v2 after patched with Serge&#039;s patch-file, and the value in file &#039;target/linux/ramips/base-files/etc/uci-defaults/01_leds&#039; is changed from &quot;1-1&quot; to &quot;1-2&quot;, and the image is cross-compiled, as at the moment it seems that ImageBuilder can not be used to generate an image for NBG-419 v2.</p><p>Otherwise there are no more issues.<br />So, based on testings, solutions and the workflow, I recommend approving NBG-419 v2 compatible with BB.<br />I&#039;m looking forward to see official builds for NBG-419 v2, as not so many are able to generate images by themselves, and the official builds would have compatibility with OpenWRT official opkg -repositories.</p><br /><p>Thank you all, especially to Serge for your time and passion to this issue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252205">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						27 Oct 2014, 17:02					</div>
				</div>
				<div class="post-content content">
					<p>Just for test check a case when:<br />1. &quot;1-1&quot;<br />2. module usb2<br />3. stick usb 2.0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252238">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						27 Oct 2014, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><div class="quotebox"><blockquote><p>Just for test check a case when:<br />1. &quot;1-1&quot;<br />2. module usb2<br />3. stick usb 2.0</p></blockquote></div><p>The USB led is <strong>off</strong> with the following settings, regardelss of USB 1.1 or USB 2.0 stick:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/system 

config system
        option hostname &#039;OpenWrt&#039;
        option timezone &#039;UTC&#039;

config timeserver &#039;ntp&#039;
        list server &#039;0.openwrt.pool.ntp.org&#039;
        list server &#039;1.openwrt.pool.ntp.org&#039;
        list server &#039;2.openwrt.pool.ntp.org&#039;
        list server &#039;3.openwrt.pool.ntp.org&#039;
        option enabled &#039;1&#039;
        option enable_server &#039;0&#039;

config led &#039;led_usb&#039;
        option name &#039;USB&#039;
        option sysfs &#039;nbg-419n2:green:usb&#039;
        option trigger &#039;usbdev&#039;
        option dev &#039;1-1&#039;
        option interval &#039;50&#039;

config led &#039;led_wifi_led&#039;
        option name &#039;wifi&#039;
        option sysfs &#039;rt2800pci-phy0::radio&#039;
        option trigger &#039;netdev&#039;
        option dev &#039;wlan0&#039;
        option mode &#039;link tx rx&#039;

root@OpenWrt:/# opkg list-installed | grep -i usb
kmod-ledtrig-usbdev - 3.10.49-1
kmod-usb-core - 3.10.49-1
kmod-usb-ohci - 3.10.49-1
kmod-usb-rt305x-dwc_otg - 3.10.49-1
kmod-usb-storage - 3.10.49-1
kmod-usb-storage-extras - 3.10.49-1
kmod-usb-uhci - 3.10.49-1
kmod-usb2 - 3.10.49-1</code></pre></div><p>The build is&nbsp; BARRIER BREAKER (14.07, r42625)</p><p><strong>The setting must be &#039;1-2&#039; on the v2 model.</strong></p><p><strong>!! NOTE !!</strong></p><p>I <strong>think</strong> there&#039;s a bug with the spi. In order to have the r42625 working on v2, you <strong>must</strong> delete file &#039;target/linux/ramips/patches-3.10/0222-rt5350-spi-second-device.patch&#039; !!</p><p>In addition to the file above, you may <strong>also</strong> delete file &#039;target/linux/ramips/patches-3.14/0104-rt5350-spi-second-device.patch&#039; as well. However, I didn&#039;t see any difference.</p><p>I recommend deleting the file(s) immediately after checkout, before patching and cross-compiling.</p><p>I <strong>think</strong> this is the reason why the ImageBuilder does not work.</p><p>I came to this conclusion after some &#039;svn diff&#039;, as i.e. r42056 and r42286 worked straight out of the box. Just &#039;svn co&#039; either of those, patch, and cross-compile. </p><p>i.e. r42475 does not work anymore without deleteing the file(s), as well as r42625.</p><p>Thank you, again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252424">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						29 Oct 2014, 16:20					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d like to see output of commands dmesg and lsmod for case &quot;1-1&quot;, module usb2 and usb2.0 stick.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252452">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						29 Oct 2014, 21:01					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><div class="quotebox"><blockquote><p>I&#039;d like to see output of commands dmesg and lsmod for case &quot;1-1&quot;, module usb2 and usb2.0 stick.</p></blockquote></div><p>The following is printed on console after an USB 2.0 stick is inserted:</p><div class="codebox"><pre><code>[   58.200000] usb 1-2: new high-speed USB device number 2 using ehci-platform
[   58.380000] usb-storage 1-2:1.0: USB Mass Storage device detected
[   58.400000] scsi0 : usb-storage 1-2:1.0
[   59.410000] scsi 0:0:0:0: Direct-Access     JetFlash Transcend 4GB    8.07 PQ: 0 ANSI: 4
[   59.430000] sd 0:0:0:0: Attached scsi generic sg0 type 0
[   59.440000] sd 0:0:0:0: [sda] 7864320 512-byte logical blocks: (4.02 GB/3.75 GiB)
[   59.460000] sd 0:0:0:0: [sda] Write Protect is off
[   59.470000] sd 0:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn&#039;t support DPO or FUA
[   59.500000]  sda: sda1
[   59.520000] sd 0:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p>And the same can be found with &#039;dmesg&#039;:</p><div class="codebox"><pre><code>[   58.200000] usb 1-2: new high-speed USB device number 2 using ehci-platform
[   58.380000] usb 1-2: no of_node; not parsing pinctrl DT
[   58.380000] usb-storage 1-2:1.0: no of_node; not parsing pinctrl DT
[   58.380000] usb-storage 1-2:1.0: USB Mass Storage device detected
[   58.400000] scsi0 : usb-storage 1-2:1.0
[   59.410000] scsi 0:0:0:0: Direct-Access     JetFlash Transcend 4GB    8.07 PQ: 0 ANSI: 4
[   59.430000] sd 0:0:0:0: no of_node; not parsing pinctrl DT
[   59.430000] sd 0:0:0:0: Attached scsi generic sg0 type 0
[   59.440000] sd 0:0:0:0: [sda] 7864320 512-byte logical blocks: (4.02 GB/3.75 GiB)
[   59.460000] sd 0:0:0:0: [sda] Write Protect is off
[   59.470000] sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
[   59.470000] sd 0:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn&#039;t support DPO or FUA
[   59.500000]  sda: sda1
[   59.520000] sd 0:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p>As well as after the USB 2.0 stick is removed:</p><div class="codebox"><pre><code>[  406.820000] usb 1-2: USB disconnect, device number 2</code></pre></div><p>While the modules loaded are: (during the time when the USB 2.0 stick is inserted)</p><div class="codebox"><pre><code>root@OpenWrt:~# lsmod
arc4                    1312  2 
cfg80211              197911  2 rt2x00lib
compat                  2285  3 rt2800soc
crc_ccitt               1019  2 rt2800lib
crc_itu_t               1019  0 
crypto_blkcipher       10375  1 arc4
dwc_otg                61645  0 
eeprom_93cx6            1807  0 
ehci_hcd               29964  1 ehci_platform
ehci_platform           2272  0 
fat                    45167  1 vfat
gpio_button_hotplug     6000  0 
input_core             24281  1 rfkill
ip6_tables              8993  3 ip6table_raw
ip6t_REJECT             2336  2 
ip6table_filter          656  1 
ip6table_mangle         1024  1 
ip6table_raw             576  1 
ip_tables               9165  4 iptable_nat
ipt_MASQUERADE          1136  1 
ipt_REJECT              1776  2 
iptable_filter           720  1 
iptable_mangle           928  1 
iptable_nat             1680  1 
iptable_raw              640  1 
ipv6                  238854 32 ip6t_REJECT
leds_gpio               2944  0 
ledtrig_gpio            2048  0 
ledtrig_usbdev          1952  0 
mac80211              345713  3 rt2800lib
mmc_block              20593  0 
mmc_core               69530  2 mmc_block
nf_conntrack           44779 13 iptable_nat
nf_conntrack_ftp        5136  1 nf_nat_ftp
nf_conntrack_ipv4       4676  8 
nf_conntrack_ipv6       4976  3 
nf_conntrack_irc        2784  1 nf_nat_irc
nf_defrag_ipv4           758  1 nf_conntrack_ipv4
nf_defrag_ipv6          8695  1 nf_conntrack_ipv6
nf_nat                  9759  7 iptable_nat
nf_nat_ftp              1216  0 
nf_nat_ipv4             2526  1 iptable_nat
nf_nat_irc              1008  0 
nls_base                5006  7 vfat
nls_cp437               4432  0 
nls_iso8859_1           2896  0 
nls_iso8859_15          3408  0 
nls_utf8                 864  0 
ohci_hcd               13360  0 
ppp_async               6176  0 
ppp_generic            19650  3 pppoe
pppoe                   7744  0 
pppox                   1338  1 pppoe
rfkill                 11874  0 
rt2800lib              91409  2 rt2800soc
rt2800mmio              6338  1 rt2800soc
rt2800soc               2480  0 
rt2x00lib              34095  5 rt2800soc
rt2x00mmio              1952  2 rt2800soc
rt2x00soc               1218  1 rt2800soc
scsi_mod               76898  4 ums_cypress
sd_mod                 25168  0 
sdhci                  17250  1 sdhci_pltfm
sdhci_pltfm             2866  0 
sg                     19120  0 
slhc                    4347  1 ppp_generic
tun                    14511  0 
ums_alauda              8288  0 
ums_cypress             2256  0 
ums_datafab             4688  0 
ums_freecom             1952  0 
ums_isd200              4976  0 
ums_jumpshot            3632  0 
ums_karma               1536  0 
ums_sddr09              8752  0 
ums_sddr55              4832  0 
ums_usbat               7344  0 
usb_common              1160  1 usbcore
usb_storage            35976 10 ums_usbat
usbcore               106727 16 ums_usbat
vfat                    7808  0 
x_tables               10997 26 ipt_MASQUERADE
xt_CT                   2272  0 
xt_LOG                  9552  0 
xt_REDIRECT             1056  0 
xt_TCPMSS               2704  2 
xt_comment               480 53 
xt_conntrack            2144 10 
xt_id                    480  0 
xt_limit                 992 20 
xt_mac                   608  0 
xt_mark                  672  0 
xt_multiport            1200  0 
xt_nat                  1072  0 
xt_state                 688  0 
xt_tcpudp               1712  8 
xt_time                 1664  0 </code></pre></div><p>And, during the boot, the following is displayed on console:</p><div class="codebox"><pre><code>[    6.350000] ohci-platform 101c1000.ohci: irq 26, io mem 0x101c1000
[    6.420000] hub 2-0:1.0: USB hub found
[    6.430000] hub 2-0:1.0: 2 ports detected
[    6.450000] dwc_otg: version 2.72a 24-JUN-2008
[    6.460000] leds-gpio gpio-leds.4: pins are not configured from the driver</code></pre></div><p>The settings are still the same:</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/system 

config system
    option hostname &#039;OpenWrt&#039;
    option timezone &#039;UTC&#039;

config timeserver &#039;ntp&#039;
    list server &#039;0.openwrt.pool.ntp.org&#039;
    list server &#039;1.openwrt.pool.ntp.org&#039;
    list server &#039;2.openwrt.pool.ntp.org&#039;
    list server &#039;3.openwrt.pool.ntp.org&#039;
    option enabled &#039;1&#039;
    option enable_server &#039;0&#039;

config led &#039;led_usb&#039;
    option name &#039;USB&#039;
    option sysfs &#039;nbg-419n2:green:usb&#039;
    option trigger &#039;usbdev&#039;
    option dev &#039;1-1&#039;
    option interval &#039;50&#039;

config led &#039;led_wifi_led&#039;
    option name &#039;wifi&#039;
    option sysfs &#039;rt2800pci-phy0::radio&#039;
    option trigger &#039;netdev&#039;
    option dev &#039;wlan0&#039;
    option mode &#039;link tx rx&#039;

root@OpenWrt:~# opkg list-installed | grep -i usb
kmod-ledtrig-usbdev - 3.10.49-1
kmod-usb-core - 3.10.49-1
kmod-usb-ohci - 3.10.49-1
kmod-usb-rt305x-dwc_otg - 3.10.49-1
kmod-usb-storage - 3.10.49-1
kmod-usb-storage-extras - 3.10.49-1
kmod-usb-uhci - 3.10.49-1
kmod-usb2 - 3.10.49-1
root@OpenWrt:~# </code></pre></div><p>I hope this helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275033">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">digital0</div>
					<div class="post-datetime">
						3 May 2015, 23:34					</div>
				</div>
				<div class="post-content content">
					<p>Hello guys,</p><p>have you finished testing? Are the patches sent to the developers?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p294625">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">M3m3nt0</div>
					<div class="post-datetime">
						4 Oct 2015, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys!</p><p>Great work you two, <strong>123serge123</strong> and <strong>jama</strong>, have made!</p><p>I&#039;m trying to update informations on the wiki; would you like to contribute? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /><a href="http://wiki.openwrt.org/toh/hwdata/zyxel/zyxel_nbg-419n_v2">http://wiki.openwrt.org/toh/hwdata/zyxe … bg-419n_v2</a><br /><a href="http://wiki.openwrt.org/toh/zyxel/zyxel_nbg-419n_v2">http://wiki.openwrt.org/toh/zyxel/zyxel_nbg-419n_v2</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315745">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">jonojen</div>
					<div class="post-datetime">
						19 Mar 2016, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;m would like to try to build for nbg-419n_v2.<br />Can I find the patch file you created somewhere or could you share it sarge?<br />Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315809">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						20 Mar 2016, 11:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jonojen wrote:</cite><blockquote><p>Hi,<br />I&#039;m would like to try to build for nbg-419n_v2.<br />Can I find the patch file you created somewhere or could you share it sarge?<br />Regards</p></blockquote></div><p>Patch for BB 14.07 you can find <a href="https://yadi.sk/d/1ZV0lKJwbTE65">https://yadi.sk/d/1ZV0lKJwbTE65</a>. For CC 15.05 need some changes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315870">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">jonojen</div>
					<div class="post-datetime">
						20 Mar 2016, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>Great thanks !!!<br />Would have taken a beginner like me ages to get there if ever.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316120">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						22 Mar 2016, 16:07					</div>
				</div>
				<div class="post-content content">
					<p>Beginner can start from <a href="https://wiki.openwrt.org">https://wiki.openwrt.org</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318030">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">jonojen</div>
					<div class="post-datetime">
						3 Apr 2016, 21:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Seems to work great with 15.05 as well with some small change to your patch file for 14.07 (see below).</p><p>I have compiled and run the code on the router and tested lan port and wifi so far. USB port and led not tested yet. My spare time is consumed by the kids...</p><div class="codebox"><pre><code>jon@owrt:~/openwrt_15_05$ diff ../openwrt_14_07/sarge/bb-final-ramips-add-zyxel-nbg-419n2.patch add-nbg-419n2_on_15_manual.patch 
43,44c43,44
&lt; --- target/linux/ramips/base-files/etc/uci-defaults/01_leds    (revision 42702)
&lt; +++ target/linux/ramips/base-files/etc/uci-defaults/01_leds    (working copy)
---
&gt; --- target/linux/ramips/base-files/etc/board.d/01_leds
&gt; +++ target/linux/ramips/base-files/etc/board.d/01_leds    (working copy)
jon@owrt:~/openwrt_15_05$ </code></pre></div><p>Thanks again!</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=52666&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=52666&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>